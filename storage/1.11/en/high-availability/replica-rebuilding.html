<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Replica Rebuilding :: Rancher product documentation</title>
    <link rel="prev" href="automatic-replica-balancing.html">
    <link rel="next" href="fast-replica-rebuilding.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-08-19"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/storage/1.11/en/high-availability/replica-rebuilding.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/storage/1.11/en/high-availability/replica-rebuilding.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="storage" data-version="1.11">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Storage</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../longhorn-documentation.html">SUSE® Storage Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../introduction/introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/concepts.html">Architecture and Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/document-conventions.html">Document Conventions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../important-notes.html">Important Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation and Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/best-practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../installation-setup/installation/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-argocd.html">Install SUSE Storage Using ArgoCD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-fleet.html">Install SUSE Storage Using Fleet</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-flux.html">Install SUSE® Storage Using Flux</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-helm.html">Install SUSE Storage Using Helm</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-helm-controller.html">Install SUSE Storage Using Helm Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/helm-values.html">Helm Values</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-kubectl.html">Install SUSE Storage Using Kubectl</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-rancher.html">Install SUSE Storage Using Rancher</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/rancher-windows-cluster.html">Rancher Windows Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/airgapped-environment.html">Install SUSE Storage in an Air-Gapped Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Operating System and Distribution Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/container-optimized-os.html">Container-Optimized OS (COS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/gke.html">Google Kubernetes Engine (GKE)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/k3s.html">K3s</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/ocp-okd.html">Red Hat OpenShift Container Platform and OKD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/rke-coreos.html">RKE and CoreOS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/talos-linux.html">Talos Linux</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/setup-performance-scalability-sizing-guidelines.html">Setup, Performance, Scalability, and Sizing Guidelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/uninstallation.html">Uninstallation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">Upgrades</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Component Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/auto-upgrade-engine.html">Automatically Upgrade the Longhorn Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/manually-upgrade-engine.html">Manually Upgrade the Longhorn Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/upgrade-longhorn-manager.html">Upgrade Longhorn Manager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Kubernetes Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-aks.html">Upgrade Kubernetes on Azure Kubernetes Service (AKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-eks.html">Upgrade Kubernetes on Amazon Elastic Kubernetes Service (Amazon EKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-gke.html">Upgrade Kubernetes on Google Kubernetes Engine (GKE)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">SUSE® Storage System</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/system-access/system-access.html">System Access</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-ui.html">Access the User Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/create-ingress.html">Create an Ingress with Basic Authentication (nginx)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-cli.html">Command Line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/install-longhorn-cli.html">Install the CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-python-client.html">Python Client</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/networking/networking.html">Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/networking/storage-network.html">Storage Network</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/mtls-support.html">Mutual TLS (mTLS) Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/customize-default-settings.html">Customize Default Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/settings.html">Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">V2 Data Engine (Preview Feature)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/features.html">V2 Data Engine Features</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/selective-engine-activation.html">Selective V2 Data Engine Activation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/ublk-frontend-support.html">UBLK Frontend Support</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/node-disk-support.html">Node Disk Support</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/replica-rebuild-qos.html">Replica Rebuild QoS</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/interrupt-mode.html">Interrupt Mode</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/volume-expansion.html">Volume Expansion</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/volume-clone.html">Volume Clone</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/quick-start-guide.html">Quick Start Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/performance.html">Performance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/examples-resources.html">Examples of Kubernetes Resources that Use SUSE® Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/migrate-flexvolume.html">Migrate from the Flexvolume Driver to CSI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Nodes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-space-usage.html">Node Space Usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/default-disk-and-node-config.html">Configure Default Node and Disk Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/storage-tags.html">Storage Tags</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/multiple-disks.html">Multiple Disks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/disks-or-nodes-eviction.html">Evicting Replicas on Disabled Disks or Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/scheduling.html">Scheduling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-conditions.html">Node Conditions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-selector.html">Node Selector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/taints-tolerations.html">Taints and Tolerations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/priority-class.html">Priority Class</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Managed Kubernetes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/aks-managed-node-groups.html">Managed Node Groups on Azure Kubernetes Service (AKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/eks-managed-node-pools.html">Managed Node Pools on Amazon Elastic Kubernetes Service (Amazon EKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/gke-managed-node-pools.html">Managed Node Pools on Google Kubernetes Engine (GKE)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Volumes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/create-volumes.html">Create Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/pvc-ownership-and-permission.html">PVC Ownership and Permission</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/rwx-volumes.html">ReadWriteMany (RWX) Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/clone-volumes.html">Clone Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/detach-volumes.html">Detach Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/delete-volumes.html">Delete Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/use-as-iscsi-target.html">Use a Volume as an iSCSI Target</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/identify-workloads.html">Identify Workloads that Use a Volume</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-size.html">Volume Size</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-expansion.html">Volume Expansion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-attachment.html">SUSE Storage VolumeAttachment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/trim-filesystem.html">Trim the Filesystem</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-conditions.html">Volume Conditions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-encryption.html">Volume Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/storageclass-parameters.html">StorageClass Parameters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../volumes/backing-images/backing-images.html">Backing Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../volumes/backing-images/backing-image-encryption.html">Backing Image Encryption</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">High Availability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="automatic-replica-balancing.html">Automatic Replica Balancing</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="replica-rebuilding.html">Replica Rebuilding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fast-replica-rebuilding.html">Fast Replica Rebuilding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="offline-replica-rebuilding.html">Offline Replica Rebuilding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="revision_counter.html">Revision Counter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="data-locality.html">Data Locality</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kubernetes-cluster-autoscaler.html">Kubernetes Cluster Autoscaler Support (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rwx-volume-fast-failover.html">RWX Volume Fast Failover (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="volume-recovery.html">Volume Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="node-failure.html">Node Failure Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Snapshots and Backups</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/volume-snapshots-backups.html">Volume Snapshots and Backups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-snapshot.html">Create a Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/snapshot-space-management.html">Snapshot Space Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/configure-backup-target.html">Configure a Backup Target</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-backup.html">Create a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/sync-backup-volumes-manually.html">Manually Synchronize Backup Volumes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-recurring-backup-snapshot-job.html">Create a Recurring Snapshot or Backup Job</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-volume-from-backup.html">Restore a Volume from a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-recurring-job-from-backup.html">Restore a Recurring Job from a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-volume-statefulset.html">Restore a Volume for a Kubernetes StatefulSet</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshots.html">CSI Snapshots</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-backing-image.html">CSI Volume Snapshot Associated with a SUSE® Storage Backing Image</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-backup.html">CSI Volume Snapshot Associated with a SUSE® Storage Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-snapshot.html">CSI Volume Snapshot Associated with a SUSE® Storage Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/enable-csi-snapshot-creation.html">Enable CSI Snapshot Creation on a Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/system-backups/system-backups.html">SUSE® Storage System Backups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-to-cluster-using-rancher-snapshot.html">Restore the SUSE® Storage System to a Cluster Using a Rancher Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-to-new-cluster-using-velero.html">Restore the SUSE® Storage System to a New Cluster Using Velero</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/create-system-backup.html">Create a SUSE Storage System Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-system.html">Restore the SUSE® Storage System</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../snapshots-backups/backing-image-backups.html">Backing Image Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../snapshots-backups/restore-cluster-rancher-snapshot.html">Restore a Cluster Using a Rancher Snapshot</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Data Integrity and Recovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/snapshot-data-integrity-check.html">Snapshot Data Integrity Check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/orphaned-data-cleanup.html">Orphaned Data Cleanup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/orphaned-instance-cleanup.html">Orphaned Instance Cleanup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/disaster-recovery-volumes.html">Disaster Recovery Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Data Recovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/identify-corrupted-replicas.html">Identify Corrupted Replicas</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/retrieve-volume-data-from-replica.html">Retrieve Volume Data from a Single Replica</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-from-data-errors.html">Identify and Recover from Data Errors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-from-full-disk.html">Recover from a Full Disk</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-without-system.html">Recover from a SUSE® Storage Backup without the System Installed</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Observability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/configure-prometheus-grafana.html">Configure Prometheus and Grafana to Monitor SUSE® Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/alert-rule-examples.html">Alert Rule Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/longhorn-metrics.html">SUSE® Storage Metrics for Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/integrate-with-rancher-monitoring.html">Integrate SUSE® Storage Metrics into the Rancher Monitoring System</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/kubelet-volume-metrics.html">Kubelet Volume Metrics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting and Maintenance</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/support-bundle.html">Support Bundle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/troubleshooting.html">Troubleshooting Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/v2-data-engine-issues.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/maintenance.html">Node Maintenance and Kubernetes Upgrade Guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Storage</span>
    <span class="version">1.11 (Dev)</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../../latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version is-current">
              <a href="../longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/storage" title="SUSE Storage" aria-label="SUSE Documentation - SUSE Storage">
        SUSE Storage
      </a>
    </li>
      <li>
          High Availability
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.11 (Dev)</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../../latest/en/longhorn-documentation.html">Latest</a>
    <a class="version is-current" href="replica-rebuilding.html">1.11 (Dev)</a>
    <a class="version" href="../../../1.10/en/high-availability/replica-rebuilding.html">1.10 (Dev)</a>
    <a class="version is-missing" href="../../../1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
    <a class="version is-missing" href="../../../1.8/en/longhorn-documentation.html">1.8</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/longhorn-product-docs/edit/main/docs/version-1.11/modules/en/pages/high-availability/replica-rebuilding.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:storage" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is unreleased documentation for SUSE® Storage 1.11 (Dev).</p>
</div>
</td>
</tr>
</table>
</div>
<h1 class="page">Replica Rebuilding</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When SUSE Storage detects a failed or deleted replica, it automatically initiates a rebuilding process. This document outlines the replica rebuilding workflow for v1 data engine, including <strong>full</strong>, <strong>delta</strong>, and <strong>fast</strong> rebuilding methods. It also explains the limitations associated with each method.</p>
</div>
<div class="paragraph">
<p><strong>Rebuilding will not start in the following scenarios</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The volume is migrating to another node.</p>
</li>
<li>
<p>The volume is an old restore/DR volume.</p>
</li>
<li>
<p>The volume is expanding in size.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_replica_rebuilding_workflow"><a class="anchor" href="#_replica_rebuilding_workflow"></a>Replica Rebuilding Workflow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replica rebuilding may occur in the following scenarios for the v1 data engine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A node is rebooted, drained, or evicted.</p>
</li>
<li>
<p>A replica becomes unhealthy or is deleted.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/diagrams/architecture/replica-rebuilding-flow.png" alt="Image">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mark the target replica with <code>WO</code> (write-only) mode.</p>
</li>
<li>
<p>Create a new snapshot to serve as the volume head reference point for data integrity checks.</p>
</li>
<li>
<p>Generate the synchronization file list for the volume head and snapshot files.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_for_v1_data_engine"><a class="anchor" href="#_for_v1_data_engine"></a>For V1 Data Engine</h3>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Start a receiver server on the target replica for each snapshot.</p>
</li>
<li>
<p>Instruct the source replica to begin data synchronization.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For each snapshot:</p>
<div class="ulist">
<ul>
<li>
<p>Check if the snapshot file exists in the data directory of the target replica.</p>
<div class="ulist">
<ul>
<li>
<p>If <em>no</em>, transfer the entire snapshot data from the source replica to the target replica.
See <a href="#_full_replica_rebuilding">Full Replica Rebuilding</a>.</p>
</li>
<li>
<p>If <em>yes</em>, check whether the snapshot checksum files exist, and whether the modification time and checksums are identical between the target and source replicas.</p>
<div class="ulist">
<ul>
<li>
<p>If <em>yes</em>, SUSE Storage skips transferring the data of the snapshot. This optimization reduces CPU usage, disk I/O, network I/O, and total rebuild time. See <a href="#_fast_replica_rebuilding">Fast Replica Rebuilding</a>.</p>
</li>
<li>
<p>If <em>no</em>, SUSE Storage calculates and compares block-level checksums using the SHA-512 algorithm. If mismatches are found, only the differing blocks are synchronized.
See <a href="#_delta_replica_rebuilding">Delta Replica Rebuilding</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_for_v2_data_engine"><a class="anchor" href="#_for_v2_data_engine"></a>For V2 Data Engine</h3>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Expose the source and target replicas and prepare a shallow copy using the SPDK engine.</p>
</li>
<li>
<p>For each snapshot:</p>
<div class="ulist">
<ul>
<li>
<p>Check if the snapshot timestamp, actual size, and checksum match between the source and target.</p>
<div class="ulist">
<ul>
<li>
<p>If <em>yes</em>, SUSE Storage skips transferring the data of that snapshot.</p>
</li>
<li>
<p>If <em>no</em>, check whether both the source and target snapshots contain ranged checksums.</p>
<div class="ulist">
<ul>
<li>
<p>If <em>yes</em>, fetch and compare the range checksums. If mismatches exist, only the mismatched ranges are copied.
See <a href="#_fast_replica_rebuilding">Fast Replica Rebuilding</a>.</p>
</li>
<li>
<p>If <em>no</em>, delete the existing target snapshot. Then, copy the entire snapshot from the source replica to the target replica.
See <a href="#_full_replica_rebuilding">Full Replica Rebuilding</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_full_replica_rebuilding"><a class="anchor" href="#_full_replica_rebuilding"></a>Full Replica Rebuilding</h3>
<div class="paragraph">
<p>If the replica is unrecoverable or has no existing data, SUSE Storage synchronizes all data from a healthy replica. It reconstructs the replica by transferring the full snapshot chain.</p>
</div>
<div class="paragraph">
<p>Full replica rebuilding consumes significant network bandwidth and results in heavy disk write operations on the target node. However, it is required when the target replica has no usable data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_delta_replica_rebuilding"><a class="anchor" href="#_delta_replica_rebuilding"></a>Delta Replica Rebuilding</h3>
<div class="paragraph">
<p>Delta replica rebuilding is only for v1 data engine. It starts with a reusable failed replica, and it checks the data integrity for all snapshots' data block by block.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is available for failed replica reuse only, and there is an existing snapshot file (with the same name) in the failed replica data directory</p>
</li>
<li>
<p>When a snapshot has no checksum, SUSE Storage performs delta replica rebuilding for this snapshot instead.</p>
</li>
<li>
<p><strong>Pros</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Reduce network bandwidth consumption.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Cons</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Increased CPU overhead because SUSE Storage will compute the checksum of the snapshot data block by block for data integrity check.</p>
</li>
<li>
<p>Rebuilding time is influenced by CPU performance.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_fast_replica_rebuilding"><a class="anchor" href="#_fast_replica_rebuilding"></a>Fast Replica Rebuilding</h3>
<div class="paragraph">
<p>Fast replica rebuilding is enabled when the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The fast replica rebuild setting is enabled:</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>fast-replica-rebuild-enabled: true</code></p>
</div>
</div>
</div>
</li>
<li>
<p>Snapshot checksum files are created (checksums are precomputed) using one of the following methods:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>snapshot-data-integrity</code> is set to <code>enabled</code>:
A scheduled job calculates checksums for all snapshots at a configured interval (default: 7 days).</p>
</li>
<li>
<p><code>snapshot-data-integrity-immediate-check-after-snapshot-creation</code> is set to <code>true</code>:
The snapshot checksum is calculated immediately after snapshot creation.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These checksum calculations consume storage and computing resources.
The calculation time is unpredictable and may negatively impact storage performance.
For more information, see <a href="../data-integrity-recovery/snapshot-data-integrity-check.html" class="xref page">Snapshot Data Integrity</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Pros</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Minimizes network bandwidth consumption.</p>
</li>
<li>
<p>Minimizes disk I/O.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Cons</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Calculating snapshot checksums can be time-consuming.</p>
</li>
<li>
<p>The timing of checksum calculation is unpredictable. It may trigger even under high I/O load.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="fast-replica-rebuilding.html" class="xref page">Fast Replica Rebuilding</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_factors_that_affect_rebuilding_performance"><a class="anchor" href="#_factors_that_affect_rebuilding_performance"></a>Factors That Affect Rebuilding Performance</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Large volume head</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Why it matters</strong>:
The volume head is a special file that never has a precomputed checksum.
If a replica fails, SUSE Storage must always synchronize the entire volume head.
A larger volume head increases rebuild time.</p>
</li>
<li>
<p><strong>How to prevent</strong>:
Take snapshots regularly to reduce the volume head&#8217;s size.
Schedule snapshots before planned maintenance to minimize rebuild time.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>No snapshots exist</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Why it matters</strong>:
Without snapshots, SUSE Storage cannot skip data transfer or reuse existing data.
If a volume head snapshot is created but its checksum isn&#8217;t ready, SUSE Storage must perform delta rebuilding.
This increases CPU usage due to block-by-block checksum comparisons.</p>
</li>
<li>
<p><strong>How to prevent</strong>:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable <code>snapshot-data-integrity-immediate-check-after-snapshot-creation</code> or <code>snapshot-data-integrity</code> to precompute checksums.
<strong>Trade-off:</strong> Increases CPU, disk I/O, and storage usage during computation.</p>
</li>
<li>
<p>Use a recurring job to create snapshots regularly.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Snapshot purged</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Why it matters</strong>:
When snapshot purging starts, system-generated snapshots are coalesced into the next snapshot.
This invalidates the checksum of next snapshot.</p>
</li>
<li>
<p><strong>How to prevent</strong>:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable <code>snapshot-data-integrity-immediate-check-after-snapshot-creation</code> to ensure checksums are computed after purging.</p>
</li>
<li>
<p>Proactively create a snapshot and allow time for checksum generation before performing upgrades or rebuilds.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Concurrent rebuilds</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Why it matters</strong>:
Running multiple rebuilds on the same node can overuse CPU, disk input-output, and network input-output, impacting performance.</p>
</li>
<li>
<p><strong>How to prevent</strong>:
Tune the number of concurrent rebuilds using the <code>concurrent-replica-rebuild-per-node-limit</code> setting.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Multiple replica failures</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Why it matters</strong>:
Increases rebuild time and complexity.
If <code>auto-cleanup-system-generated-snapshot</code> is <code>true</code> and no user-created snapshots exist, two failed replicas may trigger at least one full data transfer.</p>
<div class="paragraph">
<p>For more details, see <a href="https://github.com/longhorn/longhorn/issues/9335">Avoid "full data transfer" when rebuilding two failed replicas</a>.</p>
</div>
</li>
<li>
<p><strong>How to prevent</strong>:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable <code>auto-cleanup-system-generated-snapshot</code> before performing maintenance.</p>
</li>
<li>
<p>Create user snapshots of all volumes before starting maintenance.</p>
</li>
<li>
<p>Use a recurring job to take snapshots regularly.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_cases"><a class="anchor" href="#_use_cases"></a>Use Cases</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_node_reboot_during_upgrade"><a class="anchor" href="#_node_reboot_during_upgrade"></a>Node Reboot During Upgrade</h3>
<div class="paragraph">
<p>When a worker node with replicas is rebooted as part of a planned upgrade:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The replica on that node becomes temporarily unavailable and fails, but read and write operations continue.</p>
</li>
<li>
<p>If the node recovers within the <code>replica-replenishment-wait-interval</code>, SUSE Storage initiates a rebuild using the reusable failed replica.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>During the rebuilding process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SUSE Storage selects the latest reusable failed replica if multiple reusable failed replicas are available.</p>
</li>
<li>
<p>Based on the rebuild scenario:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>If fast replica rebuilding is enabled and all snapshot checksums exist</strong>:
SUSE Storage triggers <a href="#_fast_replica_rebuilding">Fast Replica Rebuilding</a>.
Only changed blocks in the volume head are synced, avoiding both full and delta rebuilding.</p>
</li>
<li>
<p><strong>If fast replica rebuilding is enabled but some snapshot checksums are missing</strong>:
SUSE Storage triggers <a href="#_delta_replica_rebuilding">Delta Replica Rebuilding</a>.
Changed blocks from snapshots without checksums are synced, avoiding full rebuilding.</p>
</li>
<li>
<p><strong>If fast replica rebuilding is disabled</strong>:
SUSE Storage performs delta rebuilding by syncing changed blocks of <strong>all</strong> snapshots, avoiding full rebuilding.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_short_term_node_drain"><a class="anchor" href="#_short_term_node_drain"></a>Short-Term Node Drain</h3>
<div class="paragraph">
<p>If a worker node is drained for short-term maintenance and then quickly restored:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The replica on the drained node is marked as failed immediately.</p>
</li>
<li>
<p>If the node is uncordoned before the <code>replica-replenishment-wait-interval</code> expires, SUSE Storage attempts to reuse the failed replica.</p>
</li>
<li>
<p>Rebuild behavior follows the same logic as described in the previous use case.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relevant_settings"><a class="anchor" href="#_relevant_settings"></a>Relevant Settings</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fast-replica-rebuild-enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables fast replica rebuilding. Relies on precomputed snapshot checksums.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../data-integrity-recovery/snapshot-data-integrity-check.html" class="xref page">snapshot-data-integrity</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fast-check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hashes snapshot disk files only if they are unhashed or their modification time has changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>snapshot-data-integrity-cronjob</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0 0 */7 * *</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cron schedule to compute checksums for all snapshots. Default: every 7 days.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>snapshot-data-integrity-immediate-check-after-snapshot-creation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, computes checksums immediately after snapshot creation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replica-replenishment-wait-interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in seconds to wait before creating a new replica. Allows reuse of failed replicas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>concurrent-replica-rebuild-per-node-limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limits the number of concurrent replica rebuilds per node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offline-replica-rebuilding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines whether degraded replicas are rebuilt while the volume is detached.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_settings_trade_off_analysis"><a class="anchor" href="#_settings_trade_off_analysis"></a>Settings Trade-Off Analysis</h3>
<div class="ulist">
<ul>
<li>
<p><a href="../longhorn-system/settings.html#_fast_replica_rebuild_enabled" class="xref page">fast-replica-rebuild-enabled</a></p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>:
Skips snapshot data transfer if checksums are current. Provides fast rebuilds but doesn&#8217;t revalidate data.</p>
</li>
<li>
<p><code>disabled</code>:
Performs delta rebuilding using block comparisons. Slower, but ensures snapshot data integrity.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p><a href="../data-integrity-recovery/snapshot-data-integrity-check.html" class="xref page">snapshot-data-integrity</a></p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>:
By default, calculates snapshot checksums every 7 days. Increases CPU, disk I/O, and resource usage.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p><a href="../longhorn-system/settings.html#_snapshot_data_integrity_check_cronjob" class="xref page">snapshot-data-integrity-cronjob</a></p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Default: <code>0 0 */7 * *</code></p>
<div class="paragraph">
<p>If <code>snapshot-data-integrity</code> is enabled, this defines when snapshot checksums are recalculated. Snapshots created between cron runs may lack checksums.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p><a href="../longhorn-system/settings.html#_immediate_snapshot_data_integrity_check_after_creating_a_snapshot" class="xref page">snapshot-data-integrity-immediate-check-after-snapshot-creation</a></p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>true</code>:
Immediately computes snapshot checksums after creation. Increases CPU and disk I/O usage. Completion time is unpredictable.</p>
</li>
<li>
<p><code>false</code>:
Snapshots may not have checksums until the next cron run. Delta rebuilding will be required if checksums are missing.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p><a href="../longhorn-system/settings.html#_replica_replenishment_wait_interval" class="xref page">replica-replenishment-wait-interval</a></p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Default: <code>600</code> seconds</p>
<div class="ulist">
<ul>
<li>
<p><strong>Short interval</strong>:
May skip reusing failed replicas and trigger full rebuilds.</p>
</li>
<li>
<p><strong>Long interval</strong>:
Waits longer to reuse failed replicas but may delay recovery.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p><a href="../longhorn-system/settings.html#_concurrent_replica_rebuild_per_node_limit" class="xref page">concurrent-replica-rebuild-per-node-limit</a></p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Default: <code>5</code></p>
<div class="ulist">
<ul>
<li>
<p><strong>High limit</strong>:
May overload node resources, slowing down rebuilds and active workloads.</p>
</li>
<li>
<p><strong>Low limit</strong>:
Reduces resource contention but increases rebuild time due to queueing.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="automatic-replica-balancing.html">Automatic Replica Balancing</a></span>
  <span class="next"><a href="fast-replica-rebuilding.html">Fast Replica Rebuilding</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
