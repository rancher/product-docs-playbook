<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>Architecture and Concepts | SUSE® Storage  1.8</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/storage/1.10/en/introduction/concepts.html">
    <link rel="prev" href="introduction.html">
    <link rel="next" href="terminology.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-08-22"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>
<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/assets");
</script>
<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/storage/1.8/en/introduction/concepts.html" hreflang="x-default" rel="alternate"/>
<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/storage/1.8/en/introduction/concepts.html" hrefLang="en-US" rel="alternate" />

<!-- JSON-LD for doc metadata -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "name": "Architecture and Concepts | SUSE Storage 1.8",
  "headline": "Architecture and Concepts",
  "description": "Architecture and Concepts",
  "inLanguage": "en",
  "dateModified": "2025-08-22T00:00:00Z",
  "author": {
    "@type": "Organization",
    "name": "SUSE Product & Solution Documentation Team",
    "url": "https://documentation.suse.com"
  },
  "mentions": [
    {
      "@type": "SoftwareApplication",
      "name": "SUSE Storage",
      "softwareVersion": "1.8",
      "applicationCategory": "Cloud Infrastructure",
      "operatingSystem": "Linux"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "SUSE",
    "url": "https://documentation.suse.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
    }
  }
}
</script>
<!-- end JSON-LD for doc metadata -->
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><shared-header
language="en"
languages='{
    "en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
    "de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
    "fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
    "es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
    "zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
    "pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'
enable-search='false'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="storage" data-version="1.8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Storage</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../longhorn-documentation.html">SUSE® Storage Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="concepts.html">Architecture and Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="document-conventions.html">Document Conventions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../important-notes.html">Important Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation and Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/best-practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../installation-setup/installation/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-argocd.html">Install SUSE Storage Using ArgoCD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-fleet.html">Install SUSE Storage Using Fleet</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-flux.html">Install SUSE® Storage Using Flux</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-helm.html">Install SUSE Storage Using Helm</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-helm-controller.html">Install SUSE Storage Using Helm Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/helm-values.html">Helm Values</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-kubectl.html">Install SUSE Storage Using Kubectl</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-rancher.html">Install SUSE Storage Using Rancher</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/rancher-windows-cluster.html">Rancher Windows Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/airgapped-environment.html">Install SUSE Storage in an Air-Gapped Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Operating System and Distribution Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/gke.html">Google Kubernetes Engine (GKE)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/k3s.html">K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/setup-performance-scalability-sizing-guidelines.html">Setup, Performance, Scalability, and Sizing Guidelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/uninstallation.html">Uninstallation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">Upgrades</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Component Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/auto-upgrade-engine.html">Automatically Upgrade the Longhorn Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/manually-upgrade-engine.html">Manually Upgrade the Longhorn Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/upgrade-longhorn-manager.html">Upgrade Longhorn Manager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Kubernetes Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-aks.html">Upgrade Kubernetes on Azure Kubernetes Service (AKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-eks.html">Upgrade Kubernetes on Amazon Elastic Kubernetes Service (Amazon EKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-gke.html">Upgrade Kubernetes on Google Kubernetes Engine (GKE)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">SUSE® Storage System</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/system-access/system-access.html">System Access</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-ui.html">Access the User Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/create-ingress.html">Create an Ingress with Basic Authentication (nginx)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-cli.html">Command Line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/install-longhorn-cli.html">Install the CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-python-client.html">Python Client</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/networking/networking.html">Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/networking/storage-network.html">Storage Network</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/mtls-support.html">Mutual TLS (mTLS) Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/customize-default-settings.html">Customize Default Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/settings.html">Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">V2 Data Engine (Experimental)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/v2-data-engine.html">V2 Data Engine (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/features.html">V2 Data Engine Features</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/selective-engine-activation.html">Selective V2 Data Engine Activation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/node-disk-support.html">Node Disk Support</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/configurable-cpu-cores.html">Configurable CPU Cores</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/quick-start-guide.html">Quick Start Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/performance.html">Performance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/examples-resources.html">Examples of Kubernetes Resources that Use SUSE® Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/migrate-flexvolume.html">Migrate from the Flexvolume Driver to CSI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Nodes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-space-usage.html">Node Space Usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/default-disk-and-node-config.html">Configure Default Node and Disk Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/storage-tags.html">Storage Tags</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/multiple-disks.html">Multiple Disks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/disks-or-nodes-eviction.html">Evicting Replicas on Disabled Disks or Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/scheduling.html">Scheduling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-conditions.html">Node Conditions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-selector.html">Node Selector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/taints-tolerations.html">Taints and Tolerations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/priority-class.html">Priority Class</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Managed Kubernetes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/aks-managed-node-groups.html">Managed Node Groups on Azure Kubernetes Service (AKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/eks-managed-node-pools.html">Managed Node Pools on Amazon Elastic Kubernetes Service (Amazon EKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/gke-managed-node-pools.html">Managed Node Pools on Google Kubernetes Engine (GKE)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Volumes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/create-volumes.html">Create Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/pvc-ownership-and-permission.html">PVC Ownership and Permission</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/rwx-volumes.html">ReadWriteMany (RWX) Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/clone-volumes.html">Clone Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/detach-volumes.html">Detach Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/delete-volumes.html">Delete Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/use-as-iscsi-target.html">Use a Volume as an iSCSI Target</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/identify-workloads.html">Identify Workloads that Use a Volume</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-size.html">Volume Size</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-expansion.html">Volume Expansion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-attachment.html">SUSE Storage VolumeAttachment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/trim-filesystem.html">Trim the Filesystem</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-conditions.html">Volume Conditions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-encryption.html">Volume Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/storageclass-parameters.html">StorageClass Parameters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../volumes/backing-images/backing-images.html">Backing Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../volumes/backing-images/backing-image-encryption.html">Backing Image Encryption</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">High Availability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/automatic-replica-balancing.html">Automatic Replica Balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/fast-replica-rebuilding.html">Fast Replica Rebuilding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/revision_counter.html">Revision Counter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/data-locality.html">Data Locality</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/kubernetes-cluster-autoscaler.html">Kubernetes Cluster Autoscaler Support (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/rwx-volume-fast-failover.html">RWX Volume Fast Failover (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/volume-recovery.html">Volume Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/node-failure.html">Node Failure Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Snapshots and Backups</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/volume-snapshots-backups.html">Volume Snapshots and Backups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-snapshot.html">Create a Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/snapshot-space-management.html">Snapshot Space Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/configure-backup-target.html">Configure a Backup Target</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-backup.html">Create a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/sync-backup-volumes-manually.html">Manually Synchronize Backup Volumes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-recurring-backup-snapshot-job.html">Create a Recurring Snapshot or Backup Job</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-volume-from-backup.html">Restore a Volume from a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-recurring-job-from-backup.html">Restore a Recurring Job from a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-volume-statefulset.html">Restore a Volume for a Kubernetes StatefulSet</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshots.html">CSI Snapshots</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-backing-image.html">CSI Volume Snapshot Associated with a SUSE® Storage Backing Image</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-backup.html">CSI Volume Snapshot Associated with a SUSE® Storage Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-snapshot.html">CSI Volume Snapshot Associated with a SUSE® Storage Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/enable-csi-snapshot-creation.html">Enable CSI Snapshot Creation on a Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/system-backups/system-backups.html">SUSE® Storage System Backups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-to-cluster-using-rancher-snapshot.html">Restore the SUSE® Storage System to a Cluster Using a Rancher Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-to-new-cluster-using-velero.html">Restore the SUSE® Storage System to a New Cluster Using Velero</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/create-system-backup.html">Create a SUSE® Storage System Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-system.html">Restore the SUSE® Storage System</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../snapshots-backups/backing-image-backups.html">Backing Image Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../snapshots-backups/restore-cluster-rancher-snapshot.html">Restore a Cluster Using a Rancher Snapshot</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Data Integrity and Recovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/snapshot-data-integrity-check.html">Snapshot Data Integrity Check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/orphaned-data-cleanup.html">Orphaned Data Cleanup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/disaster-recovery-volumes.html">Disaster Recovery Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Data Recovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/identify-corrupted-replicas.html">Identify Corrupted Replicas</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/retrieve-volume-data-from-replica.html">Retrieve Volume Data from a Single Replica</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-from-data-errors.html">Identify and Recover from Data Errors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-from-full-disk.html">Recover from a Full Disk</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-without-system.html">Recover from a SUSE® Storage Backup without the System Installed</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Observability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/configure-prometheus-grafana.html">Configure Prometheus and Grafana to Monitor SUSE® Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/alert-rule-examples.html">Alert Rule Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/longhorn-metrics.html">SUSE® Storage Metrics for Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/integrate-with-rancher-monitoring.html">Integrate SUSE® Storage Metrics into the Rancher Monitoring System</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/kubelet-volume-metrics.html">Kubelet Volume Metrics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting and Maintenance</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/support-bundle.html">Support Bundle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/troubleshooting.html">Troubleshooting Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/v2-data-engine-issues.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/maintenance.html">Node Maintenance and Kubernetes Upgrade Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Glossary</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../glossary/glossary.html">Glossary/Terminologies</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Storage</span>
    <span class="version">1.8</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.31/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.32/en/introduction.html">1.32-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.31/en/introduction.html">1.31-latest</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/v0.25/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/v0.25/en/index.html">0.25</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.14/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/1.8/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../os-manager/1.9/en/index.html">1.9-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../os-manager/1.8/en/index.html">1.8</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher for AWS</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">v2.13</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../../1.10/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../1.10/en/longhorn-documentation.html">1.10 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../1.9/en/longhorn-documentation.html">1.9</a>
            </li>
            <li class="version is-current">
              <a href="../longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-virtual-clusters/v1.0.1/en/introduction.html">SUSE® Virtual Clusters</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../suse-virtual-clusters/1.0.2/en/introduction.html">1.0.2-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../suse-virtual-clusters/v1.0.1/en/introduction.html">v1.0.1-latest</a>
            </li>
            <li class="version">
              <a href="../../../../suse-virtual-clusters/v1.0.0/en/introduction.html">v1.0.0</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.6/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.7/en/introduction/overview.html">v1.7 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a class="home-link-dsc" href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home"></a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/storage" title="SUSE Storage" aria-label="SUSE Documentation - SUSE Storage">
        SUSE Storage
      </a>
    </li>
      <li>
          <a href="introduction.html" title="Introduction" aria-label="Introduction">Introduction</a>
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.8</button>
  <div class="version-menu">
    <a class="version" href="../../../1.11/en/introduction/concepts.html">1.11 (Dev)</a>
    <a class="version" href="../../../1.10/en/introduction/concepts.html">1.10 (Latest)</a>
    <a class="version" href="../../../1.9/en/introduction/concepts.html">1.9</a>
    <a class="version is-current" href="concepts.html">1.8</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/longhorn-product-docs/edit/main/docs/version-1.8/modules/en/pages/introduction/concepts.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:storage" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Architecture and Concepts</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>SUSE Storage creates a dedicated storage controller for each volume and synchronously replicates the volume across multiple replicas stored on multiple nodes.</p>
</div>
<div class="paragraph">
<p>The storage controller and replicas are themselves orchestrated using Kubernetes.</p>
</div>
<div class="paragraph">
<p>For an overview of features, refer to <a href="introduction.html" class="xref page">this section.</a></p>
</div>
<div class="paragraph">
<p>For the installation requirements, go to <a href="../installation-setup/requirements.html" class="xref page">this section.</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>This section assumes familiarity with Kubernetes persistent storage concepts. For more information on these concepts, refer to the <a href="#_appendix_how_persistent_storage_works_in_kubernetes">appendix.</a> For help with the terminology used in this page, refer to <a href="terminology.html" class="xref page">this section.</a></p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_design"><a class="anchor" href="#_1_design"></a>1. Design</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The design has two layers: the data plane and the control plane. The Longhorn Engine is a storage controller that corresponds to the data plane, and the Longhorn Manager corresponds to the control plane.</p>
</div>
<div class="sect2">
<h3 id="_1_1_the_longhorn_manager_and_the_longhorn_engine"><a class="anchor" href="#_1_1_the_longhorn_manager_and_the_longhorn_engine"></a>1.1. The Longhorn Manager and the Longhorn Engine</h3>
<div class="paragraph">
<p>The Longhorn Manager Pod runs on each node in the SUSE Storage cluster as a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">DaemonSet</a>. It creates and manages volumes in the Kubernetes cluster and handles the API calls from the SUSE Storage UI or the Longhorn CSI plugin. It follows the Kubernetes controller pattern, which is sometimes called the operator pattern.</p>
</div>
<div class="paragraph">
<p>The Longhorn Manager communicates with the Kubernetes API server to create a new SUSE Storage volume <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">CR</a>. Then the Longhorn Manager watches the API server&#8217;s response, and when it sees that the Kubernetes API server created a new SUSE Storage volume CR, the Longhorn Manager creates a new volume.</p>
</div>
<div class="paragraph">
<p>When the Longhorn Manager is asked to create a volume, it creates a Longhorn Engine instance on the node the volume is attached to, and it creates a replica on each node where a replica will be placed. Replicas should be placed on separate hosts to ensure maximum availability.</p>
</div>
<div class="paragraph">
<p>The multiple data paths for replicas ensure the high availability of a Longhorn volume. If an issue occurs with a replica or the Engine, it won&#8217;t affect all replicas or the pod&#8217;s access to the volume. The pod will continue to function normally. For a given volume with a replica count of <code>N</code>, the Longhorn volume can tolerate a maximum of <code>N-1</code> replica failures. This is because at least one healthy replica is necessary for the volume to remain operational.</p>
</div>
<div class="paragraph">
<p>The Longhorn Engine always runs in the same node as the Pod that uses the SUSE Storage volume. It synchronously replicates the volume across the multiple replicas stored on multiple nodes.</p>
</div>
<div class="paragraph">
<p>The Engine and replicas are orchestrated using Kubernetes.</p>
</div>
<div class="paragraph">
<p>In the figure below,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are three instances with SUSE Storage volumes.</p>
</li>
<li>
<p>Each volume has a dedicated controller, called the Longhorn Engine. For V1 volumes, the engine runs as a Linux process, while for V2 volumes, it operates as an SPDK RAID block device (bdev).</p>
</li>
<li>
<p>Each SUSE Storage volume has two replicas. In V1, replicas run as Linux processes, while in V2, they are implemented as SPDK logical volume bdevs.</p>
</li>
<li>
<p>The arrows in the figure indicate the read/write data flow between the volume, controller instance, replica instances, and disks.</p>
</li>
<li>
<p>By creating a separate Longhorn Engine for each volume, if one controller fails, the function of other volumes is not impacted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Figure 1. Read/write Data Flow between the Volume, Longhorn Engine, Replica Instances, and Disks</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/diagrams/architecture/how-longhorn-works-with-kubernetes.svg" alt="read/write data flow between the volume" width="controller instance" height="replica instances">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_advantages_of_a_microservices_based_design"><a class="anchor" href="#_1_2_advantages_of_a_microservices_based_design"></a>1.2. Advantages of a Microservices Based Design</h3>
<div class="paragraph">
<p>Each Engine only needs to serve one volume, simplifying the design of the storage controllers. Because the failure domain of the controller software is isolated to individual volumes, a controller crash will only impact one volume.</p>
</div>
<div class="paragraph">
<p>The Longhorn Engine is simple and lightweight, allowing us to create thousands of separate engines. Kubernetes schedules these separate engines, drawing resources from a shared set of disks and working with SUSE Storage to form a resilient distributed block storage system.</p>
</div>
<div class="paragraph">
<p>Because each volume has its own controller, the controller and replica instances for each volume can also be upgraded without causing a noticeable disruption in IO operations.</p>
</div>
<div class="paragraph">
<p>SUSE Storage can create a long-running job to orchestrate the upgrade of all live volumes without disrupting the on-going operation of the system. To ensure that an upgrade does not cause unforeseen issues, SUSE Storage can choose to upgrade a small subset of the volumes and roll back to the old version if something goes wrong during the upgrade.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_csi_driver"><a class="anchor" href="#_1_3_csi_driver"></a>1.3. CSI Driver</h3>
<div class="paragraph">
<p>The Longhorn CSI driver takes the block device, formats it, and mounts it on the node. Then the <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/">kubelet</a> bind-mounts the device inside a Kubernetes Pod. This allows the Pod to access the SUSE Storage volume.</p>
</div>
<div class="paragraph">
<p>The required Kubernetes CSI Driver images will be deployed automatically by the longhorn driver deployer.
To install SUSE Storage in an air gapped environment, refer to <a href="../installation-setup/installation/airgapped-environment.html" class="xref page">this section</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_4_csi_plugin"><a class="anchor" href="#_1_4_csi_plugin"></a>1.4. CSI Plugin</h3>
<div class="paragraph">
<p>SUSE Storage is managed in Kubernetes via a <a href="https://kubernetes-csi.github.io/docs/">CSI Plugin.</a> This allows for easy installation of the plugin.</p>
</div>
<div class="paragraph">
<p>The Kubernetes CSI plugin calls SUSE Storage to create volumes to create persistent data for a Kubernetes workload. The CSI plugin gives you the ability to create, delete, attach, detach, mount the volume, and take snapshots of the volume. All other functionality provided by SUSE Storage is implemented through the UI.</p>
</div>
<div class="paragraph">
<p>The Kubernetes cluster internally uses the CSI interface to communicate with the Longhorn CSI plugin. And the Longhorn CSI plugin communicates with the Longhorn Manager using the Longhorn API.</p>
</div>
<div class="paragraph">
<p>For v1 volumes, SUSE Storage uses iSCSI, which may require additional configuration on your nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Depending on the Linux distribution, you need to install either <code>open-iscsi</code> or <code>iscsiadm</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In contrast, v2 volumes come with different prerequisites, depending on the configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kernel modules like <code>vfio_pci</code> and <code>uio_pci_generic</code> are required.</p>
</li>
<li>
<p>For the NVMe-TCP frontend, the <code>nvme_tcp</code> module is necessary.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_1_5_the_ui"><a class="anchor" href="#_1_5_the_ui"></a>1.5. The UI</h3>
<div class="paragraph">
<p>The UI interacts with the Longhorn Manager through the Longhorn API, and acts as a complement of Kubernetes. Through the UI, you can manage snapshots, backups, nodes and disks.</p>
</div>
<div class="paragraph">
<p>Besides, the space usage of the cluster worker nodes is collected and illustrated by the UI. See <a href="../nodes/node-space-usage.html" class="xref page">here</a> for details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_volumes_and_primary_storage"><a class="anchor" href="#_2_volumes_and_primary_storage"></a>2. Volumes and Primary Storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When creating a volume, the Longhorn Manager creates the Longhorn Engine microservice and the replicas for each volume as microservices. Together, these microservices form a SUSE Storage volume. Each replica should be placed on a different node or on different disks.</p>
</div>
<div class="paragraph">
<p>After the Longhorn Engine is created by the Longhorn Manager, it connects to the replicas. The Engine exposes a block device on the same node where the Pod is running.</p>
</div>
<div class="paragraph">
<p>A SUSE Storage volume can be created with kubectl.</p>
</div>
<h3 id="_2_1_thin_provisioning_and_volume_size" class="discrete">2.1. Thin Provisioning and Volume Size</h3>
<div class="paragraph">
<p>SUSE Storage is a thin-provisioned storage system. That means a SUSE Storage volume will only take the space it needs at the moment. For example, if you allocated a 20 GB volume but only use 1GB of it, the actual data size on your disk would be 1 GB. You can see the actual data size in the volume details in the UI.</p>
</div>
<div class="paragraph">
<p>A SUSE Storage volume itself cannot shrink in size if you&#8217;ve removed content from your volume. For example, if you create a volume of 20 GB, used 10 GB, then removed the content of 9 GB, the actual size on the disk would still be 10 GB instead of 1 GB. This happens because SUSE Storage operates on the block level, not the filesystem level, so SUSE Storage doesn&#8217;t know if the content has been removed by a user or not. That information is mostly kept at the filesystem level.</p>
</div>
<div class="paragraph">
<p>For more introductions about the volume-size related concepts, see this <a href="../volumes/volume-size.html" class="xref page">doc</a> for more details.</p>
</div>
<h3 id="_2_2_reverting_volumes_in_maintenance_mode" class="discrete">2.2. Reverting Volumes in Maintenance Mode</h3>
<div class="paragraph">
<p>When a volume is attached from the UI, there is a checkbox for Maintenance mode. It&#8217;s mainly used to revert a volume from a snapshot.</p>
</div>
<div class="paragraph">
<p>The option will result in attaching the volume without enabling the frontend (block device or iSCSI), to make sure no one can access the volume data when the volume is attached.</p>
</div>
<div class="paragraph">
<p>After v0.6.0, the snapshot reverting operation required the volume to be in maintenance mode. This is because if the block device&#8217;s content is modified while the volume is mounted or being used, it will cause filesystem corruption.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also useful to inspect the volume state without worrying about the data being accessed by accident.</p>
</div>
<div class="sect2">
<h3 id="_2_3_replicas"><a class="anchor" href="#_2_3_replicas"></a>2.3. Replicas</h3>
<div class="paragraph">
<p>Each replica contains a chain of snapshots of a SUSE Storage volume. A snapshot is like a layer of an image, with the oldest snapshot used as the base layer, and newer snapshots on top. Data is only included in a new snapshot if it overwrites data in an older snapshot. Together, a chain of snapshots shows the current state of the data.</p>
</div>
<div class="paragraph">
<p>For each SUSE Storage volume, multiple replicas of the volume should run in the Kubernetes cluster, each on a separate node. All replicas are treated the same, and the Longhorn Engine always runs on the same node as the pod, which is also the consumer of the volume. In that way, we make sure that even if the Pod is down, the Engine can be moved to another Pod and your service will continue undisrupted.</p>
</div>
<div class="paragraph">
<p>The default replica count can be changed in the <a href="../longhorn-system/settings.html#_default_replica_count" class="xref page">settings.</a> When a volume is attached, the replica count for the volume can be changed in the UI.</p>
</div>
<div class="paragraph">
<p>If the current healthy replica count is less than specified replica count, SUSE Storage will start rebuilding new replicas.</p>
</div>
<div class="paragraph">
<p>If the current healthy replica count is more than the specified replica count, Replica Auto Balance and Data Locality are disabled, SUSE Storage will do nothing. In this situation, if a replica fails or is deleted, SUSE Storage will not start rebuilding new replicas unless the healthy replica count dips below the specified replica count. If Replica Auto Balance or Data Locality are set, SUSE Storage might delete one of the replicas.</p>
</div>
<div class="paragraph">
<p>SUSE Storage replicas are built using Linux <a href="https://en.wikipedia.org/wiki/Sparse_file">sparse files,</a> which support thin provisioning.</p>
</div>
<div class="sect3">
<h4 id="_2_3_1_how_read_and_write_operations_work_for_replicas"><a class="anchor" href="#_2_3_1_how_read_and_write_operations_work_for_replicas"></a>2.3.1. How Read and Write Operations Work for Replicas</h4>
<div class="paragraph">
<p>When data is read from a replica of a volume, if the data can be found in the live data, then that data is used. If not, the newest snapshot will be read. If the data is not found in the newest snapshot, the next-oldest snapshot is read, and so on, until the oldest snapshot is read.</p>
</div>
<div class="paragraph">
<p>When you take a snapshot, a <a href="https://en.wikipedia.org/wiki/Data_differencing">differencing</a> disk is created. As the number of snapshots grows, the differencing disk chain (also called a chain of snapshots) could get quite long. To improve read performance, SUSE Storage therefore maintains a read index that records which differencing disk holds valid data for each 4K block of storage.</p>
</div>
<div class="paragraph">
<p>In the following figure, the volume has eight blocks. The read index has eight entries and is filled up lazily as read operations take place.</p>
</div>
<div class="paragraph">
<p>A write operation resets the read index, causing it to point to the live data. The live data consists of data at some indices and empty space in other indices.</p>
</div>
<div class="paragraph">
<p>Beyond the read index, we currently do not maintain additional metadata to indicate which blocks are used.</p>
</div>
<div class="paragraph">
<p><strong>Figure 2. How the Read Index Keeps Track of Which Snapshot Holds the Most Recent Data</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/diagrams/architecture/read-index.png" alt="how the read index keeps track of which snapshot holds the most recent data">
</div>
</div>
<div class="paragraph">
<p>The figure above is color-coded to show which blocks contain the most recent data according to the read index, and the source of the latest data is also listed in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Read Index</th>
<th class="tableblock halign-left valign-top">Source of the latest data</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Newest snapshot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Live data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oldest snapshot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oldest snapshot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oldest snapshot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Live data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Live data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Live data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that as the green arrow shows in the figure above, Index 5 of the read index previously pointed to the second-oldest snapshot as the source of the most recent data, then it changed to point to the the live data when the 4K block of storage at Index 5 was overwritten by the live data.</p>
</div>
<div class="paragraph">
<p>The read index is kept in memory and consumes one byte for each 4K block. The byte-sized read index means you can take as many as 254 snapshots for each volume.</p>
</div>
<div class="paragraph">
<p>The read index consumes a certain amount of in-memory data structure for each replica. A 1 TB volume, for example, consumes 256 MB of in-memory read index.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_3_2_how_new_replicas_are_added"><a class="anchor" href="#_2_3_2_how_new_replicas_are_added"></a>2.3.2 How New Replicas are Added</h4>
<div class="paragraph">
<p>When a new replica is added, the existing replicas are synced to the new replica. The first replica is created by taking a new snapshot from the live data.</p>
</div>
<div class="paragraph">
<p>The following steps show a more detailed breakdown of how SUSE Storage adds new replicas:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Longhorn Engine is paused.</p>
</li>
<li>
<p>Let&#8217;s say that the chain of snapshots within the replica consists of the live data and a snapshot. When the new replica is created, the live data becomes the newest (second) snapshot and a new, blank version of live data is created.</p>
</li>
<li>
<p>The new replica is created in WO (write-only) mode.</p>
</li>
<li>
<p>The Longhorn Engine is unpaused.</p>
</li>
<li>
<p>All the snapshots are synced.</p>
</li>
<li>
<p>The new replica is set to RW (read-write) mode.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_2_3_3_how_faulty_replicas_are_rebuilt"><a class="anchor" href="#_2_3_3_how_faulty_replicas_are_rebuilt"></a>2.3.3. How Faulty Replicas are Rebuilt</h4>
<div class="paragraph">
<p>SUSE Storage will always try to maintain at least given number of healthy replicas for each volume.</p>
</div>
<div class="paragraph">
<p>When the controller detects failures in one of its replicas, it marks the replica as being in an error state. The Longhorn Manager is responsible for initiating and coordinating the process of rebuilding the faulty replica.</p>
</div>
<div class="paragraph">
<p>To rebuild the faulty replica, the Longhorn Manager creates a blank replica and calls the Longhorn Engine to add the blank replica into the volume&#8217;s replica set.</p>
</div>
<div class="paragraph">
<p>To add the blank replica, the Engine performs the following operations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pauses all read and write operations.</p>
</li>
<li>
<p>Adds the blank replica in WO (write-only) mode.</p>
</li>
<li>
<p>Takes a snapshot of all existing replicas, which will now have a blank differencing disk at its head.</p>
</li>
<li>
<p>Unpauses all read and write operations. Only write operations will be dispatched to the newly added replica.</p>
</li>
<li>
<p>Starts a background process to sync all but the most recent differencing disk from a good replica to the blank replica.</p>
</li>
<li>
<p>After the sync completes, all replicas now have consistent data, and the volume manager sets the new replica to RW (read-write) mode.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, the Longhorn Manager calls the Longhorn Engine to remove the faulty replica from its replica set.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_4_snapshots"><a class="anchor" href="#_2_4_snapshots"></a>2.4. Snapshots</h3>
<div class="paragraph">
<p>The snapshot feature enables a volume to be reverted back to a certain point in history. Backups in secondary storage can also be built from a snapshot.</p>
</div>
<div class="paragraph">
<p>When a volume is restored from a snapshot, it reflects the state of the volume at the time the snapshot was created.</p>
</div>
<div class="paragraph">
<p>The snapshot feature is also a part of the SUSE Storage rebuilding process. Every time SUSE Storage detects a replica is down, it will automatically take a (system) snapshot and start rebuilding it on another node.</p>
</div>
<div class="sect3">
<h4 id="_2_4_1_how_snapshots_work"><a class="anchor" href="#_2_4_1_how_snapshots_work"></a>2.4.1. How Snapshots Work</h4>
<div class="paragraph">
<p>A snapshot is like a layer of an image, with the oldest snapshot used as the base layer, and newer snapshots on top. Data is only included in a new snapshot if it overwrites data in an older snapshot. Together, a chain of snapshots shows the current state of the data. For a more detailed breakdown of how data is read from a replica, refer to the section on <a href="#_2_3_1_how_read_and_write_operations_work_for_replicas">read and write operations for replicas.</a></p>
</div>
<div class="paragraph">
<p>Snapshots cannot change after they are created, unless a snapshot is deleted, in which case its changes are conflated with the next most recent snapshot. New data is always written to the live version. New snapshots are always created from live data.</p>
</div>
<div class="paragraph">
<p>To create a new snapshot, the live data becomes the newest snapshot. Then a new, blank version of the live data is created, taking the place of the old live data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_4_2_recurring_snapshots"><a class="anchor" href="#_2_4_2_recurring_snapshots"></a>2.4.2. Recurring Snapshots</h4>
<div class="paragraph">
<p>To reduce the space taken by snapshots, user can schedule a recurring snapshot or backup with a number of snapshots to retain, which will automatically create a new snapshot/backup on schedule, then clean up for any excessive snapshots/backups.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_4_3_deleting_snapshots"><a class="anchor" href="#_2_4_3_deleting_snapshots"></a>2.4.3. Deleting Snapshots</h4>
<div class="paragraph">
<p>Unwanted snapshots can be manually deleted through the UI. Any system generated snapshots will be automatically marked for deletion if the deletion of any snapshot was triggered.</p>
</div>
<div class="paragraph">
<p>The latest snapshot cannot be deleted. This is because whenever a snapshot is deleted, SUSE Storage will conflate its content with the next snapshot, so that the next and later snapshot retains the correct content.</p>
</div>
<div class="paragraph">
<p>But SUSE Storage cannot do that for the latest snapshot since there is no more recent snapshot to be conflated with the deleted snapshot. The next &#8220;snapshot&#8221; of the latest snapshot is the live volume (volume-head), which is being read/written by the user at the moment, so the conflation process cannot happen.</p>
</div>
<div class="paragraph">
<p>Instead, the latest snapshot will be marked as removed, and it will be cleaned up next time when possible.</p>
</div>
<div class="paragraph">
<p>To clean up the latest snapshot, a new snapshot can be created, then the previous "latest" snapshot can be removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_4_4_storing_snapshots"><a class="anchor" href="#_2_4_4_storing_snapshots"></a>2.4.4. Storing Snapshots</h4>
<div class="paragraph">
<p>Snapshots are stored locally, as a part of each replica of a volume. They are stored on the disk of the nodes within the Kubernetes cluster.
Snapshots are stored in the same location as the volume data on the host&#8217;s physical disk.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_4_5_crash_consistency"><a class="anchor" href="#_2_4_5_crash_consistency"></a>2.4.5. Crash Consistency</h4>
<div class="paragraph">
<p>SUSE Storage is a crash-consistent block storage solution.</p>
</div>
<div class="paragraph">
<p>It&#8217;s normal for the OS to keep content in the cache before writing into the block layer. This means that if all of the replicas are down, then SUSE Storage may not contain the changes that occurred immediately before the shutdown, because the content was kept in the OS-level cache and wasn&#8217;t yet transferred to the SUSE Storage system.</p>
</div>
<div class="paragraph">
<p>This problem is similar to problems that could happen if your desktop computer shuts down due to a power outage. After resuming the power, you may find some corrupted files in the hard drive.</p>
</div>
<div class="paragraph">
<p>To force the data to be written to the block layer at any given moment, the sync command can be manually run on the node, or the disk can be unmounted. The OS would write the content from the cache to the block layer in either situation.</p>
</div>
<div class="paragraph">
<p>SUSE Storage runs the sync command automatically before creating a snapshot.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_backups_and_secondary_storage"><a class="anchor" href="#_3_backups_and_secondary_storage"></a>3. Backups and Secondary Storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A backup is an object in the backupstore, which is an NFS or S3 compatible object store external to the Kubernetes cluster. Backups provide a form of secondary storage so that even if your Kubernetes cluster becomes unavailable, your data can still be retrieved.</p>
</div>
<div class="paragraph">
<p>Because the volume replication is synchronized, and because of network latency, it is hard to do cross-region replication. The backupstore is also used as a medium to address this problem.</p>
</div>
<div class="paragraph">
<p>When the backup target is configured on the UI (<strong>Setting &#8594; Backup Target</strong>), SUSE Storage can connect to the backupstore and display a list of existing backups on the <strong>Backup</strong> screen.</p>
</div>
<div class="paragraph">
<p>If SUSE Storage runs in a second Kubernetes cluster, it can also sync disaster recovery volumes to the backups in secondary storage, so that your data can be recovered more quickly in the second Kubernetes cluster.</p>
</div>
<div class="sect2">
<h3 id="_3_1_how_backups_work"><a class="anchor" href="#_3_1_how_backups_work"></a>3.1. How Backups Work</h3>
<div class="paragraph">
<p>A backup is created using one snapshot as a source, so that it reflects the state of the volume&#8217;s data at the time that the snapshot was created. A backup is stored remotely outside of the cluster.</p>
</div>
<div class="paragraph">
<p>By contrast to a snapshot, a backup can be thought of as a flattened version of a chain of snapshots. Similar to the way that information is lost when a layered image is converted to a flat image, data is also lost when a chain of snapshots is converted to a backup. In both conversions, any overwritten data would be lost.</p>
</div>
<div class="paragraph">
<p>Because backups don&#8217;t contain snapshots, they don&#8217;t contain the history of changes to the volume data. After you restore a volume from a backup, the volume initially contains one snapshot. This snapshot is a conflated version of all the snapshots in the original chain, and it reflects the live data of the volume at the time at the time the backup was created.</p>
</div>
<div class="paragraph">
<p>While snapshots can be hundreds of gigabytes, backups are made of 2 MB files.</p>
</div>
<div class="paragraph">
<p>Each new backup of the same original volume is incremental, detecting and transmitting the changed blocks between snapshots. This is a relatively easy task because each snapshot is a <a href="https://en.wikipedia.org/wiki/Data_differencing">differencing</a> file and only stores the changes from the last snapshot. This design also means that if no blocks have changed and a backup is taken, that backup in the backupstore will show as 0 bytes. However if you were to restore from that backup it would still contain the full volume data, since it would restore the necessary blocks already present on the backupstore, that are required for a backup.</p>
</div>
<div class="paragraph">
<p>To avoid storing a very large number of small blocks of storage, SUSE Storage performs backup operations using 2 MB blocks. That means that if any 4K block in a 2MB boundary is changed, SUSE Storage will back up the entire 2MB block. This offers the right balance between manageability and efficiency.</p>
</div>
<div class="paragraph">
<p><strong>Figure 3. The Relationship between Backups in Secondary Storage and Snapshots in Primary Storage</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/diagrams/concepts/longhorn-backup-creation.png" alt="the relationship between backups in secondary storage and snapshots in primary storage">
</div>
</div>
<div class="paragraph">
<p>The above figure describes how backups are created from snapshots:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Primary Storage side of the diagram shows one replica of a SUSE Storage volume in the Kubernetes cluster. The replica consists of a chain of four snapshots. In order from newest to oldest, the snapshots are Live Data, snap3, snap2, and snap1.</p>
</li>
<li>
<p>The Secondary Storage side of the diagram shows two backups in an external object storage service such as S3.</p>
</li>
<li>
<p>In Secondary Storage, the color coding for backup-from-snap2 shows that it includes both the blue change from snap1 and the green changes from snap2. No changes from snap2 overwrote the data in snap1, therefore the changes from both snap1 and snap2 are both included in backup-from-snap2.</p>
</li>
<li>
<p>The backup named backup-from-snap3 reflects the state of the volume&#8217;s data at the time that snap3 was created. The color coding and arrows indicate that backup-from-snap3 contains all of the dark red changes from snap3, but only one of the green changes from snap2. This is because one of the red changes in snap3 overwrote one of the green changes in snap2. This illustrates how backups don&#8217;t include the full history of change, because they conflate snapshots with the snapshots that came before them.</p>
</li>
<li>
<p>Each backup maintains its own set of 2 MB blocks. Each 2 MB block is backed up only once. The two backups share one green block and one blue block.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a backup is deleted from the secondary storage, SUSE Storage does not delete all the blocks that it uses. Instead, it performs a garbage collection periodically to clean up unused blocks from secondary storage.</p>
</div>
<div class="paragraph">
<p>The 2 MB blocks for all backups belonging to the same volume are stored under a common directory and can therefore be shared across multiple backups.</p>
</div>
<div class="paragraph">
<p>To save space, the 2 MB blocks that didn&#8217;t change between backups can be reused for multiple backups that share the same backup volume in secondary storage. Because checksums are used to address the 2 MB blocks, we achieve some degree of deduplication for the 2 MB blocks in the same volume.</p>
</div>
<div class="paragraph">
<p>Volume-level metadata is stored in volume.cfg. The metadata files for each backup (e.g., snap2.cfg) are relatively small because they only contain the <a href="https://en.wikipedia.org/wiki/Offset_(computer_science)">offsets</a> and <a href="https://en.wikipedia.org/wiki/Checksum">checksums</a> of all the 2 MB blocks in the backup.</p>
</div>
<div class="paragraph">
<p>Each 2 MB block (.blk file) is compressed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_2_recurring_backups"><a class="anchor" href="#_3_2_recurring_backups"></a>3.2. Recurring Backups</h3>
<div class="paragraph">
<p>Backup operations can be scheduled using the recurring snapshot and backup feature, but they can also be done as needed.</p>
</div>
<div class="paragraph">
<p>It&#8217;s recommended to schedule recurring backups for your volumes. If a backupstore is not available, it&#8217;s recommended to have the recurring snapshot scheduled instead.</p>
</div>
<div class="paragraph">
<p>Backup creation involves copying the data through the network, so it will take time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_3_disaster_recovery_volumes"><a class="anchor" href="#_3_3_disaster_recovery_volumes"></a>3.3. Disaster Recovery Volumes</h3>
<div class="paragraph">
<p>A disaster recovery (DR) volume is a special volume that stores data in a backup cluster in case the whole main cluster goes down. DR volumes are used to increase the resiliency of SUSE Storage volumes.</p>
</div>
<div class="paragraph">
<p>Because the main purpose of a DR volume is to restore data from backup, this type of volume doesn&#8217;t support the following actions before it is activated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating, deleting, and reverting snapshots</p>
</li>
<li>
<p>Creating backups</p>
</li>
<li>
<p>Creating persistent volumes</p>
</li>
<li>
<p>Creating persistent volume claims</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A DR volume can be created from a volume&#8217;s backup in the backupstore. After the DR volume is created, SUSE Storage will monitor its original backup volume and incrementally restore from the latest backup. A backup volume is an object in the backupstore that contains multiple backups of the same volume.</p>
</div>
<div class="paragraph">
<p>If the original volume in the main cluster goes down, the DR volume can be immediately activated in the backup cluster, reducing the time needed to restore the data from the backupstore to the volume in the backup cluster.</p>
</div>
<div class="paragraph">
<p>When a DR volume is activated, SUSE Storage will check the last backup of the original volume. If that backup has not already been restored, the restoration will be started, and the activate action will fail. Users need to wait for the restoration to complete before retrying.</p>
</div>
<div class="paragraph">
<p>The Backup Target in the settings cannot be updated if any DR volumes exist.</p>
</div>
<div class="paragraph">
<p>After a DR volume is activated, it becomes a normal SUSE Storage volume and it cannot be deactivated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_4_backupstore_update_intervals_rto_and_rpo"><a class="anchor" href="#_3_4_backupstore_update_intervals_rto_and_rpo"></a>3.4. Backupstore Update Intervals, RTO, and RPO</h3>
<div class="paragraph">
<p>Incremental restoration is usually triggered by the periodic backupstore update. You can set the update interval on the backup target settings screen (<strong>Setting &#8594; Backup Target</strong>).</p>
</div>
<div class="paragraph">
<p>Notice that this interval can potentially impact Recovery Time Objective (RTO). If it is too long, there may be a large amount of data for the disaster recovery volume to restore, which will take a long time.</p>
</div>
<div class="paragraph">
<p>As for Recovery Point Objective (RPO), it is determined by recurring backup scheduling of the backup volume. If recurring backup scheduling for normal volume A creates a backup every hour, then the RPO is one hour. You can check here to see how to set recurring backups in SUSE Storage.</p>
</div>
<div class="paragraph">
<p>The following analysis assumes that the volume creates a backup every hour, and that incrementally restoring data from one backup takes five minutes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the backupstore poll interval is 30 minutes, then there will be at most one backup worth of data since the last restoration. The time for restoring one backup is five minutes, so the RTO would be five minutes.</p>
</li>
<li>
<p>If the backupstore poll interval is 12 hours, then there will be at most 12 backups worth of data since the last restoration. The time for restoring the backups is 5 * 12 = 60 minutes, so the RTO would be 60 minutes.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_how_persistent_storage_works_in_kubernetes"><a class="anchor" href="#_appendix_how_persistent_storage_works_in_kubernetes"></a>Appendix: How Persistent Storage Works in Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To understand persistent storage in Kubernetes, it is important to understand Volumes, PersistentVolumes, PersistentVolumeClaims, and StorageClasses, and how they work together.</p>
</div>
<div class="paragraph">
<p>One important property of a Kubernetes Volume is that it has the same lifecycle as the Pod it belongs to. The Volume is lost if the Pod is gone. In contrast, a PersistentVolume continues to exist in the system until users delete it. Volumes can also be used to share data between containers inside the same Pod, but this isn&#8217;t the primary use case because users normally only have one container per Pod.</p>
</div>
<div class="paragraph">
<p>A <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">PersistentVolume (PV)</a> is a piece of persistent storage in the Kubernetes cluster, while a <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PersistentVolumeClaim (PVC)</a> is a request for storage. <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/">StorageClasses</a> allow new storage to be dynamically provisioned for workloads on demand.</p>
</div>
<div class="sect2">
<h3 id="_how_kubernetes_workloads_use_new_and_existing_persistent_storage"><a class="anchor" href="#_how_kubernetes_workloads_use_new_and_existing_persistent_storage"></a>How Kubernetes Workloads use New and Existing Persistent Storage</h3>
<div class="paragraph">
<p>Broadly speaking, there are two main ways to use persistent storage in Kubernetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use an existing persistent volume</p>
</li>
<li>
<p>Dynamically provision new persistent volumes</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_existing_storage_provisioning"><a class="anchor" href="#_existing_storage_provisioning"></a>Existing Storage Provisioning</h3>
<div class="paragraph">
<p>To use an existing PV, your application will need to use a PVC that is bound to a PV, and the PV should include the minimum resources that the PVC requires.</p>
</div>
<div class="paragraph">
<p>In other words, a typical workflow for setting up existing storage in Kubernetes is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up persistent storage volumes, in the sense of physical or virtual storage that you have access to.</p>
</li>
<li>
<p>Add a PV that refers to the persistent storage.</p>
</li>
<li>
<p>Add a PVC that refers to the PV.</p>
</li>
<li>
<p>Mount the PVC as a volume in your workload.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a PVC requests a piece of storage, the Kubernetes API server will try to match that PVC with a pre-allocated PV as matching volumes become available. If a match can be found, the PVC will be bound to the PV, and the user will start to use that pre-allocated piece of storage.</p>
</div>
<div class="paragraph">
<p>if a matching volume does not exist, PersistentVolumeClaims will remain unbound indefinitely. For example, a cluster provisioned with many 50 Gi PVs would not match a PVC requesting 100 Gi. The PVC could be bound after a 100 Gi PV is added to the cluster.</p>
</div>
<div class="paragraph">
<p>In other words, you can create unlimited PVCs, but they will only be bound to PVs if the Kubernetes master can find a sufficient PV that has at least the amount of disk space required by the PVC.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_storage_provisioning"><a class="anchor" href="#_dynamic_storage_provisioning"></a>Dynamic Storage Provisioning</h3>
<div class="paragraph">
<p>For dynamic storage provisioning, your application will need to use a PVC that is bound to a StorageClass. The StorageClass contains the authorization to provision new persistent volumes.</p>
</div>
<div class="paragraph">
<p>The overall workflow for dynamically provisioning new storage in Kubernetes involves a StorageClass resource:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a StorageClass and configure it to automatically provision new storage from the storage that you have access to.</p>
</li>
<li>
<p>Add a PVC that refers to the StorageClass.</p>
</li>
<li>
<p>Mount the PVC as a volume for your workload.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Kubernetes cluster administrators can use a Kubernetes StorageClass to describe the &#8220;classes&#8221; of storage they offer. StorageClasses can have different capacity limits, different IOPS, or any other parameters that the provisioner supports. The storage vendor specific provisioner is be used along with the StorageClass to allocate PV automatically, following the parameters set in the StorageClass object. Also, the provisioner now has the ability to enforce the resource quotas and permission requirements for users. In this design, admins are freed from the unnecessary work of predicting the need for PVs and allocating them.</p>
</div>
<div class="paragraph">
<p>When a StorageClass is used, a Kubernetes administrator is not responsible for allocating every piece of storage. The administrator just needs to give users permission to access a certain storage pool, and decide the quota for the user. Then the user can carve out the needed pieces of the storage from the storage pool.</p>
</div>
<div class="paragraph">
<p>StorageClasses can also be used without explicitly creating a StorageClass object in Kubernetes. Since the StorageClass is also a field used to match a PVC with a PV, a PV can be created manually with a custom Storage Class name, then a PVC can be created that asks for a PV with that StorageClass name. Kubernetes can then bind your PVC to the PV with the specified StorageClass name, even if the StorageClass object doesn&#8217;t exist as a Kubernetes resource.</p>
</div>
<div class="paragraph">
<p>SUSE Storage introduces a StorageClass so that your Kubernetes workloads can carve out pieces of your persistent storage as necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="_horizontal_scaling_for_kubernetes_workloads_with_persistent_storage"><a class="anchor" href="#_horizontal_scaling_for_kubernetes_workloads_with_persistent_storage"></a>Horizontal Scaling for Kubernetes Workloads with Persistent Storage</h3>
<div class="paragraph">
<p>The VolumeClaimTemplate is a StatefulSet spec property, and it provides a way for the block storage solution to scale horizontally for a Kubernetes workload.</p>
</div>
<div class="paragraph">
<p>This property can be used to create matching PVs and PVCs for Pods that were created by a StatefulSet.</p>
</div>
<div class="paragraph">
<p>Those PVCs are created using a StorageClass, so they can be set up automatically when the StatefulSet scales up.</p>
</div>
<div class="paragraph">
<p>When a StatefulSet scales down, the extra PVs/PVCs are kept in the cluster, and they are reused when the StatefulSet scales up again.</p>
</div>
<div class="paragraph">
<p>The VolumeClaimTemplate is important for block storage solutions like EBS and SUSE Storage. Because those solutions are inherently <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes">ReadWriteOnce,</a> they cannot be shared between the Pods.</p>
</div>
<div class="paragraph">
<p>Deployments don&#8217;t work well with persistent storage if you have more than one Pod running with persistent data. For more than one pod, a StatefulSet should be used.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="introduction.html">Introduction</a></span>
  <span class="next"><a href="terminology.html">Terminology</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
