<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configure Prometheus and Grafana to Monitor SUSE® Storage :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/storage/latest/en/observability/configure-prometheus-grafana.html">
    <link rel="prev" href="../data-integrity-recovery/data-recovery/recover-without-system.html">
    <link rel="next" href="alert-rule-examples.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-07-29"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/storage/latest/en/observability/configure-prometheus-grafana.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/storage/latest/en/observability/configure-prometheus-grafana.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/storage/latest/en/observability/configure-prometheus-grafana.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="storage" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Storage</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../longhorn-documentation.html">SUSE® Storage Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../introduction/introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/concepts.html">Architecture and Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/document-conventions.html">Document Conventions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../important-notes.html">Important Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation and Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/best-practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../installation-setup/installation/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-argocd.html">Install SUSE Storage Using Argo CD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-fleet.html">Install SUSE Storage Using Fleet</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-flux.html">Install SUSE® Storage Using Flux</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-helm.html">Install SUSE Storage Using Helm</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-helm-controller.html">Install SUSE Storage Using Helm Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/helm-values.html">Helm Values</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/install-using-rancher.html">Install SUSE Storage Using Rancher</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/rancher-windows-cluster.html">Rancher Windows Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/installation/airgapped-environment.html">Install SUSE Storage in an Air-Gapped Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Operating System and Distribution Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/container-optimized-os.html">Container-Optimized OS (COS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/gke.html">Google Kubernetes Engine (GKE)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/k3s.html">K3s</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/ocp-okd.html">Red Hat OpenShift Container Platform and OKD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/rke-coreos.html">RKE and CoreOS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/os-distro/talos-linux.html">Talos Linux</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/setup-performance-scalability-sizing-guidelines.html">Setup, Performance, Scalability, and Sizing Guidelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/uninstallation.html">Uninstallation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">Upgrades</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Component Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/auto-upgrade-engine.html">Automatically Upgrade the Longhorn Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/manually-upgrade-engine.html">Manually Upgrade the Longhorn Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/longhorn-components/upgrade-longhorn-manager.html">Upgrade Longhorn Manager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Kubernetes Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-aks.html">Upgrade Kubernetes on Azure Kubernetes Service (AKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-eks.html">Upgrade Kubernetes on Amazon Elastic Kubernetes Service (Amazon EKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrades/kubernetes/upgrade-k8s-on-gke.html">Upgrade Kubernetes on Google Kubernetes Engine (GKE)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Migration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration/migration.html">Migrating to SUSE Storage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">SUSE® Storage System</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/system-access/system-access.html">System Access</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-ui.html">Access the User Interface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/create-ingress.html">Create an Ingress with Basic Authentication (nginx)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-cli.html">Command Line Interface (CLI)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/install-longhorn-cli.html">Install the CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/system-access/longhorn-python-client.html">Python Client</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/networking/networking.html">Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/networking/storage-network.html">Storage Network</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/mtls-support.html">Mutual TLS (mTLS) Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/customize-default-settings.html">Customize Default Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/settings.html">Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">V2 Data Engine (Preview Feature)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/features.html">V2 Data Engine Features</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/selective-engine-activation.html">Selective V2 Data Engine Activation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/ublk-frontend-support.html">UBLK Frontend Support</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/node-disk-support.html">Node Disk Support</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/features/configurable-cpu-cores.html">Configurable CPU Cores</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/quick-start-guide.html">Quick Start Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../longhorn-system/v2-data-engine/performance.html">Performance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/examples-resources.html">Examples of Kubernetes Resources that Use SUSE® Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../longhorn-system/migrate-flexvolume.html">Migrate from the Flexvolume Driver to CSI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Nodes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-space-usage.html">Node Space Usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/default-disk-and-node-config.html">Configure Default Node and Disk Settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/storage-tags.html">Storage Tags</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/multiple-disks.html">Multiple Disks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/disks-or-nodes-eviction.html">Evicting Replicas on Disabled Disks or Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/scheduling.html">Scheduling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-conditions.html">Node Conditions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/node-selector.html">Node Selector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/taints-tolerations.html">Taints and Tolerations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../nodes/priority-class.html">Priority Class</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Managed Kubernetes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/aks-managed-node-groups.html">Managed Node Groups on Azure Kubernetes Service (AKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/eks-managed-node-pools.html">Managed Node Pools on Amazon Elastic Kubernetes Service (Amazon EKS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../nodes/managed-kubernetes/gke-managed-node-pools.html">Managed Node Pools on Google Kubernetes Engine (GKE)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Volumes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/create-volumes.html">Create Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/pvc-ownership-and-permission.html">PVC Ownership and Permission</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/rwx-volumes.html">ReadWriteMany (RWX) Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/clone-volumes.html">Clone Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/detach-volumes.html">Detach Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/delete-volumes.html">Delete Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/use-as-iscsi-target.html">Use a Volume as an iSCSI Target</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/identify-workloads.html">Identify Workloads that Use a Volume</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-size.html">Volume Size</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-expansion.html">Volume Expansion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-attachment.html">SUSE Storage VolumeAttachment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/trim-filesystem.html">Trim the Filesystem</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-conditions.html">Volume Conditions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/volume-encryption.html">Volume Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../volumes/storageclass-parameters.html">StorageClass Parameters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../volumes/backing-images/backing-images.html">Backing Images</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../volumes/backing-images/backing-image-encryption.html">Backing Image Encryption</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">High Availability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/automatic-replica-balancing.html">Automatic Replica Balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/fast-replica-rebuilding.html">Fast Replica Rebuilding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/offline-replica-rebuilding.html">Offline Replica Rebuilding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/revision_counter.html">Revision Counter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/data-locality.html">Data Locality</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/kubernetes-cluster-autoscaler.html">Kubernetes Cluster Autoscaler Support (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/rwx-volume-fast-failover.html">RWX Volume Fast Failover (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/volume-recovery.html">Volume Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../high-availability/node-failure.html">Node Failure Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Snapshots and Backups</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/volume-snapshots-backups.html">Volume Snapshots and Backups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-snapshot.html">Create a Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/snapshot-space-management.html">Snapshot Space Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/configure-backup-target.html">Configure a Backup Target</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-backup.html">Create a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/sync-backup-volumes-manually.html">Manually Synchronize Backup Volumes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/create-recurring-backup-snapshot-job.html">Create a Recurring Snapshot or Backup Job</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-volume-from-backup.html">Restore a Volume from a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-recurring-job-from-backup.html">Restore a Recurring Job from a Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/volume-snapshots-backups/restore-volume-statefulset.html">Restore a Volume for a Kubernetes StatefulSet</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshots.html">CSI Snapshots</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-backing-image.html">CSI Volume Snapshot Associated with a SUSE® Storage Backing Image</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-backup.html">CSI Volume Snapshot Associated with a SUSE® Storage Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/csi-snapshot-longhorn-snapshot.html">CSI Volume Snapshot Associated with a SUSE® Storage Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/csi-snapshots/enable-csi-snapshot-creation.html">Enable CSI Snapshot Creation on a Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../snapshots-backups/system-backups/system-backups.html">SUSE® Storage System Backups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-to-cluster-using-rancher-snapshot.html">Restore the SUSE® Storage System to a Cluster Using a Rancher Snapshot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-to-new-cluster-using-velero.html">Restore the SUSE® Storage System to a New Cluster Using Velero</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/create-system-backup.html">Create a SUSE Storage System Backup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../snapshots-backups/system-backups/restore-system.html">Restore the SUSE® Storage System</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../snapshots-backups/backing-image-backups.html">Backing Image Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../snapshots-backups/restore-cluster-rancher-snapshot.html">Restore a Cluster Using a Rancher Snapshot</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Data Integrity and Recovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/snapshot-data-integrity-check.html">Snapshot Data Integrity Check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/orphaned-data-cleanup.html">Orphaned Data Cleanup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/orphaned-instance-cleanup.html">Orphaned Instance Cleanup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-integrity-recovery/disaster-recovery-volumes.html">Disaster Recovery Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Data Recovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/identify-corrupted-replicas.html">Identify Corrupted Replicas</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/retrieve-volume-data-from-replica.html">Retrieve Volume Data from a Single Replica</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-from-data-errors.html">Identify and Recover from Data Errors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-from-full-disk.html">Recover from a Full Disk</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data-integrity-recovery/data-recovery/recover-without-system.html">Recover from a SUSE® Storage Backup without the System Installed</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Observability</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configure-prometheus-grafana.html">Configure Prometheus and Grafana to Monitor SUSE® Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="alert-rule-examples.html">Alert Rule Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="longhorn-metrics.html">SUSE® Storage Metrics for Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integrate-with-rancher-monitoring.html">Integrate SUSE® Storage Metrics into the Rancher Monitoring System</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kubelet-volume-metrics.html">Kubelet Volume Metrics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting and Maintenance</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/support-bundle.html">Support Bundle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/troubleshooting.html">Troubleshooting Problems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/v2-data-engine-issues.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting-maintenance/maintenance.html">Node Maintenance and Kubernetes Upgrade Guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Storage</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/storage" title="SUSE Storage" aria-label="SUSE Documentation - SUSE Storage">
        SUSE Storage
      </a>
    </li>
      <li>
          Observability
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">Latest</button>
  <div class="version-menu">
    <a class="version is-current" href="configure-prometheus-grafana.html">Latest</a>
    <a class="version" href="../../../1.11/en/observability/configure-prometheus-grafana.html">1.11 (Dev)</a>
    <a class="version" href="../../../1.10/en/observability/configure-prometheus-grafana.html">1.10 (Dev)</a>
    <a class="version" href="../../../1.9/en/observability/configure-prometheus-grafana.html">1.9 (Latest)</a>
    <a class="version" href="../../../1.8/en/observability/configure-prometheus-grafana.html">1.8</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/longhorn-product-docs/edit/main/docs/latest/modules/en/pages/observability/configure-prometheus-grafana.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:storage" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configure Prometheus and Grafana to Monitor SUSE® Storage</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Longhorn natively exposes metrics in <a href="https://prometheus.io/docs/instrumenting/exposition_formats/#text-based-format">Prometheus text format</a> on a REST endpoint <code>http://LONGHORN_MANAGER_IP:PORT/metrics</code>.</p>
</div>
<div class="paragraph">
<p>You can use any collecting tools such as <a href="https://prometheus.io/">Prometheus</a>, <a href="https://graphiteapp.org/">Graphite</a>, <a href="https://www.influxdata.com/time-series-platform/telegraf/">Telegraf</a> to scrape these metrics then visualize the collected data by tools such as <a href="https://grafana.com/">Grafana</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="longhorn-metrics.html" class="xref page">Longhorn Metrics for Monitoring</a> for available metrics.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_high_level_overview"><a class="anchor" href="#_high_level_overview"></a>High-level Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The monitoring system uses <code>Prometheus</code> for collecting data and alerting, and <code>Grafana</code> for visualizing/dashboarding the collected data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prometheus server which scrapes and stores time-series data from Longhorn metrics endpoints. The Prometheus is also responsible for generating alerts based on configured rules and collected data. Prometheus servers then send alerts to an Alertmanager.</p>
</li>
<li>
<p>AlertManager then manages those alerts, including silencing, inhibition, aggregation, and sending out notifications via methods such as email, on-call notification systems, and chat platforms.</p>
</li>
<li>
<p>Grafana which queries Prometheus server for data and draws a dashboard for visualization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The below picture describes the detailed architecture of the monitoring system.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/screenshots/monitoring/longhorn-monitoring-system.png" alt="images">
</div>
</div>
<div class="paragraph">
<p>There are 2 unmentioned components in the above picture:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Longhorn Backend service is a service pointing to the set of Longhorn manager pods. Longhorn&#8217;s metrics are exposed in Longhorn manager pods at the endpoint <code>http://LONGHORN_MANAGER_IP:PORT/metrics</code>.</p>
</li>
<li>
<p><a href="https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/user-guides/getting-started.md">Prometheus operator</a> makes running Prometheus on top of Kubernetes very easy. The operator watches 3 custom resources: ServiceMonitor, Prometheus ,and AlertManager.
When you create those custom resources, Prometheus Operator deploys and manages the Prometheus server, AlertManager with the user-specified configurations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document uses the <code>default</code> namespace for the monitoring system. To install on a different namespace, change the field <code>namespace: &lt;OTHER_NAMESPACE&gt;</code> in manifests.</p>
</div>
<div class="sect2">
<h3 id="_install_prometheus_operator"><a class="anchor" href="#_install_prometheus_operator"></a>Install Prometheus Operator</h3>
<div class="paragraph">
<p>Follow instructions in <a href="https://github.com/prometheus-operator/prometheus-operator#quickstart">Prometheus Operator - Quickstart</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> You may need to choose a release that is compatible with the Kubernetes version of the cluster.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_install_longhorn_servicemonitor"><a class="anchor" href="#_install_longhorn_servicemonitor"></a>Install Longhorn ServiceMonitor</h3>
<div class="sect3">
<h4 id="_install_longhorn_servicemonitor_with_kubectl"><a class="anchor" href="#_install_longhorn_servicemonitor_with_kubectl"></a>Install Longhorn ServiceMonitor with Kubectl</h4>
<div class="paragraph">
<p>Create a ServiceMonitor for Longhorn Manager.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: monitoring.coreos.com/v1
 kind: ServiceMonitor
 metadata:
   name: longhorn-prometheus-servicemonitor
   namespace: default
   labels:
     name: longhorn-prometheus-servicemonitor
 spec:
   selector:
     matchLabels:
       app: longhorn-manager
   namespaceSelector:
     matchNames:
     - longhorn-system
   endpoints:
   - port: manager</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_longhorn_servicemonitor_with_helm"><a class="anchor" href="#_install_longhorn_servicemonitor_with_helm"></a>Install Longhorn ServiceMonitor with Helm</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the YAML file <code>longhorn/chart/values.yaml</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> metrics:
   serviceMonitor:
     # -- Setting that allows the creation of a [Prometheus Operator](https://prometheus-operator.dev/) ServiceMonitor resource for Longhorn Manager components.
     enabled: true</code></pre>
</div>
</div>
</li>
<li>
<p>Create a ServiceMonitor for Longhorn Manager using Helm.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">helm upgrade longhorn longhorn/longhorn --namespace longhorn-system -f values.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Longhorn ServiceMonitor is a <a href="https://prometheus-operator.dev/">Prometheus Operator</a> custom resource. This setup allows the Prometheus server to discover all Longhorn Manager pods and their respective endpoints.</p>
</div>
<div class="paragraph">
<p>You can use the label selector <code>app: longhorn-manager</code> to select the longhorn-backend service, which points to the set of Longhorn Manager pods.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_and_configure_prometheus_alertmanager"><a class="anchor" href="#_install_and_configure_prometheus_alertmanager"></a>Install and configure Prometheus AlertManager</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a highly available Alertmanager deployment with 3 instances.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: monitoring.coreos.com/v1
 kind: Alertmanager
 metadata:
   name: longhorn
   namespace: default
 spec:
   replicas: 3</code></pre>
</div>
</div>
</li>
<li>
<p>The Alertmanager instances will not start unless a valid configuration is given.
See <a href="https://prometheus.io/docs/alerting/latest/configuration/">Prometheus - Configuration</a> for more explanation.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> global:
   resolve_timeout: 5m
 route:
   group_by: [alertname]
   receiver: email_and_slack
 receivers:
 - name: email_and_slack
   email_configs:
   - to: &lt;the email address to send notifications to&gt;
     from: &lt;the sender address&gt;
     smarthost: &lt;the SMTP host through which emails are sent&gt;
     # SMTP authentication information.
     auth_username: &lt;the username&gt;
     auth_identity: &lt;the identity&gt;
     auth_password: &lt;the password&gt;
     headers:
       subject: 'Longhorn-Alert'
     text: |-
       {{ range .Alerts }}
         *Alert:* {{ .Annotations.summary }} - `{{ .Labels.severity }}`
         *Description:* {{ .Annotations.description }}
         *Details:*
         {{ range .Labels.SortedPairs }} • *{{ .Name }}:* `{{ .Value }}`
         {{ end }}
       {{ end }}
   slack_configs:
   - api_url: &lt;the Slack webhook URL&gt;
     channel: &lt;the channel or user to send notifications to&gt;
     text: |-
       {{ range .Alerts }}
         *Alert:* {{ .Annotations.summary }} - `{{ .Labels.severity }}`
         *Description:* {{ .Annotations.description }}
         *Details:*
         {{ range .Labels.SortedPairs }} • *{{ .Name }}:* `{{ .Value }}`
         {{ end }}
       {{ end }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the above Alertmanager config in a file called <code>alertmanager.yaml</code> and create a secret from it using kubectl.</p>
</div>
<div class="paragraph">
<p>Alertmanager instances require the secret resource naming to follow the format <code>alertmanager-&lt;ALERTMANAGER_NAME&gt;</code>. In the previous step, the name of the Alertmanager is <code>longhorn</code>, so the secret name must be <code>alertmanager-longhorn</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre> $ kubectl create secret generic alertmanager-longhorn --from-file=alertmanager.yaml -n default</pre>
</div>
</div>
</li>
<li>
<p>To be able to view the web UI of the Alertmanager, expose it through a Service. A simple way to do this is to use a Service of type NodePort.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: v1
 kind: Service
 metadata:
   name: alertmanager-longhorn
   namespace: default
 spec:
   type: NodePort
   ports:
   - name: web
     nodePort: 30903
     port: 9093
     protocol: TCP
     targetPort: web
   selector:
     alertmanager: longhorn</code></pre>
</div>
</div>
<div class="paragraph">
<p>After creating the above service, you can access the web UI of Alertmanager via a Node&#8217;s IP and the port 30903.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Use the above <code>NodePort</code> service for quick verification only because it doesn&#8217;t communicate over the TLS connection. You may want to change the service type to <code>ClusterIP</code> and set up an Ingress-controller to expose the web UI of Alertmanager over a TLS connection.</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_install_and_configure_prometheus_server"><a class="anchor" href="#_install_and_configure_prometheus_server"></a>Install and configure Prometheus server</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create PrometheusRule custom resource to define alert conditions. See more examples about Longhorn alert rules at <a href="alert-rule-examples.html" class="xref page">Longhorn Alert Rule Examples</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: monitoring.coreos.com/v1
 kind: PrometheusRule
 metadata:
   labels:
     prometheus: longhorn
     role: alert-rules
   name: prometheus-longhorn-rules
   namespace: default
 spec:
   groups:
   - name: longhorn.rules
     rules:
     - alert: LonghornVolumeUsageCritical
       annotations:
         description: Longhorn volume {{$labels.volume}} on {{$labels.node}} is at {{$value}}% used for
           more than 5 minutes.
         summary: Longhorn volume capacity is over 90% used.
       expr: 100 * (longhorn_volume_usage_bytes / longhorn_volume_capacity_bytes) &gt; 90
       for: 5m
       labels:
         issue: Longhorn volume {{$labels.volume}} usage on {{$labels.node}} is critical.
         severity: critical</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/#alerting-rules">Prometheus - Alerting rules</a> for more information.</p>
</div>
</li>
<li>
<p>If <a href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/">RBAC</a> authorization is activated, Create a ClusterRole and ClusterRoleBinding for the Prometheus Pods.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: v1
 kind: ServiceAccount
 metadata:
   name: prometheus
   namespace: default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRole
 metadata:
   name: prometheus
   namespace: default
 rules:
 - apiGroups: [""]
   resources:
   - nodes
   - services
   - endpoints
   - pods
   verbs: ["get", "list", "watch"]
 - apiGroups: [""]
   resources:
   - configmaps
   verbs: ["get"]
 - nonResourceURLs: ["/metrics"]
   verbs: ["get"]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRoleBinding
 metadata:
   name: prometheus
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: ClusterRole
   name: prometheus
 subjects:
 - kind: ServiceAccount
   name: prometheus
   namespace: default</code></pre>
</div>
</div>
</li>
<li>
<p>Create a Prometheus custom resource. Notice that we select the Longhorn service monitor and Longhorn rules in the spec.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: monitoring.coreos.com/v1
 kind: Prometheus
 metadata:
   name: longhorn
   namespace: default
 spec:
   replicas: 2
   serviceAccountName: prometheus
   alerting:
     alertmanagers:
       - namespace: default
         name: alertmanager-longhorn
         port: web
   serviceMonitorSelector:
     matchLabels:
       name: longhorn-prometheus-servicemonitor
   ruleSelector:
     matchLabels:
       prometheus: longhorn
       role: alert-rules</code></pre>
</div>
</div>
</li>
<li>
<p>To be able to view the web UI of the Prometheus server, expose it through a Service. A simple way to do this is to use a Service of type NodePort.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: v1
 kind: Service
 metadata:
   name: prometheus-longhorn
   namespace: default
 spec:
   type: NodePort
   ports:
   - name: web
     nodePort: 30904
     port: 9090
     protocol: TCP
     targetPort: web
   selector:
     prometheus: longhorn</code></pre>
</div>
</div>
<div class="paragraph">
<p>After creating the above service, you can access the web UI of the Prometheus server via a Node&#8217;s IP and the port 30904.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>At this point, you should be able to see all Longhorn manager targets as well as Longhorn rules in the targets and rules section of the Prometheus server UI.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Use the above NodePort service for quick verification only because it doesn&#8217;t communicate over the TLS connection. You may want to change the service type to <code>ClusterIP</code> and set up an Ingress controller to expose the web UI of the Prometheus server over a TLS connection.</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_setup_grafana"><a class="anchor" href="#_setup_grafana"></a>Setup Grafana</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Grafana datasource ConfigMap.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: v1
 kind: ConfigMap
 metadata:
   name: grafana-datasources
   namespace: default
 data:
   prometheus.yaml: |-
     {
         "apiVersion": 1,
         "datasources": [
             {
                "access":"proxy",
                 "editable": true,
                 "name": "prometheus-longhorn",
                 "orgId": 1,
                 "type": "prometheus",
                 "url": "http://prometheus-longhorn.default.svc:9090",
                 "version": 1
             }
         ]
     }</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> change field <code>url</code> if you are installing the monitoring stack in a different namespace.
<code>http://prometheus-longhorn.&lt;NAMESPACE&gt;.svc:9090"</code></p>
</div>
</blockquote>
</div>
</li>
<li>
<p>Create Grafana Deployment.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: grafana
   namespace: default
   labels:
     app: grafana
 spec:
   replicas: 1
   selector:
     matchLabels:
       app: grafana
   template:
     metadata:
       name: grafana
       labels:
         app: grafana
     spec:
       containers:
       - name: grafana
         image: grafana/grafana:7.1.5
         ports:
         - name: grafana
           containerPort: 3000
         resources:
           limits:
             memory: "500Mi"
             cpu: "300m"
           requests:
             memory: "500Mi"
             cpu: "200m"
         volumeMounts:
           - mountPath: /var/lib/grafana
             name: grafana-storage
           - mountPath: /etc/grafana/provisioning/datasources
             name: grafana-datasources
             readOnly: false
       volumes:
         - name: grafana-storage
           emptyDir: {}
         - name: grafana-datasources
           configMap:
               defaultMode: 420
               name: grafana-datasources</code></pre>
</div>
</div>
</li>
<li>
<p>Create Grafana Service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: v1
 kind: Service
 metadata:
   name: grafana
   namespace: default
 spec:
   selector:
     app: grafana
   type: ClusterIP
   ports:
     - port: 3000
       targetPort: 3000</code></pre>
</div>
</div>
</li>
<li>
<p>Expose Grafana on NodePort <code>32000</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> kubectl -n default patch svc grafana --type='json' -p '[{"op":"replace","path":"/spec/type","value":"NodePort"},{"op":"replace","path":"/spec/ports/0/nodePort","value":32000}]'</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Use the above NodePort service for quick verification only because it doesn&#8217;t communicate over the TLS connection. You may want to change the service type to ClusterIP and set up an Ingress controller to expose Grafana over a TLS connection.</p>
</div>
</blockquote>
</div>
</li>
<li>
<p>Access the Grafana dashboard using any node IP on port <code>32000</code>.</p>
<div class="listingblock">
<div class="content">
<pre> # Default Credential
 User: admin
 Pass: admin</pre>
</div>
</div>
</li>
<li>
<p>Setup Longhorn dashboard.</p>
<div class="paragraph">
<p>Once inside Grafana, import the prebuilt <a href="https://grafana.com/grafana/dashboards/17626">Longhorn example dashboard</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://grafana.com/docs/grafana/latest/reference/export_import/">Grafana Lab - Export and import</a> for instructions on how to import a Grafana dashboard.</p>
</div>
<div class="paragraph">
<p>You should see the following dashboard at successful setup:
 <span class="image"><img src="../_images/screenshots/monitoring/longhorn-example-grafana-dashboard.png" alt="images"></span></p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../data-integrity-recovery/data-recovery/recover-without-system.html">Recover from a SUSE® Storage Backup without the System Installed</a></span>
  <span class="next"><a href="alert-rule-examples.html">Alert Rule Examples</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
