<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Harvester Cloud Provider :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/virtualization/v1.5/en/integrations/rancher/cloud-provider.html">
    <link rel="prev" href="node-driver/k3s-cluster.html">
    <link rel="next" href="csi-driver.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-03-12"/>
<link rel="stylesheet" href="../../../../../_/css/search.css">
<link rel="icon" href="../../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/virtualization/v1.5/en/integrations/rancher/cloud-provider.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/virtualization/v1.5/en/integrations/rancher/cloud-provider.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/virtualization/v1.5/en/integrations/rancher/cloud-provider.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="virtualization" data-version="v1.5">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Virtualization</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../introduction/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../introduction/deploy-ha-cluster.html">Deploy a High-Availability Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../introduction/deploy-singlenode-cluster.html">Deploy a Single-Node Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../introduction/glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../introduction/document-conventions.html">Document Conventions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation and Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation-setup/requirements.html">Hardware and Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation Media</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/media/net-install.html">Net Install ISO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/media/install-binaries-mode.html">Install Binaries Only</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation Methods</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/methods/iso-install.html">ISO Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/methods/usb-install.html">USB Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/methods/pxe-boot-install.html">PXE Boot Installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/config/configuration-file.html">Configuration File</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/config/update-configuration.html">Update the Configuration After Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/config/settings.html">Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../installation-setup/config/cloudinitcrd.html">CloudInit CRD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation-setup/management-address.html">Management Address</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation-setup/external-disk.html">External Disk Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation-setup/authentication.html">Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation-setup/airgap.html">Air-Gapped Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../installation-setup/single-node-clusters.html">Single-Node Clusters</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/upgrades.html">Upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-1-2-to-v1-2-0.html">Upgrade from v1.1.2 to v1.2.0 (not recommended)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-2-0-to-v1-2-1.html">Upgrade from v1.1.2/v1.1.3/v1.2.0 to v1.2.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-2-1-to-v1-2-2.html">Upgrade from v1.2.1 to v1.2.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-2-2-to-v1-3-1.html">Upgrade from v1.2.2/v1.3.0 to v1.3.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-3-1-to-v1-3-2.html">Upgrade from v1.3.1 to v1.3.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-3-2-to-v1-4-0.html">Upgrade from v1.3.2 to v1.4.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-4-0-to-v1-4-1.html">Upgrade from v1.4.0 to v1.4.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-4-1-to-v1-4-2.html">Upgrade from v1.4.1 to v1.4.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-4-1-to-v1-4-3.html">Upgrade from v1.4.1 or v1.4.2 to v1.4.3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-4-2-to-v1-5-0.html">Upgrade from v1.4.2 or v1.4.3 to v1.5.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-4-2-to-v1-5-1.html">Upgrade from v1.4.2 or v1.4.3 to v1.5.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/v1-5-0-to-v1-5-1.html">Upgrade from v1.5.0 to v1.5.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrades/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Hosts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../hosts/hosts.html">Host Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../hosts/witness-node.html">Witness Node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../hosts/vgpu-support.html">vGPU Support</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Virtual Machines</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/virtual-machines.html">Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Virtual Machine Images</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../virtual-machines/vm-images/upload-image.html">Upload Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../virtual-machines/vm-images/custom-suse-images.html">Custom SUSE Virtual Machine Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../virtual-machines/vm-images/image-security.html">Image Security</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/create-vm.html">Create a Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/create-windows-vm.html">Create a Windows Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/edit-vm.html">Edit a Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/access-vm.html">Access to the Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/clone-vm.html">Clone a Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/backup-restore.html">Virtual Machine Backup, Snapshot &amp; Restore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/live-migration.html">Live Migration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/hotplug-volume.html">Hot-Plug Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/resource-overcommit.html">Resource Overcommit</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../virtual-machines/cpu-pinning.html">CPU Pinning</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Storage</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Volumes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../storage/volumes/create-volume.html">Create a Volume</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../storage/volumes/edit-volume.html">Edit a Volume</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../storage/volumes/clone-volume.html">Clone a Volume</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../storage/volumes/export-volume.html">Export a Volume to Image</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../storage/volumes/volume-snapshots.html">Volume Snapshots</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../storage/volumes/volume-security.html">Volume Security</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../storage/storageclass.html">StorageClass</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../storage/csidriver.html">Third-Party Storage Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../storage/longhorn-v2-data-engine.html">Longhorn V2 Data Engine</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../networking/cluster-network.html">Cluster Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../networking/vm-network.html">VM Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../networking/deep-dive.html">Networking Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../networking/load-balancer.html">Load Balancer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../networking/ip-pool.html">IP Pool</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../networking/storage-network.html">Storage Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../networking/best-practices.html">Networking Best Practices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Observability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../observability/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../observability/monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Add-ons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/add-ons.html">Add-ons</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/harvester-seeder.html">Harvester Seeder</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/lvm-local-storage.html">Local Storage Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/nvidia-driver-toolkit.html">NVIDIA Driver Toolkit</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/pcidevices-controller.html">PCI Devices Controller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/rancher-vcluster.html">Rancher Manager (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/vm-dhcp-controller.html">VM DHCP Controller (Managed DHCP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../add-ons/vm-import-controller.html">VM Import Controller</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Rancher Integration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rancher-integration.html">SUSE Rancher Prime Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="virtualization-management.html">Virtualization Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Node Driver</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="node-driver/node-driver.html">Harvester Node Driver</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="node-driver/rke1-cluster.html">Creating an RKE1 Kubernetes Cluster</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="node-driver/rke2-cluster.html">Creating an RKE2 Kubernetes Cluster</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="node-driver/k3s-cluster.html">Creating an K3s Kubernetes Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="cloud-provider.html">Harvester Cloud Provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="csi-driver.html">Harvester CSI Driver</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="resource-quota.html">Resource Quotas</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rancher-terraform-provider.html">Rancher Terraform</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="import-vm.html">Import a Cluster Built on a SUSE® Virtualization VM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="harvester-ui-extension.html">Harvester UI Extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../terraform/terraform-provider.html">Terraform Provider</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../troubleshooting/faq.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../troubleshooting/installation.html">Installation Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../troubleshooting/operating-system.html">Operating System Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../troubleshooting/cluster.html">Cluster Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../troubleshooting/virtual-machines.html">Virtual Machine Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../troubleshooting/monitoring.html">Monitoring Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../troubleshooting/rancher.html">Rancher Issues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Developer Content</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../developer/addon-development.html">Add-on Development Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../api.html">API</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Virtualization</span>
    <span class="version">v1.5 (Latest)</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-current is-latest">
              <a href="../../introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/virtualization" title="SUSE Virtualization" aria-label="SUSE Documentation - SUSE Virtualization">
        SUSE Virtualization
      </a>
    </li>
      <li>
          Integrations
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.5 (Latest)</button>
  <div class="version-menu">
    <a class="version" href="../../../../v1.6/en/integrations/rancher/cloud-provider.html">v1.6 (Dev)</a>
    <a class="version is-current" href="cloud-provider.html">v1.5 (Latest)</a>
    <a class="version" href="../../../../v1.4/en/integrations/rancher/cloud-provider.html">v1.4</a>
    <a class="version" href="../../../../v1.3/en/integrations/rancher/cloud-provider.html">v1.3</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/harvester-product-docs/edit/main/versions/v1.5/modules/en/pages/integrations/rancher/cloud-provider.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:virtualization" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Harvester Cloud Provider</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="node-driver/rke1-cluster.html" class="xref page">RKE1</a> and <a href="node-driver/rke2-cluster.html" class="xref page">RKE2</a> clusters can be provisioned in Rancher using the built-in Harvester Node Driver. Harvester provides <a href="#_load_balancer_support">load balancer</a> and Harvester cluster <a href="csi-driver.html" class="xref page">storage passthrough</a> support to the guest Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>In this page we will learn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to deploy the Harvester cloud provider in both RKE1 and RKE2 cluster.</p>
</li>
<li>
<p>How to use the <a href="#_load_balancer_support">Harvester load balancer</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_backward_compatibility_notice"><a class="anchor" href="#_backward_compatibility_notice"></a>Backward Compatibility Notice</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note a known backward compatibility issue if you&#8217;re using the Harvester cloud provider version <strong>v0.2.2</strong> or higher. If your Harvester version is below <strong>v1.2.0</strong> and you intend to use newer RKE2 versions (i.e., &gt;= <code>v1.26.6+rke2r1</code>, <code>v1.25.11+rke2r1</code>, <code>v1.24.15+rke2r1</code>), it is essential to upgrade your Harvester cluster to v1.2.0 or a higher version before proceeding with the upgrade of the guest Kubernetes cluster or Harvester cloud provider.</p>
</div>
<div class="paragraph">
<p>For a detailed support matrix, please refer to the <strong>Harvester CCM &amp; CSI Driver with RKE2 Releases</strong> section of the official <a href="https://www.suse.com/suse-harvester/support-matrix/all-supported-versions/">website</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying"><a class="anchor" href="#_deploying"></a>Deploying</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>The Kubernetes cluster is built on top of Harvester virtual machines.</p>
</li>
<li>
<p>The Harvester virtual machines run as guest Kubernetes nodes are in the same namespace.</p>
</li>
<li>
<p>The Harvester virtual machine guests' hostnames match their corresponding Harvester virtual machine names. Guest cluster Harvester VMs can&#8217;t have different hostnames than their Harvester VM names when using the Harvester CSI driver. We hope <a href="https://github.com/harvester/harvester/issues/4396">to remove this limitation</a> in a future release of Harvester.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each Harvester VM must have the <code>macvlan</code> kernel module, which is required for the <code>LoadBalancer</code> services of the <strong>DHCP</strong> IPAM mode.</p>
</div>
<div class="paragraph">
<p>To check if the kernel module is available, access the VM and run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">lsmod | grep macvlan
sudo modprobe macvlan</code></pre>
</div>
</div>
<div class="paragraph">
<p>The kernel module is likely to be missing if the following occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$ lsmod | grep macvlan</code> does not produce output.</p>
</li>
<li>
<p><code>$ sudo modprobe macvlan</code> displays an error message similar to <code>modprobe: FATAL: Module macvlan not found in directory /lib/modules/5.14.21-150400.22-default</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, the <code>macvlan</code> kernel module is not included in SUSE Linux Enterprise 15 Service Pack 4/5/6 minimal cloud images (see <a href="https://github.com/harvester/harvester/issues/6418">Issue #6418</a>). Those images contain the <a href="https://software.opensuse.org/package/kernel-default-base"><code>kernel-default-base</code></a> package, which includes only the base modules. However, the <code>macvlan</code> kernel driver becomes available when you install the <code>kernel-default</code> package.</p>
</div>
<div class="paragraph">
<p>To eliminate the need for manual intervention after the guest cluster is provisioned, build your own cloud images using the openSUSE Build Service (OBS). You must remove the <code>kernel-default-base</code> package and add the <code>kernel-default</code> package in the <code>Minimal.kiwi</code> file to ensure that the resulting cloud image includes the <code>macvlan</code> kernel module. For more information, see <a href="../../virtual-machines/vm-images/custom-suse-images.html" class="xref page">Custom SUSE VM Images</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_to_the_rke1_cluster_with_harvester_node_driver"><a class="anchor" href="#_deploying_to_the_rke1_cluster_with_harvester_node_driver"></a>Deploying to the RKE1 Cluster with Harvester Node Driver</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rancher Kubernetes Engine (RKE) will reach the end of its life on <strong>July 31, 2025</strong>. SUSE Virtualization <strong>v1.6.0</strong> and later versions will not support RKE. Switching to RKE2, which provides a more secure and efficient environment, is recommended.</p>
</div>
<div class="paragraph">
<p>In-place upgrades are not an option, so you must create new RKE2 clusters and migrate the workloads from your existing RKE clusters (known as replatforming). For more information, see <a href="https://www.suse.com/support/kb/doc/?id=000021513">RKE End of Life</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When spinning up an RKE cluster using the Harvester node driver, you can perform two steps to deploy the <code>Harvester</code> cloud provider:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <code>Harvester(Out-of-tree)</code> option.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/rke-cloud-provider.png" alt="rke cloud provider">
</div>
</div>
</li>
<li>
<p>Install <code>Harvester Cloud Provider</code> from the Rancher marketplace.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/install-harvester-cloud-provider.png" alt="install harvester cloud provider">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_to_the_rke2_cluster_with_harvester_node_driver"><a class="anchor" href="#_deploying_to_the_rke2_cluster_with_harvester_node_driver"></a>Deploying to the RKE2 Cluster with Harvester Node Driver</h3>
<div class="paragraph">
<p>When spinning up an RKE2 cluster using the Harvester node driver, select the <code>Harvester</code> cloud provider. The node driver will then help deploy both the CSI driver and CCM automatically.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/rke2-cloud-provider.png" alt="rke2 cloud provider">
</div>
</div>
<div class="paragraph">
<p>Starting with Rancher v2.9.0, you can configure a specific folder for cloud config data using the <strong>Data directory configuration path</strong> field.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/rke2-cloud-provider-custom-data-dir.png" alt="rke2 cloud provider custom data dir">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manually_deploying_to_the_rke2_cluster"><a class="anchor" href="#_manually_deploying_to_the_rke2_cluster"></a>Manually Deploying to the RKE2 Cluster</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate cloud config data using the script <code>generate_addon.sh</code>, and then place the data on every custom node (directory: <code>/etc/kubernetes/cloud-config</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">    curl -sfL https://raw.githubusercontent.com/harvester/cloud-provider-harvester/master/deploy/generate_addon.sh | bash -s &lt;serviceaccount name&gt; &lt;namespace&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The script depends on <code>kubectl</code> and <code>jq</code> when operating the Harvester cluster, and functions only when given access to the <code>Harvester Cluster</code> kubeconfig file.</p>
</div>
<div class="paragraph">
<p>You can find the <code>kubeconfig</code> file in one of the Harvester management nodes in the <code>/etc/rancher/rke2/rke2.yaml</code> path. The server IP must be replaced with the VIP address.</p>
</div>
<div class="paragraph">
<p>Example of content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: &lt;redacted&gt;
    server: https://127.0.0.1:6443
  name: default
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must specify the namespace in which the guest cluster will be created.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example of output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">########## cloud config ############
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: &lt;CACERT&gt;
    server: https://HARVESTER-ENDPOINT/k8s/clusters/local
  name: local
contexts:
- context:
    cluster: local
    namespace: default
    user: harvester-cloud-provider-default-local
  name: harvester-cloud-provider-default-local
current-context: harvester-cloud-provider-default-local
kind: Config
preferences: {}
users:
- name: harvester-cloud-provider-default-local
  user:
    token: &lt;TOKEN&gt;

########## cloud-init user data ############
write_files:
- encoding: b64
  content: &lt;CONTENT&gt;
  owner: root:root
  path: /etc/kubernetes/cloud-config
  permissions: '0644'</code></pre>
</div>
</div>
</li>
<li>
<p>On the RKE2 cluster creation page, go to the <strong>Cluster Configuration</strong> screen and set the value of <strong>Cloud Provider</strong> to <strong>External</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/external-harvester-cloud-provider.png" alt="external harvester cloud provider">
</div>
</div>
</li>
<li>
<p>Copy and paste the <code>cloud-init user data</code> content to <strong>Machine Pools</strong> &gt; <strong>Show Advanced</strong> &gt; <strong>User Data</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/cloud-config-userdata.png" alt="cloud config userdata">
</div>
</div>
</li>
<li>
<p>Add the <code>HelmChart</code> CRD for <code>harvester-cloud-provider</code> to <strong>Cluster Configuration</strong> &gt; <strong>Add-On Config</strong> &gt; <strong>Additional Manifest</strong>.</p>
<div class="paragraph">
<p>You must replace <code>&lt;cluster-name&gt;</code> with the name of your cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"> apiVersion: helm.cattle.io/v1
 kind: HelmChart
 metadata:
   name: harvester-cloud-provider
   namespace: kube-system
 spec:
   targetNamespace: kube-system
   bootstrap: true
   repo: https://raw.githubusercontent.com/rancher/charts/dev-v2.9
   chart: harvester-cloud-provider
   version:  104.0.2+up0.2.6
   helmVersion: v3
   valuesContent: |-
     global:
       cattle:
         clusterName: &lt;cluster-name&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/external-cloud-provider-addon.png" alt="external cloud provider addon">
</div>
</div>
</li>
<li>
<p>To create the load balancer, add the annotation <code>cloudprovider.harvesterhci.io/ipam: &lt;dhcp|pool&gt;</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/harvester-cloud-provider-loadbalancer-annotation.png" alt="harvester cloud provider loadbalancer annotation">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_to_the_rke2_custom_cluster_experimental"><a class="anchor" href="#_deploying_to_the_rke2_custom_cluster_experimental"></a>Deploying to the RKE2 custom cluster (experimental)</h3>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/custom.png" alt="custom">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate cloud config data using the script <code>generate_addon.sh</code>, and then place the data on every custom node (directory: <code>/etc/kubernetes/cloud-config</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> curl -sfL https://raw.githubusercontent.com/harvester/cloud-provider-harvester/master/deploy/generate_addon.sh | bash -s &lt;serviceaccount name&gt; &lt;namespace&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The script depends on <code>kubectl</code> and <code>jq</code> when operating the Harvester cluster, and functions only when given access to the <code>Harvester Cluster</code> kubeconfig file.</p>
</div>
<div class="paragraph">
<p>You can find the <code>kubeconfig</code> file in one of the Harvester management nodes in the <code>/etc/rancher/rke2/rke2.yaml</code> path. The server IP must be replaced with the VIP address.</p>
</div>
<div class="paragraph">
<p>Example of content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: &lt;redacted&gt;
    server: https://127.0.0.1:6443
  name: default
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must specify the namespace in which the guest cluster will be created.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example of output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">########## cloud config ############
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: &lt;CACERT&gt;
    server: https://HARVESTER-ENDPOINT/k8s/clusters/local
  name: local
contexts:
- context:
    cluster: local
    namespace: default
    user: harvester-cloud-provider-default-local
  name: harvester-cloud-provider-default-local
current-context: harvester-cloud-provider-default-local
kind: Config
preferences: {}
users:
- name: harvester-cloud-provider-default-local
  user:
    token: &lt;TOKEN&gt;

########## cloud-init user data ############
write_files:
- encoding: b64
  content: &lt;CONTENT&gt;
  owner: root:root
  path: /etc/kubernetes/cloud-config
  permissions: '0644'</code></pre>
</div>
</div>
</li>
<li>
<p>Create a VM in the Harvester cluster with the following settings:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Basics</strong> tab: The minimum requirements are 2 CPUs and 4 GiB of RAM. The required disk space depends on the VM image.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/custom-cluster-vm-cpu-and-ram.png" alt="custom cluster vm cpu and ram">
</div>
</div>
</li>
<li>
<p><strong>Networks</strong> tab: Specify a network name with the format <code>nic-&lt;number&gt;</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/custom-cluster-vm-network.png" alt="custom cluster vm network">
</div>
</div>
</li>
<li>
<p><strong>Advanced Options</strong> tab: Copy and paste the content of the <strong>Cloud Config User Data</strong> screen.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/custom-cluster-vm-user-data.png" alt="custom cluster vm user data">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Basics</strong> tab of the <strong>Cluster Configuration</strong> screen, select <strong>Harvester</strong> as the <strong>Cloud Provider</strong> and then select <strong>Create</strong> to spin up the cluster.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/create-custom-rke2.png" alt="create custom rke2">
</div>
</div>
</li>
<li>
<p>On the <strong>Registration</strong> tab, perform the steps required to run the RKE2 registration command on the VM.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/custom-cluster-registration.png" alt="custom cluster registration">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_to_the_k3s_cluster_with_harvester_node_driver_experimental"><a class="anchor" href="#_deploying_to_the_k3s_cluster_with_harvester_node_driver_experimental"></a>Deploying to the K3s cluster with Harvester node driver (experimental)</h3>
<div class="paragraph">
<p>When spinning up a K3s cluster using the Harvester node driver, you can perform the following steps to deploy the harvester cloud provider:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use <code>generate_addon.sh</code> to generate cloud config.</p>
<div class="listingblock">
<div class="content">
<pre> curl -sfL https://raw.githubusercontent.com/harvester/cloud-provider-harvester/master/deploy/generate_addon.sh | bash -s &lt;serviceaccount name&gt; &lt;namespace&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The output will look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> ########## cloud config ############
 apiVersion: v1
 clusters:
 - cluster:
     certificate-authority-data: &lt;CACERT&gt;
     server: https://HARVESTER-ENDPOINT/k8s/clusters/local
   name: local
 contexts:
 - context:
     cluster: local
     namespace: default
     user: harvester-cloud-provider-default-local
   name: harvester-cloud-provider-default-local
 current-context: harvester-cloud-provider-default-local
 kind: Config
 preferences: {}
 users:
 - name: harvester-cloud-provider-default-local
   user:
     token: &lt;TOKEN&gt;


 ########## cloud-init user data ############
 write_files:
 - encoding: b64
   content: &lt;CONTENT&gt;
   owner: root:root
   path: /etc/kubernetes/cloud-config
   permissions: '0644'</pre>
</div>
</div>
</li>
<li>
<p>Copy and paste the <code>cloud-init user data</code> content to <strong>Machine Pools &gt; Show Advanced &gt; User Data</strong>.
<span class="image"><img src="../../_images/rancher/cloud-config-userdata.png" alt="cloud config userdata"></span></p>
</li>
<li>
<p>Add the following <code>HelmChart</code> yaml of <code>harvester-cloud-provider</code> to <strong>Cluster Configuration &gt; Add-On Config &gt; Additional Manifest</strong>.</p>
<div class="listingblock">
<div class="content">
<pre> apiVersion: helm.cattle.io/v1
 kind: HelmChart
 metadata:
   name: harvester-cloud-provider
   namespace: kube-system
 spec:
   targetNamespace: kube-system
   bootstrap: true
   repo: https://charts.harvesterhci.io/
   chart: harvester-cloud-provider
   version: 0.2.2
   helmVersion: v3</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/external-cloud-provider-addon.png" alt="external cloud provider addon">
</div>
</div>
</li>
<li>
<p>Disable the <code>in-tree</code> cloud provider in the following ways:</p>
<div class="ulist">
<ul>
<li>
<p>Click the <code>Edit as YAML</code> button.</p>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/edit-k3s-cluster-yaml.png" alt="edit k3s cluster yaml">
</div>
</div>
</li>
<li>
<p>Disable <code>servicelb</code> and set <code>disable-cloud-controller: true</code> to disable the default K3s cloud controller.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  machineGlobalConfig:
    disable:
      - servicelb
    disable-cloud-controller: true</code></pre>
</div>
</div>
</li>
<li>
<p>Add <code>cloud-provider=external</code> to use the Harvester cloud provider.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  machineSelectorConfig:
    - config:
        kubelet-arg:
        - cloud-provider=external
        protect-kernel-defaults: false</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/k3s-cluster-yaml-content-for-harvester-cloud-provider.png" alt="k3s cluster yaml content for harvester cloud provider">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>With these settings in place a K3s cluster should provision successfully while using the external cloud provider.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrade_cloud_provider"><a class="anchor" href="#_upgrade_cloud_provider"></a>Upgrade Cloud Provider</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_upgrade_rke2"><a class="anchor" href="#_upgrade_rke2"></a>Upgrade RKE2</h3>
<div class="paragraph">
<p>The cloud provider can be upgraded by upgrading the RKE2 version. You can upgrade the RKE2 cluster via the Rancher UI as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>☰ &gt; Cluster Management</strong>.</p>
</li>
<li>
<p>Find the guest cluster that you want to upgrade and select ⋮ <strong>&gt; Edit Config</strong>.</p>
</li>
<li>
<p>Select <strong>Kubernetes Version</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_rkek3s"><a class="anchor" href="#_upgrade_rkek3s"></a>Upgrade RKE/K3s</h3>
<div class="paragraph">
<p>RKE/K3s upgrade cloud provider via the Rancher UI, as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>☰ &gt; RKE/K3s Cluster &gt; Apps &gt; Installed Apps</strong>.</p>
</li>
<li>
<p>Find the cloud provider chart and select ⋮ <strong>&gt; Edit/Upgrade</strong>.</p>
</li>
<li>
<p>Select <strong>Version</strong>.</p>
</li>
<li>
<p>Click <strong>Next &gt; Update</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The upgrade process for a <a href="../../installation-setup/single-node-clusters.html" class="xref page">single-node guest cluster</a> may stall when the new <code>harvester-cloud-provider</code> pod is stuck in the <em>Pending</em> state. This issue is caused by a section in the <code>harvester-cloud-provider</code> deployment that describes the rolling update strategy. Specifically, the default value conflicts with the <code>podAntiAffinity</code> configuration in single-node clusters.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://github.com/harvester/harvester/issues/5348#issuecomment-2055453709">this GitHub issue comment</a>. To address the issue, manually delete the old <code>harvester-cloud-provider</code> pod. You might need to do this multiple times until the new pod can be successfully scheduled.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_load_balancer_support"><a class="anchor" href="#_load_balancer_support"></a>Load Balancer Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you&#8217;ve deployed the Harvester cloud provider, you can leverage the Kubernetes <code>LoadBalancer</code> service to expose a microservice within the guest cluster to the external world. Creating a Kubernetes <code>LoadBalancer</code> service assigns a dedicated Harvester load balancer to the service, and you can make adjustments through the <code>Add-on Config</code> within the Rancher UI.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/rancher/lb-svc.png" alt="lb svc">
</div>
</div>
<div class="sect2">
<h3 id="_ipam"><a class="anchor" href="#_ipam"></a>IPAM</h3>
<div class="paragraph">
<p>Harvester&#8217;s built-in load balancer offers both <strong>DHCP</strong> and <strong>Pool</strong> modes, and you can configure it by adding the annotation <code>cloudprovider.harvesterhci.io/ipam: $mode</code> to its corresponding service. Starting from Harvester cloud provider &gt;= v0.2.0, it also introduces a unique <strong>Share IP</strong> mode. A service shares its load balancer IP with other services in this mode.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DCHP:</strong> A DHCP server is required. The Harvester load balancer will request an IP address from the DHCP server.</p>
</li>
<li>
<p><strong>Pool:</strong> An <a href="../../networking/ip-pool.html" class="xref page">IP pool</a> must be configured first. The Harvester load balancer controller will allocate an IP for the load balancer service following <a href="../../networking/ip-pool.html#_selection_policy" class="xref page">the IP pool selection policy</a>.</p>
</li>
<li>
<p><strong>Share IP:</strong> When creating a new load balancer service, you can re-utilize an existing load balancer service IP. The new service is referred to as a secondary service, while the currently chosen service is the primary one. To specify the primary service in the secondary service, you can add the annotation <code>cloudprovider.harvesterhci.io/primary-service: $primary-service-name</code>.  However, there are two known limitations:</p>
<div class="ulist">
<ul>
<li>
<p>Services that share the same IP address can&#8217;t use the same port.</p>
</li>
<li>
<p>Secondary services cannot share their IP with additional services.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Modifying the <code>IPAM</code> mode isn&#8217;t allowed. You must create a new service if you intend to change the <code>IPAM</code> mode.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_health_checks"><a class="anchor" href="#_health_checks"></a>Health checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beginning with Harvester cloud provider v0.2.0, additional health checks of the <code>LoadBalancer</code> service within the guest Kubernetes cluster are no longer necessary. Instead, you can configure <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-a-tcp-liveness-probe">liveness</a> and <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-readiness-probes">readiness</a> probes for your workloads. Consequently, any unavailable pods will be automatically removed from the load balancer endpoints to achieve the same desired outcome.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="node-driver/k3s-cluster.html">Creating an K3s Kubernetes Cluster</a></span>
  <span class="next"><a href="csi-driver.html">Harvester CSI Driver</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../../_/js/site.js"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../.." data-snippet-length="100" data-stylesheet="../../../../../_/css/search.css"></script>
<script async src="../../../../../search-index.js"></script>
<script src="../../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
