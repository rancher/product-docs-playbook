<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Storage Network :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/virtualization/v1.5/en/networking/storage-network.html">
    <link rel="prev" href="ip-pool.html">
    <link rel="next" href="best-practices.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-07-16"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/virtualization/v1.5/en/networking/storage-network.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/virtualization/v1.4/en/networking/storage-network.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/virtualization/v1.4/en/networking/storage-network.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="virtualization" data-version="v1.4">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Virtualization</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/deploy-ha-cluster.html">Deploy a High-Availability Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/deploy-singlenode-cluster.html">Deploy a Single-Node Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/document-conventions.html">Document Conventions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation and Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/requirements.html">Hardware and Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation Media</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/media/net-install.html">Net Install ISO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/media/install-binaries-mode.html">Install Binaries Only</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation Methods</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/methods/iso-install.html">ISO Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/methods/usb-install.html">USB Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/methods/pxe-boot-install.html">PXE Boot Installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/config/configuration-file.html">Configuration File</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/config/update-configuration.html">Update the Configuration After Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/config/settings.html">Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../installation-setup/config/cloudinitcrd.html">CloudInit CRD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/management-address.html">Management Address</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/external-disk.html">External Disk Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/authentication.html">Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/airgap.html">Air-Gapped Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation-setup/single-node-clusters.html">Single-Node Clusters</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/upgrades.html">Upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-1-2-to-v1-2-0.html">Upgrade from v1.1.2 to v1.2.0 (not recommended)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-2-0-to-v1-2-1.html">Upgrade from v1.1.2/v1.1.3/v1.2.0 to v1.2.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-2-1-to-v1-2-2.html">Upgrade from v1.2.1 to v1.2.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-2-2-to-v1-3-1.html">Upgrade from v1.2.2/v1.3.0 to v1.3.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-3-1-to-v1-3-2.html">Upgrade from v1.3.1 to v1.3.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-3-2-to-v1-4-0.html">Upgrade from v1.3.2 to v1.4.0</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-4-0-to-v1-4-1.html">Upgrade from v1.4.0 to v1.4.1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-4-1-to-v1-4-2.html">Upgrade from v1.4.1 to v1.4.2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/v1-4-1-to-v1-4-3.html">Upgrade from v1.4.1 or v1.4.2 to v1.4.3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Hosts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hosts/hosts.html">Host Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hosts/witness-node.html">Witness Node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hosts/vgpu-support.html">vGPU Support</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Virtual Machines</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/virtual-machines.html">Virtual Machines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Virtual Machine Images</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../virtual-machines/vm-images/upload-image.html">Upload Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../virtual-machines/vm-images/custom-suse-images.html">Custom SUSE Virtual Machine Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../virtual-machines/vm-images/image-security.html">Image Security</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/create-vm.html">Create a Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/create-windows-vm.html">Create a Windows Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/edit-vm.html">Edit a Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/access-vm.html">Access to the Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/clone-vm.html">Clone a Virtual Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/backup-restore.html">Virtual Machine Backup, Snapshot &amp; Restore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/live-migration.html">Live Migration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/hotplug-volume.html">Hot-Plug Volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/resource-overcommit.html">Resource Overcommit</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../virtual-machines/cpu-pinning.html">CPU Pinning</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Storage</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Volumes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/volumes/create-volume.html">Create a Volume</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/volumes/edit-volume.html">Edit a Volume</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/volumes/clone-volume.html">Clone a Volume</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/volumes/export-volume.html">Export a Volume to Image</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/volumes/volume-snapshots.html">Volume Snapshots</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/volumes/volume-security.html">Volume Security</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/storageclass.html">StorageClass</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/csidriver.html">Third-Party Storage Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/longhorn-v2-data-engine.html">Longhorn V2 Data Engine</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cluster-network.html">Cluster Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vm-network.html">VM Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deep-dive.html">Networking Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="load-balancer.html">Load Balancer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ip-pool.html">IP Pool</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="storage-network.html">Storage Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="best-practices.html">Networking Best Practices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Observability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../observability/monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Add-ons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/add-ons.html">Add-ons</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/harvester-seeder.html">Harvester Seeder</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/lvm-local-storage.html">Local Storage Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/nvidia-driver-toolkit.html">NVIDIA Driver Toolkit</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/pcidevices-controller.html">PCI Devices Controller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/rancher-vcluster.html">Rancher Manager (Experimental)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/vm-dhcp-controller.html">VM DHCP Controller (Managed DHCP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/vm-import-controller.html">VM Import Controller</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Rancher Integration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/rancher-integration.html">SUSE Rancher Prime Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/virtualization-management.html">Virtualization Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Node Driver</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../integrations/rancher/node-driver/node-driver.html">Harvester Node Driver</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../integrations/rancher/node-driver/rke1-cluster.html">Creating an RKE1 Kubernetes Cluster</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../integrations/rancher/node-driver/rke2-cluster.html">Creating an RKE2 Kubernetes Cluster</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../integrations/rancher/node-driver/k3s-cluster.html">Creating an K3s Kubernetes Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/cloud-provider.html">Harvester Cloud Provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/csi-driver.html">Harvester CSI Driver</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/resource-quota.html">Resource Quotas</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/rancher-terraform-provider.html">Rancher Terraform</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/import-vm.html">Import a Cluster Built on a SUSE® Virtualization VM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/rancher/harvester-ui-extension.html">Harvester UI Extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrations/terraform/terraform-provider.html">Terraform Provider</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/faq.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/installation.html">Installation Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/operating-system.html">Operating System Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/cluster.html">Cluster Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/virtual-machines.html">Virtual Machine Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/monitoring.html">Monitoring Issues</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/rancher.html">Rancher Issues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Developer Content</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developer/addon-development.html">Add-on Development Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../api.html">API</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Virtualization</span>
    <span class="version">v1.4</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../../v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version is-current">
              <a href="../introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/virtualization" title="SUSE Virtualization" aria-label="SUSE Documentation - SUSE Virtualization">
        SUSE Virtualization
      </a>
    </li>
      <li>
          Networking
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.4</button>
  <div class="version-menu">
    <a class="version" href="../../../v1.6/en/networking/storage-network.html">v1.6 (Dev)</a>
    <a class="version" href="../../../v1.5/en/networking/storage-network.html">v1.5 (Latest)</a>
    <a class="version is-current" href="storage-network.html">v1.4</a>
    <a class="version" href="../../../v1.3/en/networking/storage-network.html">v1.3</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/harvester-product-docs/edit/main/versions/v1.4/modules/en/pages/networking/storage-network.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:virtualization" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Storage Network</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>SUSE Virtualization uses SUSE Storage to provide block device volumes for virtual machines and pods. If you want to isolate SUSE Storage replication traffic from the Kubernetes cluster network (for example, the management network) or other cluster-wide workloads, you can allocate a dedicated storage network for SUSE Storage replication traffic to get better network bandwidth and performance.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://documentation.suse.com/cloudnative/storage/1.7/en/longhorn-system/networking/storage-network.html">Storage Network</a> in the SUSE Storage documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Avoid configuring SUSE Storage settings directly, as this can result in unexpected or unwanted system behavior.</p>
</li>
<li>
<p>You can only use the SUSE Storage storage network with the default V1 Data Engine. Usage with the V2 Data Engine is not yet supported.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are some prerequisites before configuring the SUSE Virtualization <code>storage-network</code> setting.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Well-configured Cluster Network and VLAN Config.</p>
<div class="ulist">
<ul>
<li>
<p>Users have to ensure the Cluster Network is configured and VLAN Config will cover all nodes and ensure the network connectivity is working and expected in all nodes.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All VMs should be stopped.</p>
<div class="ulist">
<ul>
<li>
<p>We recommend checking the VM status with the following command and should get an empty result.</p>
</li>
<li>
<p><code>kubectl get -A vmi</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>All pods that are attached to SUSE Storage volumes should be stopped.</p>
</li>
<li>
<p>All ongoing image uploads or downloads should be either completed or deleted.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the SUSE Virtualization cluster was upgraded from v1.0.3, please check if Whereabouts CNI is installed properly before you move on to the next step. <a href="https://github.com/harvester/harvester/issues/3168">Issue 3168</a> describes that the SUSE Virtualization cluster will not always install Whereabouts CNI properly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify the <code>ippools.whereabouts.cni.cncf.io</code> CRD exists with the following command.</p>
<div class="ulist">
<ul>
<li>
<p><code>kubectl get crd ippools.whereabouts.cni.cncf.io</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If the SUSE Virtualization cluster doesn&#8217;t have <code>ippools.whereabouts.cni.cncf.io</code>, please add <a href="https://github.com/harvester/harvester/tree/v1.1.0/deploy/charts/harvester/dependency_charts/whereabouts/crds">these two CRDs</a> before configuring the <code>storage-network</code> setting.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">kubectl apply -f https://raw.githubusercontent.com/harvester/harvester/v1.1.0/deploy/charts/harvester/dependency_charts/whereabouts/crds/whereabouts.cni.cncf.io_ippools.yaml
kubectl apply -f https://raw.githubusercontent.com/harvester/harvester/v1.1.0/deploy/charts/harvester/dependency_charts/whereabouts/crds/whereabouts.cni.cncf.io_overlappingrangeipreservations.yaml</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_example"><a class="anchor" href="#_configuration_example"></a>Configuration example</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>VLAN ID</p>
<div class="ulist">
<ul>
<li>
<p>Please check with your network switch setting, and provide a dedicated VLAN ID for storage network.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Well-configured Cluster Network and VLAN Config</p>
<div class="ulist">
<ul>
<li>
<p>Please refer Networking page for more details and configure <code>Cluster Network</code> and <code>VLAN Config</code> but not <code>Networks</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>IP range for storage network</p>
<div class="ulist">
<ul>
<li>
<p>IP range should not conflict or overlap with Kubernetes cluster networks(<code>10.42.0.0/16</code>, <code>10.43.0.0/16</code>, <code>10.52.0.0/16</code> and <code>10.53.0.0/16</code> are reserved).</p>
</li>
<li>
<p>IP range should be in IPv4 CIDR format and SUSE Storage pods use storage network as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>instance-manager</code> pods: Instance Manager components were consolidated in SUSE Storage v1.5.0. The Engine Instance Manager and Replica Instance Manager are now deprecated. One IP is required for each node. During an upgrade, two versions of these pods will exist (old and new), and the old version will be deleted once the upgrade is successful.</p>
</li>
<li>
<p><code>backing-image-ds</code> pods: These are employed to process on-the-fly uploads and downloads of backing image data sources. These pods will be removed once the image uploads or downloads are completed.</p>
</li>
<li>
<p><code>backing-image-manager</code> pods: 1 IP per disk, similar to the instance manager pods. Two versions of these will coexist during an upgrade, and the old ones will be removed after the upgrade is completed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The required number of IPs is calculated using a simple formula: <code>Required Number of IPs = (Number of Nodes * 2) + (Number of Disks * 2) + Number of Images to Download/Upload</code></p>
<div class="paragraph">
<p>Example: If a cluster has five nodes with two disks each, and ten images will be uploaded simultaneously, the IP range should be greater than or equal to <code>/26</code> (<code>(5 * 2) + (5 * 2) + 10 = 30</code>).</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Exclude IP addresses that SUSE Storage pods and the storage network must not use, such as addresses reserved for <a href="../integrations/rancher/csi-driver.html#_rwx_volume_support" class="xref page">RWX volume support</a>, the gateway, and other components.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will take the following configuration as an example to explain the details of the storage network.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VLAN ID for storage network: <code>100</code></p>
</li>
<li>
<p>Cluster network: <code>storage</code></p>
</li>
<li>
<p>IP range: <code>192.168.0.0/24</code></p>
</li>
<li>
<p>IP address to be excluded: <code>192.168.0.1/32</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_process"><a class="anchor" href="#_configuration_process"></a>Configuration process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SUSE Virtualization creates a Multus <code>NetworkAttachmentDefinition</code> from the configuration, stops pods related to SUSE Storage volumes, updates SUSE Storage settings, and restarts previous pods.</p>
</div>
<div class="sect2">
<h3 id="_before_applying_the_storage_network_setting"><a class="anchor" href="#_before_applying_the_storage_network_setting"></a>Before applying the <code>storage-network</code> setting</h3>
<div class="paragraph">
<p>Here we have two cases.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expect that VM VLAN traffic and SUSE Storage storage network use the same group of physical interfaces.</p>
</li>
<li>
<p>Expect that VM VLAN traffic and SUSE Storage storage network use different physical interfaces.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SUSE Storage will send replication traffic through the specific interfaces shown as the red line in the figure.</p>
</div>
<div class="sect3">
<h4 id="_same_physical_interfaces"><a class="anchor" href="#_same_physical_interfaces"></a>Same physical interfaces</h4>
<div class="paragraph">
<p>Take <code>eth2</code> and <code>eth3</code> as an example for VM VLAN traffic and SUSE Storage storage network simultaneously.</p>
</div>
<div class="paragraph">
<p>Please refer Networking page to configure <code>ClusterNetwork</code> and <code>VLAN Config</code> with <code>eth2</code> and <code>eth3</code> and remember the <code>ClusterNetwork</code> name for the further step.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/storagenetwork/storagenetwork-same.png" alt="storagenetwork-same.png">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_different_physical_interfaces"><a class="anchor" href="#_different_physical_interfaces"></a>Different physical interfaces</h4>
<div class="paragraph">
<p><code>eth2</code> and <code>eth3</code> are for VM VLAN Traffic. <code>eth4</code> and <code>eth5</code> are for SUSE Storage storage network.</p>
</div>
<div class="paragraph">
<p>Please refer Networking page to configure <code>ClusterNetwork</code> and <code>VLAN Config</code> with <code>eth4</code> and <code>eth5</code> for storage network and remember the <code>ClusterNetwork</code> name for the further step.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/storagenetwork/storagenetwork-diff.png" alt="storagenetwork-diff.png">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storage_network_setting"><a class="anchor" href="#_storage_network_setting"></a><code>storage-network</code> setting</h3>
<div class="paragraph">
<p>The <a href="../installation-setup/config/settings.html#_storage_network" class="xref page"><code>storage-network</code> setting</a> allows you to configure the network used to isolate in-cluster storage traffic when segregation is required.</p>
</div>
<div class="paragraph">
<p>You can <a href="#_enable_the_storage_network">enable</a> and <a href="#_disable_the_storage_network">disable</a> the storage network using either the UI or the CLI. When the setting is enabled, you must construct a Multus <code>NetworkAttachmentDefinition</code> CRD by configuring certain fields.</p>
</div>
<div class="sect3">
<h4 id="_suse_virtualization_ui"><a class="anchor" href="#_suse_virtualization_ui"></a>SUSE Virtualization UI</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the SUSE Virtualization UI to configure the <code>storage-network</code> setting is strongly recommended.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_enable_the_storage_network"><a class="anchor" href="#_enable_the_storage_network"></a>Enable the storage network</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Advanced &#8594; Settings &#8594; storage-network</strong>.</p>
</li>
<li>
<p>Select <strong>Enabled</strong>.</p>
</li>
<li>
<p>Configure the <strong>VLAN ID</strong>, <strong>Cluster Network</strong>, <strong>IP Range</strong>, and <strong>Exclude</strong> fields to construct a Multus <code>NetworkAttachmentDefinition</code> CRD.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/storagenetwork/storage-network-enabled.png" alt="Storage network enabled">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_disable_the_storage_network"><a class="anchor" href="#_disable_the_storage_network"></a>Disable the storage network</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Advanced &#8594; Settings &#8594; storage-network</strong>.</p>
</li>
<li>
<p>Select <strong>Disable</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the storage network is disabled, SUSE Storage starts using the pod network for storage-related operations.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/storagenetwork/storage-network-disabled.png" alt="Storage network disabled">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cli"><a class="anchor" href="#_cli"></a>CLI</h4>
<div class="paragraph">
<p>You can use the following command to configure the <a href="../installation-setup/config/settings.html#_storage_network" class="xref page"><code>storage-network</code> setting</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl edit settings.harvesterhci.io storage-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>The storage network is automatically enabled in the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>value</code> field contains a valid JSON string.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: harvesterhci.io/v1beta1
kind: Setting
metadata:
  name: storage-network
value: '{"vlan":100,"clusterNetwork":"storage","range":"192.168.0.0/24", "exclude":["192.168.0.100/32"]}'</code></pre>
</div>
</div>
</li>
<li>
<p>The <code>value</code> field is empty.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: harvesterhci.io/v1beta1
kind: Setting
metadata:
  name: storage-network
value: ''</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The storage network is disabled when you remove the <code>value</code> field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: harvesterhci.io/v1beta1
kind: Setting
metadata:
  name: storage-network</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SUSE Virtualization considers extra insignificant characters in a JSON string as a different configuration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_change_the_mtu_of_the_storage_network"><a class="anchor" href="#_change_the_mtu_of_the_storage_network"></a>Change the MTU of the storage network</h4>
<div class="paragraph">
<p>Follow the instructions in <a href="cluster-network.html#_change_the_mtu_of_a_network_configuration_with_an_attached_storage_network" class="xref page">Change the MTU of a network configuration with an attached storage network</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_after_applying_the_storage_network_setting"><a class="anchor" href="#_after_applying_the_storage_network_setting"></a>After applying the <code>storage-network</code> setting</h3>
<div class="paragraph">
<p>SUSE Virtualization will stop all pods that are related to SUSE Storage volumes. Currently, SUSE Virtualization has some pods listed below that will be stopped during setting.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prometheus</p>
</li>
<li>
<p>Grafana</p>
</li>
<li>
<p>Alertmanager</p>
</li>
<li>
<p>VM Import Controller</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SUSE Virtualization will also create a new <code>NetworkAttachmentDefinition</code> and update the SUSE Storage storage network setting.</p>
</div>
<div class="paragraph">
<p>Once the SUSE Storage setting is updated, SUSE Storage will restart all <code>instance-manager-r</code>, <code>instance-manager-e</code>, and <code>backing-image-manager</code> pods to apply the new network configuration, and SUSE Virtualization will restart the pods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SUSE Virtualization will not start VM automatically. Users should check whether the configuration is completed or not in the next section and start VM manually on demand.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_verify_that_the_configuration_is_completed"><a class="anchor" href="#_verify_that_the_configuration_is_completed"></a>Verify that the configuration is completed</h3>
<div class="sect3">
<h4 id="_step_1"><a class="anchor" href="#_step_1"></a>Step 1</h4>
<div class="paragraph">
<p>Check if the <code>storage-network</code> setting&#8217;s status is <code>True</code> and the type is <code>configured</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get settings.harvesterhci.io storage-network -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Completed Setting Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: harvesterhci.io/v1beta1
kind: Setting
metadata:
  annotations:
    storage-network.settings.harvesterhci.io/hash: da39a3ee5e6b4b0d3255bfef95601890afd80709
    storage-network.settings.harvesterhci.io/net-attach-def: ""
    storage-network.settings.harvesterhci.io/old-net-attach-def: ""
  creationTimestamp: "2022-10-13T06:36:39Z"
  generation: 51
  name: storage-network
  resourceVersion: "154638"
  uid: 2233ad63-ee52-45f6-a79c-147e48fc88db
status:
  conditions:
  - lastUpdateTime: "2022-10-13T13:05:17Z"
    reason: Completed
    status: "True"
    type: configured</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2"><a class="anchor" href="#_step_2"></a>Step 2</h4>
<div class="paragraph">
<p>Verify the readiness of all SUSE Storage <code>instance-manager-e</code>, <code>instance-manager-r</code>, and <code>backing-image-manager</code> pods, and confirm that their networks are correctly configured.</p>
</div>
<div class="paragraph">
<p>Execute the following command to inspect a pod&#8217;s details:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n longhorn-system describe pod &lt;pod-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you encounter an event resembling the following one, the storage network might have run out of its available IPs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Events:
  Type     Reason                  Age                    From     Message
  ----     ------                  ----                   ----     -------
  ....

  Warning  FailedCreatePodSandBox  2m58s                  kubelet  Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for
 sandbox "04e9bc160c4f1da612e2bb52dadc86702817ac557e641a3b07b7c4a340c9fc48": plugin type="multus" name="multus-cni-network" failed (add): [longhorn-system/ba
cking-image-ds-default-image-lxq7r/7d6995ee-60a6-4f67-b9ea-246a73a4df54:storagenetwork-sdfg8]: error adding container to network "storagenetwork-sdfg8": erro
r at storage engine: Could not allocate IP in range: ip: 172.16.0.1 / - 172.16.0.6 / range: net.IPNet{IP:net.IP{0xac, 0x10, 0x0, 0x0}, Mask:net.IPMask{0xff,
0xff, 0xff, 0xf8}}

  ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please reconfigure the storage network with a sufficient IP range.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the storage network has run out of IPs, you might encounter the same error when you upload/download images. Please delete the related images and reconfigure the storage network with a sufficient IP range.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_step_3"><a class="anchor" href="#_step_3"></a>Step 3</h4>
<div class="paragraph">
<p>Check the <code>k8s.v1.cni.cncf.io/network-status</code> annotations and ensure that an interface named <code>lhnet1</code> exists, with an IP address within the designated IP range.</p>
</div>
<div class="paragraph">
<p>Users could use the following command to show all Instance Manager to verify.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get pods -n longhorn-system -l longhorn.io/component=instance-manager -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Correct Network Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Pod
metadata:
  annotations:
    cni.projectcalico.org/containerID: 2518b0696f6635896645b5546417447843e14208525d3c19d7ec6d7296cc13cd
    cni.projectcalico.org/podIP: 10.52.2.122/32
    cni.projectcalico.org/podIPs: 10.52.2.122/32
    k8s.v1.cni.cncf.io/network-status: |-
      [{
          "name": "k8s-pod-network",
          "ips": [
              "10.52.2.122"
          ],
          "default": true,
          "dns": {}
      },{
          "name": "harvester-system/storagenetwork-95bj4",
          "interface": "lhnet1",
          "ips": [
              "192.168.0.3"
          ],
          "mac": "2e:51:e6:31:96:40",
          "dns": {}
      }]
    k8s.v1.cni.cncf.io/networks: '[{"namespace": "harvester-system", "name": "storagenetwork-95bj4",
      "interface": "lhnet1"}]'
    k8s.v1.cni.cncf.io/networks-status: |-
      [{
          "name": "k8s-pod-network",
          "ips": [
              "10.52.2.122"
          ],
          "default": true,
          "dns": {}
      },{
          "name": "harvester-system/storagenetwork-95bj4",
          "interface": "lhnet1",
          "ips": [
              "192.168.0.3"
          ],
          "mac": "2e:51:e6:31:96:40",
          "dns": {}
      }]
    kubernetes.io/psp: global-unrestricted-psp
    longhorn.io/last-applied-tolerations: '[{"key":"kubevirt.io/drain","operator":"Exists","effect":"NoSchedule"}]'

Omitted...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_4"><a class="anchor" href="#_step_4"></a>Step 4</h4>
<div class="paragraph">
<p>The storage network is dedicated to <a href="#_same_physical_interfaces">internal communication between SUSE Storage pods</a>, resulting in high performance and reliability. However, the storage network still relies on the <a href="deep-dive.html#_external_networking" class="xref page">external network infrastructure</a> for connectivity (similar to how the <a href="vm-network.html#_create_a_vm_with_vlan_network" class="xref page">VM VLAN network</a> functions). When the external network is not connected and configured correctly, you may encounter the following issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The newly created VM becomes stuck at the <code>Not-Ready</code> state.</p>
</li>
<li>
<p>The <code>longhorn-manager</code> pod logs include error messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>longhorn-manager-j6dhh/longhorn-manager.log:2024-03-20T16:25:24.662251001Z time="2024-03-20T16:25:24Z" level=error msg="Failed rebuilding of replica 10.0.16.26:10000" controller=longhorn-engine engine=pvc-0a151c59-ffa9-4938-9c86-59ebb296bc88-e-c2a7fe77 error="proxyServer=10.52.6.33:8501 destination=10.0.16.23:10000: failed to add replica tcp://10.0.16.26:10000 for volume: rpc error: code = Unknown desc = failed to get replica 10.0.16.26:10000: rpc error: code = Unavailable desc = all SubConns are in TransientFailure, latest connection error: connection error: desc = \"transport: Error while dialing dial tcp 10.0.16.26:10000: connect: no route to host\"" node=oml-harvester-9 volume=pvc-0a151c59-ffa9-4938-9c86-59ebb296bc88</pre>
</div>
</div>
<div class="paragraph">
<p>To test the communication between SUSE Storage pods, perform the following steps:</p>
</div>
<div class="paragraph">
<p>4.1 Obtain the storage network IP of each Instance Manager pod identified in the previous step.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>instance-manager-r-43f1624d14076e1d95cd72371f0316e2
storage network IP: 10.0.16.8

instance-manager-e-ba38771e483008ce61249acf9948322f
storage network IP: 10.0.16.14</pre>
</div>
</div>
<div class="paragraph">
<p>4.2 Log in to those pods.</p>
</div>
<div class="paragraph">
<p>When you run the command <code>ip addr</code>, the output includes IPs that are identical to IPs in the pod annotations. In the following example, one IP is for the pod network, while the other is for the storage network.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl exec -i -t -n longhorn-system instance-manager-e-ba38771e483008ce61249acf9948322f -- /bin/sh

$ ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
...
3: eth0@if2277: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default // pod network link
    link/ether 0e:7c:d6:77:44:72 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.52.6.146/32 scope global eth0
...
4: lhnet1@if2278: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default // storage network link, note the MTU value
    link/ether fe:92:4f:fb:dd:20 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.0.16.14/20 brd 10.0.31.255 scope global lhnet1
...

$ ip route
default via 169.254.1.1 dev eth0
10.0.16.0/20 dev lhnet1 proto kernel scope link src 10.0.16.14
169.254.1.1 dev eth0 scope link</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The storage network link always inherits the MTU value of the attached <a href="cluster-network.html#_cluster_network" class="xref page">cluster network</a>, regardless of the configured <a href="cluster-network.html#_change_the_mtu_of_a_network_configuration_with_an_attached_storage_network" class="xref page">MTU value</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4.3 Start a simple HTTP server in one pod.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ python3 -m http.server 8000 --bind 10.0.16.14 (replace with your pod storage network IP)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Explicitly bind the simple HTTP server to the storage network IP.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4.4 Test the HTTP server in another pod.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>From instance-manager-r-43f1624d14076e1d95cd72371f0316e2 (IP 10.0.16.8)

$ curl http://10.0.16.14:8000</pre>
</div>
</div>
<div class="paragraph">
<p>When the storage network is functioning correctly, the <code>curl</code> command returns a list of files on the HTTP server.</p>
</div>
<div class="paragraph">
<p>4.5 (Optional) Troubleshoot issues.</p>
</div>
<div class="paragraph">
<p>The storage network may malfunction because of issues with the external network, such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Physical NICs (installed on SUSE Virtualization nodes) that are associated with the storage network were not added to the same VLAN in the external switches.</p>
</li>
<li>
<p>The external switches are not correctly connected and configured.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_virtual_machines_manually"><a class="anchor" href="#_start_virtual_machines_manually"></a>Start virtual machines manually</h3>
<div class="paragraph">
<p>After verifying the configuration, users could start VM manually on demand.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_best_practices"><a class="anchor" href="#_best_practices"></a>Best practices</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>When configuring an <a href="#_configuration_example">IP range</a> for the storage network, ensure that the allocated IP addresses can service the future needs of the cluster. This is important because SUSE Storage pods (<code>instance-manager</code> and <code>backing-image-manager</code>) stop running when new nodes are added to the cluster or more disks are added to a node after the storage network is configured, and when the required number of IPs exceeds the allocated IPs. Resolving the issue involves reconfiguring the storage network with the correct IP range.</p>
</li>
<li>
<p>Configure the storage network on a non-<code>mgmt</code> cluster network to ensure complete separation of the SUSE Storage replication traffic from the Kubernetes control plane traffic. Using <code>mgmt</code> is possible but not recommended because of the negative impact (resource and bandwidth contention) on the control plane network performance. Use <code>mgmt</code> only if your cluster has NIC-related constraints and if you can completely segregate the traffic.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="ip-pool.html">IP Pool</a></span>
  <span class="next"><a href="best-practices.html">Networking Best Practices</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
