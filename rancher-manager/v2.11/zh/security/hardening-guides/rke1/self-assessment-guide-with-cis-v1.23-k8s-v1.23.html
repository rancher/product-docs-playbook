<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RKE 自我评估指南 - CIS Benchmark v1.23 - K8s v1.23 :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/rancher-manager/v2.11/zh/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">
    <link rel="prev" href="rke1.html">
    <link rel="next" href="self-assessment-guide-with-cis-v1.24-k8s-v1.24.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-03-21"/>
<link rel="stylesheet" href="../../../../../../_/css/search.css">
<link rel="icon" href="../../../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/rancher-manager/v2.11/zh/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/rancher-manager/v2.11/en/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/rancher-manager/v2.11/zh/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html" hrefLang="zh-CN" rel="alternate" />


<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/rancher-manager/v2.11/en/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html" hreflang="en-US" rel="alternate" />









<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="rancher-manager" data-version="v2.11">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Rancher Manager</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../release-notes.html">发版说明</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">About Rancher</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../about-rancher/what-is-rancher.html">什么是 SUSE Rancher Prime？</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../about-rancher/prime.html">Cloud Native</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../about-rancher/overview.html">概述</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../about-rancher/architecture/architecture.html">架构</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../about-rancher/architecture/recommendations.html">架构推荐</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../about-rancher/architecture/communicating-with-downstream-clusters.html">与下游集群通信</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../about-rancher/architecture/rancher-server-and-components.html">SUSE Rancher Prime Server 和 Components</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../about-rancher/concepts.html">Kubernetes 概念</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../about-rancher/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/installation-and-upgrade.html">Installation and Upgrades</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/quick-start.html">SUSE Rancher Prime 部署快速入门指南</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/deploy-rancher/deploy-rancher.html">部署 SUSE Rancher Prime Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/deploy-rancher/helm-cli.html">Helm CLI 快速入门</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/deploy-rancher/aws-marketplace.html">Cloud Native AWS Marketplace 快速入门</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/deploy-rancher/equinix-metal.html">SUSE Rancher Prime Equinix Metal 快速入门</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/deploy-workloads/deploy-workloads.html">部署工作负载</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/deploy-workloads/workload-ingress.html">部署带有 Ingress 的工作负载</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/quick-start/deploy-workloads/nodeports.html">部署带有 NodePort 的工作负载</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/requirements/requirements.html">安装要求</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/requirements/install-docker.html">安装 Docker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/requirements/dockershim.html">Dockershim</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/requirements/port-requirements.html">端口要求</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/requirements/helm-version-requirements.html">Helm 版本要求</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/best-practices.html">SUSE Rancher Prime Server 的最佳实践</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/deployment-strategy.html">SUSE Rancher Prime 部署策略</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/tips-for-running-rancher.html">SUSE Rancher Prime 运行技巧</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/tuning-rancher-at-scale.html">SUSE Rancher Prime 大规模部署的调优和最佳实践</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/tuning-etcd-for-large-installs.html">为大型安装进行 etcd 调优</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/high-availability-installs.html">高可用安装</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/rancher-on-vsphere.html">在 vSphere 环境中安装 SUSE Rancher Prime</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/best-practices/resources.html">其他资源</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/references/references.html">安装参考</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/references/helm-chart-options.html">SUSE Rancher Prime Helm Chart 选项</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/references/tls-settings.html">TLS 设置</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/references/feature-flags.html">功能开关</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/resources/resources.html">资源</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/resources/bootstrap-password.html">引导密码</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/resources/tls-secrets.html">添加 TLS 密文</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/resources/custom-ca-root-certificates.html">自定义 CA 根证书</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/resources/update-rancher-certificate.html">更新 SUSE Rancher Prime 证书</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/resources/upgrade-cert-manager.html">升级 Cert-Manager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/infrastructure-setup.html">Kubernetes 集群基础设施</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/ha-k3s-kubernetes-cluster.html">为高可用 SUSE® Rancher Prime: K3s Kubernetes 集群设置基础设施</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/ha-rke2-kubernetes-cluster.html">为高可用 SUSE® Rancher Prime: RKE2 Kubernetes 集群设置基础设施</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/ha-rke1-kubernetes-cluster.html">为高可用 RKE Kubernetes 集群设置基础设施</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/nodes-in-amazon-ec2.html">在 Amazon EC2 中配置节点</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/mysql-database-in-amazon-rds.html">在 Amazon RDS 中创建 MySQL 数据库</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/amazon-elb-load-balancer.html">设置 Amazon NLB 网络负载均衡器</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/configure-layer-7-nginx-load-balancer.html">7 层 NGINX 负载均衡器上的 TLS 终止（Docker 安装）</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/infrastructure-setup/nginx-load-balancer.html">配置 NGINX 负载均衡器</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/install-kubernetes/install-kubernetes.html">Kubernetes 使用教程</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/install-kubernetes/k3s-for-rancher.html">为 SUSE Rancher Prime 设置高可用 SUSE® Rancher Prime: K3s Kubernetes 集群</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/install-kubernetes/rke2-for-rancher.html">为 SUSE Rancher Prime 设置高可用的 SUSE® Rancher Prime: RKE2 Kubernetes 集群</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/install-kubernetes/rke1-for-rancher.html">配置高可用的 RKE Kubernetes 集群</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/rancher-on-aks.html">在 Azure Kubernetes Service 上安装 SUSE Rancher Prime</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/rancher-on-amazon-eks.html">在 Amazon EKS 上安装 SUSE Rancher Prime</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/rancher-on-gke.html">在 GKE 集群上安装 SUSE Rancher Prime</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/cloud-marketplace/cloud-marketplace.html">云市场集成</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/cloud-marketplace/aws/aws.html">AWS Marketplace 集成</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/cloud-marketplace/aws/adapter-requirements.html">先决条件</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/cloud-marketplace/aws/install-adapter.html">安装 Adapter</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/cloud-marketplace/aws/uninstall-adapter.html">卸载 Adapter</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/cloud-marketplace/aws/common-issues.html">常见问题</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/hosted-kubernetes/cloud-marketplace/supportconfig.html">Supportconfig Bundle</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/other-installation-methods.html">其他安装方式</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/air-gapped/air-gapped.html">离线 Helm CLI 安装</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/air-gapped/infrastructure-private-registry.html">1. 设置基础设施和私有镜像仓库</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/air-gapped/publish-images.html">2. 收集镜像并发布到私有仓库</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/air-gapped/install-kubernetes.html">3. 安装 Kubernetes（Docker 安装请跳过）</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/air-gapped/install-rancher-ha.html">4. 安装 SUSE Rancher Prime</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/air-gapped/local-system-charts.html">离线安装中设置本地 System Charts</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/air-gapped/upgrades.html">在离线环境中升级</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/http-proxy/http-proxy.html">使用 HTTP 代理安装 SUSE Rancher Prime</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/http-proxy/set-up-infrastructure.html">1. 配置基础设施</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/http-proxy/install-kubernetes.html">2. 安装 Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../installation-and-upgrade/other-installation-methods/http-proxy/install-rancher.html">3. 安装 SUSE Rancher Prime</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../installation-and-upgrade/install-rancher.html">在 Kubernetes 集群上安装/升级 SUSE Rancher Prime</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../installation-and-upgrade/upgrades.html">升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../installation-and-upgrade/rollbacks.html">回滚</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../installation-and-upgrade/troubleshooting/troubleshooting.html">SUSE Rancher Prime Server Kubernetes 集群的问题排查</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/troubleshooting/certificate-troubleshooting.html">证书故障排除</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../installation-and-upgrade/troubleshooting/rancher-ha.html">SUSE Rancher Prime HA</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/rancher-admin.html">Rancher Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">User Management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/authn-and-authz.html">配置认证</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/manage-users-and-groups.html">用户和组</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/create-local-users.html">本地身份验证</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">External Authentication</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/jwt-authentication.html">JSON Web Token (JWT) Authentication</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-generic-oidc.html">Configure Generic OIDC</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-active-directory.html">配置 Active Directory (AD)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-azure-ad.html">配置 Azure AD</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-freeipa.html">配置 FreeIPA</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-github.html">配置 GitHub</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-google-oauth.html">配置 Google OAuth</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-keycloak-oidc.html">配置 Keycloak (OIDC)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-keycloak-saml.html">配置 Keycloak (SAML)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-okta-saml.html">配置 Okta (SAML)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/configure-pingidentity.html">配置 PingIdentity (SAML)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/microsoft-ad-federation-service-saml/microsoft-ad-federation-service-saml.html">配置 Microsoft AD FS (SAML)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/microsoft-ad-federation-service-saml/ms-adfs-for-rancher.html">1. 在 Microsoft AD FS 中配置 SUSE Rancher Prime</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/microsoft-ad-federation-service-saml/rancher-for-ms-adfs.html">2. 在 SUSE Rancher Prime 中配置 Microsoft AD FS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/openldap/openldap.html">配置 OpenLDAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/openldap/reference.html">OpenLDAP 配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/shibboleth-saml/shibboleth-saml.html">配置 Shibboleth (SAML)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/shibboleth-saml/group-permissions.html">Shibboleth 和 OpenLDAP 的组权限</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/manage-role-based-access-control-rbac/manage-role-based-access-control-rbac.html">管理 RBAC</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/manage-role-based-access-control-rbac/global-permissions.html">全局权限</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/manage-role-based-access-control-rbac/cluster-and-project-roles.html">集群和项目角色</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/manage-role-based-access-control-rbac/custom-roles.html">自定义角色</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/manage-role-based-access-control-rbac/locked-roles.html">锁定角色</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/users/authn-and-authz/enable-user-retention.html">Enabling User Retention</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/users/settings/settings.html">用户设置</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/users/settings/api-keys.html">API 密钥</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/users/settings/manage-node-templates.html">管理节点模板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/users/settings/user-preferences.html">用户偏好</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/users/settings/manage-cloud-credentials.html">管理云凭证</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Global Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/custom-branding.html">定制品牌</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/global-default-private-registry.html">配置全局默认私有镜像仓库</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/global-configuration/provisioning-drivers/provisioning-drivers.html">配置驱动</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/provisioning-drivers/manage-cluster-drivers.html">集群驱动</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/provisioning-drivers/manage-node-drivers.html">主机驱动</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/rke1-templates.html">RKE 模板</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/access-or-share-templates.html">访问和共享</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/apply-templates.html">应用模板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/creator-permissions.html">模板创建者权限</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/enforce-templates.html">强制使用模板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/example-use-cases.html">示例场景</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/infrastructure.html">RKE 模板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/manage-templates.html">创建和修改 RKE 模板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/override-template-settings.html">覆盖模板设置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/global-configuration/rke1-templates/template-example-yaml.html">RKE1 示例 YAML</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/back-up-restore-and-disaster-recovery.html">备份和灾难恢复</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/usage-guide.html">备份恢复使用指南</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/back-up.html">备份 SUSE Rancher Prime</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/configuration/backup.html">备份配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/configuration/storage.html">备份存储位置配置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/restore.html">还原 SUSE Rancher Prime</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/configuration/restore.html">还原配置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/migrate-to-a-new-cluster.html">将 SUSE Rancher Prime 迁移到新集群</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/back-up-restore-and-disaster-recovery/configuration/examples.html">示例</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">CLI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/cli/kubectl.html">kubectl 实用程序</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/cli/rancher-cli.html">SUSE Rancher Prime CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../rancher-admin/experimental-features/experimental-features.html">启用实验功能</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/experimental-features/ui-server-side-pagination.html">UI Server-Side Pagination</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/experimental-features/continuous-delivery.html">持续交付</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/experimental-features/cluster-role-aggregation.html">ClusterRole Aggregation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/experimental-features/istio-traffic-management-features.html">UI 管理 Istio 虚拟服务和目标规则</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/experimental-features/rancher-on-arm64.html">在 ARM64 上运行 SUSE Rancher Prime（实验性）</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../rancher-admin/experimental-features/unsupported-storage-drivers.html">使用非默认支持的存储驱动</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/cluster-deployment.html">Cluster Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-deployment/node-requirements.html">SUSE Rancher Prime 管理集群的节点要求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/production-checklist/production-checklist.html">生产就绪集群检查清单</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/production-checklist/recommended-cluster-architecture.html">推荐的集群架构</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/production-checklist/roles-for-nodes-in-kubernetes.html">Kubernetes 中节点的角色</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/production-checklist/tips-to-set-up-containers.html">设置容器的技巧</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/hosted-kubernetes.html">通过托管 Kubernetes 提供商设置集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/aks/aks.html">创建 AKS 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/aks/configuration.html">AKS 集群配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/eks/eks.html">创建 EKS 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/eks/configuration.html">EKS 集群配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/gke/gke.html">创建 GKE 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/gke/configuration.html">GKE 集群配置参考</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/gke/private-clusters.html">私有集群</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/hosted-kubernetes/sync-clusters.html">同步</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/set-up-cloud-providers/set-up-cloud-providers.html">设置 Cloud Provider</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/set-up-cloud-providers/amazon.html">设置 Amazon 云提供商</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/set-up-cloud-providers/azure.html">设置 Azure 云提供商</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/set-up-cloud-providers/configure-in-tree-vsphere.html">配置树内 vSphere 云提供商</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/set-up-cloud-providers/configure-out-of-tree-vsphere.html">配置树外 vSphere 云提供商</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/set-up-cloud-providers/google-compute-engine.html">设置 Google Compute Engine 云提供商</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/migrate-to-an-out-of-tree-cloud-provider/amazon.html">将 Amazon 从树内迁移到树外</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/migrate-to-an-out-of-tree-cloud-provider/azure.html">Migrating Azure In-tree to Out-of-tree</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/migrate-to-an-out-of-tree-cloud-provider/vsphere.html">将 vSphere 从树内迁移到树外</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-deployment/launch-kubernetes-with-rancher.html">使用 SUSE Rancher Prime 启动 Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-deployment/about-rancher-agents.html">SUSE Rancher Prime Agent</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-deployment/enable-cluster-agent-scheduling-customization.html">Enabling Cluster Agent Scheduling Customization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-deployment/rke1-vs-rke2.html">RKE1 和 SUSE® Rancher Prime: RKE2 差​​异</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/infra-providers.html">在云厂商的新节点上启动 Kubernetes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/digitalocean/digitalocean.html">创建 DigitalOcean 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/digitalocean/machine-configuration.html">DigitalOcean 主机配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/digitalocean/node-template-configuration.html">DigitalOcean 节点模板配置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/aws/aws.html">创建 Amazon EC2 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/aws/machine-configuration.html">EC2 主机配置参考</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/aws/node-template-configuration.html">EC2 节点模板配置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/azure/azure.html">创建 Azure 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/azure/machine-configuration.html">Azure 主机配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/azure/node-template-configuration.html">Azure 节点模板配置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/nutanix/nutanix.html">创建 Nutanix AOS 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/nutanix/provision-kubernetes-clusters-in-aos.html">在 Nutanix AOS 中配置 Kubernetes 集群</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/nutanix/node-template-configuration.html">Nutanix 节点模板配置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/vsphere/vsphere.html">创建 vSphere 集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/vsphere/best-practices.html">SUSE Rancher Prime 管理 vSphere 集群的最佳实践</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/vsphere/create-credentials.html">在 vSphere 控制台中创建凭证</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/vsphere/create-a-vm-template.html">创建 vSphere 虚拟机模板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/vsphere/provision-kubernetes-clusters-in-vsphere.html">在 vSphere 中配置 Kubernetes 集群</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/vsphere/node-template-configuration.html">vSphere 节点模板配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/infra-providers/vsphere/shutdown-vm.html">Graceful Shutdown for VMware vSphere Virtual Machines</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/custom-clusters/custom-clusters.html">在现有自定义节点上启动 Kubernetes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-deployment/custom-clusters/rancher-agent-options.html">SUSE Rancher Prime Agent 选项</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/custom-clusters/windows/azure-storageclass-configuration.html">Azure 中存储类的配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/custom-clusters/windows/network-requirements-for-host-gateway.html">Host Gateway (L2bridge) 的网络要求</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/custom-clusters/windows/use-windows-clusters.html">在 Windows 集群上启动 Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/custom-clusters/windows/windows-linux-cluster-feature-parity.html">Windows 和 Linux 集群的功能奇偶一致性</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-deployment/custom-clusters/windows/workload-migration-guidance.html">将 Windows 工作负载从 SUSE® Rancher Prime: RKE2 迁移到 SUSE® Rancher Prime: RKE2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/configuration/k3s.html">SUSE® Rancher Prime: K3s 集群配置参考</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/configuration/rke2.html">SUSE® Rancher Prime: RKE2 集群配置参考</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-deployment/configuration/rke1.html">RKE 集群配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-deployment/register-existing-clusters.html">注册现有集群</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-deployment/register-existing-clusters-troubleshooting.html">注册集群</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/manage-clusters.html">Cluster Administration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Manage Clusters</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/best-practices/disconnected-clusters.html">Best Practices for Disconnected Clusters</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/access-clusters/access-clusters.html">访问集群</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/access-clusters/add-users-to-clusters.html">将用户添加到集群</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/access-clusters/authorized-cluster-endpoint.html">授权集群端点的工作原理</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/access-clusters/use-kubectl-and-kubeconfig.html">使用 Kubectl 和 kubeconfig 访问集群</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/clean-cluster-nodes.html">从节点中移除 Kubernetes 组件</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/manage-persistent-storage.html">Kubernetes 持久存储： 卷和存储类</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/about-glusterfs-volumes.html">GlusterFS 卷</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/about-persistent-storage.html">持久存储的工作原理</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/dynamically-provision-new-storage.html">在 SUSE Rancher Prime 中动态配置新存储</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/install-iscsi-volumes.html">iSCSI 卷</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/set-up-existing-storage.html">设置现有存储</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/use-external-ceph-driver.html">使用外部 Ceph 驱动</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/examples/nfs-storage.html">NFS 存储</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/examples/persistent-storage-in-amazon-ebs.html">在 Amazon EBS 中创建持久存储</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/examples/examples.html">配置存储示例</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/persistent-storage/examples/vsphere-storage.html">vSphere 存储</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/install-cluster-autoscaler/install-cluster-autoscaler.html">Cluster Autoscaler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/install-cluster-autoscaler/use-aws-ec2-auto-scaling-groups.html">通过 AWS EC2 Auto Scaling 组使用 Cluster Autoscaler</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/cluster-templates.html">集群模板</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/nodes-and-node-pools.html">节点和节点池</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/projects-and-namespaces.html">使用 SUSE Rancher Prime 的项目和 Kubernetes 命名空间</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/rotate-certificates.html">证书轮换</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/manage-clusters/rotate-encryption-key.html">加密密钥轮换</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/kubernetes-resources-setup.html">Kubernetes 资源</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/workloads-and-pods/workloads-and-pods.html">Kubernetes 工作负载和 Pod</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/workloads-and-pods/deploy-workloads.html">部署工作负载</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/workloads-and-pods/add-a-sidecar.html">添加 Sidecar</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/workloads-and-pods/upgrade-workloads.html">升级工作负载</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/workloads-and-pods/roll-back-workloads.html">回滚工作负载</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/horizontal-pod-autoscaler/horizontal-pod-autoscaler.html">Horizontal Pod Autoscaler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/horizontal-pod-autoscaler/about-hpas.html">Horizontal Pod Autoscaler 介绍</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/horizontal-pod-autoscaler/manage-hpas-with-ui.html">使用 SUSE Rancher Prime UI 管理 HPA</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/horizontal-pod-autoscaler/manage-hpas-with-kubectl.html">使用 kubectl 管理 HPA</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/horizontal-pod-autoscaler/test-hpas-with-kubectl.html">使用 kubectl 测试 HPA</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/load-balancer-and-ingress-controller/load-balancer-and-ingress-controller.html">在 SUSE Rancher Prime 中设置负载均衡器和 Ingress Controller</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/load-balancer-and-ingress-controller/layer-4-and-layer-7-load-balancing.html">四层和七层负载均衡</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/load-balancer-and-ingress-controller/add-ingresses.html">添加 Ingress</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/load-balancer-and-ingress-controller/ingress-configuration.html">Ingress 配置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/create-services.html">Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/configmaps.html">ConfigMap</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/kubernetes-resources/kubernetes-and-docker-registries.html">Kubernetes 镜像仓库和容器镜像仓库</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/backups-and-restore/backups-and-restore.html">升级和回滚 Kubernetes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/backups-and-restore/backups-without-uprading-rancher.html">在不升级 SUSE Rancher Prime 的情况下升级 Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/backups-and-restore/backups.html">备份集群</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/backups-and-restore/restore.html">使用备份恢复集群</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../cluster-admin/namespaces.html">命名空间</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/project-admin/project-admin.html">项目管理</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/project-admin/add-users-to-projects.html">添加项目成员</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/project-admin/project-resource-quotas/project-resource-quotas.html">项目资源配额</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/project-admin/project-resource-quotas/resource-quotas-in-projects.html">SUSE Rancher Prime 项目中资源配额的工作原理</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/project-admin/project-resource-quotas/override-default-limit-in-namespaces.html">覆盖命名空间的默认限制</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/project-admin/project-resource-quotas/resource-quota-types.html">资源配额类型参考</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../cluster-admin/project-admin/project-resource-quotas/set-container-default-resource-limits.html">设置容器默认资源限制</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../cluster-admin/helm-charts-in-rancher/helm-charts-in-rancher.html">Helm Charts 和 Apps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/helm-charts-in-rancher/create-apps.html">创建应用</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../cluster-admin/helm-charts-in-rancher/oci-repositories.html">Using OCI-Based Helm Chart Repositories</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../security-overview.html">安全</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cves.html">安全公告和 CVE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../kubernetes-security-best-practices.html">Kubernetes 安全最佳实践</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../rancher-security-best-practices.html">SUSE Rancher Prime 安全最佳实践</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../rancher-webhook/rancher-webhook.html">SUSE Rancher Prime Webhook</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../rancher-webhook/expired-webhook-certificate-rotation.html">过期 Webhook 证书轮换</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../rancher-webhook/hardening.html">加固 SUSE Rancher Prime Webhook</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../selinux-rpm/about-rancher-selinux.html">关于 rancher-selinux</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../selinux-rpm/selinux-rpm.html">SELinux RPM</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../selinux-rpm/about-rke2-selinux.html">关于 rke2-selinux</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../hardening-guides.html">SUSE Rancher Prime 自我评估和加固指南</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../k3s/k3s.html">SUSE® Rancher Prime: K3s 加固指南</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../k3s/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">SUSE® Rancher Prime: K3s 自我评估指南 - CIS Benchmark v1.23 - K8s v1.23</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../k3s/self-assessment-guide-with-cis-v1.24-k8s-v1.24.html">SUSE® Rancher Prime: K3s 自我评估指南 - CIS Benchmark v1.24 - K8s v1.24</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../k3s/self-assessment-guide-with-cis-v1.7-k8s-v1.25-v1.26-v1.27.html">SUSE® Rancher Prime: K3s 自我评估指南 - CIS Benchmark v1.7 - K8s v1.25/v1.26/v1.27</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="rke1.html">RKE 加固指南</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="4">
    <a class="nav-link" href="self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">RKE 自我评估指南 - CIS Benchmark v1.23 - K8s v1.23</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="self-assessment-guide-with-cis-v1.24-k8s-v1.24.html">RKE 自我评估指南 - CIS Benchmark v1.24 - K8s v1.24</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="self-assessment-guide-with-cis-v1.7-k8s-v1.25-v1.26-v1.27.html">RKE 自我评估指南 - CIS Benchmark v1.7 - K8s v1.25/v1.26/v1.27</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../rke2/rke2.html">SUSE® Rancher Prime: RKE2 加固指南</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rke2/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">SUSE® Rancher Prime: RKE2 自我评估指南 - CIS Benchmark v1.23 - K8s v1.23</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rke2/self-assessment-guide-with-cis-v1.24-k8s-v1.24.html">SUSE® Rancher Prime: RKE2 自我评估指南 - CIS Benchmark v1.24 - K8s v1.24</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rke2/self-assessment-guide-with-cis-v1.7-k8s-v1.25-v1.26-v1.27.html">SUSE® Rancher Prime: RKE2 自我评估指南 - CIS Benchmark v1.7 - K8s v1.25/v1.26/v1.27</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../upgrade-a-hardened-cluster-to-k8s-v1-25.html">将加固的自定义/导入集群升级到 Kubernetes v1.25</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../cis-scans/cis-scans.html">CIS 扫描</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/rbac-for-cis-scans.html">RBAC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/how-to.html">CIS 扫描指南</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/install-rancher-cis-benchmark.html">安装 SUSE Rancher Prime CIS Benchmark</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/uninstall-rancher-cis-benchmark.html">卸载 SUSE Rancher Prime CIS Benchmark</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/configuration-reference.html">配置</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/custom-benchmark.html">为集群扫描创建自定义 Benchmark 版本</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/skipped-and-not-applicable-tests.html">跳过和不适用的测试</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/run-a-scan.html">运行扫描</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/run-a-scan-periodically-on-a-schedule.html">定时运行扫描</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/skip-tests.html">跳过测试</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/view-reports.html">查看报告</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/enable-alerting-for-rancher-cis-benchmark.html">为 SUSE Rancher Prime CIS Benchmark 启用告警</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/configure-alerts-for-periodic-scan-on-a-schedule.html">为定时扫描配置告警</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../cis-scans/create-a-custom-benchmark-version-to-run.html">为集群扫描创建自定义 Benchmark 版本</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../psa-pss.html">Pod 安全标准 (PSS) 和 Pod 安全准入 (PSA)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../psact.html">Pod 安全准入 (PSA) 配置模板</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../sample-psact.html">PodSecurityConfiguration 示例</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../secrets-hub.html">密文</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../open-ports-with-firewalld.html">使用 firewalld 打开端口</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../encrypting-http.html">加密 HTTP 通信</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../integrations/integrations.html">Integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../integrations/kubernetes-distributions.html">Kubernetes 发行版</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../integrations/rancher-extensions.html">扩展</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../integrations/harvester/harvester.html">SUSE Virtualization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/harvester/overview.html">概述</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../integrations/longhorn/longhorn.html">SUSE Storage</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/longhorn/overview.html">概述</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../integrations/neuvector/neuvector.html">SUSE® Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/neuvector/overview.html">概述</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../integrations/kubewarden.html">SUSE Security Admission Controller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../integrations/elemental.html">SUSE® Rancher Prime: OS Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../integrations/fleet/fleet.html">SUSE® Rancher Prime: Continuous Delivery</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/fleet/overview.html">概述</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/fleet/architecture.html">架构</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/fleet/use-fleet-behind-a-proxy.html">在代理后使用 SUSE® Rancher Prime: Continuous Delivery</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/fleet/windows-support.html">Windows 支持</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../integrations/suse-observability.html">SUSE® Observability</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../integrations/rancher-desktop.html">桌面上的 Kubernetes 与 Rancher Desktop</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../integrations/cluster-api/cluster-api.html">SUSE® Rancher Prime: Cluster API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../integrations/cluster-api/overview.html">概述</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Observability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../observability/rancher-cluster-tools.html">集群工具：Logging，Monitoring 和可视化</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../observability/rancher-project-tools.html">项目工具：Logging，Monitoring 和可视化</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/logging/logging.html">SUSE Rancher Prime Logging 集成</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/logging-architecture.html">架构</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/best-practices.html">Logging 最佳实践</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/rbac-for-logging.html">Logging 的 RBAC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/logging-helm-chart-options.html">rancher-logging Helm Chart 选项</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/enable-api-audit-log.html">启用 API 审计日志以记录系统事件</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/enable-api-audit-log-in-downstream-clusters.html">下游集群开启 API 审计日志</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/taints-and-tolerations.html">处理污点和容忍度</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Custom Resource Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/logging/custom-resource-configuration/flows-and-clusterflows.html">Flows 和 ClusterFlows</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/logging/custom-resource-configuration/outputs-and-clusteroutputs.html">Outputs 和 ClusterOutputs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/logging/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/monitoring-and-dashboards.html">监控和告警</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/best-practices.html">监控最佳实践</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/built-in-dashboards.html">内置仪表板</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/how-monitoring-works.html">Monitoring 的工作原理</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/promql-expressions.html">PromQL 表达式参考</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/rbac-for-monitoring.html">RBAC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/windows-support.html">Monitoring V2 的 Windows 集群支持</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/enable-monitoring.html">启用 Monitoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/uninstall-monitoring.html">卸载 Monitoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/set-up-monitoring-for-workloads.html">为工作负载设置 Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/examples.html">示例</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/helm-chart-options.html">Helm Chart 选项</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/receivers.html">接收器配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/routes.html">路由配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/servicemonitors-and-podmonitors.html">ServiceMonitor 和 PodMonitor 配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/advanced/advanced.html">高级配置</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/advanced/alertmanager.html">Alertmanager 配置</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/advanced/prometheus.html">Prometheus 配置</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/advanced/prometheusrules.html">PrometheusRule 配置</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/configuration.html">配置</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/configuration/debug-high-memory-usage.html">调试高内存用量</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/customizing-dashboard/create-persistent-grafana-dashboard.html">持久化 Grafana 仪表板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/customizing-dashboard/customize-grafana-dashboard.html">自定义 Grafana 仪表板</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/prometheus-federator/prometheus-federator.html">Prometheus Federator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/prometheus-federator/rbac.html">RBAC</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/prometheus-federator/enable-prometheus-federator.html">启用 Prometheus Federator</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/prometheus-federator/uninstall-prometheus-federator.html">卸载 Prometheus Federator</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/prometheus-federator/set-up-workloads.html">为工作负载设置 Prometheus Federator</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/prometheus-federator/customize-grafana-dashboards.html">自定义 Grafana 仪表板</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/monitoring-and-dashboards/prometheus-federator/install-project-monitors.html">安装 Project Monitor</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/istio/istio.html">Istio</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/istio/rbac.html">RBAC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/istio/cpu-and-memory-allocations.html">CPU 和内存分配</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../observability/istio/disable-istio.html">禁用 Istio</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/istio/configuration/configuration.html">配置选项</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/configuration/selectors-and-scrape-configurations.html">选择器和抓取配置</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/configuration/project-network-isolation.html">项目网络隔离的其他步骤</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/configuration/install-istio-on-rke2-cluster.html">在 SUSE® Rancher Prime: RKE2 和 SUSE® Rancher Prime: K3s 集群上安装 Istio 的其他步骤</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/guides/enable-istio-in-cluster.html">1. 在集群中启用 Istio</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/guides/enable-istio-in-namespace.html">2. 在命名空间中启用 Istio</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/guides/set-up-traffic-management.html">5. 设置 Istio 的流量管理组件</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../observability/istio/guides/guides.html">设置指南</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/guides/generate-and-view-traffic.html">6. 生成和查看流量</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/guides/set-up-istio-gateway.html">4. 设置 Istio Gateway</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../../observability/istio/guides/use-istio-sidecar.html">3. 使用 Istio Sidecar 添加部署和服务</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">API</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../api/quickstart.html">API 快速入门指南</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../api/workflows/projects.html">项目</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../api/reference.html">API 参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../api/api-tokens.html">API 令牌</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../api/extension-apiserver.html">Extension API Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../api/v3-rancher-api-guide.html">API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../troubleshooting/general-troubleshooting.html">一般故障排除</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../../troubleshooting/kubernetes-components/kubernetes-components.html">Kubernetes 组件</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/kubernetes-components/troubleshooting-controlplane-nodes.html">Controlplane 节点故障排除</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/kubernetes-components/troubleshooting-etcd-nodes.html">etcd 节点故障排除</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/kubernetes-components/troubleshooting-nginx-proxy.html">nginx-proxy 故障排除</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/kubernetes-components/troubleshooting-worker-nodes-and-generic-components.html">Worker 节点和通用组件故障排除</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/other-troubleshooting-tips/user-id-tracking-in-audit-logs.html">审计日志中的用户 ID 跟踪</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/other-troubleshooting-tips/networking.html">网络</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/other-troubleshooting-tips/kubernetes-resources.html">Kubernetes 资源</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../troubleshooting/other-troubleshooting-tips/dns.html">DNS</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">FAQ</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/general-faq.html">一般常见问题解答</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/deprecated-features.html">SUSE Rancher Prime 中已弃用的功能</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/install-and-configure-kubectl.html">安装和配置 kubectl</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/dockershim.html">Dockershim</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/technical-items.html">技术</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/security.html">安全</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/container-network-interface-providers.html">CNI 网络插件</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faq/rancher-is-no-longer-needed.html">卸载 SUSE Rancher Prime</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../contribute-to-rancher.html">参与 SUSE Rancher Prime 社区贡献</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Rancher Manager</span>
    <span class="version">v2.11</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../../../../latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../../v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version is-current">
              <a href="../../../../en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../../v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../../v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../../v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/rancher-manager" title="SUSE Rancher Manager" aria-label="SUSE Documentation - SUSE Rancher Manager">
        SUSE Rancher Manager
      </a>
    </li>
      <li>
          Security
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v2.11</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../../../../latest/en/about-rancher/what-is-rancher.html">latest</a>
    <a class="version is-missing" href="../../../../../v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
    <a class="version is-current" href="self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">v2.11</a>
    <a class="version" href="../../../../../v2.10/zh/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">v2.10</a>
    <a class="version" href="../../../../../v2.9/zh/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">v2.9</a>
    <a class="version" href="../../../../../v2.8/zh/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.html">v2.8</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/rancher-product-docs/edit/main/versions/v2.11/modules/zh/pages/security/hardening-guides/rke1/self-assessment-guide-with-cis-v1.23-k8s-v1.23.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:rancher-manager" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">RKE 自我评估指南 - CIS Benchmark v1.23 - K8s v1.23</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rancher Kubernetes Engine (RKE/RKE1) will reach end of life on <strong>July 31, 2025</strong>. Rancher 2.12.0 and later will no longer support provisioning or managing downstream RKE1 clusters. We recommend replatforming RKE1 clusters to RKE2 to ensure continued support and security updates. Learn more about the transition <a href="https://www.suse.com/support/kb/doc/?id=000021518">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>本文档是 <a href="rke1.html" class="xref page">RKE 加固指南</a>的配套文档，该指南提供了关于如何加固正在生产环境中运行并由 Rancher 管理的 RKE 集群的指导方针。本 benchmark 指南可帮助你根据 CIS Kubernetes Benchmark 中的每个 control 来评估加固集群的安全性。</p>
</div>
<div class="paragraph">
<p>本指南对应以下版本的 Rancher、CIS Benchmarks 和 Kubernetes：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rancher 版本</th>
<th class="tableblock halign-left valign-top">CIS Benchmark 版本</th>
<th class="tableblock halign-left valign-top">Kubernetes 版本</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rancher v2.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benchmark v1.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes v1.23</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>本指南将介绍各种 controls，并提供更新的示例命令来审计 Rancher 创建的集群中的合规性。由于 Rancher 和 RKE 将 Kubernetes 服务安装为 Docker 容器，因此 CIS Kubernetes Benchmark 中的许多 control 验证检查不适用。这些检查将返回 <code>Not Applicable</code> 的结果。</p>
</div>
<div class="paragraph">
<p>本文档适用于 Rancher 运维人员、安全团队、审计员和决策者。</p>
</div>
<div class="paragraph">
<p>有关每个 control 的更多信息，包括详细描述和未通过测试的补救措施，请参考 CIS Kubernetes Benchmark v1.23 的相应部分。你可以在<a href="https://www.cisecurity.org/benchmark/kubernetes/">互联网安全中心 (CIS)</a>创建免费账户后下载 benchmark。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_测试方法"><a class="anchor" href="#_测试方法"></a>测试方法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rancher 和 RKE 通过 Docker 容器安装 Kubernetes 服务。配置是通过初始化时传递给容器的参数定义的，而不是通过配置文件。</p>
</div>
<div class="paragraph">
<p>在 control 审计与原始 CIS benchmark 不同时，提供了针对 Rancher 的特定审计命令以进行测试。在执行测试时，你将需要访问所有 RKE 节点主机上的命令行。这些命令还使用了 <a href="https://kubernetes.io/docs/tasks/tools/">kubectl</a>（带有有效的配置文件）和 <a href="https://stedolan.github.io/jq/">jq</a> 工具，在测试和评估测试结果时这些工具是必需的。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>本指南仅涵盖 <code>automated</code>（之前称为 <code>scored</code>）测试。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_controls"><a class="anchor" href="#_controls"></a>Controls</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_1_master_node_configuration_files"><a class="anchor" href="#_1_1_master_node_configuration_files"></a>1.1 Master Node Configuration Files</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_1_1_ensure_that_the_api_server_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_1_ensure_that_the_api_server_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.1 Ensure that the API server pod specification file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for kube-apiserver.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_2_ensure_that_the_api_server_pod_specification_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_2_ensure_that_the_api_server_pod_specification_file_ownership_is_set_to_rootroot_automated"></a>1.1.2 Ensure that the API server pod specification file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for kube-apiserver.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_3_ensure_that_the_controller_manager_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_3_ensure_that_the_controller_manager_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.3 Ensure that the controller manager pod specification file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for controller-manager.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_4_ensure_that_the_controller_manager_pod_specification_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_4_ensure_that_the_controller_manager_pod_specification_file_ownership_is_set_to_rootroot_automated"></a>1.1.4 Ensure that the controller manager pod specification file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for controller-manager.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_5_ensure_that_the_scheduler_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_5_ensure_that_the_scheduler_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.5 Ensure that the scheduler pod specification file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for scheduler.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_6_ensure_that_the_scheduler_pod_specification_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_6_ensure_that_the_scheduler_pod_specification_file_ownership_is_set_to_rootroot_automated"></a>1.1.6 Ensure that the scheduler pod specification file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for scheduler.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_7_ensure_that_the_etcd_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_7_ensure_that_the_etcd_pod_specification_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.7 Ensure that the etcd pod specification file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for etcd.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_8_ensure_that_the_etcd_pod_specification_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_8_ensure_that_the_etcd_pod_specification_file_ownership_is_set_to_rootroot_automated"></a>1.1.8 Ensure that the etcd pod specification file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for etcd.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_9_ensure_that_the_container_network_interface_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_9_ensure_that_the_container_network_interface_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.9 Ensure that the Container Network Interface file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the control plane node.
For example, chmod 644 &lt;path/to/cni/files&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ps -fC ${kubeletbin:-kubelet} | grep -- --cni-conf-dir || echo "/etc/cni/net.d" | sed 's%.*cni-conf-dir[= ]\([^ ]*\).*%\1%' | xargs -I{} find {} -mindepth 1 | xargs --no-run-if-empty stat -c permissions=%a find /var/lib/cni/networks -type f 2&gt; /dev/null | xargs --no-run-if-empty stat -c permissions=%a</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'permissions' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_10_ensure_that_the_container_network_interface_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_10_ensure_that_the_container_network_interface_file_ownership_is_set_to_rootroot_automated"></a>1.1.10 Ensure that the Container Network Interface file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the control plane node.
For example,
chown root:root &lt;path/to/cni/files&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ps -fC ${kubeletbin:-kubelet} | grep -- --cni-conf-dir || echo "/etc/cni/net.d" | sed 's%.*cni-conf-dir[= ]\([^ ]*\).*%\1%' | xargs -I{} find {} -mindepth 1 | xargs --no-run-if-empty stat -c %U:%G find /var/lib/cni/networks -type f 2&gt; /dev/null | xargs --no-run-if-empty stat -c %U:%G</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'root:root' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_11_ensure_that_the_etcd_data_directory_permissions_are_set_to_700_or_more_restrictive_automated"><a class="anchor" href="#_1_1_11_ensure_that_the_etcd_data_directory_permissions_are_set_to_700_or_more_restrictive_automated"></a>1.1.11 Ensure that the etcd data directory permissions are set to 700 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
On the etcd server node, get the etcd data directory, passed as an argument --data-dir,
from the command 'ps -ef | grep etcd'.
Run the below command (based on the etcd data directory found above). For example,
chmod 700 /var/lib/etcd</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c %a /node/var/lib/etcd</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'700' is equal to '700'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">700</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_12_ensure_that_the_etcd_data_directory_ownership_is_set_to_etcdetcd_automated"><a class="anchor" href="#_1_1_12_ensure_that_the_etcd_data_directory_ownership_is_set_to_etcdetcd_automated"></a>1.1.12 Ensure that the etcd data directory ownership is set to etcd:etcd (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
On the etcd server node, get the etcd data directory, passed as an argument --data-dir,
from the command 'ps -ef | grep etcd'.
Run the below command (based on the etcd data directory found above).
For example, chown etcd:etcd /var/lib/etcd</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_13_ensure_that_the_admin_conf_file_permissions_are_set_to_600_or_more_restrictive_automated"><a class="anchor" href="#_1_1_13_ensure_that_the_admin_conf_file_permissions_are_set_to_600_or_more_restrictive_automated"></a>1.1.13 Ensure that the admin.conf file permissions are set to 600 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE does not store the kubernetes default kubeconfig credentials file on the nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_14_ensure_that_the_admin_conf_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_14_ensure_that_the_admin_conf_file_ownership_is_set_to_rootroot_automated"></a>1.1.14 Ensure that the admin.conf file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE does not store the kubernetes default kubeconfig credentials file on the nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_15_ensure_that_the_scheduler_conf_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_15_ensure_that_the_scheduler_conf_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.15 Ensure that the scheduler.conf file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for scheduler.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_16_ensure_that_the_scheduler_conf_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_16_ensure_that_the_scheduler_conf_file_ownership_is_set_to_rootroot_automated"></a>1.1.16 Ensure that the scheduler.conf file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for scheduler.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_17_ensure_that_the_controller_manager_conf_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_17_ensure_that_the_controller_manager_conf_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.17 Ensure that the controller-manager.conf file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for controller-manager.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_18_ensure_that_the_controller_manager_conf_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_18_ensure_that_the_controller_manager_conf_file_ownership_is_set_to_rootroot_automated"></a>1.1.18 Ensure that the controller-manager.conf file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for controller-manager.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_19_ensure_that_the_kubernetes_pki_directory_and_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_1_1_19_ensure_that_the_kubernetes_pki_directory_and_file_ownership_is_set_to_rootroot_automated"></a>1.1.19 Ensure that the Kubernetes PKI directory and file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the master node.
For example,
chown -R root:root /etc/kubernetes/pki/</p>
</div>
<div class="paragraph">
<p><strong>Audit Script:</strong> <code>check_files_owner_in_dir.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

# This script is used to ensure the owner is set to root:root for
# the given directory and all the files in it
#
# inputs:
#   $1 = /full/path/to/directory
#
# outputs:
#   true/false

INPUT_DIR=$1

if [[ "${INPUT_DIR}" == "" ]]; then
    echo "false"
    exit
fi

if [[ $(stat -c %U:%G ${INPUT_DIR}) != "root:root" ]]; then
    echo "false"
    exit
fi

statInfoLines=$(stat -c "%n %U:%G" ${INPUT_DIR}/*)
while read -r statInfoLine; do
  f=$(echo ${statInfoLine} | cut -d' ' -f1)
  p=$(echo ${statInfoLine} | cut -d' ' -f2)

  if [[ $(basename "$f" .pem) == "kube-etcd-"* ]]; then
    if [[ "$p" != "root:root" &amp;&amp; "$p" != "etcd:etcd" ]]; then
      echo "false"
      exit
    fi
  else
    if [[ "$p" != "root:root" ]]; then
      echo "false"
      exit
    fi
  fi
done &lt;&lt;&lt; "${statInfoLines}"


echo "true"
exit</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Execution:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./check_files_owner_in_dir.sh /node/etc/kubernetes/ssl</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'true' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_20_ensure_that_the_kubernetes_pki_certificate_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_1_1_20_ensure_that_the_kubernetes_pki_certificate_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>1.1.20 Ensure that the Kubernetes PKI certificate file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the master node.
For example,
chmod -R 644 /etc/kubernetes/pki/*.crt</p>
</div>
<div class="paragraph">
<p><strong>Audit Script:</strong> <code>check_files_permissions.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

# This script is used to ensure the file permissions are set to 644 or
# more restrictive for all files in a given directory or a wildcard
# selection of files
#
# inputs:
#   $1 = /full/path/to/directory or /path/to/fileswithpattern
#                                   ex: !(*key).pem
#
#   $2 (optional) = permission (ex: 600)
#
# outputs:
#   true/false

# Turn on "extended glob" for use of '!' in wildcard
shopt -s extglob

# Turn off history to avoid surprises when using '!'
set -H

USER_INPUT=$1

if [[ "${USER_INPUT}" == "" ]]; then
  echo "false"
  exit
fi


if [[ -d ${USER_INPUT} ]]; then
  PATTERN="${USER_INPUT}/*"
else
  PATTERN="${USER_INPUT}"
fi

PERMISSION=""
if [[ "$2" != "" ]]; then
  PERMISSION=$2
fi

FILES_PERMISSIONS=$(stat -c %n\ %a ${PATTERN})

while read -r fileInfo; do
  p=$(echo ${fileInfo} | cut -d' ' -f2)

  if [[ "${PERMISSION}" != "" ]]; then
    if [[ "$p" != "${PERMISSION}" ]]; then
      echo "false"
      exit
    fi
  else
    if [[ "$p" != "644" &amp;&amp; "$p" != "640" &amp;&amp; "$p" != "600" ]]; then
      echo "false"
      exit
    fi
  fi
done &lt;&lt;&lt; "${FILES_PERMISSIONS}"


echo "true"
exit</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Execution:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./check_files_permissions.sh '/node/etc/kubernetes/ssl/!(*key).pem'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'true' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_21_ensure_that_the_kubernetes_pki_key_file_permissions_are_set_to_600_automated"><a class="anchor" href="#_1_1_21_ensure_that_the_kubernetes_pki_key_file_permissions_are_set_to_600_automated"></a>1.1.21 Ensure that the Kubernetes PKI key file permissions are set to 600 (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the control plane node.
For example,
chmod -R 600 /etc/kubernetes/ssl/*key.pem</p>
</div>
<div class="paragraph">
<p><strong>Audit Script:</strong> <code>check_files_permissions.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

# This script is used to ensure the file permissions are set to 644 or
# more restrictive for all files in a given directory or a wildcard
# selection of files
#
# inputs:
#   $1 = /full/path/to/directory or /path/to/fileswithpattern
#                                   ex: !(*key).pem
#
#   $2 (optional) = permission (ex: 600)
#
# outputs:
#   true/false

# Turn on "extended glob" for use of '!' in wildcard
shopt -s extglob

# Turn off history to avoid surprises when using '!'
set -H

USER_INPUT=$1

if [[ "${USER_INPUT}" == "" ]]; then
  echo "false"
  exit
fi


if [[ -d ${USER_INPUT} ]]; then
  PATTERN="${USER_INPUT}/*"
else
  PATTERN="${USER_INPUT}"
fi

PERMISSION=""
if [[ "$2" != "" ]]; then
  PERMISSION=$2
fi

FILES_PERMISSIONS=$(stat -c %n\ %a ${PATTERN})

while read -r fileInfo; do
  p=$(echo ${fileInfo} | cut -d' ' -f2)

  if [[ "${PERMISSION}" != "" ]]; then
    if [[ "$p" != "${PERMISSION}" ]]; then
      echo "false"
      exit
    fi
  else
    if [[ "$p" != "644" &amp;&amp; "$p" != "640" &amp;&amp; "$p" != "600" ]]; then
      echo "false"
      exit
    fi
  fi
done &lt;&lt;&lt; "${FILES_PERMISSIONS}"


echo "true"
exit</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Execution:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./check_files_permissions.sh '/node/etc/kubernetes/ssl/*key.pem'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'true' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_2_api_server"><a class="anchor" href="#_1_2_api_server"></a>1.2 API Server</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_2_1_ensure_that_the_anonymous_auth_argument_is_set_to_false_automated"><a class="anchor" href="#_1_2_1_ensure_that_the_anonymous_auth_argument_is_set_to_false_automated"></a>1.2.1 Ensure that the --anonymous-auth argument is set to false (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the below parameter.
--anonymous-auth=false</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--anonymous-auth' is equal to 'false'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_2_ensure_that_the_token_auth_file_parameter_is_not_set_automated"><a class="anchor" href="#_1_2_2_ensure_that_the_token_auth_file_parameter_is_not_set_automated"></a>1.2.2 Ensure that the --token-auth-file parameter is not set (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the documentation and configure alternate mechanisms for authentication. Then,
edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and remove the --token-auth-file=&lt;filename&gt; parameter.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--token-auth-file' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_3_ensure_that_the_denyserviceexternalips_is_not_set_automated"><a class="anchor" href="#_1_2_3_ensure_that_the_denyserviceexternalips_is_not_set_automated"></a>1.2.3 Ensure that the --DenyServiceExternalIPs is not set (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and remove the <code>DenyServiceExternalIPs</code>
from enabled admission plugins.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--enable-admission-plugins' does not have 'DenyServiceExternalIPs' OR '--enable-admission-plugins' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_4_ensure_that_the_kubelet_https_argument_is_set_to_true_automated"><a class="anchor" href="#_1_2_4_ensure_that_the_kubelet_https_argument_is_set_to_true_automated"></a>1.2.4 Ensure that the --kubelet-https argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and remove the --kubelet-https parameter.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--kubelet-https' is present OR '--kubelet-https' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_5_ensure_that_the_kubelet_client_certificate_and_kubelet_client_key_arguments_are_set_as_appropriate_automated"><a class="anchor" href="#_1_2_5_ensure_that_the_kubelet_client_certificate_and_kubelet_client_key_arguments_are_set_as_appropriate_automated"></a>1.2.5 Ensure that the --kubelet-client-certificate and --kubelet-client-key arguments are set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and set up the TLS connection between the
apiserver and kubelets. Then, edit API server pod specification file
/etc/kubernetes/manifests/kube-apiserver.yaml on the control plane node and set the
kubelet client certificate and key parameters as below.
--kubelet-client-certificate=&lt;path/to/client-certificate-file&gt;
--kubelet-client-key=&lt;path/to/client-key-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--kubelet-client-certificate' is present AND '--kubelet-client-key' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_6_ensure_that_the_kubelet_certificate_authority_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_1_2_6_ensure_that_the_kubelet_certificate_authority_argument_is_set_as_appropriate_automated"></a>1.2.6 Ensure that the --kubelet-certificate-authority argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and setup the TLS connection between
the apiserver and kubelets. Then, edit the API server pod specification file
/etc/kubernetes/manifests/kube-apiserver.yaml on the control plane node and set the
--kubelet-certificate-authority parameter to the path to the cert file for the certificate authority.
--kubelet-certificate-authority=&lt;ca-string&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--kubelet-certificate-authority' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_7_ensure_that_the_authorization_mode_argument_is_not_set_to_alwaysallow_automated"><a class="anchor" href="#_1_2_7_ensure_that_the_authorization_mode_argument_is_not_set_to_alwaysallow_automated"></a>1.2.7 Ensure that the --authorization-mode argument is not set to AlwaysAllow (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --authorization-mode parameter to values other than AlwaysAllow.
One such example could be as below.
--authorization-mode=RBAC</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--authorization-mode' does not have 'AlwaysAllow'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_8_ensure_that_the_authorization_mode_argument_includes_node_automated"><a class="anchor" href="#_1_2_8_ensure_that_the_authorization_mode_argument_includes_node_automated"></a>1.2.8 Ensure that the --authorization-mode argument includes Node (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --authorization-mode parameter to a value that includes Node.
--authorization-mode=Node,RBAC</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--authorization-mode' has 'Node'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_9_ensure_that_the_authorization_mode_argument_includes_rbac_automated"><a class="anchor" href="#_1_2_9_ensure_that_the_authorization_mode_argument_includes_rbac_automated"></a>1.2.9 Ensure that the --authorization-mode argument includes RBAC (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --authorization-mode parameter to a value that includes RBAC,
for example <code>--authorization-mode=Node,RBAC</code>.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--authorization-mode' has 'RBAC'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_10_ensure_that_the_admission_control_plugin_eventratelimit_is_set_manual"><a class="anchor" href="#_1_2_10_ensure_that_the_admission_control_plugin_eventratelimit_is_set_manual"></a>1.2.10 Ensure that the admission control plugin EventRateLimit is set (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and set the desired limits in a configuration file.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
and set the below parameters.
--enable-admission-plugins=&#8230;&#8203;,EventRateLimit,&#8230;&#8203;
--admission-control-config-file=&lt;path/to/configuration/file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--enable-admission-plugins' has 'EventRateLimit'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_11_ensure_that_the_admission_control_plugin_alwaysadmit_is_not_set_automated"><a class="anchor" href="#_1_2_11_ensure_that_the_admission_control_plugin_alwaysadmit_is_not_set_automated"></a>1.2.11 Ensure that the admission control plugin AlwaysAdmit is not set (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and either remove the --enable-admission-plugins parameter, or set it to a
value that does not include AlwaysAdmit.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--enable-admission-plugins' does not have 'AlwaysAdmit' OR '--enable-admission-plugins' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_12_ensure_that_the_admission_control_plugin_alwayspullimages_is_set_manual"><a class="anchor" href="#_1_2_12_ensure_that_the_admission_control_plugin_alwayspullimages_is_set_manual"></a>1.2.12 Ensure that the admission control plugin AlwaysPullImages is set (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --enable-admission-plugins parameter to include
AlwaysPullImages.
--enable-admission-plugins=&#8230;&#8203;,AlwaysPullImages,&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_13_ensure_that_the_admission_control_plugin_securitycontextdeny_is_set_if_podsecuritypolicy_is_not_used_manual"><a class="anchor" href="#_1_2_13_ensure_that_the_admission_control_plugin_securitycontextdeny_is_set_if_podsecuritypolicy_is_not_used_manual"></a>1.2.13 Ensure that the admission control plugin SecurityContextDeny is set if PodSecurityPolicy is not used (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --enable-admission-plugins parameter to include
SecurityContextDeny, unless PodSecurityPolicy is already in place.
--enable-admission-plugins=&#8230;&#8203;,SecurityContextDeny,&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_14_ensure_that_the_admission_control_plugin_serviceaccount_is_set_automated"><a class="anchor" href="#_1_2_14_ensure_that_the_admission_control_plugin_serviceaccount_is_set_automated"></a>1.2.14 Ensure that the admission control plugin ServiceAccount is set (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the documentation and create ServiceAccount objects as per your environment.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and ensure that the --disable-admission-plugins parameter is set to a
value that does not include ServiceAccount.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--disable-admission-plugins' is present OR '--disable-admission-plugins' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_15_ensure_that_the_admission_control_plugin_namespacelifecycle_is_set_automated"><a class="anchor" href="#_1_2_15_ensure_that_the_admission_control_plugin_namespacelifecycle_is_set_automated"></a>1.2.15 Ensure that the admission control plugin NamespaceLifecycle is set (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --disable-admission-plugins parameter to
ensure it does not include NamespaceLifecycle.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--disable-admission-plugins' is present OR '--disable-admission-plugins' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_16_ensure_that_the_admission_control_plugin_noderestriction_is_set_automated"><a class="anchor" href="#_1_2_16_ensure_that_the_admission_control_plugin_noderestriction_is_set_automated"></a>1.2.16 Ensure that the admission control plugin NodeRestriction is set (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and configure NodeRestriction plug-in on kubelets.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --enable-admission-plugins parameter to a
value that includes NodeRestriction.
--enable-admission-plugins=&#8230;&#8203;,NodeRestriction,&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--enable-admission-plugins' has 'NodeRestriction'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_17_ensure_that_the_secure_port_argument_is_not_set_to_0_automated"><a class="anchor" href="#_1_2_17_ensure_that_the_secure_port_argument_is_not_set_to_0_automated"></a>1.2.17 Ensure that the --secure-port argument is not set to 0 (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and either remove the --secure-port parameter or
set it to a different (non-zero) desired port.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--secure-port' is greater than 0 OR '--secure-port' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_18_ensure_that_the_profiling_argument_is_set_to_false_automated"><a class="anchor" href="#_1_2_18_ensure_that_the_profiling_argument_is_set_to_false_automated"></a>1.2.18 Ensure that the --profiling argument is set to false (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the below parameter.
--profiling=false</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--profiling' is equal to 'false'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_19_ensure_that_the_audit_log_path_argument_is_set_automated"><a class="anchor" href="#_1_2_19_ensure_that_the_audit_log_path_argument_is_set_automated"></a>1.2.19 Ensure that the --audit-log-path argument is set (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --audit-log-path parameter to a suitable path and
file where you would like audit logs to be written, for example,
--audit-log-path=/var/log/apiserver/audit.log</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--audit-log-path' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_20_ensure_that_the_audit_log_maxage_argument_is_set_to_30_or_as_appropriate_automated"><a class="anchor" href="#_1_2_20_ensure_that_the_audit_log_maxage_argument_is_set_to_30_or_as_appropriate_automated"></a>1.2.20 Ensure that the --audit-log-maxage argument is set to 30 or as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --audit-log-maxage parameter to 30
or as an appropriate number of days, for example,
--audit-log-maxage=30</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--audit-log-maxage' is greater or equal to 30</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_21_ensure_that_the_audit_log_maxbackup_argument_is_set_to_10_or_as_appropriate_automated"><a class="anchor" href="#_1_2_21_ensure_that_the_audit_log_maxbackup_argument_is_set_to_10_or_as_appropriate_automated"></a>1.2.21 Ensure that the --audit-log-maxbackup argument is set to 10 or as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --audit-log-maxbackup parameter to 10 or to an appropriate
value. For example,
--audit-log-maxbackup=10</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--audit-log-maxbackup' is greater or equal to 10</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_22_ensure_that_the_audit_log_maxsize_argument_is_set_to_100_or_as_appropriate_automated"><a class="anchor" href="#_1_2_22_ensure_that_the_audit_log_maxsize_argument_is_set_to_100_or_as_appropriate_automated"></a>1.2.22 Ensure that the --audit-log-maxsize argument is set to 100 or as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --audit-log-maxsize parameter to an appropriate size in MB.
For example, to set it as 100 MB, --audit-log-maxsize=100</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--audit-log-maxsize' is greater or equal to 100</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_24_ensure_that_the_service_account_lookup_argument_is_set_to_true_automated"><a class="anchor" href="#_1_2_24_ensure_that_the_service_account_lookup_argument_is_set_to_true_automated"></a>1.2.24 Ensure that the --service-account-lookup argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the below parameter.
--service-account-lookup=true
Alternatively, you can delete the --service-account-lookup parameter from this file so
that the default takes effect.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--service-account-lookup' is not present OR '--service-account-lookup' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_25_ensure_that_the_request_timeout_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_1_2_25_ensure_that_the_request_timeout_argument_is_set_as_appropriate_automated"></a>1.2.25 Ensure that the --request-timeout argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --service-account-key-file parameter
to the public key file for service accounts. For example,
--service-account-key-file=&lt;filename&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--service-account-key-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_26_ensure_that_the_etcd_certfile_and_etcd_keyfile_arguments_are_set_as_appropriate_automated"><a class="anchor" href="#_1_2_26_ensure_that_the_etcd_certfile_and_etcd_keyfile_arguments_are_set_as_appropriate_automated"></a>1.2.26 Ensure that the --etcd-certfile and --etcd-keyfile arguments are set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and set up the TLS connection between the apiserver and etcd.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the etcd certificate and key file parameters.
--etcd-certfile=&lt;path/to/client-certificate-file&gt;
--etcd-keyfile=&lt;path/to/client-key-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--etcd-certfile' is present AND '--etcd-keyfile' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_27_ensure_that_the_tls_cert_file_and_tls_private_key_file_arguments_are_set_as_appropriate_automated"><a class="anchor" href="#_1_2_27_ensure_that_the_tls_cert_file_and_tls_private_key_file_arguments_are_set_as_appropriate_automated"></a>1.2.27 Ensure that the --tls-cert-file and --tls-private-key-file arguments are set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and set up the TLS connection on the apiserver.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the TLS certificate and private key file parameters.
--tls-cert-file=&lt;path/to/tls-certificate-file&gt;
--tls-private-key-file=&lt;path/to/tls-key-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--tls-cert-file' is present AND '--tls-private-key-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_28_ensure_that_the_client_ca_file_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_1_2_28_ensure_that_the_client_ca_file_argument_is_set_as_appropriate_automated"></a>1.2.28 Ensure that the --client-ca-file argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and set up the TLS connection on the apiserver.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the client certificate authority file.
--client-ca-file=&lt;path/to/client-ca-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--client-ca-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_29_ensure_that_the_etcd_cafile_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_1_2_29_ensure_that_the_etcd_cafile_argument_is_set_as_appropriate_automated"></a>1.2.29 Ensure that the --etcd-cafile argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and set up the TLS connection between the apiserver and etcd.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the etcd certificate authority file parameter.
--etcd-cafile=&lt;path/to/ca-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--etcd-cafile' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_30_ensure_that_the_encryption_provider_config_argument_is_set_as_appropriate_manual"><a class="anchor" href="#_1_2_30_ensure_that_the_encryption_provider_config_argument_is_set_as_appropriate_manual"></a>1.2.30 Ensure that the --encryption-provider-config argument is set as appropriate (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and configure a EncryptionConfig file.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the --encryption-provider-config parameter to the path of that file.
For example, --encryption-provider-config=&lt;/path/to/EncryptionConfig/File&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--encryption-provider-config' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_31_ensure_that_encryption_providers_are_appropriately_configured_automated"><a class="anchor" href="#_1_2_31_ensure_that_encryption_providers_are_appropriately_configured_automated"></a>1.2.31 Ensure that encryption providers are appropriately configured (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and configure a EncryptionConfig file.
In this file, choose aescbc, kms or secretbox as the encryption provider.</p>
</div>
<div class="paragraph">
<p><strong>Audit Script:</strong> <code>check_encryption_provider_config.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

# This script is used to check the encrption provider config is set to aesbc
#
# outputs:
#   true/false

# TODO: Figure out the file location from the kube-apiserver commandline args
ENCRYPTION_CONFIG_FILE="/node/etc/kubernetes/ssl/encryption.yaml"

if [[ ! -f "${ENCRYPTION_CONFIG_FILE}" ]]; then
  echo "false"
  exit
fi

for provider in "$@"
do
  if grep "$provider" "${ENCRYPTION_CONFIG_FILE}"; then
    echo "true"
    exit
  fi
done

echo "false"
exit</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Execution:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./check_encryption_provider_config.sh aescbc</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'true' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">- aescbc: true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_32_ensure_that_the_api_server_only_makes_use_of_strong_cryptographic_ciphers_automated"><a class="anchor" href="#_1_2_32_ensure_that_the_api_server_only_makes_use_of_strong_cryptographic_ciphers_automated"></a>1.2.32 Ensure that the API Server only makes use of Strong Cryptographic Ciphers (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the control plane node and set the below parameter.
--tls-cipher-suites=TLS_AES_128_GCM_SHA256,TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256,
TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,
TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,
TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256,TLS_RSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,
TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_GCM_SHA384</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--tls-cipher-suites' contains valid elements from 'TLS_AES_128_GCM_SHA256,TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256,TLS_RSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_GCM_SHA384'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_3_controller_manager"><a class="anchor" href="#_1_3_controller_manager"></a>1.3 Controller Manager</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_3_1_ensure_that_the_terminated_pod_gc_threshold_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_1_3_1_ensure_that_the_terminated_pod_gc_threshold_argument_is_set_as_appropriate_automated"></a>1.3.1 Ensure that the --terminated-pod-gc-threshold argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the control plane node and set the --terminated-pod-gc-threshold to an appropriate threshold,
for example, --terminated-pod-gc-threshold=10</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-controller-manager | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--terminated-pod-gc-threshold' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5411 5390 2 21:34 ? 00:00:06 kube-controller-manager --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --allow-untagged-cloud=true --leader-elect=true --terminated-pod-gc-threshold=1000 --allocate-node-cidrs=true --node-monitor-grace-period=40s --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --profiling=false --configure-cloud-routes=false --enable-hostpath-provisioner=false --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --address=0.0.0.0 --v=2 --cloud-provider= --pod-eviction-timeout=5m0s --cluster-cidr=10.42.0.0/16 --use-service-account-credentials=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_2_ensure_that_the_profiling_argument_is_set_to_false_automated"><a class="anchor" href="#_1_3_2_ensure_that_the_profiling_argument_is_set_to_false_automated"></a>1.3.2 Ensure that the --profiling argument is set to false (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the control plane node and set the below parameter.
--profiling=false</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-controller-manager | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--profiling' is equal to 'false'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5411 5390 2 21:34 ? 00:00:06 kube-controller-manager --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --allow-untagged-cloud=true --leader-elect=true --terminated-pod-gc-threshold=1000 --allocate-node-cidrs=true --node-monitor-grace-period=40s --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --profiling=false --configure-cloud-routes=false --enable-hostpath-provisioner=false --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --address=0.0.0.0 --v=2 --cloud-provider= --pod-eviction-timeout=5m0s --cluster-cidr=10.42.0.0/16 --use-service-account-credentials=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_3_ensure_that_the_use_service_account_credentials_argument_is_set_to_true_automated"><a class="anchor" href="#_1_3_3_ensure_that_the_use_service_account_credentials_argument_is_set_to_true_automated"></a>1.3.3 Ensure that the --use-service-account-credentials argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the control plane node to set the below parameter.
--use-service-account-credentials=true</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-controller-manager | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--use-service-account-credentials' is not equal to 'false'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5411 5390 2 21:34 ? 00:00:06 kube-controller-manager --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --allow-untagged-cloud=true --leader-elect=true --terminated-pod-gc-threshold=1000 --allocate-node-cidrs=true --node-monitor-grace-period=40s --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --profiling=false --configure-cloud-routes=false --enable-hostpath-provisioner=false --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --address=0.0.0.0 --v=2 --cloud-provider= --pod-eviction-timeout=5m0s --cluster-cidr=10.42.0.0/16 --use-service-account-credentials=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_4_ensure_that_the_service_account_private_key_file_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_1_3_4_ensure_that_the_service_account_private_key_file_argument_is_set_as_appropriate_automated"></a>1.3.4 Ensure that the --service-account-private-key-file argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the control plane node and set the --service-account-private-key-file parameter
to the private key file for service accounts.
--service-account-private-key-file=&lt;filename&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-controller-manager | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--service-account-private-key-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5411 5390 2 21:34 ? 00:00:06 kube-controller-manager --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --allow-untagged-cloud=true --leader-elect=true --terminated-pod-gc-threshold=1000 --allocate-node-cidrs=true --node-monitor-grace-period=40s --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --profiling=false --configure-cloud-routes=false --enable-hostpath-provisioner=false --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --address=0.0.0.0 --v=2 --cloud-provider= --pod-eviction-timeout=5m0s --cluster-cidr=10.42.0.0/16 --use-service-account-credentials=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_5_ensure_that_the_root_ca_file_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_1_3_5_ensure_that_the_root_ca_file_argument_is_set_as_appropriate_automated"></a>1.3.5 Ensure that the --root-ca-file argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the control plane node and set the --root-ca-file parameter to the certificate bundle file`.
--root-ca-file=&lt;path/to/file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-controller-manager | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--root-ca-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5411 5390 2 21:34 ? 00:00:06 kube-controller-manager --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --allow-untagged-cloud=true --leader-elect=true --terminated-pod-gc-threshold=1000 --allocate-node-cidrs=true --node-monitor-grace-period=40s --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --profiling=false --configure-cloud-routes=false --enable-hostpath-provisioner=false --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --address=0.0.0.0 --v=2 --cloud-provider= --pod-eviction-timeout=5m0s --cluster-cidr=10.42.0.0/16 --use-service-account-credentials=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_6_ensure_that_the_rotatekubeletservercertificate_argument_is_set_to_true_automated"><a class="anchor" href="#_1_3_6_ensure_that_the_rotatekubeletservercertificate_argument_is_set_to_true_automated"></a>1.3.6 Ensure that the RotateKubeletServerCertificate argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the control plane node and set the --feature-gates parameter to include RotateKubeletServerCertificate=true.
--feature-gates=RotateKubeletServerCertificate=true</p>
</div>
<div class="paragraph">
<p>Cluster provisioned by RKE handles certificate rotation directly through RKE.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_7_ensure_that_the_bind_address_argument_is_set_to_127_0_0_1_automated"><a class="anchor" href="#_1_3_7_ensure_that_the_bind_address_argument_is_set_to_127_0_0_1_automated"></a>1.3.7 Ensure that the --bind-address argument is set to 127.0.0.1 (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the control plane node and ensure the correct value for the --bind-address parameter</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-controller-manager | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--bind-address' is present OR '--bind-address' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5411 5390 2 21:34 ? 00:00:06 kube-controller-manager --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --allow-untagged-cloud=true --leader-elect=true --terminated-pod-gc-threshold=1000 --allocate-node-cidrs=true --node-monitor-grace-period=40s --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --profiling=false --configure-cloud-routes=false --enable-hostpath-provisioner=false --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --address=0.0.0.0 --v=2 --cloud-provider= --pod-eviction-timeout=5m0s --cluster-cidr=10.42.0.0/16 --use-service-account-credentials=true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_scheduler"><a class="anchor" href="#_1_4_scheduler"></a>1.4 Scheduler</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_4_1_ensure_that_the_profiling_argument_is_set_to_false_automated"><a class="anchor" href="#_1_4_1_ensure_that_the_profiling_argument_is_set_to_false_automated"></a>1.4.1 Ensure that the --profiling argument is set to false (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Scheduler pod specification file /etc/kubernetes/manifests/kube-scheduler.yaml file
on the control plane node and set the below parameter.
--profiling=false</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-scheduler | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--profiling' is equal to 'false'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5564 5543 0 21:34 ? 00:00:01 kube-scheduler --v=2 --address=0.0.0.0 --leader-elect=true --profiling=false --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_4_2_ensure_that_the_bind_address_argument_is_set_to_127_0_0_1_automated"><a class="anchor" href="#_1_4_2_ensure_that_the_bind_address_argument_is_set_to_127_0_0_1_automated"></a>1.4.2 Ensure that the --bind-address argument is set to 127.0.0.1 (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the Scheduler pod specification file /etc/kubernetes/manifests/kube-scheduler.yaml
on the control plane node and ensure the correct value for the --bind-address parameter</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-scheduler | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--bind-address' is present OR '--bind-address' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5564 5543 0 21:34 ? 00:00:01 kube-scheduler --v=2 --address=0.0.0.0 --leader-elect=true --profiling=false --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_etcd_node_configuration"><a class="anchor" href="#_2_etcd_node_configuration"></a>2 Etcd Node Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_2_1_ensure_that_the_cert_file_and_key_file_arguments_are_set_as_appropriate_automated"><a class="anchor" href="#_2_1_ensure_that_the_cert_file_and_key_file_arguments_are_set_as_appropriate_automated"></a>2.1 Ensure that the --cert-file and --key-file arguments are set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the etcd service documentation and configure TLS encryption.
Then, edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml
on the master node and set the below parameters.
--cert-file=&lt;/path/to/ca-file&gt;
--key-file=&lt;/path/to/key-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--cert-file' is present AND '--key-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">etcd 5096 5076 3 21:34 ? 00:00:08 /usr/local/bin/etcd --initial-cluster=etcd-ip-172-31-26-226=https://172.31.26.226:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --initial-cluster-token=etcd-cluster-1 --name=etcd-ip-172-31-26-226 --listen-client-urls=https://172.31.26.226:2379 --listen-peer-urls=https://172.31.26.226:2380 --client-cert-auth=true --election-timeout=5000 --initial-advertise-peer-urls=https://172.31.26.226:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --initial-cluster-state=new --advertise-client-urls=https://172.31.26.226:2379 --heartbeat-interval=500 --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 5258 5238 18 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16 root 17615 17594 5 21:38 ? 00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=0 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.23-hardened --json --log_dir /tmp/sonobuoy/logs --outputfile /tmp/sonobuoy/etcd.json</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_ensure_that_the_client_cert_auth_argument_is_set_to_true_automated"><a class="anchor" href="#_2_2_ensure_that_the_client_cert_auth_argument_is_set_to_true_automated"></a>2.2 Ensure that the --client-cert-auth argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml on the master
node and set the below parameter.
--client-cert-auth="true"</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--client-cert-auth' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">etcd 5096 5076 3 21:34 ? 00:00:08 /usr/local/bin/etcd --initial-cluster=etcd-ip-172-31-26-226=https://172.31.26.226:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --initial-cluster-token=etcd-cluster-1 --name=etcd-ip-172-31-26-226 --listen-client-urls=https://172.31.26.226:2379 --listen-peer-urls=https://172.31.26.226:2380 --client-cert-auth=true --election-timeout=5000 --initial-advertise-peer-urls=https://172.31.26.226:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --initial-cluster-state=new --advertise-client-urls=https://172.31.26.226:2379 --heartbeat-interval=500 --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 5258 5238 18 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16 root 17615 17594 3 21:38 ? 00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=0 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.23-hardened --json --log_dir /tmp/sonobuoy/logs --outputfile /tmp/sonobuoy/etcd.json</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_3_ensure_that_the_auto_tls_argument_is_not_set_to_true_automated"><a class="anchor" href="#_2_3_ensure_that_the_auto_tls_argument_is_not_set_to_true_automated"></a>2.3 Ensure that the --auto-tls argument is not set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml on the master
node and either remove the --auto-tls parameter or set it to false.
--auto-tls=false</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'ETCD_AUTO_TLS' is not present OR 'ETCD_AUTO_TLS' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=ip-172-31-26-226 ETCDCTL_API=3 ETCDCTL_CACERT=/etc/kubernetes/ssl/kube-ca.pem ETCDCTL_CERT=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem ETCDCTL_KEY=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem ETCDCTL_ENDPOINTS=https://172.31.26.226:2379 ETCD_UNSUPPORTED_ARCH=x86_64 HOME=/</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_4_ensure_that_the_peer_cert_file_and_peer_key_file_arguments_are_set_as_appropriate_automated"><a class="anchor" href="#_2_4_ensure_that_the_peer_cert_file_and_peer_key_file_arguments_are_set_as_appropriate_automated"></a>2.4 Ensure that the --peer-cert-file and --peer-key-file arguments are set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the etcd service documentation and configure peer TLS encryption as appropriate
for your etcd cluster.
Then, edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml on the
master node and set the below parameters.
--peer-client-file=&lt;/path/to/peer-cert-file&gt;
--peer-key-file=&lt;/path/to/peer-key-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--peer-cert-file' is present AND '--peer-key-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">etcd 5096 5076 3 21:34 ? 00:00:08 /usr/local/bin/etcd --initial-cluster=etcd-ip-172-31-26-226=https://172.31.26.226:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --initial-cluster-token=etcd-cluster-1 --name=etcd-ip-172-31-26-226 --listen-client-urls=https://172.31.26.226:2379 --listen-peer-urls=https://172.31.26.226:2380 --client-cert-auth=true --election-timeout=5000 --initial-advertise-peer-urls=https://172.31.26.226:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --initial-cluster-state=new --advertise-client-urls=https://172.31.26.226:2379 --heartbeat-interval=500 --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 5258 5238 18 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16 root 17615 17594 3 21:38 ? 00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=0 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.23-hardened --json --log_dir /tmp/sonobuoy/logs --outputfile /tmp/sonobuoy/etcd.json</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_5_ensure_that_the_peer_client_cert_auth_argument_is_set_to_true_automated"><a class="anchor" href="#_2_5_ensure_that_the_peer_client_cert_auth_argument_is_set_to_true_automated"></a>2.5 Ensure that the --peer-client-cert-auth argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml on the master
node and set the below parameter.
--peer-client-cert-auth=true</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--peer-client-cert-auth' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">etcd 5096 5076 3 21:34 ? 00:00:08 /usr/local/bin/etcd --initial-cluster=etcd-ip-172-31-26-226=https://172.31.26.226:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --initial-cluster-token=etcd-cluster-1 --name=etcd-ip-172-31-26-226 --listen-client-urls=https://172.31.26.226:2379 --listen-peer-urls=https://172.31.26.226:2380 --client-cert-auth=true --election-timeout=5000 --initial-advertise-peer-urls=https://172.31.26.226:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --initial-cluster-state=new --advertise-client-urls=https://172.31.26.226:2379 --heartbeat-interval=500 --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 5258 5238 18 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16 root 17615 17594 3 21:38 ? 00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=0 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.23-hardened --json --log_dir /tmp/sonobuoy/logs --outputfile /tmp/sonobuoy/etcd.json</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_6_ensure_that_the_peer_auto_tls_argument_is_not_set_to_true_automated"><a class="anchor" href="#_2_6_ensure_that_the_peer_auto_tls_argument_is_not_set_to_true_automated"></a>2.6 Ensure that the --peer-auto-tls argument is not set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml on the master
node and either remove the --peer-auto-tls parameter or set it to false.
--peer-auto-tls=false</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'ETCD_PEER_AUTO_TLS' is not present OR 'ETCD_PEER_AUTO_TLS' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=ip-172-31-26-226 ETCDCTL_API=3 ETCDCTL_CACERT=/etc/kubernetes/ssl/kube-ca.pem ETCDCTL_CERT=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem ETCDCTL_KEY=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem ETCDCTL_ENDPOINTS=https://172.31.26.226:2379 ETCD_UNSUPPORTED_ARCH=x86_64 HOME=/</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_7_ensure_that_a_unique_certificate_authority_is_used_for_etcd_automated"><a class="anchor" href="#_2_7_ensure_that_a_unique_certificate_authority_is_used_for_etcd_automated"></a>2.7 Ensure that a unique Certificate Authority is used for etcd (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong></p>
</div>
<div class="paragraph">
<p>Follow the etcd documentation and create a dedicated certificate authority setup for the
etcd service.
Then, edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml on the
master node and set the below parameter.
--trusted-ca-file=&lt;/path/to/ca-file&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--trusted-ca-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">etcd 5096 5076 3 21:34 ? 00:00:08 /usr/local/bin/etcd --initial-cluster=etcd-ip-172-31-26-226=https://172.31.26.226:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226.pem --initial-cluster-token=etcd-cluster-1 --name=etcd-ip-172-31-26-226 --listen-client-urls=https://172.31.26.226:2379 --listen-peer-urls=https://172.31.26.226:2380 --client-cert-auth=true --election-timeout=5000 --initial-advertise-peer-urls=https://172.31.26.226:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --initial-cluster-state=new --advertise-client-urls=https://172.31.26.226:2379 --heartbeat-interval=500 --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-172-31-26-226-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 5258 5238 18 21:34 ? 00:00:40 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16 root 17615 17594 2 21:38 ? 00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=0 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.23-hardened --json --log_dir /tmp/sonobuoy/logs --outputfile /tmp/sonobuoy/etcd.json</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_1_authentication_and_authorization"><a class="anchor" href="#_3_1_authentication_and_authorization"></a>3.1 Authentication and Authorization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_3_1_1_client_certificate_authentication_should_not_be_used_for_users_manual"><a class="anchor" href="#_3_1_1_client_certificate_authentication_should_not_be_used_for_users_manual"></a>3.1.1 Client certificate authentication should not be used for users (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Alternative mechanisms provided by Kubernetes such as the use of OIDC should be
implemented in place of client certificates.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_2_logging"><a class="anchor" href="#_3_2_logging"></a>3.2 Logging</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_3_2_1_ensure_that_a_minimal_audit_policy_is_created_automated"><a class="anchor" href="#_3_2_1_ensure_that_a_minimal_audit_policy_is_created_automated"></a>3.2.1 Ensure that a minimal audit policy is created (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Create an audit policy file for your cluster.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep kube-apiserver | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--audit-policy-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 5258 5238 17 21:34 ? 00:00:41 kube-apiserver --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --api-audiences=unknown --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --requestheader-group-headers=X-Remote-Group --advertise-address=172.31.26.226 --audit-log-format=json --requestheader-allowed-names=kube-apiserver-proxy-client --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --authentication-token-webhook-config-file=/etc/kubernetes/kube-api-authn-webhook.yaml --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --anonymous-auth=false --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --secure-port=6443 --audit-log-path=/var/log/kube-audit/audit-log.json --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --etcd-prefix=/registry --etcd-servers=https://172.31.26.226:2379 --insecure-port=0 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --runtime-config=policy/v1beta1/podsecuritypolicy=true --audit-log-maxsize=100 --cloud-provider= --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --authentication-token-webhook-cache-ttl=5s --profiling=false --requestheader-extra-headers-prefix=X-Remote-Extra- --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --audit-log-maxage=30 --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --storage-backend=etcd3 --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --authorization-mode=Node,RBAC --admission-control-config-file=/etc/kubernetes/admission.yaml --service-node-port-range=30000-32767 --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --allow-privileged=true --service-account-lookup=true --audit-log-maxbackup=10 --audit-policy-file=/etc/kubernetes/audit-policy.yaml --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-cluster-ip-range=10.43.0.0/16</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_2_2_ensure_that_the_audit_policy_covers_key_security_concerns_manual"><a class="anchor" href="#_3_2_2_ensure_that_the_audit_policy_covers_key_security_concerns_manual"></a>3.2.2 Ensure that the audit policy covers key security concerns (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Review the audit policy provided for the cluster and ensure that it covers
at least the following areas,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to Secrets managed by the cluster. Care should be taken to only
log Metadata for requests to Secrets, ConfigMaps, and TokenReviews, in
order to avoid risk of logging sensitive data.</p>
</li>
<li>
<p>Modification of Pod and Deployment objects.</p>
</li>
<li>
<p>Use of <code>pods/exec</code>, <code>pods/portforward</code>, <code>pods/proxy</code> and <code>services/proxy</code>.
For most requests, minimally logging at the Metadata level is recommended
(the most basic level of logging).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_1_worker_node_configuration_files"><a class="anchor" href="#_4_1_worker_node_configuration_files"></a>4.1 Worker Node Configuration Files</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_4_1_1_ensure_that_the_kubelet_service_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_4_1_1_ensure_that_the_kubelet_service_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>4.1.1 Ensure that the kubelet service file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for the kubelet service.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_2_ensure_that_the_kubelet_service_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_4_1_2_ensure_that_the_kubelet_service_file_ownership_is_set_to_rootroot_automated"></a>4.1.2 Ensure that the kubelet service file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Cluster provisioned by RKE doesn&#8217;t require or maintain a configuration file for the kubelet service.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_3_if_proxy_kubeconfig_file_exists_ensure_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_4_1_3_if_proxy_kubeconfig_file_exists_ensure_permissions_are_set_to_644_or_more_restrictive_automated"></a>4.1.3 If proxy kubeconfig file exists ensure permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the each worker node.
For example,
chmod 644 /etc/kubernetes/ssl/kubecfg-kube-proxy.yaml</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /node/etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; then stat -c permissions=%a /node/etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions has permissions 600, expected 644 or more restrictive OR '/etc/kubernetes/ssl/kubecfg-kube-proxy.yaml' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions=600</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_4_if_proxy_kubeconfig_file_exists_ensure_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_4_1_4_if_proxy_kubeconfig_file_exists_ensure_ownership_is_set_to_rootroot_automated"></a>4.1.4 If proxy kubeconfig file exists ensure ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the each worker node.
For example, chown root:root /etc/kubernetes/ssl/kubecfg-kube-proxy.yaml</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; then stat -c %U:%G /etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'root:root' is present OR '/etc/kubernetes/ssl/kubecfg-kube-proxy.yaml' is not present</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_5_ensure_that_the_kubeconfig_kubelet_conf_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_4_1_5_ensure_that_the_kubeconfig_kubelet_conf_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>4.1.5 Ensure that the --kubeconfig kubelet.conf file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the each worker node.
For example,
chmod 644 /etc/kubernetes/ssl/kubecfg-kube-node.yaml</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /node/etc/kubernetes/ssl/kubecfg-kube-node.yaml; then stat -c permissions=%a /node/etc/kubernetes/ssl/kubecfg-kube-node.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions has permissions 600, expected 644 or more restrictive</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions=600</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_6_ensure_that_the_kubeconfig_kubelet_conf_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_4_1_6_ensure_that_the_kubeconfig_kubelet_conf_file_ownership_is_set_to_rootroot_automated"></a>4.1.6 Ensure that the --kubeconfig kubelet.conf file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the below command (based on the file location on your system) on the each worker node.
For example,
chown root:root /etc/kubernetes/ssl/kubecfg-kube-node.yaml</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /node/etc/kubernetes/ssl/kubecfg-kube-node.yaml; then stat -c %U:%G /node/etc/kubernetes/ssl/kubecfg-kube-node.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'root:root' is equal to 'root:root'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_7_ensure_that_the_certificate_authorities_file_permissions_are_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_4_1_7_ensure_that_the_certificate_authorities_file_permissions_are_set_to_644_or_more_restrictive_automated"></a>4.1.7 Ensure that the certificate authorities file permissions are set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the following command to modify the file permissions of the
--client-ca-file chmod 644 &lt;filename&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c permissions=%a /node/etc/kubernetes/ssl/kube-ca.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions has permissions 644, expected 644 or more restrictive</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions=644</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_8_ensure_that_the_client_certificate_authorities_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_4_1_8_ensure_that_the_client_certificate_authorities_file_ownership_is_set_to_rootroot_automated"></a>4.1.8 Ensure that the client certificate authorities file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the following command to modify the ownership of the --client-ca-file.
chown root:root &lt;filename&gt;</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c %U:%G /node/etc/kubernetes/ssl/kube-ca.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'root:root' is equal to 'root:root'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_9_ensure_that_the_kubelet_config_configuration_file_has_permissions_set_to_644_or_more_restrictive_automated"><a class="anchor" href="#_4_1_9_ensure_that_the_kubelet_config_configuration_file_has_permissions_set_to_644_or_more_restrictive_automated"></a>4.1.9 Ensure that the kubelet --config configuration file has permissions set to 644 or more restrictive (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the following command (using the config file location identified in the Audit step)
chmod 644 /var/lib/kubelet/config.yaml</p>
</div>
<div class="paragraph">
<p>Clusters provisioned by RKE doesn&#8217;t require or maintain a configuration file for the kubelet.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_10_ensure_that_the_kubelet_config_configuration_file_ownership_is_set_to_rootroot_automated"><a class="anchor" href="#_4_1_10_ensure_that_the_kubelet_config_configuration_file_ownership_is_set_to_rootroot_automated"></a>4.1.10 Ensure that the kubelet --config configuration file ownership is set to root:root (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Run the following command (using the config file location identified in the Audit step)
chown root:root /var/lib/kubelet/config.yaml</p>
</div>
<div class="paragraph">
<p>Clusters provisioned by RKE doesn&#8217;t require or maintain a configuration file for the kubelet.
All configuration is passed in as arguments at container run time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_2_kubelet"><a class="anchor" href="#_4_2_kubelet"></a>4.2 Kubelet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_4_2_1_ensure_that_the_anonymous_auth_argument_is_set_to_false_automated"><a class="anchor" href="#_4_2_1_ensure_that_the_anonymous_auth_argument_is_set_to_false_automated"></a>4.2.1 Ensure that the --anonymous-auth argument is set to false (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>authentication: anonymous: enabled</code> to
<code>false</code>.
If using executable arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.
<code>--anonymous-auth=false</code>
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--anonymous-auth' is equal to 'false'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_2_ensure_that_the_authorization_mode_argument_is_not_set_to_alwaysallow_automated"><a class="anchor" href="#_4_2_2_ensure_that_the_authorization_mode_argument_is_not_set_to_alwaysallow_automated"></a>4.2.2 Ensure that the --authorization-mode argument is not set to AlwaysAllow (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>authorization.mode</code> to Webhook. If
using executable arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_AUTHZ_ARGS variable.
--authorization-mode=Webhook
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--authorization-mode' does not have 'AlwaysAllow'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_3_ensure_that_the_client_ca_file_argument_is_set_as_appropriate_automated"><a class="anchor" href="#_4_2_3_ensure_that_the_client_ca_file_argument_is_set_as_appropriate_automated"></a>4.2.3 Ensure that the --client-ca-file argument is set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>authentication.x509.clientCAFile</code> to
the location of the client CA file.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_AUTHZ_ARGS variable.
--client-ca-file=&lt;path/to/client-ca-file&gt;
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--client-ca-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_4_ensure_that_the_read_only_port_argument_is_set_to_0_automated"><a class="anchor" href="#_4_2_4_ensure_that_the_read_only_port_argument_is_set_to_0_automated"></a>4.2.4 Ensure that the --read-only-port argument is set to 0 (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>readOnlyPort</code> to 0.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.
--read-only-port=0
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--read-only-port' is equal to '0' OR '--read-only-port' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_5_ensure_that_the_streaming_connection_idle_timeout_argument_is_not_set_to_0_manual"><a class="anchor" href="#_4_2_5_ensure_that_the_streaming_connection_idle_timeout_argument_is_not_set_to_0_manual"></a>4.2.5 Ensure that the --streaming-connection-idle-timeout argument is not set to 0 (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>streamingConnectionIdleTimeout</code> to a
value other than 0.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.
--streaming-connection-idle-timeout=5m
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--streaming-connection-idle-timeout' is not equal to '0' OR '--streaming-connection-idle-timeout' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_6_ensure_that_the_protect_kernel_defaults_argument_is_set_to_true_automated"><a class="anchor" href="#_4_2_6_ensure_that_the_protect_kernel_defaults_argument_is_set_to_true_automated"></a>4.2.6 Ensure that the --protect-kernel-defaults argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>protectKernelDefaults</code> to <code>true</code>.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.
--protect-kernel-defaults=true
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--protect-kernel-defaults' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_7_ensure_that_the_make_iptables_util_chains_argument_is_set_to_true_automated"><a class="anchor" href="#_4_2_7_ensure_that_the_make_iptables_util_chains_argument_is_set_to_true_automated"></a>4.2.7 Ensure that the --make-iptables-util-chains argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>makeIPTablesUtilChains</code> to <code>true</code>.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
remove the --make-iptables-util-chains argument from the
KUBELET_SYSTEM_PODS_ARGS variable.
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--make-iptables-util-chains' is equal to 'true' OR '--make-iptables-util-chains' is not present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_8_ensure_that_the_hostname_override_argument_is_not_set_manual"><a class="anchor" href="#_4_2_8_ensure_that_the_hostname_override_argument_is_not_set_manual"></a>4.2.8 Ensure that the --hostname-override argument is not set (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the kubelet service file /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
on each worker node and remove the --hostname-override argument from the
KUBELET_SYSTEM_PODS_ARGS variable.
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p>Clusters provisioned by RKE set the --hostname-override to avoid any hostname configuration errors</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_9_ensure_that_the_event_qps_argument_is_set_to_0_or_a_level_which_ensures_appropriate_event_capture_manual"><a class="anchor" href="#_4_2_9_ensure_that_the_event_qps_argument_is_set_to_0_or_a_level_which_ensures_appropriate_event_capture_manual"></a>4.2.9 Ensure that the --event-qps argument is set to 0 or a level which ensures appropriate event capture (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>eventRecordQPS</code> to an appropriate level.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--event-qps' is equal to '0'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_10_ensure_that_the_tls_cert_file_and_tls_private_key_file_arguments_are_set_as_appropriate_automated"><a class="anchor" href="#_4_2_10_ensure_that_the_tls_cert_file_and_tls_private_key_file_arguments_are_set_as_appropriate_automated"></a>4.2.10 Ensure that the --tls-cert-file and --tls-private-key-file arguments are set as appropriate (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>tlsCertFile</code> to the location
of the certificate file to use to identify this Kubelet, and <code>tlsPrivateKeyFile</code>
to the location of the corresponding private key file.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameters in KUBELET_CERTIFICATE_ARGS variable.
--tls-cert-file=&lt;path/to/tls-certificate-file&gt;
--tls-private-key-file=&lt;path/to/tls-key-file&gt;
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--tls-cert-file' is present AND '--tls-private-key-file' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_11_ensure_that_the_rotate_certificates_argument_is_not_set_to_false_automated"><a class="anchor" href="#_4_2_11_ensure_that_the_rotate_certificates_argument_is_not_set_to_false_automated"></a>4.2.11 Ensure that the --rotate-certificates argument is not set to false (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to add the line <code>rotateCertificates</code> to <code>true</code> or
remove it altogether to use the default value.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
remove --rotate-certificates=false argument from the KUBELET_CERTIFICATE_ARGS
variable.
Based on your system, restart the kubelet service. For example,
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'{.rotateCertificates}' is present OR '{.rotateCertificates}' is not present</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_12_verify_that_the_rotatekubeletservercertificate_argument_is_set_to_true_automated"><a class="anchor" href="#_4_2_12_verify_that_the_rotatekubeletservercertificate_argument_is_set_to_true_automated"></a>4.2.12 Verify that the RotateKubeletServerCertificate argument is set to true (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> Not Applicable</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Edit the kubelet service file /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
on each worker node and set the below parameter in KUBELET_CERTIFICATE_ARGS variable.
--feature-gates=RotateKubeletServerCertificate=true
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p>Clusters provisioned by RKE handles certificate rotation directly through RKE.</p>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_13_ensure_that_the_kubelet_only_makes_use_of_strong_cryptographic_ciphers_automated"><a class="anchor" href="#_4_2_13_ensure_that_the_kubelet_only_makes_use_of_strong_cryptographic_ciphers_automated"></a>4.2.13 Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If using a Kubelet config file, edit the file to set <code>TLSCipherSuites</code> to
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
or to a subset of these values.
If using executable arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the --tls-cipher-suites parameter as follows, or to a subset of these values.
--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -fC kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Config:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/kubelet/config.yaml; then /bin/cat /var/lib/kubelet/config.yaml; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'--tls-cipher-suites' contains valid elements from 'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">UID PID PPID C STIME TTY TIME CMD root 5730 5709 4 21:34 ? 00:00:08 kubelet --pod-infra-container-image=rancher/mirrored-pause:3.6 --network-plugin=cni --protect-kernel-defaults=true --fail-swap-on=false --hostname-override=ip-172-31-26-226 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cni-conf-dir=/etc/cni/net.d --anonymous-auth=false --streaming-connection-idle-timeout=30m --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cloud-provider= --cluster-domain=cluster.local --resolv-conf=/etc/resolv.conf --make-iptables-util-chains=true --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --root-dir=/var/lib/kubelet --read-only-port=0 --v=2 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --feature-gates=RotateKubeletServerCertificate=true --cgroups-per-qos=True --cluster-dns=10.43.0.10 --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --node-ip=172.31.26.226 --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-172-31-26-226-key.pem --event-qps=0 --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_1_rbac_and_service_accounts"><a class="anchor" href="#_5_1_rbac_and_service_accounts"></a>5.1 RBAC and Service Accounts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_1_1_ensure_that_the_cluster_admin_role_is_only_used_where_required_manual"><a class="anchor" href="#_5_1_1_ensure_that_the_cluster_admin_role_is_only_used_where_required_manual"></a>5.1.1 Ensure that the cluster-admin role is only used where required (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Identify all clusterrolebindings to the cluster-admin role. Check if they are used and
if they need this role or if they could use a role with fewer privileges.
Where possible, first bind users to a lower privileged role and then remove the
clusterrolebinding to the cluster-admin role :
kubectl delete clusterrolebinding [name]</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_2_minimize_access_to_secrets_manual"><a class="anchor" href="#_5_1_2_minimize_access_to_secrets_manual"></a>5.1.2 Minimize access to secrets (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Where possible, remove get, list and watch access to Secret objects in the cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_3_minimize_wildcard_use_in_roles_and_clusterroles_manual"><a class="anchor" href="#_5_1_3_minimize_wildcard_use_in_roles_and_clusterroles_manual"></a>5.1.3 Minimize wildcard use in Roles and ClusterRoles (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Where possible replace any use of wildcards in clusterroles and roles with specific
objects or actions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_4_minimize_access_to_create_pods_manual"><a class="anchor" href="#_5_1_4_minimize_access_to_create_pods_manual"></a>5.1.4 Minimize access to create pods (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Where possible, remove create access to pod objects in the cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_5_ensure_that_default_service_accounts_are_not_actively_used_automated"><a class="anchor" href="#_5_1_5_ensure_that_default_service_accounts_are_not_actively_used_automated"></a>5.1.5 Ensure that default service accounts are not actively used. (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Create explicit service accounts wherever a Kubernetes workload requires specific access
to the Kubernetes API server.
Modify the configuration of each default service account to include this value
automountServiceAccountToken: false</p>
</div>
<div class="paragraph">
<p><strong>Audit Script:</strong> <code>check_for_default_sa.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -eE

handle_error() {
    echo "false"
}

trap 'handle_error' ERR

count_sa=$(kubectl get serviceaccounts --all-namespaces -o json | jq -r '.items[] | select(.metadata.name=="default") | select((.automountServiceAccountToken == null) or (.automountServiceAccountToken == true))' | jq .metadata.namespace | wc -l)
if [[ ${count_sa} -gt 0 ]]; then
    echo "false"
    exit
fi

for ns in $(kubectl get ns --no-headers -o custom-columns=":metadata.name")
do
    for result in $(kubectl get clusterrolebinding,rolebinding -n $ns -o json | jq -r '.items[] | select((.subjects[].kind=="ServiceAccount" and .subjects[].name=="default") or (.subjects[].kind=="Group" and .subjects[].name=="system:serviceaccounts"))' | jq -r '"\(.roleRef.kind),\(.roleRef.name)"')
    do
        read kind name &lt;&lt;&lt;$(IFS=","; echo $result)
        resource_count=$(kubectl get $kind $name -n $ns -o json | jq -r '.rules[] | select(.resources[] != "podsecuritypolicies")' | wc -l)
        if [[ ${resource_count} -gt 0 ]]; then
            echo "false"
            exit
        fi
    done
done


echo "true"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Execution:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./check_for_default_sa.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'true' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Error from server (Forbidden): serviceaccounts is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "serviceaccounts" in API group "" at the cluster scope Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "cattle-fleet-system" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "cattle-impersonation-system" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "cattle-system" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "cis-operator-system" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "default" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "ingress-nginx" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "kube-node-lease" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "kube-public" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "kube-system" Error from server (Forbidden): clusterrolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "clusterrolebindings" in API group "rbac.authorization.k8s.io" at the cluster scope Error from server (Forbidden): rolebindings.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "rolebindings" in API group "rbac.authorization.k8s.io" in the namespace "local" true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_6_ensure_that_service_account_tokens_are_only_mounted_where_necessary_manual"><a class="anchor" href="#_5_1_6_ensure_that_service_account_tokens_are_only_mounted_where_necessary_manual"></a>5.1.6 Ensure that Service Account Tokens are only mounted where necessary (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Modify the definition of pods and service accounts which do not need to mount service
account tokens to disable it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_7_avoid_use_of_systemmasters_group_manual"><a class="anchor" href="#_5_1_7_avoid_use_of_systemmasters_group_manual"></a>5.1.7 Avoid use of system:masters group (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Remove the system:masters group from all users in the cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_8_limit_use_of_the_bind_impersonate_and_escalate_permissions_in_the_kubernetes_cluster_manual"><a class="anchor" href="#_5_1_8_limit_use_of_the_bind_impersonate_and_escalate_permissions_in_the_kubernetes_cluster_manual"></a>5.1.8 Limit use of the Bind, Impersonate and Escalate permissions in the Kubernetes cluster (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Where possible, remove the impersonate, bind and escalate rights from subjects.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_2_pod_security_standards"><a class="anchor" href="#_5_2_pod_security_standards"></a>5.2 Pod Security Standards</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_2_1_ensure_that_the_cluster_has_at_least_one_active_policy_control_mechanism_in_place_manual"><a class="anchor" href="#_5_2_1_ensure_that_the_cluster_has_at_least_one_active_policy_control_mechanism_in_place_manual"></a>5.2.1 Ensure that the cluster has at least one active policy control mechanism in place (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Ensure that either Pod Security Admission or an external policy control system is in place
for every namespace which contains user workloads.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_2_minimize_the_admission_of_privileged_containers_manual"><a class="anchor" href="#_5_2_2_minimize_the_admission_of_privileged_containers_manual"></a>5.2.2 Minimize the admission of privileged containers (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of privileged containers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_3_minimize_the_admission_of_containers_wishing_to_share_the_host_process_id_namespace_automated"><a class="anchor" href="#_5_2_3_minimize_the_admission_of_containers_wishing_to_share_the_host_process_id_namespace_automated"></a>5.2.3 Minimize the admission of containers wishing to share the host process ID namespace (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of <code>hostPID</code> containers.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostPID == null) or (.spec.hostPID == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'count' is greater than 0</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">--count=1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_4_minimize_the_admission_of_containers_wishing_to_share_the_host_ipc_namespace_automated"><a class="anchor" href="#_5_2_4_minimize_the_admission_of_containers_wishing_to_share_the_host_ipc_namespace_automated"></a>5.2.4 Minimize the admission of containers wishing to share the host IPC namespace (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of <code>hostIPC</code> containers.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostIPC == null) or (.spec.hostIPC == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'count' is greater than 0</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">--count=1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_5_minimize_the_admission_of_containers_wishing_to_share_the_host_network_namespace_automated"><a class="anchor" href="#_5_2_5_minimize_the_admission_of_containers_wishing_to_share_the_host_network_namespace_automated"></a>5.2.5 Minimize the admission of containers wishing to share the host network namespace (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of <code>hostNetwork</code> containers.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostNetwork == null) or (.spec.hostNetwork == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'count' is greater than 0</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">--count=1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_6_minimize_the_admission_of_containers_with_allowprivilegeescalation_automated"><a class="anchor" href="#_5_2_6_minimize_the_admission_of_containers_with_allowprivilegeescalation_automated"></a>5.2.6 Minimize the admission of containers with allowPrivilegeEscalation (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of containers with <code>.spec.allowPrivilegeEscalation</code> set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p><strong>Audit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.allowPrivilegeEscalation == null) or (.spec.allowPrivilegeEscalation == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'count' is greater than 0</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">--count=1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_7_minimize_the_admission_of_root_containers_automated"><a class="anchor" href="#_5_2_7_minimize_the_admission_of_root_containers_automated"></a>5.2.7 Minimize the admission of root containers (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Create a policy for each namespace in the cluster, ensuring that either <code>MustRunAsNonRoot</code>
or <code>MustRunAs</code> with the range of UIDs not including 0, is set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_8_minimize_the_admission_of_containers_with_the_net_raw_capability_automated"><a class="anchor" href="#_5_2_8_minimize_the_admission_of_containers_with_the_net_raw_capability_automated"></a>5.2.8 Minimize the admission of containers with the NET_RAW capability (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of containers with the <code>NET_RAW</code> capability.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_9_minimize_the_admission_of_containers_with_added_capabilities_automated"><a class="anchor" href="#_5_2_9_minimize_the_admission_of_containers_with_added_capabilities_automated"></a>5.2.9 Minimize the admission of containers with added capabilities (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Ensure that <code>allowedCapabilities</code> is not present in policies for the cluster unless
it is set to an empty array.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_10_minimize_the_admission_of_containers_with_capabilities_assigned_manual"><a class="anchor" href="#_5_2_10_minimize_the_admission_of_containers_with_capabilities_assigned_manual"></a>5.2.10 Minimize the admission of containers with capabilities assigned (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Review the use of capabilites in applications running on your cluster. Where a namespace
contains applicaions which do not require any Linux capabities to operate consider adding
a PSP which forbids the admission of containers which do not drop all capabilities.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_11_minimize_the_admission_of_windows_hostprocess_containers_manual"><a class="anchor" href="#_5_2_11_minimize_the_admission_of_windows_hostprocess_containers_manual"></a>5.2.11 Minimize the admission of Windows HostProcess containers (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of containers that have <code>.securityContext.windowsOptions.hostProcess</code> set to <code>true</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_12_minimize_the_admission_of_hostpath_volumes_manual"><a class="anchor" href="#_5_2_12_minimize_the_admission_of_hostpath_volumes_manual"></a>5.2.12 Minimize the admission of HostPath volumes (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of containers with <code>hostPath</code> volumes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_13_minimize_the_admission_of_containers_which_use_hostports_manual"><a class="anchor" href="#_5_2_13_minimize_the_admission_of_containers_which_use_hostports_manual"></a>5.2.13 Minimize the admission of containers which use HostPorts (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Add policies to each namespace in the cluster which has user workloads to restrict the
admission of containers which use <code>hostPort</code> sections.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_3_network_policies_and_cni"><a class="anchor" href="#_5_3_network_policies_and_cni"></a>5.3 Network Policies and CNI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_3_1_ensure_that_the_cni_in_use_supports_networkpolicies_manual"><a class="anchor" href="#_5_3_1_ensure_that_the_cni_in_use_supports_networkpolicies_manual"></a>5.3.1 Ensure that the CNI in use supports NetworkPolicies (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If the CNI plugin in use does not support network policies, consideration should be given to
making use of a different plugin, or finding an alternate mechanism for restricting traffic
in the Kubernetes cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_3_2_ensure_that_all_namespaces_have_network_policies_defined_automated"><a class="anchor" href="#_5_3_2_ensure_that_all_namespaces_have_network_policies_defined_automated"></a>5.3.2 Ensure that all Namespaces have Network Policies defined (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the documentation and create NetworkPolicy objects as you need them.</p>
</div>
<div class="paragraph">
<p><strong>Audit Script:</strong> <code>check_for_network_policies.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -eE

handle_error() {
    echo "false"
}

trap 'handle_error' ERR

for namespace in $(kubectl get namespaces --all-namespaces -o json | jq -r '.items[].metadata.name'); do
  policy_count=$(kubectl get networkpolicy -n ${namespace} -o json | jq '.items | length')
  if [[ ${policy_count} -eq 0 ]]; then
    echo "false"
    exit
  fi
done

echo "true"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Execution:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./check_for_network_policies.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'true' is present</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_4_secrets_management"><a class="anchor" href="#_5_4_secrets_management"></a>5.4 Secrets Management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_4_1_prefer_using_secrets_as_files_over_secrets_as_environment_variables_manual"><a class="anchor" href="#_5_4_1_prefer_using_secrets_as_files_over_secrets_as_environment_variables_manual"></a>5.4.1 Prefer using Secrets as files over Secrets as environment variables (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
If possible, rewrite application code to read Secrets from mounted secret files, rather than
from environment variables.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_4_2_consider_external_secret_storage_manual"><a class="anchor" href="#_5_4_2_consider_external_secret_storage_manual"></a>5.4.2 Consider external secret storage (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Refer to the Secrets management options offered by your cloud provider or a third-party
secrets management solution.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_5_extensible_admission_control"><a class="anchor" href="#_5_5_extensible_admission_control"></a>5.5 Extensible Admission Control</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_5_1_configure_image_provenance_using_imagepolicywebhook_admission_controller_manual"><a class="anchor" href="#_5_5_1_configure_image_provenance_using_imagepolicywebhook_admission_controller_manual"></a>5.5.1 Configure Image Provenance using ImagePolicyWebhook admission controller (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and setup image provenance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_7_general_policies"><a class="anchor" href="#_5_7_general_policies"></a>5.7 General Policies</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_7_1_create_administrative_boundaries_between_resources_using_namespaces_manual"><a class="anchor" href="#_5_7_1_create_administrative_boundaries_between_resources_using_namespaces_manual"></a>5.7.1 Create administrative boundaries between resources using namespaces (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the documentation and create namespaces for objects in your deployment as you need
them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_7_2_ensure_that_the_seccomp_profile_is_set_to_dockerdefault_in_your_pod_definitions_manual"><a class="anchor" href="#_5_7_2_ensure_that_the_seccomp_profile_is_set_to_dockerdefault_in_your_pod_definitions_manual"></a>5.7.2 Ensure that the seccomp profile is set to docker/default in your Pod definitions (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Use <code>securityContext</code> to enable the docker/default seccomp profile in your pod definitions.
An example is as below:
securityContext:
seccompProfile:
type: RuntimeDefault</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_7_3_apply_securitycontext_to_your_pods_and_containers_manual"><a class="anchor" href="#_5_7_3_apply_securitycontext_to_your_pods_and_containers_manual"></a>5.7.3 Apply SecurityContext to your Pods and Containers (Manual)</h3>
<div class="paragraph">
<p><strong>Result:</strong> warn</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Follow the Kubernetes documentation and apply SecurityContexts to your Pods. For a
suggested list of SecurityContexts, you may refer to the CIS Security Benchmark for Docker
Containers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_7_4_the_default_namespace_should_not_be_used_automated"><a class="anchor" href="#_5_7_4_the_default_namespace_should_not_be_used_automated"></a>5.7.4 The default namespace should not be used (Automated)</h3>
<div class="paragraph">
<p><strong>Result:</strong> pass</p>
</div>
<div class="paragraph">
<p><strong>Remediation:</strong>
Ensure that namespaces are created to allow for appropriate segregation of Kubernetes
resources and that all new resources are created in a specific namespace.</p>
</div>
<div class="paragraph">
<p><strong>Audit Script:</strong> <code>check_for_default_ns.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -eE

handle_error() {
    echo "false"
}

trap 'handle_error' ERR

count=$(kubectl get all -n default -o json | jq .items[] | jq -r 'select((.metadata.name!="kubernetes"))' | jq .metadata.name | wc -l)
if [[ ${count} -gt 0 ]]; then
    echo "false"
    exit
fi

echo "true"</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Audit Execution:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./check_for_default_ns.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected Result</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">'true' is equal to 'true'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Returned Value</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Error from server (Forbidden): replicationcontrollers is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "replicationcontrollers" in API group "" in the namespace "default" Error from server (Forbidden): services is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "services" in API group "" in the namespace "default" Error from server (Forbidden): daemonsets.apps is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "daemonsets" in API group "apps" in the namespace "default" Error from server (Forbidden): deployments.apps is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "deployments" in API group "apps" in the namespace "default" Error from server (Forbidden): replicasets.apps is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "replicasets" in API group "apps" in the namespace "default" Error from server (Forbidden): statefulsets.apps is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "statefulsets" in API group "apps" in the namespace "default" Error from server (Forbidden): horizontalpodautoscalers.autoscaling is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "horizontalpodautoscalers" in API group "autoscaling" in the namespace "default" Error from server (Forbidden): cronjobs.batch is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "cronjobs" in API group "batch" in the namespace "default" Error from server (Forbidden): jobs.batch is forbidden: User "system:serviceaccount:cis-operator-system:cis-serviceaccount" cannot list resource "jobs" in API group "batch" in the namespace "default" true</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="rke1.html">RKE 加固指南</a></span>
  <span class="next"><a href="self-assessment-guide-with-cis-v1.24-k8s-v1.24.html">RKE 自我评估指南 - CIS Benchmark v1.24 - K8s v1.24</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../../.." data-snippet-length="100" data-stylesheet="../../../../../../_/css/search.css"></script>
<script async src="../../../../../../search-index.js"></script>
<script src="../../../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
