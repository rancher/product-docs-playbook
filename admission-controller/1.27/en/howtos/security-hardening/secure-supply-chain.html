<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Secure supply chain :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/admission-controller/1.29/en/howtos/security-hardening/secure-supply-chain.html">
    <link rel="prev" href="security-hardening.html">
    <link rel="next" href="webhook-mtls.html">
    <meta name="description" content="A secure supply chain infrastructure using Kubewarden.">
    <meta name="keywords" content="["kubewarden", "kubernetes", "secure supply chain", "infrastructure"]">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-07-09"/>
<link rel="stylesheet" href="../../../../../_/css/search.css">
<link rel="icon" href="../../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/admission-controller/1.29/en/howtos/security-hardening/secure-supply-chain.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/admission-controller/1.27/en/howtos/security-hardening/secure-supply-chain.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/admission-controller/1.27/en/howtos/security-hardening/secure-supply-chain.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="admission-controller" data-version="1.27">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">Admission Controller</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../quick-start.html">Quick start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../tutorials/writing-policies/index.html">Writing Kubewarden policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../tutorials/writing-policies/CEL/01-intro-cel.html">Introduction to CEL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/CEL/02-reusing-vap.html">Reusing ValidatingAdmissionPolicies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/CEL/03-context-aware.html">Context-aware CEL policies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/CEL/04-example-sigstore.html">Sigstore host capabilities</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../tutorials/writing-policies/rust/01-intro-rust.html">Rust</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rust/02-create-policy.html">Creating a policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rust/03-define-policy-settings.html">Defining policy settings</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rust/04-write-validation-logic.html">Writing validation logic</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rust/05-mutation-policy.html">Creating a new mutation policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rust/06-logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rust/07-build-and-distribute.html">Building and distributing policies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rust/08-raw-policies.html">Raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../tutorials/writing-policies/go/01-intro-go.html">Writing policies in Go</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/02-scaffold.html">Creating a new validation policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/03-policy-settings.html">Defining policy settings</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/04-validation.html">Writing the validation logic</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/05-e2e-tests.html">End-to-end testing</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/06-logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/07-automate.html">Integrating with GitHub Actions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/08-distribute.html">Distributing policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/09-validation-with-queries.html">Validation using JSON queries</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/go/10-raw-policies.html">Writing raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../tutorials/writing-policies/rego/01-intro-rego.html">Rego</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/02-builtin-support.html">Builtin support</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Open Policy Agent</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/open-policy-agent/01-intro.html">Introduction to Open Policy Agent</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/open-policy-agent/02-create-policy.html">Creating a new policy</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/open-policy-agent/03-build-and-run.html">Build and run a OPA policy for Kubewarden</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/open-policy-agent/04-distribute.html">Distributing an OPA policy with Kubewarden</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/open-policy-agent/05-raw-policies.html">Writing raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Gatekeeper</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/gatekeeper/01-intro.html">Gatekeeper support</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/gatekeeper/02-create-policy.html">Creating a new Gatekeeper Rego policy</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/gatekeeper/03-build-and-run.html">Build and run a Gatekeeper policy</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tutorials/writing-policies/rego/gatekeeper/04-distribute.html">Distributing a Gatekeeper policy with Kubewarden</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/writing-policies/dotnet.html">C#</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/writing-policies/swift.html">Swift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/writing-policies/typescript.html">Typescript</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/writing-policies/other-languages.html">Other languages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">WASI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/wasi/01-intro-wasi.html">WASI</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../tutorials/writing-policies/wasi/02-raw-policies.html">Writing raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/writing-policies/metadata.html">Policy metadata</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Testing policies</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/testing-policies/index.html">Policy testing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/testing-policies/02-policy-authors.html">Testing for policy authors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../tutorials/testing-policies/03-cluster-operators.html">Testing for cluster operators</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tutorials/verifying-kubewarden.html">Verifying Kubewarden</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tutorials/publish-policy-to-artifact-hub.html">Publish policies to Artifact Hub</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Explanations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../explanations/mutating-policies.html">Mutating policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../explanations/context-aware-policies.html">Context aware policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../explanations/policy-groups.html">Policy Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../explanations/certificates.html">Certificate rotation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../explanations/distributing-policies.html">Distributing policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Comparisons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../explanations/comparisons/opa-comparison.html">Kubewarden vs OPA Gatekeeper</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../../explanations/audit-scanner/audit-scanner.html">What is the Audit Scanner?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../explanations/audit-scanner/limitations.html">Audit Scanner - Limitations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../explanations/audit-scanner/policy-reports.html">Audit Scanner - Policy Reports</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../explanations/architecture.html">Admission Controller architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Howtos</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tasks.html">Common tasks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-kwctl.html">Install <code>kwctl</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../production-deployments.html">Production deployments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy-at-scale.html">Deployment at scale</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../audit-scanner.html">Audit Scanner</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../policies.html">Configuring policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../emergency-disable.html">Emergency disable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Configuring Policy Servers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../policy-servers/01-custom-cas.html">Using custom CAs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../policy-servers/02-private-registry.html">Configuring PolicyServers to use private registries</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../policy-servers/03-production-deployments.html">Production deployments</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../policy-groups.html">Policy groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../psp-migration.html">PSP migration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../vap-migration.html">ValidatingAdmissionPolicy migration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pod-security-admission-with-kubewarden.html">Pod Security Admission</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../custom-certificate-authorities.html">Custom certificate authorities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../raw-policies.html">Raw policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../argocd-installation.html">ArgoCD Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="security-hardening.html">Security</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="secure-supply-chain.html">Secure supply chain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webhook-mtls.html">Enable mTLS with K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Air gap</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../airgap/01-requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../airgap/02-install.html">Installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Telemetry quick starts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../telemetry/10-opentelemetry-qs.html">Open Telemetry quick start</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../telemetry/20-tracing-qs.html">Tracing quickstart</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../telemetry/30-metrics-qs.html">Metrics quickstart</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../telemetry/40-custom-otel-collector.html">Custom OpenTelemetry Collector</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Rancher-Fleet.html">Rancher Fleet</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Rancher UI extension</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ui-extension/01-install.html">Quickstart</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ui-extension/02-metrics.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ui-extension/03-tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../contribution-guide/contribution-guide.html">Contribution guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contribution-guide/contributing.html">Contributing to Kubewarden documentation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../contribution-guide/suggesting-an-improvement.html">Suggesting a doc improvement</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gatekeeper-migration.html">Migrating Gatekeeper policies to Kubewarden</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/CRDs.html">Custom Resource Definitions (CRD)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/dependency-matrix.html">Dependency matrix</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/artifacts.html">Artifacts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/upgrade-path.html">Upgrade path</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/metrics-reference.html">Metrics reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/monitor-mode.html">Monitor mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Policy specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reference/spec/01-intro-spec.html">Policy communication specification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reference/spec/02-settings.html">Policy settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reference/spec/03-validating-policies.html">Validating policies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reference/spec/04-mutating-policies.html">Mutating policies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reference/spec/05-context-aware-policies.html">Context aware policies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Host capabilities</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../reference/spec/host-capabilities/01-intro-host-capabilities.html">Host capabilities specification</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../reference/spec/host-capabilities/02-signature-verifier-policies.html">Signature verifier policies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../reference/spec/host-capabilities/03-container-registry.html">Container registry capabilities</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../reference/spec/host-capabilities/04-net.html">Network capabilities</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../reference/spec/host-capabilities/05-crypto.html">Cryptographic capabilities</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../reference/spec/host-capabilities/06-kubernetes.html">Kubernetes capabilities</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/oci-registries-support.html">OCI registry support for Kubewarden</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../reference/security-hardening/webhooks-hardening.html">Webhooks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/threat-model.html">Threat Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/policy-evaluation-timeout.html">Policy evaluation timeout protection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/verification-config.html">Verification configuration format</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/sources_yaml.html">Reference for sources.yaml</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/kwctl-cli.html"><code>kwctl</code> CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/policy-server-cli.html">Policy Server CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../personas.html">For who?</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../use-cases.html">Use cases</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../organization.html">Organization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../enterprise.html">Enterprise</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../disclosure.html">Security disclosure</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Admission Controller</span>
    <span class="version">1.27</span>
  </div>
  <ul class="components">
        <li class="component is-current">
          <div class="title"><a href="../../../../1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version is-current">
              <a href="../../introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/admission-controller" title="Admission Controller" aria-label="SUSE Documentation - Admission Controller">
        Admission Controller
      </a>
    </li>
      <li>
          Howtos
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.27</button>
  <div class="version-menu">
    <a class="version" href="../../../../1.30/en/howtos/security-hardening/secure-supply-chain.html">1.30-next</a>
    <a class="version" href="../../../../1.29/en/howtos/security-hardening/secure-supply-chain.html">1.29</a>
    <a class="version" href="../../../../1.28/en/howtos/security-hardening/secure-supply-chain.html">1.28</a>
    <a class="version is-current" href="secure-supply-chain.html">1.27</a>
    <a class="version" href="../../../../1.26/en/howtos/security-hardening/secure-supply-chain.html">1.26</a>
    <a class="version" href="../../../../1.25/en/howtos/security-hardening/secure-supply-chain.html">1.25</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/kubewarden-product-docs/edit/main/docs/version-1.27/modules/en/pages/howtos/security-hardening/secure-supply-chain.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:admission-controller" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Secure supply chain</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A secure supply chain infrastructure can verify the validity of its parts, or links.
It lets users and developers show the chain of custody of its software components, or artifacts.
It&#8217;s an active approach to mitigate security issues.</p>
</div>
<div class="paragraph">
<p>The <a href="https://sigstore.dev/">Sigstore</a> project provides tools and infrastructure for this.
It&#8217;s for validating the integrity of the artifact supply chain.</p>
</div>
<div class="paragraph">
<p>Kubewarden uses <a href="https://github.com/sigstore/cosign"><code>cosign</code></a> together with the <a href="https://github.com/SigStore/fulcio">fulcio</a> and <a href="https://github.com/sigstore/rekor">rekor</a> infrastructure offered by the Sigstore project.</p>
</div>
<div class="paragraph">
<p>Cluster operators can configure Kubewarden to only run policies signed by trusted entities.
Policy developers can sign their policies and publish them in a registry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the following sections, you need a few tools to be installed.
These are so users can sign and verify OCI artifacts signatures.
The examples show the use of <a href="https://docs.sigstore.dev/quickstart/quickstart-cosign/"><code>cosign</code></a> and <a href="https://github.com/kubewarden/kwctl"><code>kwctl</code></a> utilities for signing and inspecting policies.</p>
</div>
<div class="paragraph">
<p>Users may also want to use GitHub to sign their policies. In which case, they need to install <a href="https://docs.sigstore.dev/cosign/system_config/installation/#github-actions">GitHub actions</a>.</p>
</div>
<div class="paragraph">
<p>Keyless signing uses the default <a href="https://github.com/SigStore/fulcio">fulcio</a>
and <a href="https://github.com/sigstore/rekor">rekor</a> instances provided by the
Sigstore project.
Check the Sigstore documentation for details on how to use your own infrastructure for this, if needed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_signing_policies"><a class="anchor" href="#_signing_policies"></a>Signing policies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubewarden recommends using Sigstore&#8217;s <a href="https://github.com/sigstore/cosign">cosign</a> utility to signing policies.
This section shows a key-based method of signing policies.
Users need to generate a private-public key-pair for this.
The generated keys help to verify if the signed artifacts came from the expected user.
To generate this key-pair use this <code>cosign generate-key-pair</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cosign generate-key-pair</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in a prompt to type and verify a password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Enter password for private key: ●●●●●●●●
Enter password for private key again: ●●●●●●●●
Private key written to cosign.key
Public key written to cosign.pub</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can use this key to sign policies.</p>
</div>
<div class="paragraph">
<p>The private key file, <code>cosign.key</code>, shouldn&#8217;t be shared.
This is a secret file only for use by the key owner for signing policies.</p>
</div>
<div class="paragraph">
<p>To sign a policy you can use <code>cosign sign</code> passing the <code>--key</code> command line argument with your private key file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cosign sign --key cosign.key ghcr.io/kubewarden/policies/user-group-psp:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in a prompt for the password, for the specified private key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">an error occurred: no provider found for that key reference, will try to load key from disk...
Enter password for private key: ●●●●●●●●
Pushing signature to: ghcr.io/kubewarden/policies/user-group-psp</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command signs the policy by creating a new signature object.
The signature object is then uploaded into the registry, with the policy.
Now the policy is ready to use in a Kubewarden installation using signature verification.</p>
</div>
<div class="paragraph">
<p>The same policy can be signed multiple times, by the same user or different ones.
These signatures are added to the signature object along with the original signature.</p>
</div>
<div class="paragraph">
<p>For more information about how the signing process works, check out the <a href="https://docs.sigstore.dev/">Sigstore project documentation</a>.</p>
</div>
<div class="sect2">
<h3 id="_keyless_signing"><a class="anchor" href="#_keyless_signing"></a>Keyless signing</h3>
<div class="paragraph">
<p>Often policies are automatically built in CI/CD pipelines.
This complicates the key generation process.
This Sigstore keyless workflow is for these situations.
Instead of using long-lived singing keys, the keyless workflow uses certificate authorities (CAs) and certificate chains.</p>
</div>
<div class="paragraph">
<p>A short-lived certificate key is generated, and linked into a chain of trust.
It&#8217;s done by an identity challenge to confirm the signer&#8217;s identity.
The life of the certificate key is long enough for the signing to occur.
The identity challenge is done by authenticating against an OpenID Connect (OIDC) provider.
Sigstore&#8217;s Fulcio public infrastructure is used for the chain of trust.</p>
</div>
<div class="paragraph">
<p>Signing uses Sigstore&#8217;s cosign utility.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cosign sign ghcr.io/kubewarden/policies/user-group-psp:latest</code></pre>
</div>
</div>
<details>
<summary class="title">cosign output</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Generating ephemeral keys...
Retrieving signed certificate...
Your browser will now be opened to:
https://oauth2.sigstore.dev/auth/auth?access_type=online&amp;client_id=sigstore&amp;code_challenge=&lt;REDACTED&gt;&amp;code_challenge_method=S256&amp;nonce=&lt;REDACTED&gt;&amp;redirect_uri=http%3A%2F%2Flocalhost%3A34021%2Fauth%2Fcallback&amp;response_type=code&amp;scope=openid+email&amp;state=&lt;REDACTED&gt;
client.go:196: root pinning is not supported in Spec 1.0.19
Successfully verified SCT...
tlog entry created with index: 1819248
Pushing signature to: ghcr.io/kubewarden/policies/user-group-psp</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>This signs the policy and pushes it to the repository.
There are no keys generated as a byproduct.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_sign_artifacts_in_github_workflows"><a class="anchor" href="#_how_to_sign_artifacts_in_github_workflows"></a>How to sign artifacts in GitHub workflows</h3>
<div class="paragraph">
<p>When using keyless signing, in a GitHub action,
<code>cosign</code> doesn&#8217;t need the user to log in to an OIDC provider.
A GitHub token is available during the execution of the GitHub workflow.
It&#8217;s used to authenticate the user and generate the ephemeral keys.
The signing process is the same used in the keyless mode.
This is an example of how the Kubewarden project signs its policies:</p>
</div>
<details>
<summary class="title">YAML describing Kubewarden policy signing</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ... beginning of the workflow file ...
jobs:
  build:
    name: Build container image
    runs-on: ubuntu-latest
    steps:
      # ... other steps building the container image ...
      -
      name: Login to GitHub Container Registry
      uses: docker/login-action@v1
      with:
        registry: ghcr.io
        username: ${{ github.repository_owner }}
        password: ${{ inputs.GITHUB_TOKEN }}
      -
      name: Publish Wasm policy artifact to OCI registry with the 'latest' tag
      shell: bash
      if: ${{ startsWith(github.ref, 'refs/heads/') }}
      env:
        COSIGN_EXPERIMENTAL: 1
      run: |
        set -ex
        echo Pushing policy to OCI container registry
        IMMUTABLE_REF=$(kwctl push -o json ${{ PATH_TO_BUILT_WASM_FILE }} ghcr.io/myorg/policies/my-great-policy:latest | jq -r .immutable_ref)
        echo Keyless signing of policy using cosign
        cosign sign ${IMMUTABLE_REF}
      # ... other build steps ...

# ... remainder of the workflow file ...</code></pre>
</div>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Policy developers can use the Kubewarden policy templates. They have GitHub actions to build, test, sign and publish policies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_listing_policy_signatures"><a class="anchor" href="#_listing_policy_signatures"></a>Listing policy signatures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can check signature in a published policy with <code>kwctl inspect</code>.
This shows the information about the policy and its signatures as shown below:</p>
</div>
<details>
<summary class="title">kwctl inspect registry://ghcr.io/kubewarden/policies/us&#8230;&#8203;.</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kwctl inspect registry://ghcr.io/kubewarden/policies/user-group-psp:v0.2.0
Details
title:              psp-user-group
description:        Short description
author:             José Guilherme Vanz &lt;jguilhermevanz@suse.com&gt;
url:                https://github.com/kubewarden/user-group-psp-policy
source:             https://github.com/kubewarden/user-group-psp-policy
license:            Apache-2.0
mutating:           true
context aware:      false
execution mode:     kubewarden-wapc
protocol version:   1

Annotations
io.kubewarden.kwctl 0.2.5-rc2

Rules
────────────────────
---
- apiGroups:
    - ""
  apiVersions:
    - v1
  resources:
    - pods
  operations:
    - CREATE
────────────────────

Usage
This policy enforce the user and group used in the container.

Sigstore signatures

Digest:                            sha256:026af67682a85d424e7d95db460171635f5c3957d67b53499bece912cc0413cc
Media type:                        application/vnd.dev.cosign.simplesigning.v1+json
Size:                              258
Annotations
dev.sigstore.cosign/certificate    -----BEGIN CERTIFICATE-----
                                   MIIDRzCCAsygAwIBAgITbPUZlUFkkAHtbzc3rzC/3zXj1DAKBggqhkjOPQQDAzAq
                                   MRUwEwYDVQQKEwxzaWdzdG9yZS5kZXYxETAPBgNVBAMTCHNpZ3N0b3JlMB4XDTIy
                                   MDIyNTE2MzAwMloXDTIyMDIyNTE2NDAwMVowEzERMA8GA1UEChMIc2lnc3RvcmUw
                                   WTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAR/O5c6ZI5BzBweoEIam4uWu5fqzHx0
                                   3PTCgfXyyvIjorz9wX08bsndkHdWfFObU+PztbxX78An43Yw9/fHtO93o4IB5jCC
                                   AeIwDgYDVR0PAQH/BAQDAgeAMBMGA1UdJQQMMAoGCCsGAQUFBwMDMAwGA1UdEwEB
                                   /wQCMAAwHQYDVR0OBBYEFCP/v7NEJQglbDmyC5VMgnvhiuBUMB8GA1UdIwQYMBaA
                                   FFjAHl+RRaVmqXrMkKGTItAqxcX6MHgGA1UdEQRxMG+GbWh0dHBzOi8vZ2l0aHVi
                                   LmNvbS9rdWJld2FyZGVuL2dpdGh1Yi1hY3Rpb25zLy5naXRodWIvd29ya2Zsb3dz
                                   L3JldXNhYmxlLXJlbGVhc2UtcG9saWN5LXJ1c3QueW1sQHJlZnMvaGVhZHMvdjEw
                                   NgYKKwYBBAGDvzABAwQoMmJiMGQ4NjZjMzFmOGMyZTQ3NDMxMDI4M2ExNmFkMWFi
                                   NjBlZjA1YjAuBgorBgEEAYO/MAEFBCBrdWJld2FyZGVuL3VzZXItZ3JvdXAtcHNw
                                   LXBvbGljeTAcBgorBgEEAYO/MAEEBA5SZWxlYXNlIHBvbGljeTASBgorBgEEAYO/
                                   MAECBARwdXNoMDkGCisGAQQBg78wAQEEK2h0dHBzOi8vdG9rZW4uYWN0aW9ucy5n
                                   aXRodWJ1c2VyY29udGVudC5jb20wHgYKKwYBBAGDvzABBgQQcmVmcy90YWdzL3Yw
                                   LjIuMDAKBggqhkjOPQQDAwNpADBmAjEAyGQbNCkOifStO7yCCfF8yXyc144ANn2x
                                   Ty92WYC0pTaVhviOED47fgD6TncKf+92AjEAjBfjLmCG/Mwrh8t+gfHJEAWWEc9Q
                                   +j9NR4wF66uABS/TTh5CYlrnIuqSD+GBHGwV
                                   -----END CERTIFICATE-----
dev.sigstore.cosign/timestamp      {"signatures":[{"keyid":"b6710623a30c010738e64c5209d367df1c0a18cf90e6ab5292fb01680f83453d","sig":"3046022100f666a7f4b3d85d8003f2c166e27827dfa0c4ab9282e9dab19485f4e702c61700022100dfe826e0edab5f80a40f08cc87b87777a4db30775d85684fe4950e797f2f565c"}],"signed":{"_type":"timestamp","spec_version":"1.0","version":15,"expires":"2022-03-08T19:14:05Z","meta":{"snapshot.json":{"length":1655,"hashes":{"sha256":"36cf063d0717f6dc03e23027721adcd69b684d293956d3a1a7db7b0848f711d7","sha512":"f90946d0a2dc58dae4505cfb91517a40299adf9e8719f52af187e2025aad69fcdeaeded271ec25db24869841c16fbe24f3fc56f56af8fdbb8808dccec4636b64"},"version":15}}}}
dev.sigstore.cosign/bundle         {"SignedEntryTimestamp":"MEUCIEfu4qR+HsexSDk5h2QXMduvoRCX10J+4CLQWtYw5VD6AiEAyYCEjvJdv2Sr5tZ4LApnddH/4v+CoV1QkuvbCQ3iIUM=","Payload":{"body":"eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiIwMjZhZjY3NjgyYTg1ZDQyNGU3ZDk1ZGI0NjAxNzE2MzVmNWMzOTU3ZDY3YjUzNDk5YmVjZTkxMmNjMDQxM2NjIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FWUNJUUNXNWZRZ1BUUTdaTlNuRkhzbHJOTlFrS2dTSVFpOGNSMTU5UEExc0s4VGlRSWhBSndMOWJPcUJKbVduN1lLZG9Tem80c2xPZ2s4SkJCanFYZHNydDNyeVF0QiIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVUlNla05EUVhONVowRjNTVUpCWjBsVVlsQlZXbXhWUm10clFVaDBZbnBqTTNKNlF5OHplbGhxTVVSQlMwSm5aM0ZvYTJwUFVGRlJSRUY2UVhFS1RWSlZkMFYzV1VSV1VWRkxSWGQ0ZW1GWFpIcGtSemw1V2xNMWExcFlXWGhGVkVGUVFtZE9Wa0pCVFZSRFNFNXdXak5PTUdJelNteE5RalJZUkZSSmVRcE5SRWw1VGxSRk1rMTZRWGROYkc5WVJGUkplVTFFU1hsT1ZFVXlUa1JCZDAxV2IzZEZla1ZTVFVFNFIwRXhWVVZEYUUxSll6SnNibU16VW5aamJWVjNDbGRVUVZSQ1oyTnhhR3RxVDFCUlNVSkNaMmR4YUd0cVQxQlJUVUpDZDA1RFFVRlNMMDgxWXpaYVNUVkNla0ozWlc5RlNXRnROSFZYZFRWbWNYcEllREFLTTFCVVEyZG1XSGw1ZGtscWIzSjZPWGRZTURoaWMyNWthMGhrVjJaR1QySlZLMUI2ZEdKNFdEYzRRVzQwTTFsM09TOW1TSFJQT1ROdk5FbENOV3BEUXdwQlpVbDNSR2RaUkZaU01GQkJVVWd2UWtGUlJFRm5aVUZOUWsxSFFURlZaRXBSVVUxTlFXOUhRME56UjBGUlZVWkNkMDFFVFVGM1IwRXhWV1JGZDBWQ0NpOTNVVU5OUVVGM1NGRlpSRlpTTUU5Q1FsbEZSa05RTDNZM1RrVktVV2RzWWtSdGVVTTFWazFuYm5ab2FYVkNWVTFDT0VkQk1WVmtTWGRSV1UxQ1lVRUtSa1pxUVVoc0sxSlNZVlp0Y1ZoeVRXdExSMVJKZEVGeGVHTllOazFJWjBkQk1WVmtSVkZTZUUxSEswZGlWMmd3WkVoQ2VrOXBPSFphTW13d1lVaFdhUXBNYlU1MllsTTVjbVJYU214a01rWjVXa2RXZFV3eVpIQmtSMmd4V1dreGFGa3pVbkJpTWpWNlRIazFibUZZVW05a1YwbDJaREk1ZVdFeVduTmlNMlI2Q2t3elNteGtXRTVvV1cxNGJFeFlTbXhpUjFab1l6SlZkR05IT1hOaFYwNDFURmhLTVdNelVYVmxWekZ6VVVoS2JGcHVUWFpoUjFab1draE5kbVJxUlhjS1RtZFpTMHQzV1VKQ1FVZEVkbnBCUWtGM1VXOU5iVXBwVFVkUk5FNXFXbXBOZWtadFQwZE5lVnBVVVROT1JFMTRUVVJKTkUweVJYaE9iVVpyVFZkR2FRcE9ha0pzV21wQk1WbHFRWFZDWjI5eVFtZEZSVUZaVHk5TlFVVkdRa05DY21SWFNteGtNa1o1V2tkV2RVd3pWbnBhV0VsMFdqTktkbVJZUVhSalNFNTNDa3hZUW5aaVIyeHFaVlJCWTBKbmIzSkNaMFZGUVZsUEwwMUJSVVZDUVRWVFdsZDRiRmxZVG14SlNFSjJZa2RzYW1WVVFWTkNaMjl5UW1kRlJVRlpUeThLVFVGRlEwSkJVbmRrV0U1dlRVUnJSME5wYzBkQlVWRkNaemM0ZDBGUlJVVkxNbWd3WkVoQ2VrOXBPSFprUnpseVdsYzBkVmxYVGpCaFZ6bDFZM2sxYmdwaFdGSnZaRmRLTVdNeVZubFpNamwxWkVkV2RXUkROV3BpTWpCM1NHZFpTMHQzV1VKQ1FVZEVkbnBCUWtKblVWRmpiVlp0WTNrNU1GbFhaSHBNTTFsM0NreHFTWFZOUkVGTFFtZG5jV2hyYWs5UVVWRkVRWGRPY0VGRVFtMUJha1ZCZVVkUllrNURhMDlwWmxOMFR6ZDVRME5tUmpoNVdIbGpNVFEwUVU1dU1uZ0tWSGs1TWxkWlF6QndWR0ZXYUhacFQwVkVORGRtWjBRMlZHNWpTMllyT1RKQmFrVkJha0ptYWt4dFEwY3ZUWGR5YURoMEsyZG1TRXBGUVZkWFJXTTVVUW9yYWpsT1VqUjNSalkyZFVGQ1V5OVVWR2cxUTFsc2NtNUpkWEZUUkN0SFFraEhkMVlLTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89In19fX0=","integratedTime":1645806604,"logIndex":1506651,"logID":"c0d23d6ad406973f9559f3ba2d1ca01f84147d8ffc5b8445c224f98b9591801d"}}
dev.sigstore.cosign/chain          -----BEGIN CERTIFICATE-----
                                   MIIB9zCCAXygAwIBAgIUALZNAPFdxHPwjeDloDwyYChAO/4wCgYIKoZIzj0EAwMw
                                   KjEVMBMGA1UEChMMc2lnc3RvcmUuZGV2MREwDwYDVQQDEwhzaWdzdG9yZTAeFw0y
                                   MTEwMDcxMzU2NTlaFw0zMTEwMDUxMzU2NThaMCoxFTATBgNVBAoTDHNpZ3N0b3Jl
                                   LmRldjERMA8GA1UEAxMIc2lnc3RvcmUwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAAT7
                                   XeFT4rb3PQGwS4IajtLk3/OlnpgangaBclYpsYBr5i+4ynB07ceb3LP0OIOZdxex
                                   X69c5iVuyJRQ+Hz05yi+UF3uBWAlHpiS5sh0+H2GHE7SXrk1EC5m1Tr19L9gg92j
                                   YzBhMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBRY
                                   wB5fkUWlZql6zJChkyLQKsXF+jAfBgNVHSMEGDAWgBRYwB5fkUWlZql6zJChkyLQ
                                   KsXF+jAKBggqhkjOPQQDAwNpADBmAjEAj1nHeXZp+13NWBNa+EDsDP8G1WWg1tCM
                                   WP/WHPqpaVo0jhsweNFZgSs0eE7wYI4qAjEA2WB9ot98sIkoF3vZYdd3/VtWB5b9
                                   TNMea7Ix/stJ5TfcLLeABLE4BNJOsQ4vnBHJ
                                   -----END CERTIFICATE-----
dev.cosignproject.cosign/signature MEYCIQCW5fQgPTQ7ZNSnFHslrNNQkKgSIQi8cR159PA1sK8TiQIhAJwL9bOqBJmWn7YKdoSzo4slOgk8JBBjqXdsrt3ryQtB</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_policies"><a class="anchor" href="#_verifying_policies"></a>Verifying policies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can check if a policy is correctly signed with  <code>cosign</code> or <code>kwctl</code>.
They have similar command line options for checking policy signatures.
To check if the binary is signed with a key, use <code>kwctl</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kwctl verify -k cosign.pub ghcr.io/kubewarden/policies/user-group-psp:latest
2022-03-29T14:49:31.878180Z  INFO kwctl::verify: Policy successfully verified</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or <code>cosign</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ cosign verify --key cosign.pub ghcr.io/kubewarden/policies/user-group-psp:latest

Verification for ghcr.io/kubewarden/policies/user-group-psp:latest --
The following checks were performed on each of these signatures:
  - The cosign claims were validated
  - The signatures were verified against the specified public key
  - Any certificates were verified against the Fulcio roots.

[{"critical":{"identity":{"docker-reference":"ghcr.io/kubewarden/policies/user-group-psp"},"image":{"docker-manifest-digest":"sha256:af520a8ccee03811d426c48634b7007f1220c121cc23e14962bb64510585ce97"},"type":"cosign container image signature"},"optional":null}]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_policy_server_to_check_policy_signatures"><a class="anchor" href="#_configuring_the_policy_server_to_check_policy_signatures"></a>Configuring the policy server to check policy signatures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure Kubewarden with a <code>ConfigMap</code> to only run trusted policies.
The <code>ConfigMap</code> structure described in <a href="../../reference/verification-config.html#_signature_configuration_reference" class="xref page">Signature Configuration Reference</a>.
It&#8217;s used to verify a policy using <code>kwctl</code>.
The <code>ConfigMap</code> should define allowable configurations under the <code>verification-config</code> field.</p>
</div>
<div class="paragraph">
<p>For example, you want to run policies signed by the Kubewarden GitHub organization. Then a sample <code>ConfigMap</code> for this scenario would be:</p>
</div>
<details>
<summary class="title">$ cat kubewarden_signatures.yaml</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ cat kubewarden_signatures.yaml
apiVersion: v1
allOf:
  - kind: githubAction
    owner: kubewarden

# note that the data is stored under verification-config field
$ kubectl  create configmap my-signatures-configuration --from-file=verification-config=kubewarden_signatures.yaml

$ kubectl get configmap -o yaml my-signatures-configuration
apiVersion: v1
data:
  verification-config: |
    apiVersion: v1
    allOf:
      - kind: githubAction
        owner: kubewarden
kind: ConfigMap
metadata:
  creationTimestamp: "2022-03-29T18:27:20Z"
  name: my-signatures-configuration
  namespace: default
  resourceVersion: "10279"
  uid: d53e1c56-1fee-45de-92f5-9bd73b8cead4</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>You can use <code>kwctl scaffold verification-config</code> to generate a default verification configuration file for the <code>ConfigMap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kwctl scaffold verification-config &gt; verification_config.yaml</code></pre>
</div>
</div>
<details>
<summary class="title">$ cat verification_config.yaml</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kwctl scaffold verification-config &gt; verification_config.yaml
$ cat verification_config.yaml
# Default Kubewarden verification config
#
# With this config, the only valid policies are those signed by Kubewarden
# infrastructure.
#
# This config can be saved to its default location (for this OS) with:
#   kwctl scaffold verification-config &gt; /home/kubewarden/.config/kubewarden/verification-config.yml
#
# Providing a config in the default location enables Sigstore verification.
# See https://docs.kubewarden.io for more Sigstore verification options.
---
apiVersion: v1
allOf:
  - kind: githubAction
    owner: kubewarden
    repo: ~
    annotations: ~
anyOf: ~</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>You can use this <code>verification_config.yml</code> to create the <code>ConfigMap</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl create configmap my-signatures-configuration --from-file==verification_config.yaml
configmap/my-signatures-configuration created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can inspect with <code>get configmap</code>.</p>
</div>
<details>
<summary class="title">kubectl get configmap</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get configmap -o yaml my-signatures-configuration
apiVersion: v1
data:
  verification-config: |+
    # Default Kubewarden verification config
    #
    # With this config, the only valid policies are those signed by Kubewarden
    # infrastructure.
    #
    # This config can be saved to its default location (for this OS) with:
    #   kwctl scaffold verification-config &gt; /home/kubewarden/.config/kubewarden/verification-config.yml
    #
    # Providing a config in the default location enables Sigstore verification.
    # See https://docs.kubewarden.io for more Sigstore verification options.
    ---
    apiVersion: v1
    allOf:
      - kind: githubAction
        owner: kubewarden
        repo: ~
        annotations: ~
    anyOf: ~

kind: ConfigMap
metadata:
  creationTimestamp: "2022-04-07T11:54:27Z"
  name: my-signatures-configuration
  namespace: default
  resourceVersion: "1317"
  uid: 74dec846-7fcd-4b4b-8184-700c816f685a</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>After creating the <code>ConfigMap</code> to store the signature requirements, you can configure a Policy Server.
To start validating policy signatures by setting the <code>ConfigMap</code> name in the field <code>verificationConfig</code> (marked ➀).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policies.kubewarden.io/v1alpha2
kind: PolicyServer
metadata:
  name: default
  finalizers:
    - kubewarden
spec:
  image: ghcr.io/kubewarden/policy-server:v0.2.7
  serviceAccountName: policy-server
  replicas: 1
//highlight-next-l
  # name of the confimap with the signatures requirements
  verificationConfig: your_configmap <i class="conum" data-value="1"></i><b>(1)</b>
  env:
    - name: KUBEWARDEN_ENABLE_METRICS
      value: "1"
    - name: KUBEWARDEN_LOG_FMT
      value: otlp
    - name: "KUBEWARDEN_LOG_LEVEL"
      value: "info"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>verificationConfig</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you deploy the default Policy Server using the <code>kubewarden-defaults</code>
Helm chart then you configure this field by setting the <code>ConfigMap</code> name in the
<code>policyServer.verificationConfig</code> value.</p>
</div>
<div class="paragraph">
<p>Now, the PolicyServer rejects untrusted AdmissionPolicies and ClusterAdmissionPolicies by refusing to start.
You need to remove the untrusted policy, or change the signatures requirement, for a running PolicyServer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_signature_configuration_reference"><a class="anchor" href="#_signature_configuration_reference"></a>Signature configuration reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can validate signature requirements contained in a file. Here is an example:</p>
</div>
<details>
<summary class="title">A file of signature requirements</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1

allOf: <i class="conum" data-value="1"></i><b>(1)</b>
  - kind: githubAction
    owner: kubewarden   # mandatory
    annotations:
      env: prod

anyOf: # at least `anyOf.minimumMatches` are required to match <i class="conum" data-value="2"></i><b>(2)</b>
  minimumMatches: 2 # default is 1
  signatures:
  - kind: pubKey
    owner: flavio # optional
    key: .... # mandatory
    annotations:  # optional
      env: prod
      foo: bar
  - kind: pubKey
    owner: victor # optional
    key: .... # mandatory
  - kind: genericIssuer
    issuer: https://github.com/login/oauth
    subject:
      equal: alice@example.com
  - kind: genericIssuer
    issuer: https://token.actions.githubusercontent.com
    subject:
      equal: https://github.com/flavio/policy-secure-pod-images/.github/workflows/release.yml@refs/heads/main
  - kind: genericIssuer
    issuer: https://token.actions.githubusercontent.com
    subject:
      urlPrefix: https://github.com/flavio/
  - kind: genericIssuer
    issuer: https://token.actions.githubusercontent.com
    subject:
      urlPrefix: https://github.com/kubewarden # &lt;- it will be post-fixed with `/` for security reasons
  - kind: githubAction
    owner: flavio   # mandatory
    repo: policy1 # optional
  - kind: pubKey
    owner: alice # optional
    key: .... # mandatory</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>allOf</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>anyOf</code></td>
</tr>
</table>
</div>
</div>
</details>
<h3 id="_signature_validation" class="discrete">Signature validation</h3>
<div class="paragraph">
<p>The configuration above contains the two highlighted sections, <code>allOf</code> and <code>anyOf</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>allOf</code>: the policy is trusted only if all signature requirements here are valid.</p>
</li>
<li>
<p><code>anyOf</code>: the policy is trusted if the <code>minimumMatches</code> criterion is met.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Above, the <code>minimumMatches</code> field is 2.
So, at least two of the signature requirements must be met.
The default value for <code>minimumMatches</code> field is <code>1</code>.</p>
</div>
<div class="paragraph">
<p>All the signatures requirements from <code>allOf</code> <strong>and</strong> the minimum number from <code>anyOf</code> must be met.</p>
</div>
<h3 id="_public_key_validation" class="discrete">Public key validation</h3>
<div class="paragraph">
<p>To check a policy is signed with the correct public key, you specify the key data and the owner of the key.
In this example, <code>kind</code> is set to <code>pubKey</code> and the <code>key</code> has the public key.
The owner field is optional, but can be useful to clarify who owns the key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  - kind: pubKey
    owner: bob # optional
    key: |
      -----BEGIN PUBLIC KEY-----
      MBFKHFDGHKIJH0CAQYIKoZIzj0DAQcDQgAEX0HFTtCfTtPmkx5p1RbDE6HJSGAVD
      BVDF6SKFSF87AASUspkQsN3FO4iyWodCy5j3o0CdIJD/KJHDJFHDFIu6sA==
      -----END PUBLIC KEY-----</code></pre>
</div>
</div>
<h3 id="_keyless_signature_validation" class="discrete">Keyless signature validation</h3>
<div class="paragraph">
<p>A policy signed in keyless mode doesn&#8217;t have a public key we can verify.
You can still verify the policy with the OIDC data used during the signing process.
For that, it&#8217;s necessary to define the signature validation as <code>genericIssuer</code>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to verify information from the signature:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>issuer</code>(mandatory): this matches the <code>Issuer</code> attribute in the certificate generated by Fulcio.
This shows the OIDC used to sign the policy.</p>
</li>
<li>
<p><code>subject</code>: field used to match the <code>Subject</code> attribute in Fulcio&#8217;s certificate.
The <code>Subject</code> (Fulcio) field contains the user used to authenticate against the OIDC provider.
The verification field, <code>subject</code>, can have one of two sub fields:</p>
<div class="ulist">
<ul>
<li>
<p><code>equal</code>: the <code>Subject</code> (Fulcio) from the certificate must be equal to the value in the signature validation;</p>
</li>
<li>
<p><code>urlPrefix</code>: the certificate&#8217;s <code>Subject</code> (Fulcio) field value must be prefixed by the value defined in the signature validation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Both the <code>cosign verify</code> and the <code>kwctl inspect</code> can show information about keyless signatures.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, this configuration means the policy must have a keyless signature from Alice using the GitHub OIDC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- kind: genericIssuer
  issuer: https://github.com/login/oauth
  subject:
    equal: alice@example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration needs the policy to be signed in GitHub actions,
from a repository owned by the GitHub user <code>flavio</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- kind: genericIssuer
  issuer: https://token.actions.githubusercontent.com
  subject:
    urlPrefix: https://github.com/flavio</code></pre>
</div>
</div>
<h3 id="_github_actions_signature_verification" class="discrete">GitHub actions signature verification</h3>
<div class="paragraph">
<p>The "kind", <code>githubAction</code> is to validate policies signed in GitHub Actions.
You can do this with the <code>genericIssuer</code> kind as well.
To simplify the signature requirement process, use two extra fields for <code>githubAction</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>owner</code> (mandatory): GitHub ID of the user or organization to trust</p>
</li>
<li>
<p><code>repo</code>: the name of the repository to trust</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the last snippet, using <code>genericIssuer</code>, could be rewritten as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- kind: githubAction
  owner: flavio</code></pre>
</div>
</div>
<h3 id="_signature_annotations_validation" class="discrete">Signature annotations validation</h3>
<div class="paragraph">
<p>All signature types can have other optional validation fields, <code>annotations</code>.
These fields are key/value data added by during the signing process.</p>
</div>
<div class="paragraph">
<p>With Kubewarden, you can ensure policies are signed by trusted users
<strong>and</strong> have specific annotations.</p>
</div>
<div class="paragraph">
<p>The next validation checks 2 conditions for the policy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>that it&#8217;s signed with a specific key</p>
</li>
<li>
<p>it has a production environment annotation.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- kind: pubKey
  key: |
    -----BEGIN PUBLIC KEY-----
    MBFKHFDGHKIJH0CAQYIKoZIzj0DAQcDQgAEX0HFTtCfTtPmkx5p1RbDE6HJSGAVD
    BVDF6SKFSF87AASUspkQsN3FO4iyWodCy5j3o0CdIJD/KJHDJFHDFIu6sA==
    -----END PUBLIC KEY-----
  annotations:
    environment: production</code></pre>
</div>
</div>
<h3 id="_using_a_signature_verification_configuration_file_to_check_a_policy_oci_artifact" class="discrete">Using a signature verification configuration file to check a policy OCI artifact</h3>
<div class="paragraph">
<p>You can test if a policy passes verification using the verification config file.
Use the <code>--verification-config-path</code>  flag of the <code>kwctl verify</code> command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ cat signatures_requirements.yaml
apiVersion: v1
allOf:
  - kind: pubKey
    key: |
      -----BEGIN PUBLIC KEY-----
      MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE5Q+cN1Jj2S7N05J4AXnqwP2DyzSg
      Mc+raYce2Wthrd30MSgFtoh5ADAkCd/nML2Nx8UD9KBuASRb0gG5jXqgMQ==
      -----END PUBLIC KEY-----

$ kwctl verify --verification-config-path signatures_requirements.yaml ghcr.io/kubewarden/policies/user-group-psp:latest
2022-03-29T17:34:37.847169Z  INFO kwctl::verify: Policy successfully verified</code></pre>
</div>
</div>
<div class="paragraph">
<p>This last example tests if a given policy came from the Kubewarden organization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ cat kubewarden_signatures.yaml
apiVersion: v1
allOf:
  - kind: githubAction
    owner: kubewarden

$ kwctl verify --verification-config-path kubewarden_signatures.yaml ghcr.io/kubewarden/policies/user-group-psp:latest
2022-03-29T18:07:39.062292Z  INFO kwctl::verify: Policy successfully verified</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="security-hardening.html">Security</a></span>
  <span class="next"><a href="webhook-mtls.html">Enable mTLS with K3s</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../../_/js/site.js"></script>
<script async src="../../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../../.." data-snippet-length="100" data-stylesheet="../../../../../_/css/search.css"></script>
<script async src="../../../../../search-index.js"></script>
<script src="../../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
