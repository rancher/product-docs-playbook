<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring the SUSE Security Admission Controller stack for production :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/admission-controller/1.29/en/howtos/production-deployments.html">
    <link rel="prev" href="install-kwctl.html">
    <link rel="next" href="deploy-at-scale.html">
    <meta name="description" content="Configuring SUSE Security Admission Controller stack for production">
    <meta name="keywords" content="["SUSE Security Admission Controller", kubewarden, kubernetes, policyservers, production, poddisruptionbudget, affinity, limits, tolerations, priorityclass]">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-07-09"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/admission-controller/1.29/en/howtos/production-deployments.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/admission-controller/1.30/en/howtos/production-deployments.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/admission-controller/1.30/en/howtos/production-deployments.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="admission-controller" data-version="1.30">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">Admission Controller</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quick-start.html">Quick start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../tutorials/writing-policies/index.html">Writing SUSE Security Admission Controller policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../tutorials/writing-policies/CEL/01-intro-cel.html">Introduction to CEL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/CEL/02-reusing-vap.html">Reusing ValidatingAdmissionPolicies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/CEL/03-context-aware.html">Context-aware CEL policies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/CEL/04-example-sigstore.html">Sigstore host capabilities</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../tutorials/writing-policies/rust/01-intro-rust.html">Rust</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rust/02-create-policy.html">Creating a policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rust/03-define-policy-settings.html">Defining policy settings</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rust/04-write-validation-logic.html">Writing validation logic</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rust/05-mutation-policy.html">Creating a new mutation policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rust/06-logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rust/07-build-and-distribute.html">Building and distributing policies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rust/08-raw-policies.html">Raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../tutorials/writing-policies/go/01-intro-go.html">Writing policies in Go</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/02-scaffold.html">Creating a new validation policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/03-policy-settings.html">Defining policy settings</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/04-validation.html">Writing the validation logic</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/05-e2e-tests.html">End-to-end testing</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/06-logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/07-automate.html">Integrating with GitHub Actions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/08-distribute.html">Distributing policy</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/09-validation-with-queries.html">Validation using JSON queries</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/go/10-raw-policies.html">Writing raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../tutorials/writing-policies/rego/01-intro-rego.html">Rego</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/rego/02-builtin-support.html">Builtin support</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Open Policy Agent</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/open-policy-agent/01-intro.html">Introduction to Open Policy Agent</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/open-policy-agent/02-create-policy.html">Creating a new policy</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/open-policy-agent/03-build-and-run.html">Build and run a OPA policy for Admission Controller</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/open-policy-agent/04-distribute.html">Distributing an OPA policy with SUSE Security Admission Controller</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/open-policy-agent/05-raw-policies.html">Writing raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Gatekeeper</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/gatekeeper/01-intro.html">Gatekeeper support</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/gatekeeper/02-create-policy.html">Creating a new Gatekeeper Rego policy</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/gatekeeper/03-build-and-run.html">Build and run a Gatekeeper policy</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tutorials/writing-policies/rego/gatekeeper/04-distribute.html">Distributing a Gatekeeper policy with SUSE Security Admission Controller</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/writing-policies/dotnet.html">C#</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/writing-policies/swift.html">Swift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/writing-policies/typescript.html">Typescript</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/writing-policies/other-languages.html">Other languages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">WASI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/wasi/01-intro-wasi.html">WASI</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/writing-policies/wasi/02-raw-policies.html">Writing raw policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/writing-policies/metadata.html">Policy metadata</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Testing policies</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/testing-policies/index.html">Policy testing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/testing-policies/02-policy-authors.html">Testing for policy authors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tutorials/testing-policies/03-cluster-operators.html">Testing for cluster operators</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/verifying-kubewarden.html">Verifying SUSE Security Admission Controller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/publish-policy-to-artifact-hub.html">Publish policies to Artifact Hub</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Explanations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../explanations/mutating-policies.html">Mutating policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../explanations/context-aware-policies.html">Context aware policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../explanations/policy-groups.html">Policy Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../explanations/certificates.html">Certificate rotation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../explanations/distributing-policies.html">Distributing policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Comparisons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../explanations/comparisons/opa-comparison.html">SUSE Security Admission Controller vs OPA Gatekeeper</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../explanations/audit-scanner/audit-scanner.html">What is the Audit Scanner?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../explanations/audit-scanner/limitations.html">Audit Scanner - Limitations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../explanations/audit-scanner/policy-reports.html">Audit Scanner - Policy Reports</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../explanations/architecture.html">Admission Controller architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Howtos</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tasks.html">Common tasks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install-kwctl.html">Install <code>kwctl</code></a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="production-deployments.html">Production deployments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deploy-at-scale.html">Deployment at scale</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="audit-scanner.html">Audit Scanner</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="policies.html">Configuring policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="emergency-disable.html">Emergency disable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Configuring Policy Servers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="policy-servers/01-custom-cas.html">Using custom CAs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="policy-servers/02-private-registry.html">Configuring PolicyServers to use private registries</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="policy-servers/03-production-deployments.html">Production deployments</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="policy-groups.html">Policy groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="psp-migration.html">PSP migration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vap-migration.html">ValidatingAdmissionPolicy migration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pod-security-admission-with-kubewarden.html">Pod Security Admission</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="custom-certificate-authorities.html">Custom certificate authorities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="raw-policies.html">Raw policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="argocd-installation.html">ArgoCD Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="security-hardening/security-hardening.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="security-hardening/secure-supply-chain.html">Secure supply chain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="security-hardening/webhook-mtls.html">Enable mTLS with K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Air gap</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="airgap/01-requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="airgap/02-install.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="airgap/03-hauler.html">Hauler installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Telemetry quick starts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="telemetry/10-opentelemetry-qs.html">Open Telemetry quick start</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="telemetry/20-tracing-qs.html">Tracing quickstart</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="telemetry/30-metrics-qs.html">Metrics quickstart</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="telemetry/40-custom-otel-collector.html">Custom OpenTelemetry Collector</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Rancher-Fleet.html">Rancher Fleet</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Rancher UI extension</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ui-extension/01-install.html">Quickstart</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ui-extension/02-metrics.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ui-extension/03-tracing.html">Tracing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Rancher Application Collection</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="application-collection/01-verify-images.html">Verify images</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Workarounds</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="workarounds/policy-server-certificate-expiry.html">Certificate rotation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="contribution-guide/contribution-guide.html">Contribution guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="contribution-guide/contributing.html">Contributing to documentation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="contribution-guide/suggesting-an-improvement.html">Improving documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="gatekeeper-migration.html">Migrating Gatekeeper Policies to SUSE Security Admission Controller</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/CRDs.html">Custom Resource Definitions (CRD)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/dependency-matrix.html">Dependency matrix</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/artifacts.html">Artifacts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/upgrade-path.html">Upgrade path</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics-reference.html">Metrics reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/monitor-mode.html">Monitor mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Policy specification</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../reference/spec/01-intro-spec.html">Policy communication specification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../reference/spec/02-settings.html">Policy settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../reference/spec/03-validating-policies.html">Validating policies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../reference/spec/04-mutating-policies.html">Mutating policies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../reference/spec/05-context-aware-policies.html">Context aware policies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Host capabilities</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../reference/spec/host-capabilities/01-intro-host-capabilities.html">Host capabilities specification</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../reference/spec/host-capabilities/02-signature-verifier-policies.html">Signature verifier policies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../reference/spec/host-capabilities/03-container-registry.html">Container registry capabilities</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../reference/spec/host-capabilities/04-net.html">Network capabilities</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../reference/spec/host-capabilities/05-crypto.html">Cryptographic capabilities</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../reference/spec/host-capabilities/06-kubernetes.html">Kubernetes capabilities</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/oci-registries-support.html">OCI registry support for Admission Controller</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../reference/security-hardening/webhooks-hardening.html">Webhooks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/threat-model.html">Threat Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/policy-evaluation-timeout.html">Policy evaluation timeout protection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/verification-config.html">Verification configuration format</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/sources_yaml.html">Reference for sources.yaml</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/kwctl-cli.html"><code>kwctl</code> CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/policy-server-cli.html">Policy Server CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../personas.html">For who?</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../use-cases.html">Use cases</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../organization.html">Organization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../enterprise.html">Enterprise</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../disclosure.html">Security disclosure</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Admission Controller</span>
    <span class="version">1.30-next</span>
  </div>
  <ul class="components">
        <li class="component is-current">
          <div class="title"><a href="../../../1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version is-current">
              <a href="../introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/admission-controller" title="Admission Controller" aria-label="SUSE Documentation - Admission Controller">
        Admission Controller
      </a>
    </li>
      <li>
          Howtos
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.30-next</button>
  <div class="version-menu">
    <a class="version is-current" href="production-deployments.html">1.30-next</a>
    <a class="version" href="../../../1.29/en/howtos/production-deployments.html">1.29</a>
    <a class="version" href="../../../1.28/en/howtos/production-deployments.html">1.28</a>
    <a class="version" href="../../../1.27/en/howtos/production-deployments.html">1.27</a>
    <a class="version" href="../../../1.26/en/howtos/production-deployments.html">1.26</a>
    <a class="version" href="../../../1.25/en/howtos/production-deployments.html">1.25</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/kubewarden-product-docs/edit/main/docs/version-1.30/modules/en/pages/howtos/production-deployments.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:admission-controller" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is unreleased documentation for Admission Controller 1.30-next.</p>
</div>
</td>
</tr>
</table>
</div>
<h1 class="page">Configuring the SUSE Security Admission Controller stack for production</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>SUSE Security Admission Controller provides features for reliability and correct scheduling of its
components in a Kubernetes cluster. Some of the hints on this page come from
Admission Controller community members using Admission Controller at scale.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to see a real example of running Admission Controller at scale
check out the <a href="deploy-at-scale.html" class="xref page">Admission Controller in a
Large-Scale Environment</a> documentation page.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_tolerations_and_affinityanti_affinity"><a class="anchor" href="#_configuring_tolerations_and_affinityanti_affinity"></a>Configuring Tolerations and Affinity/Anti-Affinity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By using the <code>tolerations</code> and <code>affinity</code> fields, operators can
fine-tune the scheduling and reliability of the Admission Controller
stack to meet their specific deployment needs and constraints. For
more details on the exact fields and their configurations, refer to the
<a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">Kubernetes
documentation on Taints and Tolerations</a> and
<a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity">Affinity
and Anti-Affinity</a>.</p>
</div>
<div class="paragraph">
<p>Starting from version 1.15 of the Admission Controller stack, the
Admission Controller Helm charts ship with two new values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.global.tolerations</code></p>
</li>
<li>
<p><code>.global.affinity</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These Helm chart values allow users to define Kubernetes tolerations
and affinity/anti-affinity settings for the Admission Controller stack,
including the controller deployment, audit scanner cronjob, and the default
<code>PolicyServer</code> custom resource.</p>
</div>
<div class="sect2">
<h3 id="_tolerations"><a class="anchor" href="#_tolerations"></a>Tolerations</h3>
<div class="paragraph">
<p>The <code>tolerations</code> value is an array where users can specify Kubernetes
tolerations for the Admission Controller components. Tolerations allow
pods to be scheduled on nodes with matching taints. This is useful for
managing where pods can be scheduled, especially in scenarios involving
node maintenance, dedicated workloads, or specific hardware requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">global:
  tolerations:
    - key: "key1"
      operator: "Equal"
      value: "value1"
      effect: "NoSchedule"
    - key: "key2"
      operator: "Equal"
      value: "value2"
      effect: "NoExecute"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the tolerations defined are applied to the controller
deployment, audit scanner cronjob, and the default <code>PolicyServer</code> custom
resource.</p>
</div>
</div>
<div class="sect2">
<h3 id="_affinityanti_affinity"><a class="anchor" href="#_affinityanti_affinity"></a>Affinity/Anti-Affinity</h3>
<div class="paragraph">
<p>The <code>affinity</code> value allows users to define Kubernetes affinity and
anti-affinity rules for the Admission Controller components. Affinity rules
constrain pods to specific nodes, while anti-affinity rules prevent pods from
being scheduled on certain nodes or in close proximity to other pods. These
settings are useful for ensuring high availability, fault tolerance, and
optimized resource usage in a cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">global:
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: security
                operator: In
                values:
                  - S1
          topologyKey: topology.kubernetes.io/zone
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: security
                  operator: In
                  values:
                    - S2
            topologyKey: topology.kubernetes.io/zone
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/os
                operator: In
                values:
                  - linux
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          preference:
            matchExpressions:
              - key: label-1
                operator: In
                values:
                  - key-1
        - weight: 50
          preference:
            matchExpressions:
              - key: label-2
                operator: In
                values:
                  - key-2</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the affinity rules will be applied to the controller
deployment, audit scanner cronjob, and the default <code>PolicyServer</code> custom
resource.</p>
</div>
<div class="paragraph">
<p>The previous affinity configuration available in the <code>kubewarden-default</code>
Helm chart, which was used to define the affinity configuration for the
<code>PolicyServer</code> only, has been removed in favor of the global <code>affinity</code>
value. This change simplifies the configuration process by providing
a single approach to defining affinity and anti-affinity rules for all
Admission Controller components.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The old <code>affinity</code> configuration in the <code>kubewarden-default</code> Helm chart has
been removed. Users should now use the <code>.global.affinity</code> field to configure
affinity and anti-affinity settings for the entire Admission Controller stack.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_priorityclasses"><a class="anchor" href="#_configuring_priorityclasses"></a>Configuring priorityClasses</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By using priorityClasses, operators can enforce a scheduling priority
for the workload pods of the Admission Controller stack. This ensures the
Admission Controller workload is available over other workloads, preventing
eviction and ensuring service reliability. For more information, refer to the
<a href="https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/">Kubernetes
documentation on Priorityclasses</a>.</p>
</div>
<div class="paragraph">
<p>Starting from version 1.25 of the Admission Controller stack, the
Admission Controller Helm charts ship with a new value:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.global.priorityClassName</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The priorityClass defined by name in this value is applied to the controller
deployment pods, and the pods of the default <code>PolicyServer</code> custom resource.</p>
</div>
<div class="paragraph">
<p>The <code>.global.priorityClassName</code> value expects a name of an existing
PriorityClass. As an example, we could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: kubewarden-high-priority
value: 1000000
globalDefault: false
description: "This priority class should be used for XYZ service pods only."</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kubernetes already ships with two PriorityClasses
that are good candidates: <code>system-cluster-critical</code> and
<code>system-node-critical</code>. These are common classes and are used to
<a href="https://kubernetes.io/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/">ensure
that critical components are always scheduled first</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you delete a PriorityClass, existing Pods that use the name of the
deleted PriorityClass remain unchanged, but following Pods that use the
name of the deleted PriorityClass will not be created by Kubernetes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policyserver_production_configuration"><a class="anchor" href="#_policyserver_production_configuration"></a><code>PolicyServer</code> production configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>PolicyServers</code> are critical to the cluster. Reliability of them is important
as they process Admission Requests destined for the Kubernetes API via the
Validating and Mutating Webhooks.</p>
</div>
<div class="paragraph">
<p>As with other Dynamic Admission Controllers, this process happens before
requests reach the Kubernetes API server. Latency or service delays by the
Dynamic Admission Controller may introduce cluster inconsistency, Denial
of Service, or deadlock.</p>
</div>
<div class="paragraph">
<p>Admission Controller provides several ways to increase the reliability of
<code>PolicyServers</code>. Production deployments can vary a great deal, it is up to
the operator to configure the deployment for their needs.</p>
</div>
<div class="sect2">
<h3 id="_poddisruptionbudgets"><a class="anchor" href="#_poddisruptionbudgets"></a>PodDisruptionBudgets</h3>
<div class="paragraph">
<p>The Admission Controller controller can create a
<a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">PodDisruptionBudget</a>
(PDB) for the <code>PolicyServer</code> Pods. This controls the range of <code>PolicyServer</code>
Pod replicas associated with the <code>PolicyServer</code>, ensuring high availability
and controlled eviction in case of node maintenance, scaling operations or
cluster upgrades.</p>
</div>
<div class="paragraph">
<p>This is achieved by setting <code>spec.minAvailable</code>, or <code>spec.maxUnavailable</code>
of the <code>PolicyServer</code> resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>minAvailable</code>: specifies the minimum number of <code>PolicyServer</code> Pods that
must be available at all times. Can be an integer or a percentage.</p>
<div class="literalblock">
<div class="content">
<pre>Useful for maintaining the operational integrity of the `PolicyServer`,
ensuring that policies are continuously enforced without interruption.</pre>
</div>
</div>
</li>
<li>
<p><code>maxUnavailable</code>: specifies the maximum number of <code>PolicyServer</code> Pods
that can be unavailable at any given time. Can be an integer or a percentage.</p>
<div class="literalblock">
<div class="content">
<pre>Useful for performing rolling updates or partial maintenance without
fully halting the policy enforcement mechanism.</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can specify only one of <code>maxUnavailable</code> and <code>minAvailable</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuring_minavailable_or_maxunavailable"><a class="anchor" href="#_configuring_minavailable_or_maxunavailable"></a>Configuring minAvailable or maxUnavailable</h4>
<div class="listingblock">
<div class="title">Example: Set minAvailable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policies.kubewarden.io/v1
kind: PolicyServer
metadata:
  name: your-policy-server
spec:
  # Other configuration fields
  minAvailable: 2 # ensure at least two policy-server Pods are available at all times</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Set maxUnavailable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policies.kubewarden.io/v1
kind: PolicyServer
metadata:
  name: your-policy-server
spec:
  # Other configuration fields
  maxUnavailable: "30%" # ensure no more than 30% of policy-server Pods are unavailable at all times</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_affinity_anti_affinity"><a class="anchor" href="#_affinity_anti_affinity"></a>Affinity / Anti-affinity</h3>
<div class="paragraph">
<p>The Admission Controller controller can set the affinity of
<code>PolicyServer</code> Pods. This allows constraint of Pods to specific
nodes, or Pods against other Pods. For more information on Affinity, see the
<a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity">Kubernetes
docs</a>.</p>
</div>
<div class="paragraph">
<p>Kubernetes affinity configuration allows constraining Pods to nodes (via
<code>spec.affinity.nodeAffinity</code>) or constraining Pods with regards to other Pods
(via <code>spec.affinity.podAffinity</code>). Affinity can be set as a soft constraint
(with <code>preferredDuringSchedulingIgnoredDuringExecution</code>) or a hard one
(with <code>requiredDuringSchedulingIgnoredDuringExecution</code>).</p>
</div>
<div class="paragraph">
<p>Affinity / anti-affinity matches against specific labels, be it nodes'
labels (e.g: <code>topology.kubernetes.io/zone</code> set to <code>antarctica-east1</code>)
or Pods labels. Pods created from <code>PolicyServer</code> definitions have a label
<code>kubewarden/policy-server</code> set to the name of the <code>PolicyServer</code>. (e.g:
<code>kubewarden/policy-server: default</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Inter-pod affinity/anti-affinity require substantial amounts of processing
and are not recommended in clusters larger than several hundred nodes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure affinity for a <code>PolicyServer</code>, set its <code>spec.affinity</code>
field. This field accepts a YAML object matching the contents of a Pod&#8217;s
<code>spec.affinity</code>.</p>
</div>
<div class="sect3">
<h4 id="_configuring_affinity_anti_affinity"><a class="anchor" href="#_configuring_affinity_anti_affinity"></a>Configuring Affinity / Anti-affinity</h4>
<div class="listingblock">
<div class="title">Example: Spread the <code>PolicyServer</code> Pods across zones and hostnames</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policies.kubewarden.io/v1
kind: PolicyServer
metadata:
  name: your-policy-server
spec:
  # Other configuration fields
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: kubewarden/policy-server
                operator: In
                values:
                  - your-policy-server
          topologyKey: topology.kubernetes.io/zone
        - labelSelector:
            matchExpressions:
              - key: kubewarden/policy-server
                operator: In
                values:
                  - your-policy-server
          topologyKey: kubernetes.io/hostname</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Only schedule <code>PolicyServer</code> pods in control-plane nodes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policies.kubewarden.io/v1
kind: PolicyServer
metadata:
  name: your-policy-server
spec:
  # Other configuration fields
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: kubewarden/policy-server
                operator: In
                values:
                  - your-policy-server
          topologyKey: node-role.kubernetes.io/control-plane</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_limits_and_requests"><a class="anchor" href="#_limits_and_requests"></a>Limits and Requests</h3>
<div class="paragraph">
<p>The Admission Controller controller can set the resource limits and
requests of <code>PolicyServer</code> Pods. This specifies how much of each resource
each of the containers associated with the <code>PolicyServer</code> Pods needs. For
<code>PolicyServers</code>, only <code>cpu</code> and <code>memory</code> resources are relevant. See the
<a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-units-in-kubernetes">Kubernetes
docs</a> on resource units for more information.</p>
</div>
<div class="paragraph">
<p>This is achieved by setting the following <code>PolicyServer</code> resource fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spec.limits</code>: Limits on resources, enforced by the container
runtime. Different runtimes can have different ways to implement the
restrictions.</p>
</li>
<li>
<p><code>spec.requests</code>: Amount of resources to reserve for each container. It is
possible and allowed for a container to use more resource than its <code>request</code>.</p>
<div class="literalblock">
<div class="content">
<pre>If omitted, it defaults to `spec.limits` if that is set (unless
`spec.requests` of containers is set to some defaults via an admission
mechanism).</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Undercommitting resources of <code>PolicyServers</code> may cause reliability issues
in the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuring_limits_and_requests"><a class="anchor" href="#_configuring_limits_and_requests"></a>Configuring Limits and Requests</h4>
<div class="listingblock">
<div class="title">Example: Set hard limits for each <code>PolicyServer</code> container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policies.kubewarden.io/v1
kind: PolicyServer
metadata:
  name: your-policy-server
spec:
  # Other configuration fields
  limits:
    cpu: 500m
    memory: 1Gi</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_priorityclasses"><a class="anchor" href="#_priorityclasses"></a>PriorityClasses</h3>
<div class="paragraph">
<p>The Admission Controller controller can set the PriorityClass used for the
pods of <code>PolicyServers</code>. This means <code>PolicyServer</code> workloads are scheduled
with priority, preventing eviction and ensuring service reliability. See the
<a href="https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/">Kubernetes
docs for more information</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you delete a PriorityClass, existing Pods that use the name of the
deleted PriorityClass remain unchanged, but following Pods that use the
name of the deleted PriorityClass will not be created by Kubernetes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuring_priorityclasses_2"><a class="anchor" href="#_configuring_priorityclasses_2"></a>Configuring PriorityClasses</h4>
<div class="listingblock">
<div class="title">Example: Using the default <code>system-cluster-critical</code> priorityClass:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policies.kubewarden.io/v1
kind: PolicyServer
metadata:
  name: your-policy-server
spec:
  # Other configuration fields
  priorityClassName: system-cluster-critical</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_isolate_policy_workloads"><a class="anchor" href="#_isolate_policy_workloads"></a>Isolate Policy Workloads</h3>
<div class="paragraph">
<p>To ensure stability and high performance at scale, users can run separate
<strong><code>PolicyServer</code></strong> deployments to isolate different workloads.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Dedicate one <code>PolicyServer</code> to Context-Aware Policies:</strong> These policies are
more resource-intensive because they query the Kubernetes API server or other
external services like Sigstore, OCI registries, among others. Isolating them
prevents a slow policy from creating a bottleneck for other, faster policies.</p>
</li>
<li>
<p><strong>Use another <code>PolicyServer</code> for All Other Policies:</strong> Run regular,
self-contained policies on a separate server to ensure low latency for the
most common admission requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also consider splitting even further the workload. For example, if
you have some policies that are slow and require a bigger execution timeout,
consider moving them into a dedicated <code>PolicyServer</code>. This way you ensure
that policies will not block the workers to evaluate other requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_allocation_and_scaling"><a class="anchor" href="#_resource_allocation_and_scaling"></a>Resource Allocation and Scaling</h3>
<div class="paragraph">
<p>To handle high traffic and ensure availability, provide sufficient resources
and scale your replicas.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Allocate Sufficient Resources:</strong> In high-traffic environments, allocate
generous resources to each replica. Do not starve the <code>PolicyServers</code>, as
insufficient CPU or memory is a primary cause of request timeouts. Remember
that <code>PolicyServers</code> will receive requests from control plane and the
Admission Controller audit scanner.</p>
</li>
<li>
<p><strong>Scale for High Availability:</strong> For deployments handling hundreds of
requests per second, run a high number of replicas. This distributes the
load effectively and ensures that the failure of a few pods does not impact
the cluster&#8217;s operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Start with a baseline of 3-5 replicas and monitor CPU and memory usage. Scale
the replica count as needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_effective_auditing_at_scale"><a class="anchor" href="#_effective_auditing_at_scale"></a>Effective Auditing at Scale</h3>
<div class="paragraph">
<p>To run audits efficiently on large clusters, fine-tune the audit scanner
for performance and parallelism.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Schedule Audits Periodically:</strong> Running a scan frequently can be a good
balance between catching configuration drift and minimizing load on the
API server.</p>
</li>
<li>
<p><strong>Tune Parallelism Aggressively:</strong> The key to fast audits is
parallelization. With high-parallelism settings, you can reduce audit times
on massive clusters to just over an hour.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s important to remember that audit scanner sends requests to
<code>PolicyServers</code>. Therefore, its parallelism can impact on <code>PolicyServer</code>
performance. If you want to have an aggressive parallelism to reduce the
scan times in big clusters, you may need to increase the policy server
resources available to avoid impacting the admission controller performance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Set <code>disableStore: true</code> to reduce load if you consume audit results
from logs and do not require policy <code>Reports</code> nor <code>ClusterReports</code> custom
resources in the cluster.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="install-kwctl.html">Install <code>kwctl</code></a></span>
  <span class="next"><a href="deploy-at-scale.html">Deployment at scale</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
