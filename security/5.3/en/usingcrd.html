<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CRD - Custom Resource Definitions :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/security/5.4/en/usingcrd.html">
    <link rel="prev" href="federated.html">
    <link rel="next" href="import.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2024-09-27"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/security/5.4/en/usingcrd.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/security/5.3/en/usingcrd.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/security/5.3/en/usingcrd.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="security" data-version="5.3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Security</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="overview.html">SUSE® Security Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Understanding SUSE® Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="requirements.html">System Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation.html">Deployment Preparation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="policy-overview.html">Security Policy Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="integration.html">Enterprise Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ci-workflow.html">CI/CD Workflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Operational Tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Deploying SUSE® Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="configmap.html">Deploy Using ConfigMap</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="operators.html">Deploy Using Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="publick8s.html">Deploying SUSE Security on Public Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="awsmarketplace.html">AWS Marketplace Listing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="kubernetes.html">Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="openshift.html">OpenShift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rancher.html">Rancher Deployment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="airgap.html">Air-Gapped Deployment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="docker.html">Docker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="updating.html">Updating SUSE® Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="testing.html">Evaluating and Testing SUSE® Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting.html">Troubleshooting Deployments</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="users.html">Users and Roles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="restore.html">Restoring SUSE® Security Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="remove.html">Removing or Resetting SUSE® Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="internal.html">Replacing Internal Certificates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="replacecert.html">Replacing Self-Signed Certificates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rest-api.html">Connect to Manager, REST API Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="automation.html">Automation with REST API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">SUSE® Security Interface</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="navigation.html">Navigating the Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="multicluster.html">Enterprise Multi-Cluster Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="modes.html">Modes: Discover, Monitor, Protect</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reporting.html">Reporting &amp; Notifications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="customui.html">Customizing the UI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security Management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security Policy</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Admission Controls</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="admission.html">Admission Controls</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="sigstore.html">Sigstore Cosign Signature Verifiers</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="assessment.html">Configuration Assessment for Kubernetes Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="groups.html">Groups</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="networkrules.html">Network Rules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="processrules.html">Process Profile Rules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="filerules.html">File Access Rules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="responserules.html">Response Rules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="dlp.html">DLP &amp; WAF Sensors</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="threats.html">Network Threat Signatures</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="customcompliance.html">Custom Compliance Checks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="federated.html">Federated Policy</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Custom Resource Definitions</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="4">
    <a class="nav-link" href="usingcrd.html">Using CRD</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="import.html">Importing CRD from Console</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security Risks, Scanning &amp; Compliance</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Scanning &amp; Compliance</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="scanning.html">Scanning</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="vulnerabilities.html">Vulnerability Management</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="compliance.html">Compliance &amp; CIS Benchmarks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Registry Scanning</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="registry-scanning-configuration.html">Registry Scanning Configuration</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="harbor.html">Harbor Pluggable Scanner Module</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ecr-iam.html">ECR Scanning Using IAM Roles</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="gcr-sa.html">GCR Scanning Using Service Accounts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Build Phase Image Scanning</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="build-image-scanning.html">Local</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="jenkins.html">Jenkins</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="bamboo.html">Bamboo</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="circleci.html">CircleCI</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="azuredevops.html">Azure DevOps</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="gitlab.html">Gitlab</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="github.html">GitHub</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="improve-score.html">Improve Security Risk Score</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="cve-sources.html">CVE Database Sources &amp; Version</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="updating-cve-database.html">Updating the CVE Database</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scanners.html">Parallel &amp; Stand-Alone Scanners</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Enterprise Features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Integration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ldap.html">LDAP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="msad.html">Microsoft AD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="saml.html">SAML (Okta)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="msazure.html">SAML (Azure AD)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adfs.html">SAML (ADFS)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="openid.html">OpenID Connect Azure/Okta</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="oidc-adfs.html">OpenID Connect (OIDC) for ADFS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ibmsa.html">IBM Security Advisor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ibmqr.html">IBM QRadar</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="splunk.html">Splunk</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="details.html">Environment Variables Details</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli.html">Command Line</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5x.html">5.x Release Notes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4x.html">4.x Release Notes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="other.html">Integrations &amp; Other Components</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Security</span>
    <span class="version">5.3</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../5.4/en/overview.html">5.4</a>
            </li>
            <li class="version is-current">
              <a href="overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/security" title="SUSE Security" aria-label="SUSE Documentation - SUSE Security">
        SUSE Security
      </a>
    </li>
      <li>
          Security Management
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">5.3</button>
  <div class="version-menu">
    <a class="version" href="../../5.4/en/usingcrd.html">5.4</a>
    <a class="version is-current" href="usingcrd.html">5.3</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/neuvector-product-docs/edit/main/docs/5.3/modules/en/pages/usingcrd.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:security" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CRD - Custom Resource Definitions</h1>
<div class="sect1">
<h2 id="_suse_security_crd_for_policy_as_code"><a class="anchor" href="#_suse_security_crd_for_policy_as_code"></a>SUSE® Security CRD for Policy As Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SUSE® Security custom resource definitions (CRDs) can be used by various teams to automatically define security policies in the SUSE® Security container security platform. Developers, DevOps, DevSecOps, and Security teams can collaborate to automate security policies for new or updated applications deployed to production. CRDs can also be used to enforce global security policies across multiple Kubernetes clusters.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CRDs are supported in Kubernetes 1.11 and later. Deploying the SUSE® Security security rule CRD in earlier versions may not result in an error, but the CRD will not be processed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>CRD&#8217;s can be used to support many use cases and workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define security policy during application development, to push into production.</p>
</li>
<li>
<p>Learn behavior using SUSE® Security and export the CRD for review before pushing into production.</p>
</li>
<li>
<p>Migrate security policies from staging to production clusters.</p>
</li>
<li>
<p>Replicate rules across multiple replicated clusters in hybrid or multi-clouds.</p>
</li>
<li>
<p>Enforce global security policies (see examples for this at bottom).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CRD&#8217;s bring many benefits, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define / declare the security policy, as code.</p>
</li>
<li>
<p>Version and track the security policies the same as application deployment manifests.</p>
</li>
<li>
<p>Define the allowed behavior of any application including network, file and process behavior.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_supported_resource_types"><a class="anchor" href="#_supported_resource_types"></a>Supported Resource Types</h3>
<div class="paragraph">
<p>SUSE® Security supports two kinds of custom resource definitions.  They are the NvSecurityRule and NvClusterSecurityRule.  The difference among the two comes down to the boundary set by the definition of the scope.  The  NvSecurityRule resource is scoped at the namespace level, whereas the NvClusterSecurityRule is scoped at the cluster level.  Either of the resource types can be configured in a yaml file and can be created during deployment, as shown in the deployment instructions and examples for SUSE® Security.</p>
</div>
<div class="paragraph">
<p>The significance of the NvSecurityRule resource type with a scope of namespace lies in the enforcement of the configured domain of the target group, which must match the configured namespace in the SUSE® Security&#8217;s  CRD security policy.  This provides enforcement to prevent unwanted cross-namespace policy creation which affect a Target-Group policy rule.</p>
</div>
<div class="paragraph">
<p>For the NvClusterSecurityRule custom resource definition, this has a cluster level scope, and therefore, does not enforce any namespace boundary on a defined target.  However, the user-context that is used for importing the CRD-yaml file must have the necessary permissions to access or reside in the same namespace as the one configured in the CRD-yaml file, or the import will be rejected.</p>
</div>
<div class="sect3">
<h4 id="_enabling_crd_support"><a class="anchor" href="#_enabling_crd_support"></a>Enabling CRD Support</h4>
<div class="paragraph">
<p>As described in the Kubernetes and OpenShift deployment sections (Deploying SUSE® Security),  the appropriate clusterroles and clusterrole bindings for custom resources and NvSecurityRules should be added first.</p>
</div>
<div class="paragraph">
<p>Then NvSecurityRule and NvClusterSecurityRule should be created using the sample yaml in those sections. SUSE® Security CRDs can now be deployed.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_a_sample_suse_security_crd"><a class="anchor" href="#_generating_a_sample_suse_security_crd"></a>Generating a Sample SUSE® Security CRD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest way to see how the yaml file format looks for a SUSE® Security CRD is to export it from the SUSE® Security Console. After you have tested your application while SUSE® Security is in Discover mode learning the network, file, and process behavior, you can export the learned policy.</p>
</div>
<div class="paragraph">
<p>Go to the Policy &#8594; Groups menu and click on Export Group Policy from the upper right.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/export_crd.png" alt="CRDExport"></span></p>
</div>
<div class="paragraph">
<p>Then select the Groups that you wish to export, such as the three in the demo namespace above. Inspect the saved CRD yaml below to see how the SUSE® Security network, process, and file rules are expressed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to the selected group(s), all 'linked' groups will also be exported. A linked group is any other group that a selected group will connect to or from as allowed by a network rule.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sample Exported CRD</p>
</div>
<details>
<summary class="title">Click here for details</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
items:
- apiVersion: neuvector.com/v1
  kind: NvSecurityRule
  metadata:
    name: nv.nginx-pod.demo
    namespace: demo
  spec:
    egress:
    - selector:
        criteria:
        - key: service
          op: =
          value: node-pod.demo
        - key: domain
          op: =
          value: demo
        name: nv.node-pod.demo
      action: allow
      applications:
      - HTTP
      name: nv.node-pod.demo-egress-0
      ports: any
    file: []
    ingress:
    - selector:
        criteria:
        - key: service
          op: =
          value: exploit.demo
        - key: domain
          op: =
          value: demo
        name: nv.exploit.demo
      action: allow
      applications:
      - HTTP
      name: nv.nginx-pod.demo-ingress-0
      ports: any
    process:
    - action: allow
      name: nginx
      path: /usr/sbin/nginx
    - action: allow
      name: pause
      path: /pause
    - action: allow
      name: ps
      path: /bin/ps
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: nginx-pod.demo
        - key: domain
          op: =
          value: demo
        name: nv.nginx-pod.demo
      policymode: Monitor
- apiVersion: neuvector.com/v1
  kind: NvSecurityRule
  metadata:
    name: nv.node-pod.demo
    namespace: demo
  spec:
    egress:
    - selector:
        criteria:
        - key: address
          op: =
          value: google.com
        name: test
      action: allow
      applications:
      - SSL
      name: test-egress-1
      ports: any
    - selector:
        criteria:
        - key: service
          op: =
          value: redis-pod.demo
        - key: domain
          op: =
          value: demo
        name: nv.redis-pod.demo
      action: allow
      applications:
      - Redis
      name: nv.redis-pod.demo-egress-2
      ports: any
    - selector:
        criteria:
        - key: service
          op: =
          value: kube-dns.kube-system
        - key: domain
          op: =
          value: kube-system
        name: nv.kube-dns.kube-system
      action: allow
      applications:
      - DNS
      name: nv.kube-dns.kube-system-egress-3
      ports: any
    file: []
    ingress: []
    process:
    - action: allow
      name: curl
      path: ""
    - action: allow
      name: node
      path: /usr/bin/nodejs
    - action: allow
      name: pause
      path: /pause
    - action: allow
      name: ps
      path: /bin/ps
    - action: allow
      name: sh
      path: /bin/dash
    - action: allow
      name: whoami
      path: /usr/bin/whoami
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: node-pod.demo
        - key: domain
          op: =
          value: demo
        name: nv.node-pod.demo
      policymode: Protect
- apiVersion: neuvector.com/v1
  kind: NvSecurityRule
  metadata:
    name: nv.redis-pod.demo
    namespace: demo
  spec:
    egress: []
    file: []
    ingress: []
    process:
    - action: allow
      name: pause
      path: /pause
    - action: allow
      name: redis-server
      path: /usr/local/bin/redis-server
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: redis-pod.demo
        - key: domain
          op: =
          value: demo
        name: nv.redis-pod.demo
      policymode: Monitor
- apiVersion: neuvector.com/v1
  kind: NvSecurityRule
  metadata:
    name: nv.kube-dns.kube-system
    namespace: kube-system
  spec:
    egress: null
    file: null
    ingress: null
    process: null
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: kube-dns.kube-system
        - key: domain
          op: =
          value: kube-system
        name: nv.kube-dns.kube-system
      policymode: Monitor
- apiVersion: neuvector.com/v1
  kind: NvSecurityRule
  metadata:
    name: nv.exploit.demo
    namespace: demo
  spec:
    egress: null
    file: null
    ingress: null
    process: null
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: exploit.demo
        - key: domain
          op: =
          value: demo
        name: nv.exploit.demo
      policymode: Monitor
kind: List
metadata: null</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is a namespaced CRD, of NvSecurityRule</p>
</li>
<li>
<p>nginx-pod.demo can talk to node-pod.demo over HTTP, and allowed processes are listed</p>
</li>
<li>
<p>node-pod.demo can talk to redis-pod.demo using the Redis protocol</p>
</li>
<li>
<p>The policymode of the services are set to Monitor mode</p>
</li>
<li>
<p>node-pod.demo is allowed to egress to google.com using SSL</p>
</li>
<li>
<p>Group names such as nv.node-pod.demo are referenced but not defined in the CRD, so are expected to already exist when deployed. See below for defining Groups.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policy_mode_configuration_and_group_definition"><a class="anchor" href="#_policy_mode_configuration_and_group_definition"></a>Policy Mode Configuration and Group Definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Policy mode configuration and Group definition is supported within the CRD configuration yaml file.  With policymode configured in the yaml configuration file, importing such file will set the target group to this value for the CRD import.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The imported target policy mode is not allowed to be modified from the SUSE® Security console (Policy &#8594; Groups). For example, once the mode is set to Monitor, it can only be changed through CRD modification, not through the console.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The CRD import behavior ignores the PolicyMode of any 'linked' group, leaving the Policy mode unchanged if the linked group already exists. If the linked group does not exist it will be automatically created and set to the default New Services Mode in Settings &#8594; Configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_policy_mode_configuration_requirements"><a class="anchor" href="#_policy_mode_configuration_requirements"></a>Policy Mode Configuration Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>Mode only applies to the configured Target group</p>
</li>
<li>
<p>The target group configuration must have the format nv.SERVICE_NAME.DOMAIN.</p>
<div class="ulist">
<ul>
<li>
<p>Example:  nv.xxx.yyy</p>
</li>
<li>
<p>xxx.yyy=SERVICE</p>
</li>
<li>
<p>yyy=DOMAIN</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supported values are Discover, Monitor, and Protect</p>
</li>
<li>
<p>The target group must contain the key-value pair key: service</p>
</li>
<li>
<p>A configured key: domain must match the service domain suffix with the configured service key-value pair</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Policy Mode Configuration Yaml file Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  target:
      policymode: Protect
      selector:
          name: nv.xxx.yyy
          criteria:
          - key: service            #1 of 2 Criteria must exist
            value: xxx.yyy
            op: "="
          - key: domain             #2 of 2 Criteria must exist
            value: yyy
            op: "="</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_crd_policy_rules_syntax_and_semantics"><a class="anchor" href="#_crd_policy_rules_syntax_and_semantics"></a>CRD Policy Rules Syntax and Semantics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_group_name"><a class="anchor" href="#_group_name"></a>Group Name</h3>
<div class="ulist">
<ul>
<li>
<p>Avoid using names which start with fed., nv.ip., host:, or workload: which are reserved for federated groups or ip based services.</p>
</li>
<li>
<p>You can use node, external, or containers as a group name. However, this will be the same as the reserved default group names, so a new group will not be created. Any group definition criteria in the CRD will be ignored, but the rules for the group will be processed. The new rules will be shown under the group name.</p>
</li>
<li>
<p>Meets the criteria: ^[a-zA-Z0-9]+[.:a-zA-Z0-9_-]*$</p>
</li>
<li>
<p>Must not begin with fed, workload, or nv.ip</p>
</li>
<li>
<p>If the name has the format as nv.xxx.yyy, then there must exist a matching service and domain definition, or the import validation will fail.  Please refer to the above Policy Mode Configuration for details.</p>
</li>
<li>
<p>If the group name to be imported already exists in the destination system, then the criteria must match between the imported CRD and the one in the destination system.  If there are differences, the CRD import will be rejected.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_policy_name"><a class="anchor" href="#_policy_name"></a>Policy Name</h3>
<div class="ulist">
<ul>
<li>
<p>Needs to be unique within a yaml file.</p>
</li>
<li>
<p>Cannot be empty.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ingress"><a class="anchor" href="#_ingress"></a>Ingress</h3>
<div class="ulist">
<ul>
<li>
<p>Is the traffic inbound to the target.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_egress"><a class="anchor" href="#_egress"></a>Egress</h3>
<div class="ulist">
<ul>
<li>
<p>Is the traffic leaving from the target.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_criteria"><a class="anchor" href="#_criteria"></a>Criteria</h3>
<div class="ulist">
<ul>
<li>
<p>Must not be empty unless the name is nodes, external, or containers</p>
</li>
<li>
<p>name - If the name has the service format nv.xxx.yyy, then refer to the above section Policy Mode Configuration section details</p>
</li>
<li>
<p>key - The key conforms to the regular expression pattern ^[a-zA-Z0-9]+[.:a-zA-Z0-9_-]*$</p>
</li>
<li>
<p>op (operation)</p>
<div class="ulist">
<ul>
<li>
<p>string = "="</p>
</li>
<li>
<p>string = "!="</p>
</li>
<li>
<p>string = "contains"</p>
</li>
<li>
<p>string = "prefix"</p>
</li>
<li>
<p>string = "regex"</p>
</li>
<li>
<p>string = "!regex"</p>
</li>
</ul>
</div>
</li>
<li>
<p>value - A string without limitations</p>
</li>
<li>
<p>key - Must not be empty</p>
</li>
<li>
<p>op - Operator</p>
<div class="ulist">
<ul>
<li>
<p>If the operator is equal (=) or not-equal (!=), then its&#8217; value must not be empty.</p>
</li>
<li>
<p>If the operator is equal (=) or not-equal (!=) with a value (such as* or ?), then the value cannot have any regular expresssion format like ^$.</p>
</li>
<li>
<p>Example:</p>
<div class="ulist">
<ul>
<li>
<p>Key: service</p>
</li>
<li>
<p>Op :  =</p>
</li>
<li>
<p>Value: ab?c*e^$  (this is incorrect)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Action - Allow or deny</p>
</li>
<li>
<p>Applications (supported values)</p>
<div class="ulist">
<ul>
<li>
<p>ActiveMQ</p>
</li>
<li>
<p>Apache</p>
</li>
<li>
<p>Cassandra</p>
</li>
<li>
<p>Consul</p>
</li>
<li>
<p>Couchbase</p>
</li>
<li>
<p>CouchDB</p>
</li>
<li>
<p>DHCP</p>
</li>
<li>
<p>DNS</p>
</li>
<li>
<p>Echo</p>
</li>
<li>
<p>ElasticSearch</p>
</li>
<li>
<p>etcd</p>
</li>
<li>
<p>GRPC</p>
</li>
<li>
<p>HTTP</p>
</li>
<li>
<p>Jetty</p>
</li>
<li>
<p>Kafka</p>
</li>
<li>
<p>Memcached</p>
</li>
<li>
<p>MongoDB</p>
</li>
<li>
<p>MSSQL</p>
</li>
<li>
<p>MySQL</p>
</li>
<li>
<p>nginx</p>
</li>
<li>
<p>NTP</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>PostgreSQL</p>
</li>
<li>
<p>RabbitMQ</p>
</li>
<li>
<p>Radius</p>
</li>
<li>
<p>Redis</p>
</li>
<li>
<p>RTSP</p>
</li>
<li>
<p>SIP</p>
</li>
<li>
<p>Spark</p>
</li>
<li>
<p>SSH</p>
</li>
<li>
<p>SSL</p>
</li>
<li>
<p>Syslog</p>
</li>
<li>
<p>TFTP</p>
</li>
<li>
<p>VoltDB</p>
</li>
<li>
<p>Wordpress</p>
</li>
<li>
<p>ZooKeeper</p>
</li>
</ul>
</div>
</li>
<li>
<p>Port - The specified format is xxx/yyy. Where xxx=protocol(tcp, udp), and yyy=port_number (0-65535).</p>
<div class="ulist">
<ul>
<li>
<p>TCP/123 or TCP/any</p>
</li>
<li>
<p>UDP/123 or UDP/123</p>
</li>
<li>
<p>ICMP</p>
</li>
<li>
<p>123 = TCP/123</p>
</li>
</ul>
</div>
</li>
<li>
<p>Process - A list of process with action, name, path for each</p>
<div class="ulist">
<ul>
<li>
<p>action: allow/deny  #This action has precedence over the file access rule.  This should be set to allow if the intent is to allow the file access rule to take effect.</p>
</li>
<li>
<p>name: process name</p>
</li>
<li>
<p>path: process path (optional)</p>
</li>
</ul>
</div>
</li>
<li>
<p>File - A list of file access rules; these apply only to the defined target container group</p>
<div class="ulist">
<ul>
<li>
<p>app: list of apps</p>
</li>
<li>
<p>behavior: block_access / monitor_change  #This blocks access to the defined filter below.  If monitor_change is chosen, then a security-event will be generated from the SUSE® Security&#8217;s webconsole Notifications &gt; Security events page.</p>
</li>
<li>
<p>filter:  path/filename</p>
</li>
<li>
<p>recursive: true/false</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rbac_support_with_crds"><a class="anchor" href="#_rbac_support_with_crds"></a>RBAC Support with CRDs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Utilizing Kubernetes existing RBAC model, SUSE® Security extends the CRD (Custom Resource Definition) to support RBAC by utilizing Kubernetes&#8217;s Rolebinding in association with the configured Namespace in the SUSE® Security  configured CRD rules when using the NvSecurityRule resource-type. This configured Namespace is then used to enforce the configured Target, which must reside in this namespace configured in the SUSE® Security security policy. When rolebinding a defined clusterrole, this can be used to bind to a Kubernetes User or Group. The two clusterrole resources types that SUSE® Security supports are NvSecurityRule and NvClusterSecurityRule.</p>
</div>
<div class="sect2">
<h3 id="_rolebinding_clusterolebinding_with_2_users_in_different_namespaces_to_a_clusterrole_nvsecurityrules_nvclustersecurityrules_resources"><a class="anchor" href="#_rolebinding_clusterolebinding_with_2_users_in_different_namespaces_to_a_clusterrole_nvsecurityrules_nvclustersecurityrules_resources"></a>Rolebinding &amp; Clusterolebinding with 2 Users in different Namespaces to a Clusterrole (NvSecurityRules &amp; NvClusterSecurityRules resources)</h3>
<div class="paragraph">
<p>The following illustrates a scenario creating one Clusterrole containing both resources (NvSecurityRules and NvClusterSecurityRules) to be bound to two different users.</p>
</div>
<div class="paragraph">
<p>One user (user1) belongs to Namespace (ns1), while the other user (user2) belongs to Namespace (ns2).  User1 will Rolebind to this created Clusterrole (nvsecnvclustrole), while User2 is Clusterrolebind to this same Clusterrole (nvsecnvclustrole).</p>
</div>
<div class="paragraph">
<p>The key takeaway here is to illustrate that using Rolebinding, this will have Namespace-Level-Scope, whereas using Clusterrolebinding will have Cluster-Level-Scope.  User1 will Rolebind (Namespace-Level-Scope), and User2 will be Clusterrolebind (Cluster-Level-Scope).  This matters most during RBAC enforcement based on the scope-level that bounds the created users access.</p>
</div>
</div>
<div class="sect2">
<h3 id="_example_using_2_different_types_of_defined_yaml_files_and_the_effect_of_using_each_user"><a class="anchor" href="#_example_using_2_different_types_of_defined_yaml_files_and_the_effect_of_using_each_user"></a>Example using 2 different types of defined yaml files, and the effect of using each user</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Clusterrole containing both NvSecurityRules and NvClusterSecurityRules resources.</p>
<div class="openblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice that this clusterrole has 2 resources configured, nvsecurityrules and nvclustersecurityrules. Example (nvsecnvclustroles.yaml):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
   name: nvsecnvclustrole
rules:
- apiGroups:
  - neuvector.com
  resources:
  - nvsecurityrules
  - nvclustersecurityrules
  verbs:
  - list
  - delete
  - create
  - get
  - update
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - get
  - list</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Create 2 test yaml-files. One for the NvSecurityRules, and the other for the NvClusterSecurityRules resource.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Sample <code>NvSecurityRules</code> nvsecurity.yaml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: neuvector.com/v1
kind:     NvSecurityRule
metadata:
  name:    ns1crd
  namespace: ns1
spec:
  target:
      selector:
          name: nv.nginx-pod.ns1
          criteria:
          - key: service
            value: nginx-pod.ns1
            op: "="
          - key: domain
            value: ns1
            op: "="
  ingress:
      -
        selector:
            name: ingress
            criteria:
            - key: domain
              value: demo
              op: "="
        ports: "tcp/65535"
        applications:
            - SSL
        action:  allow
        name:    ingress</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sample <code>NvClusterSecurityRules</code> nvclustersecurity.yaml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: neuvector.com/v1
kind:     NvClusterSecurityRule
metadata:
  name:    rbacnvclustmatchnamespacengtargserving
  namespace: nvclusterspace
spec:
  target:
      policymode: Protect
      selector:
          name: nv.nginx-pod.eng
          criteria:
          - key: service
            value: nginx-pod.eng
            op: "="
          - key: domain
            value: eng
            op: "="
  ingress:
      -
        selector:
            name: ingress
            criteria:
            - key: service
              value: nginx-pod.demo
              op: "="
        ports: "tcp/65535"
        applications:
            - SSL
        action:  allow
        name:    ingress</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Switching the user-context to user1 (belongs to the ns1 Namespace) has a Rolebind to the NvSecurityRules resource, who is Namespace bound to the Namespace ns1.  Therefore, importing test yaml file (kubectl create --f nvsecurity.yaml should be allowed since this yaml file configuration has the NvSecurityRules resource and the Namespace that this user is bound to.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If there is an attempt to import the test yaml file (nvclustersecurity.yaml ) however, this will be denied since the import CRD yaml file is defined with the resource NvClusterSecurityRules that has a Cluster-Scope, but user1 was Rolebind with a Namespace-Scope.  Namespace-scope has a lower privilege than Cluster-Scope.  Therefore, Kubernetes RBAC will deny such a request.</p>
</div>
<div class="paragraph">
<p>Example Error Message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Error from server (Forbidden): error when creating "rbacnvclustnamespacengtargnvclustingress.yamltmp": nvclustersecurityrules.neuvector.com is forbidden: User "user1" cannot create resource "nvclustersecurityrules" in API group "neuvector.com" at the cluster scope</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we can switch the user-context to user2 with a broader scope privilege, cluster-level-scope.  This user2 has a Clusterrolebinding that is not Namespace bound, but has a cluster-level-scope, and associates with the NvClusterSecurityRules resource.</p>
</div>
<div class="paragraph">
<p>Therefore, using user2 to import either yaml file (nvsecurity.yaml or nvclustersecurity.yaml) will be allowed, since this user&#8217;s Clusterrolebinding is not restricted to either resource NvSecurityRules (Namespace-Scope) or NvClusterSecurityRules (Cluster-Scope).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expressing_network_rules_ingress_egress_objects_in_crds"><a class="anchor" href="#_expressing_network_rules_ingress_egress_objects_in_crds"></a>Expressing Network Rules (Ingress, Egress objects) in CRDs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Network rules expressed in CRDs have an Ingress and/or Egress object, which define the allowed incoming and outgoing connections (protocols, ports etc) to/from the workload (Group). Each network rule in SUSE® Security must have a unique name in a CRD. Note that in the console, network rules only have a unique ID number.</p>
</div>
<div class="paragraph">
<p>If the 'To' (destination) of the rule is a learned, discovered group, upon export SUSE® Security prepends the 'nv.' identifier to the name. For example "nv.redis-master.demo-ingress-0". For both discovered and custom groups, SUSE® Security also appends a unique name identifier, such as '-ingress-0' in the rule name 'nv.redis-master.demo-ingress-0. For CRD rule names, the 'nv.' identifier is NOT required, and is added to exported rules for clarity. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    ingress:
    - action: allow
      applications:
      - Redis
      name: nv.redis-master.demo-ingress-0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom, user created groups are not allowed to have the 'nv.' prefix. Only discovered/learned groups with the domain and service objects should have the prefix. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - action: allow
      applications:
      - HTTP
      name: nv.node-pod.demo-egress-1
      ports: any
      priority: 0
      selector:
        comment: ""
        criteria:
        - key: service
          op: =
          value: node-pod.demo
        - key: domain
          op: =
          value: demo
        name: nv.node-pod.demo</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customized_configurations_for_deployed_applications"><a class="anchor" href="#_customized_configurations_for_deployed_applications"></a>Customized Configurations for Deployed Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the use of a customized CRD yaml file, this enables you to customize network security rules, file access rules, and process security rules, all bundled into a single configuration file.  There are multiple benefits to allow these customizations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, this allows the same rules to be applied on multiple Kubernetes environments, allowing synchronization among clusters.</p>
</li>
<li>
<p>Second, this allows preemptive rules deployment prior to the applications coming online, which provides a proactive and effective security rules deployment workflow.</p>
</li>
<li>
<p>Third, this allows the policymode to change from an evaluation one (such as Discover or Monitor), to one that protects the final staging environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These CRD rules within a yaml file can be imported into the SUSE® Security security platform through the use of Kubernetes CLI commands such as 'kubectl create --f crd.yaml'.  This empowers the security team to tailor the security rules to be applied upon various containers residing in the Kubernetes environment.</p>
</div>
<div class="paragraph">
<p>For example, a particular yaml file can be configured to enable the policymode to Discover or Monitor a particular container named nv.alpine.ns1 in a staging cluster environment.  Moreover, you can limit ssh access for a configured target container nv.alpine.ns1. to another container nv.redhat.ns2.</p>
</div>
<div class="paragraph">
<p>Once all the necessary tests and evaluations of such security rules are deemed correct, then you can migrate this to a production cluster environment simultaneous to the application deployments by using the SUSE® Security policy migration feature, which will be discussed later in this section.</p>
</div>
<div class="sect2">
<h3 id="_examples_of_crd_configurations_that_perform_these_functions"><a class="anchor" href="#_examples_of_crd_configurations_that_perform_these_functions"></a>Examples of CRD configurations that perform these functions</h3>
<div class="paragraph">
<p>The following is a sample snippet of such configurations</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: neuvector.com/v1
kind:     NvSecurityRule
metadata:
  name:    ns1global
  namespace: ns1              #The target's native namespace
spec:
  target:
      selector:
          name: nv.alpine.ns1
          criteria:
          - key: service
            value: alpine.ns1   #The source target's running container
            op: "="
          - key: domain
            value: ns1
            op: "="
  egress:
      -
        selector:
            name: egress
            criteria:
            - key: service
              value: nv.redhat.ns2      #The destination's running container
              op: "="
        ports:   tcp/22                     #Denies ssh to the destination container nv.redhat.ns2
        applications:
            - SSH
        action:  deny
        name:    egress
  file:                                       #Applies only to the defined target container group
  - app:
    - chmod                              #The application chmod is the only application allowed to access, while all other apps are denied.
    behavior: block_access      #Supported values are block_access and monitor_change.  This blocks access to the defined filter below.
    filter: /tmp/passwd.txt
    recursive: false
  process:
  - action: allow                  #This action has precedence over the file access rule.  This should be allowed if the intent is to allow the file access rule to take effect.
    name: chmod                # This configured should match the application defined under the file section.
    path: /bin/chmod</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above snippet is configured to enforce ssh access from the target group container nv.alpine.ns1 to the egress group nv.redhat.ns2.  In addition, the enforcement of file access and the process rules are defined and applied to the configured target container nv.alpine.ns1.  With this bundled configuration, we have allowed the defined network, file, and process security rules to act upon the configured target group.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policy_groups_and_rules_migration_support"><a class="anchor" href="#_policy_groups_and_rules_migration_support"></a>Policy Groups and Rules Migration Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SUSE® Security supports the exporting of certain SUSE® Security group types from a Kubernetes cluster in a yaml file and importing into another Kubernetes cluster by utilizing native kubectl commands.</p>
</div>
<div class="sect2">
<h3 id="_migration_use_cases"><a class="anchor" href="#_migration_use_cases"></a>Migration Use Cases</h3>
<div class="ulist">
<ul>
<li>
<p>Export tested CRD groups and security rules that are deemed &#8220;production ready&#8221; from a staging k8s cluster environment to a production k8s cluster environment.</p>
</li>
<li>
<p>Export learned security rules to be migrated from a staging k8s environment to a production k8s environment.</p>
</li>
<li>
<p>Allow the modification of the policymode of a configured Target group, for instance, such as Discover or Monitor mode in a staging environment, to Protect mode in a production environment.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supported_export_conditions"><a class="anchor" href="#_supported_export_conditions"></a>Supported Export Conditions</h3>
<div class="ulist">
<ul>
<li>
<p>Target, Ingress, Egress, Self-learned</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_example_of_groups_export"><a class="anchor" href="#_example_of_groups_export"></a>Example of groups export</h3>
<div class="ulist">
<ul>
<li>
<p>Exported groups with a configured attribute as domain=xx are exported with the Resource-Type NvsecurityRule along with the namespace.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/group_crd.png" alt="GroupExport"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_example_of_an_exported_group_yaml_file_with_the_nvsecurityrule_resource_type"><a class="anchor" href="#_example_of_an_exported_group_yaml_file_with_the_nvsecurityrule_resource_type"></a>Example of an exported group yaml file with the NvsecurityRule resource type</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  kind: NvSecurityRule
  metadata:
    name: nv.nginx-pod.neuvector
    namespace: neuvector
  spec:
    egress: []
    file: []
    ingress: []
    process: []
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: nginx-pod.neuvector
        - key: domain
          op: =
          value: neuvector
        name: nv.nginx-pod.neuvector
      policymode: Discover</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Exported groups without the defined criteria as domain=xx (Namespace) are exported with a Resource-Type NvClusterSecurityRule and a Namespace as default.  Examples of Exported groups without a Namespace are external, container, etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_example_of_an_exported_group_yaml_file_with_the_nvclustersecurityrule_resource_type"><a class="anchor" href="#_example_of_an_exported_group_yaml_file_with_the_nvclustersecurityrule_resource_type"></a>Example of an exported group yaml file with the NvClusterSecurityRule resource type</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  kind: NvClusterSecurityRule
  metadata:
    name: egress
    namespace: default
  spec:
    egress: []
    file:             #File path profile applicable to the Target group only, and only applies to self-learned and user create groups
    - app:
      - vi
      - cat
      behavior: block_access
      filter: /etc/mysecret              #Only vi and cat can access this file with “block_access”.
      recursive: false
    ingress:
    - selector:
        criteria:
        - key: service
          op: =
          value: nginx-pod.neuvector
        - key: domain
          op: =
          value: neuvector
        name: nv.nginx-pod.neuvector     #Group Name
      action: allow
      applications:
      - Apache
      - ElasticSearch
      name: egress-ingress-0             #Policy Name
      ports: tcp/9400
    process:      #Process profile applicable to the Target group only, and only applies to self-learned and user create groups.
       - action: deny     #Possible values are deny and allow
          name: ls
          path: /bin/ls        #This example shows it denies the ls command for this target.
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: nginx-pod.demo
        name: egress                     #Group Name
      policymode: null
- apiVersion: neuvector.com/v1
  kind: NvSecurityRule
  metadata:
    name: ingress
    namespace: demo
  spec:</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The CRD import behavior ignores the PolicyMode of any 'linked' group, leaving the Policy mode unchanged if the linked group already exists. If the linked group does not exist it will be automatically created and set to the default New Services Mode in Settings &#8594; Configuration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_unsupported_export_group_types"><a class="anchor" href="#_unsupported_export_group_types"></a>Unsupported Export Group-Types</h3>
<div class="ulist">
<ul>
<li>
<p>Federated</p>
</li>
<li>
<p>IP-Based (unsupported for learned service IP only, custom user created IP groups are supported)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_import_scenarios"><a class="anchor" href="#_import_scenarios"></a>Import Scenarios</h3>
<div class="ulist">
<ul>
<li>
<p>The import will create new groups in the destination system if the groups do not yet exist in the destination environment, and the currently used Kubernetes user-context has the necessary permissions to access the namespaces configured in the CRD-yaml file to be imported.</p>
</li>
<li>
<p>If the imported group exists in the destination system with different criteria or values, the import will be rejected.</p>
</li>
<li>
<p>If the imported group exists in the destination system with identical configurations, we will reuse the existing group with different type.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_crd_samples_for_global_rules"><a class="anchor" href="#_crd_samples_for_global_rules"></a>CRD Samples for Global Rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sample CRD below has two parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first part is a NvClusterSecurityRule for the group named containers:
The target for this NvClusterSecurityRule is all containers. It has an ingress policy that does not allow any external connections (outside your cluster) to ssh into your containers. It also denies all containers from using the ssh process.  This defined global behavior applies to all containers.</p>
</li>
<li>
<p>The second part is a NvSecurityRule for alpine services:
The target is a service called nv.alpine.default in the 'default' namespace. Because it belongs to the all containers, it will inherit the above network policy and process rule. It also adds rules that don&#8217;t not allow connections of HTTP traffic through port 80 to an external network. Also it not allow the running of the scp process.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that for service nv.alpine.default (defined as nv.xxx.yyy where xxx is the service name like alpine, yyy is the namespace like default) we can define policy mode that it is set to. Here it is defined as Protect mode (blocking all abnormal activity).</p>
</div>
<div class="paragraph">
<p>Overall since nv.alpine.defult is in protect mode, it will deny containers from running ssh and scp, and also will deny ssh connections from external or http to external.</p>
</div>
<div class="paragraph">
<p>If you change the nv.alpine.defult policymode to monitor, then SUSE® Security will just log it when scp/ssh is invoked, or there are ssh connections from external or http to external.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
items:
- apiVersion: neuvector.com/v1
  kind: NvClusterSecurityRule
  metadata:
    name: containers
    namespace: default
  spec:
    egress: []
    file: []
    ingress:
    - selector:
        criteria: []
        name: external
      action: deny
      applications:
      - SSH
      name: containers-ingress-0
      ports: tcp/22
    process:
    - action: deny
      name: ssh
      path: /bin/ssh
    target:
      selector:
        criteria:
        - key: container
          op: =
          value: '*'
        name: containers
      policymode: null
- apiVersion: neuvector.com/v1
  kind: NvSecurityRule
  metadata:
    name: nv.alpine.default
    namespace: default
  spec:
    egress:
    - selector:
        criteria: []
        name: external
      action: deny
      applications:
      - HTTP
      name: external-egress-0
      ports: tcp/80
    file: []
    ingress: []
    process:
    - action: deny
      name: scp
      path: /bin/scp
    target:
      selector:
        criteria:
        - key: service
          op: =
          value: alpine.default
        - key: domain
          op: =
          value: default
        name: nv.alpine.default
      policymode: Protect
kind: List
metadata: null</code></pre>
</div>
</div>
<div class="paragraph">
<p>To allow, or whitelist a process such as a monitoring process to run, just add a process rule with action: allow for the process name, and add the path.  The path must be specified for allow rules but is optional for deny rules.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_crd_rules_and_adding_to_existing_groups"><a class="anchor" href="#_updating_crd_rules_and_adding_to_existing_groups"></a>Updating CRD Rules and Adding to Existing Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Updating the CRD generated rules in SUSE® Security is as simple as updating the appropriate yaml file and applying the update:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f &lt;crdrule.yaml&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_criteria_support_for_nvclustersecurityrule"><a class="anchor" href="#_dynamic_criteria_support_for_nvclustersecurityrule"></a>Dynamic criteria support for NvClusterSecurityRule</h3>
<div class="paragraph">
<p>Multiple CRDs which change the criteria for existing custom group(s) are supported. This feature also allows the user to apply multiple CRDs at once, where the SUSE® Security behavior is to accept and queue the CRD so the immediate response to the user is always success.  During processing, any errors are reported into the console Notifications &#8594; Events.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="federated.html">Federated Policy</a></span>
  <span class="next"><a href="import.html">Importing CRD from Console</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
