<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Backup and Restore :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/backup_restore.html">
    <link rel="prev" href="external.html">
    <link rel="next" href="../architecture.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-08-13"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/backup_restore.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/backup_restore.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/backup_restore.html" hrefLang="en-US" rel="alternate" />





<!-- Link for the Chinese page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/datastore/backup_restore.html" hreflang="zh-CN" rel="alternate" />






<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="rke2" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">RKE2</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/quickstart.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/configuration.html">Configuration Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/ha.html">High Availability</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/methods.html">Installation Methods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/private_registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/registry_mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/containerd_registry_configuration.html">Containerd Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/airgap.html">Air-Gap Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/windows_airgap.html">Windows Air-Gap Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/server_roles.html">Managing Server Roles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/packaged_components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/uninstall.html">Uninstall</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/upgrade.html">Upgrading SUSE® Rancher Prime: RKE2 Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/manual_upgrade.html">Manual Upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/automated_upgrade.html">Automated Upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/roll_back.html">Rolling Back RKE2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/about_hardened_images.html">About Hardened Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/hardening_guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment19.html">CIS 1.9 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment18.html">CIS 1.8 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment17.html">CIS 1.7 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/fips_support.html">FIPS 140-2 Enablement</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_policies.html">Default Pod Security Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_standards.html">Default Pod Security Standards</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/secrets_encryption.html">Secrets Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/selinux.html">SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/certificates.html">Certificate Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/token.html">Token Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Datastore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="embedded.html">Embedded datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="external.html">External Datastore</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="backup_restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster_access.html">Cluster Access</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../import_images.html">Import Images</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic_network_options.html">Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus_sriov.html">Multus and SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking_services.html">Networking Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/windows_bgp.html">Windows and BGP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">Advanced Options and Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/cli_tools.html">CLI Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/linux_agent_config.html">Agent Configuration Reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource_profiling.html">Resource Profiling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/server_config.html">Server Configuration Reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/windows_agent_config.html">Windows Agent Configuration Reference</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known_issues.html">Known Issues and Limitations</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RKE2</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/rke2" title="RKE2" aria-label="SUSE Documentation - RKE2">
        RKE2
      </a>
    </li>
      <li>
          Datastore
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/rke2-product-docs/edit/main/versions/latest/modules/en/pages/datastore/backup_restore.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:rke2" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Backup and Restore</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">If using external databases or SQLite</div>
<div class="paragraph">
<p>Snapshots are for embedded etcd only, if you use another datastore with <code>datastore-endpoint</code> config go to <a href="#_external_db_backups_experimental">Experimental</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_snapshots"><a class="anchor" href="#_creating_snapshots"></a>Creating Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Snapshots are enabled by default.</p>
</div>
<div class="paragraph">
<p>The snapshot directory defaults to <code>/var/lib/rancher/rke2/server/db/snapshots</code>.</p>
</div>
<div class="paragraph">
<p>To configure the snapshot interval or the number of retained snapshots, refer to the <a href="#_options">options</a>.</p>
</div>
<div class="paragraph">
<p>In RKE2, snapshots are stored on each etcd node. If you have multiple etcd or etcd + control-plane nodes, you will have multiple copies of local etcd snapshots.</p>
</div>
<div class="paragraph">
<p>You can take a snapshot manually while RKE2 is running with the <code>etcd-snapshot</code> subcommand. For example: <code>rke2 etcd-snapshot save --name pre-upgrade-snapshot</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cluster_reset"><a class="anchor" href="#_cluster_reset"></a>Cluster Reset</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RKE2 enables a feature to reset the cluster to one member cluster by passing <code>--cluster-reset</code> flag, when passing this flag to RKE2 server it will reset the cluster with the same data dir in place, the data directory for etcd exists in <code>/var/lib/rancher/rke2/server/db/etcd</code>, this flag can be passed in the events of quorum loss in the cluster.</p>
</div>
<div class="paragraph">
<p>To pass the reset flag, first you need to stop RKE2 service if its enabled via systemd:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl stop rke2-server
rke2 server --cluster-reset</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Result:</strong>  A message in the logs say that RKE2 can be restarted without the flags. Start RKE2 again and it should start RKE2 as a 1 member cluster.</p>
</div>
<div class="sect2">
<h3 id="_restoring_a_snapshot_to_existing_nodes"><a class="anchor" href="#_restoring_a_snapshot_to_existing_nodes"></a>Restoring a Snapshot to Existing Nodes</h3>
<div class="paragraph">
<p>When RKE2 is restored from backup, the old data directory will be moved to <code>/var/lib/rancher/rke2/server/db/etcd-old-%date%/</code>. RKE2 will then attempt to restore the snapshot by creating a new data directory and start etcd with a new RKE2 cluster with one etcd member.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You must stop RKE2 service on all server nodes if it is enabled via systemd. Use the following command to do so:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl stop rke2-server</code></pre>
</div>
</div>
</li>
<li>
<p>Next, you will initiate the restore from snapshot on the first server node with the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 server \
  --cluster-reset \
  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Once the restore process is complete, start the rke2-server service on the first server node as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start rke2-server</code></pre>
</div>
</div>
</li>
<li>
<p>Remove the RKE2 db directory on the other server nodes as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf /var/lib/rancher/rke2/server/db</code></pre>
</div>
</div>
</li>
<li>
<p>Start the rke2-server service on other server nodes with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start rke2-server</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Result:</strong>  After a successful restore, a message in the logs says that etcd is running, and RKE2 can be restarted without the flags. Start RKE2 again, and it should run successfully and be restored from the specified snapshot.</p>
</div>
<div class="paragraph">
<p>When RKE2 resets the cluster, it creates an empty file at <code>/var/lib/rancher/rke2/server/db/reset-flag</code>. This file is harmless to leave in place, but must be removed in order to perform subsequent resets or restores. This file is deleted when RKE2 starts normally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restoring_a_snapshot_to_new_nodes"><a class="anchor" href="#_restoring_a_snapshot_to_new_nodes"></a>Restoring a Snapshot to New Nodes</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Back up the token server: <code>/var/lib/rancher/rke2/server/token</code> in case you will not use the same one. The token server is used to decrypt the bootstrap data inside the snapshot.</p>
</li>
<li>
<p>Stop RKE2 service on all server nodes if it is enabled and initiate the restore from snapshot on the first server node with the following commands:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl stop rke2-server
rke2 server \
  --cluster-reset \
  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;
  --token=&lt;BACKED-UP-TOKEN-VALUE&gt;</pre>
</div>
</div>
</li>
<li>
<p>Once the restore process is complete, start the rke2-server service on the first server node as follows:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl start rke2-server</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The node where the snapshot was taken will appear as <code>NotReady</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can continue to add new server and worker nodes to cluster per standard <a href="../install/ha.html#_3_launch_additional_server_nodes" class="xref page">RKE2 HA installation documentation</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_other_notes_on_restoring_a_snapshot"><a class="anchor" href="#_other_notes_on_restoring_a_snapshot"></a>Other Notes on Restoring a Snapshot</h3>
<div class="ulist">
<ul>
<li>
<p>When performing a restore from backup, users do not need to restore a snapshot using the same version of RKE2 with which the snapshot was created. Users may restore using a more recent version. Be aware when changing versions at restore which etcd version is in use.</p>
</li>
<li>
<p>If an etcd-s3 backup configuration is defined within the RKE2 <a href="../install/configuration.html" class="xref page">config file</a>, the rke2 restore will attempt to pull the snapshot file from the configured S3 bucket. In this instance only the snapshot filename should be passed in the argument <code>--cluster-reset-restore-path</code>. To restore from a local snapshot file, where an etcd-s3 backup configuration is present, add the argument <code>--etcd-s3=false</code> and pass the full path to the local snapshot file in the argument <code>--cluster-reset-restore-path</code>.</p>
</li>
<li>
<p>By default, snapshots are enabled and are scheduled to be taken every 12 hours. The snapshots are written to <code>${data-dir}/server/db/snapshots</code> with the default <code>${data-dir}</code> being <code>/var/lib/rancher/rke2</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_s3_compatible_api_support"><a class="anchor" href="#_s3_compatible_api_support"></a>S3 Compatible API Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RKE2 supports writing etcd snapshots to and restoring etcd snapshots from systems with S3-compatible APIs. S3 support is available for both on-demand and scheduled snapshots.</p>
</div>
<div class="paragraph">
<p>The arguments below exist for both the <code>server</code> and <code>etcd-snapshot</code> subcommands.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable backup to S3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 endpoint url</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-endpoint-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 custom CA cert to connect to S3 endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-skip-ssl-verify</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables S3 SSL certificate validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-access-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 access key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-secret-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 secret key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-bucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 bucket name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-region</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 region / bucket location (optional). defaults to us-east-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-folder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-insecure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables S3 over HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 timeout. Defaults to 30s</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Flag Aliases</div>
<div class="paragraph">
<p>For the <code>etcd-snapshot</code> subcommand, the <code>--etcd-s3</code> flags are aliased to <code>--s3</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform an on-demand etcd snapshot and save it to S3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 etcd-snapshot save \
  --s3 \
  --s3-bucket=&lt;S3-BUCKET-NAME&gt; \
  --s3-access-key=&lt;S3-ACCESS-KEY&gt; \
  --s3-secret-key=&lt;S3-SECRET-KEY&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To perform an S3 etcd snapshot restore, first make sure that RKE2 isn&#8217;t running. Then execute the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 server \
  --cluster-reset \
  --etcd-s3 \
  --cluster-reset-restore-path=&lt;SNAPSHOT-NAME&gt; \
  --etcd-s3-bucket=&lt;S3-BUCKET-NAME&gt; \
  --etcd-s3-access-key=&lt;S3-ACCESS-KEY&gt; \
  --etcd-s3-secret-key=&lt;S3-SECRET-KEY&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_snapshot_configuration"><a class="anchor" href="#_snapshot_configuration"></a>Snapshot Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_options"><a class="anchor" href="#_options"></a>Options</h3>
<div class="paragraph">
<p>These options can be set in the <a href="../install/configuration.html" class="xref page">configuration file</a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etcd-disable-snapshots</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable automatic etcd snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etcd-snapshot-schedule-cron</code> value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot interval time in cron spec. eg. every 4 hours <code>0 */4 * * *</code>. Defaults is every 12 hours <code>0 */12 * * *</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etcd-snapshot-retention</code> value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of snapshots to retain. Defaults to 5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etcd-snapshot-dir</code> value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory to save db snapshots. Default location: <code>${data-dir}/db/snapshots</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-reset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forget all peers and become sole member of a new cluster. This can also be set with the environment variable <code>[$RKE2_CLUSTER_RESET]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-reset-restore-path</code> value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to snapshot file to be restored</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>etcd-snapshot-compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compress etcd snapshots</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_list_snapshots"><a class="anchor" href="#_list_snapshots"></a>List Snapshots</h3>
<div class="paragraph">
<p>You can list local snapshots with the <code>etcd-snapshot ls</code> subcommand.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prune_snapshots"><a class="anchor" href="#_prune_snapshots"></a>Prune Snapshots</h3>
<div class="paragraph">
<p>Snapshots are pruned automatically when the number of snapshots exceeds the configured retention count. The oldest snapshots are removed first.</p>
</div>
<div class="paragraph">
<p>You can manually prune "on-demand" snapshots down to a smaller amount using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 etcd-snapshot prune --etcd-snapshot-retention &lt;NUM-OF-SNAPSHOTS-TO-RETAIN&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can manually prune "scheduled" snapshots down to a smaller amount using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 etcd-snapshot prune --name etcd-snapshot --etcd-snapshot-retention &lt;NUM-OF-SNAPSHOTS-TO-RETAIN&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_db_backups_experimental"><a class="anchor" href="#_external_db_backups_experimental"></a>External DB Backups (Experimental)</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to backing up the datastore itself, you must also back up the server token file at <code>/var/lib/rancher/rke2/server/token</code>. You must restore this file, or pass its value into the <code>token</code> option, when restoring from backup. If you do not use the same token value when restoring, the snapshot will be unusable, as the token is used to encrypt confidential data within the datastore itself.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_backup_and_restore_with_sqlite"><a class="anchor" href="#_backup_and_restore_with_sqlite"></a>Backup and Restore with SQLite</h3>
<div class="paragraph">
<p>No special commands are required to back up or restore the SQLite datastore.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To back up the SQLite datastore, take a copy of <code>/var/lib/rancher/rke2/server/db/</code>.</p>
</li>
<li>
<p>To restore the SQLite datastore, restore the contents of <code>/var/lib/rancher/rke2/server/db</code> (and the token, as discussed above).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_backup_and_restore_with_external_datastore"><a class="anchor" href="#_backup_and_restore_with_external_datastore"></a>Backup and Restore with External Datastore</h3>
<div class="paragraph">
<p>When an external datastore is used, backup and restore operations are handled outside of RKE2. The database administrator will need to back up the external database, or restore it from a snapshot or dump.</p>
</div>
<div class="paragraph">
<p>We recommend configuring the database to take recurring snapshots.</p>
</div>
<div class="paragraph">
<p>For details on taking database snapshots and restoring your database from them, refer to the official database documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/replication-snapshot-method.html">Official MySQL documentation</a></p>
</li>
<li>
<p><a href="https://www.postgresql.org/docs/15/backup-dump.html">Official PostgreSQL documentation</a></p>
</li>
<li>
<p><a href="https://etcd.io/docs/latest/op-guide/recovery/">Official etcd documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="external.html">External Datastore</a></span>
  <span class="next"><a href="../architecture.html">Architecture</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
