<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Embedded Registry Mirror :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/rke2/latest/zh/install/registry_mirror.html">
    <link rel="prev" href="private_registry.html">
    <link rel="next" href="containerd_registry_configuration.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-10-29"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/install/registry_mirror.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/install/registry_mirror.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/install/registry_mirror.html" hrefLang="zh-CN" rel="alternate" />


<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/install/registry_mirror.html" hreflang="en-US" rel="alternate" />









<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="rke2" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">RKE2</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">介绍</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart.html">快速开始</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="requirements.html">要求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">配置选项</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ha.html">高可用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="methods.html">安装方法</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="private_registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="registry_mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="containerd_registry_configuration.html">Containerd 镜像仓库配置</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="airgap.html">离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="windows_airgap.html">Windows 离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="server_roles.html">管理 Server 角色</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="packaged_components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="uninstall.html">卸载</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/upgrade.html">升级 SUSE® Rancher Prime: RKE2 集群</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/manual_upgrade.html">手动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/automated_upgrade.html">自动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/roll_back.html">Rolling Back RKE2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/about_hardened_images.html">强化镜像</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/hardening_guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment19.html">CIS 1.9 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment18.html">CIS 1.8 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment17.html">CIS 1.7 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/fips_support.html">FIPS 140-2 启用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_policies.html">默认 Pod 安全策略</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_standards.html">默认 Pod 安全标准</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/secrets_encryption.html">Secrets Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/selinux.html">SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/certificates.html">Certificate Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/token.html">Token Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Datastore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/embedded.html">Embedded datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/external.html">External Datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/backup_restore.html">备份与恢复</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">下一代 Kubernetes 发行版剖析</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster_access.html">集群访问</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../import_images.html">Import Images</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic_network_options.html">Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus_sriov.html">Multus and SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking_services.html">Networking Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/windows_bgp.html">Windows and BGP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm 集成</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高级选项和配置</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/cli_tools.html">CLI 工具</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/linux_agent_config.html">Agent 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/logging.html">日志</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource_profiling.html">Resource Profiling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/server_config.html">Server 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/windows_agent_config.html">Windows Agent 配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known_issues.html">已知问题和限制</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RKE2</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/rke2" title="RKE2" aria-label="SUSE Documentation - RKE2">
        RKE2
      </a>
    </li>
      <li>
          Installation
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/rke2-product-docs/edit/main/versions/latest/modules/zh/pages/install/registry_mirror.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:rke2" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Embedded Registry Mirror</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>The Embedded Registry Mirror is available as an experimental feature as of January 2024 releases: v1.26.13+rke2r1, v1.27.10+rke2r1, v1.28.6+rke2r1, v1.29.1+rke2r1 and GA as of December 2024 releases: v1.29.12+rke2r1,v1.30.8+rke2r1, v1.31.4+rke2r1.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RKE2 embeds <a href="https://github.com/spegel-org/spegel">Spegel</a>, a stateless distributed OCI registry mirror that allows peer-to-peer sharing of container images between nodes in a Kubernetes cluster. The distributed registry mirror is disabled by default. For RKE2 to leverage it, you must enable both the <a href="#_enabling_the_distributed_oci_registry_mirror">Distributed OCI Registry Mirror</a> and the <a href="#_enabling_registry_mirroring">Registry mirroring</a> as explained in the following subsections.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_the_distributed_oci_registry_mirror"><a class="anchor" href="#_enabling_the_distributed_oci_registry_mirror"></a>Enabling The Distributed OCI Registry Mirror</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to enable the embedded registry mirror, server nodes must be configured with <code>embedded-registry: true</code>. This option enables the embedded mirror for use on all nodes in the cluster.</p>
</div>
<div class="paragraph">
<p>When enabled at a cluster level, all nodes will host a local OCI registry on port 9345, and publish a list of available images via a peer to peer network on port 5001. Any image available in the containerd image store on any node, can be pulled by other cluster members without access to an external registry. Images imported via <a href="airgap.html#_tarball_method" class="xref page">air-gap image tar files</a> or <a href="../import_images.html#_pre_import_images" class="xref page">pre-imported</a> are pinned in containerd to ensure that they remain available and are not pruned by Kubelet garbage collection.</p>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>Requirements</h3>
<div class="paragraph">
<p>When the embedded registry mirror is enabled, all nodes must be able to reach each other via their internal IP addresses, on TCP ports 5001 and 9345. If nodes cannot reach each other, it may take longer for images to be pulled, as the distributed registry will be tried first by containerd, before it falls back to other endpoints.</p>
</div>
</div>
<div class="sect2">
<h3 id="_metrics"><a class="anchor" href="#_metrics"></a>Metrics</h3>
<div class="paragraph">
<p>Spegel provides a few metrics that can be helpful to track its activity and can be queried in the supervisor. However, the supervisor metrics are disabled by default. To enable them, server nodes must be started with <code>supervisor-metrics: true</code> in the configuration file.</p>
</div>
<div class="paragraph">
<p>Once enabled, query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl get --server https://$SERVER_NAME:9345 --raw /metrics | grep spegel</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_registry_mirroring"><a class="anchor" href="#_enabling_registry_mirroring"></a>Enabling Registry Mirroring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enabling mirroring for a registry allows a node to both pull images from that registry from other nodes, and share the registry&#8217;s images with other nodes. If a registry is enabled for mirroring on some nodes, but not on others, only the nodes with the registry enabled will exchange images from that registry.</p>
</div>
<div class="paragraph">
<p>In order to enable mirroring of images from an upstream container registry, nodes must have an entry in the <code>mirrors</code> section of <code>registries.yaml</code> for that registry. The registry does not need to have any endpoints listed, it just needs to be present. For example, to enable distributed mirroring of images from <code>docker.io</code> and <code>registry.k8s.io</code>, configure <code>registries.yaml</code> with the following content on all cluster nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
  registry.k8s.io:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Endpoints for registry mirrors may also be added as usual. In the following configuration, images pull attempts will first try the embedded mirror, then <code>mirror.example.com</code>, then finally <code>docker.io</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:
    endpoint:
      - https://mirror.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using a private registry directly, instead of as a mirror for an upstream registry, you may enable distributed mirroring in the same way public registries are enabled - by listing it in the mirrors section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  mirror.example.com:</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>Wildcard support is available as of the March 2024 releases: v1.26.15+rke2r1, v1.27.12+rke2r1, v1.28.8+rke2r1, v1.29.3+rke2r1</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>"*"</code> wildcard mirror entry can be used to enable distributed mirroring of all registries. Note that the asterisk MUST be quoted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  "*":</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no registries are enabled for mirroring on a node, that node does not participate in the distributed registry in any capacity.</p>
</div>
<div class="paragraph">
<p>For more information on the structure of the <code>registries.yaml</code> file, see <a href="private_registry.html" class="xref page">Private Registry Configuration</a>.</p>
</div>
<div class="sect2">
<h3 id="_default_endpoint_fallback"><a class="anchor" href="#_default_endpoint_fallback"></a>Default Endpoint Fallback</h3>
<div class="paragraph">
<p>By default, containerd will fall back to the default endpoint when pulling from registries with mirror endpoints configured. If you want to disable this, and only pull images from the configured mirrors and/or the embedded mirror, see the <a href="private_registry.html#_default_endpoint_fallback" class="xref page">Default Endpoint Fallback</a> section of the Private Registry Configuration documentation.</p>
</div>
<div class="paragraph">
<p>Note that if you are using the <code>disable-default-endpoint</code> option and want to allow pulling directly from a particular registry, while disallowing the rest, you can explicitly provide an endpoint in order to allow the image pull to fall back to the registry itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirrors:
  docker.io:           # no default endpoint, pulls will fail if not available on a node
  registry.k8s.io:     # no default endpoint, pulls will fail if not available on a node
  mirror.example.com:  # explicit default endpoint, can pull from upstream if not available on a node
    endpoint:
      - https://mirror.example.com</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_latest_tag"><a class="anchor" href="#_latest_tag"></a>Latest Tag</h3>
<div class="paragraph">
<p>When no tag is specified for a container image, the implicit default tag is <code>latest</code>. This tag is frequently updated to point at the most recent version of the image. Because this tag will point at a different revisions of an image depending on when it is pulled, the distributed registry <strong>will not</strong> pull the <code>latest</code> tag from other nodes. This forces containerd go out to an upstream registry or registry mirror to ensure a consistent view of what the <code>latest</code> tag refers to.</p>
</div>
<div class="paragraph">
<p>This aligns with the <a href="https://kubernetes.io/docs/concepts/containers/images/#imagepullpolicy-defaulting">special <code>imagePullPolicy</code> defaulting</a> observed by Kubernetes when using the <code>latest</code> tag for a container image.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security"><a class="anchor" href="#_security"></a>Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_authentication"><a class="anchor" href="#_authentication"></a>Authentication</h3>
<div class="paragraph">
<p>Access to the embedded mirror&#8217;s registry API requires a valid client certificate, signed by the cluster&#8217;s client certificate authority.</p>
</div>
<div class="paragraph">
<p>Access to the distributed hash table&#8217;s peer-to-peer network requires a preshared key that is controlled by server nodes. Nodes authenticate each other using both the preshared key, and a certificate signed by the cluster certificate authority.</p>
</div>
</div>
<div class="sect2">
<h3 id="_potential_concerns"><a class="anchor" href="#_potential_concerns"></a>Potential Concerns</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The distributed registry is built on peer-to-peer principles, and assumes an equal level of privilege and trust between all cluster members. If this does not match your cluster&#8217;s security posture, you should not enable the embedded distributed registry.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The embedded registry may make available images that a node may not otherwise have access to. For example, if some of your images are pulled from a registry, project, or repository that requires authentication via Kubernetes Image Pull Secrets, or credentials in <code>registries.yaml</code>, the distributed registry will allow other nodes to share those images without providing any credentials to the upstream registry.</p>
</div>
<div class="paragraph">
<p>Users with access to push images into the containerd image store on one node may be able to use this to 'poison' the image for other cluster nodes, as other nodes will trust the tag advertised by the node, and use it without checking with the upstream registry. If image integrity is important, you should use image digests instead of tags, as the digest cannot be poisoned in this manner.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sharing_air_gap_or_manually_loaded_images"><a class="anchor" href="#_sharing_air_gap_or_manually_loaded_images"></a>Sharing Air-gap or Manually Loaded Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Images sharing is controlled based on the source registry. Images loaded directly into containerd via <a href="airgap.html#_tarball_method" class="xref page">air-gap tarballs</a>, <a href="../import_images.html#_pre_import_images" class="xref page">pre-imported</a> or loaded directly into containerd&#8217;s image store using the <code>ctr</code> command line tool, will be shared between nodes if they are tagged as being from a registry that is enabled for mirroring.</p>
</div>
<div class="paragraph">
<p>Note that the upstream registry that the images appear to come from does not actually have to exist or be reachable. For example, you could tag images as being from a fictitious upstream registry, and import those images into containerd&#8217;s image store. You would then be able to pull those images from all cluster members, as long as that registry is listed in <code>registries.yaml</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pushing_images"><a class="anchor" href="#_pushing_images"></a>Pushing Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The embedded registry is read-only, and cannot be pushed to directly using <code>docker push</code> or other common tools that interact with OCI registries.</p>
</div>
<div class="paragraph">
<p>Images can be manually made available via the embedded registry by running <code>ctr -n k8s.io image pull</code> to pull an image, or by loading image archives created by <code>docker save</code> via the <code>ctr -n k8s.io image import</code> command or the <a href="../import_images.html#_pre_import_images" class="xref page">pre-import feature</a>. Note that the <code>k8s.io</code> namespace must be specified when managing images via <code>ctr</code> in order for them to be visible to the kubelet.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="private_registry.html">Private Registry Configuration</a></span>
  <span class="next"><a href="containerd_registry_configuration.html">Containerd 镜像仓库配置</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
