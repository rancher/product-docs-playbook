<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>External Datastore :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/rke2/latest/zh/datastore/external.html">
    <link rel="prev" href="embedded.html">
    <link rel="next" href="backup_restore.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-08-08"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/datastore/external.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/external.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/datastore/external.html" hrefLang="zh-CN" rel="alternate" />


<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/external.html" hreflang="en-US" rel="alternate" />









<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="rke2" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">RKE2</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">介绍</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/quickstart.html">快速开始</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/requirements.html">要求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/configuration.html">配置选项</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/ha.html">高可用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/methods.html">安装方法</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/private_registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/registry_mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/containerd_registry_configuration.html">Containerd 镜像仓库配置</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/airgap.html">离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/windows_airgap.html">Windows 离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/server_roles.html">管理 Server 角色</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/packaged_components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/uninstall.html">卸载</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/upgrade.html">升级 SUSE® Rancher Prime: RKE2 集群</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/manual_upgrade.html">手动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/automated_upgrade.html">自动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/roll_back.html">Rolling Back RKE2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/about_hardened_images.html">强化镜像</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/hardening_guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment19.html">CIS 1.9 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment18.html">CIS 1.8 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment17.html">CIS 1.7 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/fips_support.html">FIPS 140-2 启用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_policies.html">默认 Pod 安全策略</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_standards.html">默认 Pod 安全标准</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/secrets_encryption.html">Secrets Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/selinux.html">SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/certificates.html">Certificate Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/token.html">Token Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Datastore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="embedded.html">Embedded datastore</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="external.html">External Datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="backup_restore.html">备份与恢复</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">下一代 Kubernetes 发行版剖析</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster_access.html">集群访问</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../import_images.html">Import Images</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic_network_options.html">Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus_sriov.html">Multus and SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking_services.html">Networking Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/windows_bgp.html">Windows and BGP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm 集成</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高级选项和配置</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/cli_tools.html">CLI 工具</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/linux_agent_config.html">Agent 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/logging.html">日志</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource_profiling.html">Resource Profiling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/server_config.html">Server 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/windows_agent_config.html">Windows Agent 配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known_issues.html">已知问题和限制</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RKE2</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/rke2" title="RKE2" aria-label="SUSE Documentation - RKE2">
        RKE2
      </a>
    </li>
      <li>
          Datastore
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/rke2-product-docs/edit/main/versions/latest/modules/zh/pages/datastore/external.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:rke2" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">External Datastore</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Using an external datastore means leveraging a database that resides outside the Kubernetes cluster. Instead of being contained within the cluster, Kubernetes access the external datastore over the network. This approach could be common for organizations with existing database infrastructure or those who have more experience operating an enterprise-grade SQL database like MySQL or PostgreSQL. The project <a href="https://github.com/k3s-io/kine">kine</a> is used for SQL databases. The alternative to external datastore is <a href="embedded.html" class="xref page">embedded datastore</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_datastore_options"><a class="anchor" href="#_datastore_options"></a>Datastore Options</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>External Database</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://etcd.io/">etcd</a> (certified against version 3.5.4)</p>
</li>
<li>
<p><a href="https://www.mysql.com">MySQL</a> (certified against versions 5.7 and 8.0)</p>
</li>
<li>
<p><a href="https://mariadb.org/">MariaDB</a> (certified against version 10.6.8)</p>
</li>
<li>
<p><a href="https://www.postgresql.org/">PostgreSQL</a> (certified against versions 12.16, 13.12, 14.9 and 15.4)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Prepared Statement Support</div>
<div class="paragraph">
<p>RKE2 requires prepared statements support from the DB. This means that connection poolers such as <a href="https://www.pgbouncer.org/faq.html#how-to-use-prepared-statements-with-transaction-pooling">PgBouncer</a> may require additional configuration to work with RKE2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_external_datastore_configuration_parameters"><a class="anchor" href="#_external_datastore_configuration_parameters"></a>External Datastore Configuration Parameters</h3>
<div class="paragraph">
<p>If you wish to use an external datastore such as PostgreSQL, MySQL, or etcd you must set the <code>datastore-endpoint</code> config so that RKE2 knows how to connect to it. You may also specify parameters to configure the authentication and encryption of the connection. The below table summarizes these options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Environment Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datastore-endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RKE2_DATASTORE_ENDPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a PostgreSQL, MySQL, or etcd connection string. This is a string used to describe the connection to the datastore. The structure of this string is specific to each backend and is detailed below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datastore-cafile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RKE2_DATASTORE_CAFILE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS Certificate Authority (CA) file used to help secure communication with the datastore. If your datastore serves requests over TLS using a certificate signed by a custom certificate authority, you can specify that CA using this parameter so that the RKE2 client can properly verify the certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datastore-certfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RKE2_DATASTORE_CERTFILE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS certificate file used for client certificate based authentication to your datastore. To use this feature, your datastore must be configured to support client certificate based authentication. If you specify this parameter, you must also specify the <code>datastore-keyfile</code> parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datastore-keyfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RKE2_DATASTORE_KEYFILE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS key file used for client certificate based authentication to your datastore. See the previous <code>datastore-certfile</code> parameter for more details.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_datastore_endpoint_format_and_functionality"><a class="anchor" href="#_datastore_endpoint_format_and_functionality"></a>Datastore Endpoint Format and Functionality</h3>
<div class="paragraph">
<p>As mentioned, the format of the value passed to the <code>datastore-endpoint</code> parameter is dependent upon the datastore backend. The following details this format and functionality for each supported external datastore.</p>
</div>
<div id="_tabs_1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_postgresql" class="tab">
<p>PostgreSQL</p>
</li>
<li id="_tabs_1_mysql_mariadb" class="tab">
<p>MySQL / MariaDB</p>
</li>
<li id="_tabs_1_etcd" class="tab">
<p>etcd</p>
</li>
</ul>
</div>
<div id="_tabs_1_postgresql--panel" class="tabpanel" aria-labelledby="_tabs_1_postgresql">
<div class="paragraph">
<p>A typical <code>datastore-endpoint</code> option for PostgreSQL has the following format:</p>
</div>
<div class="paragraph">
<p><code>postgres://username:password@hostname:port/database-name</code></p>
</div>
<div class="paragraph">
<p>More advanced configuration parameters are available. For more information on these, please see <a href="https://godoc.org/github.com/lib/pq" class="bare">https://godoc.org/github.com/lib/pq</a>.</p>
</div>
<div class="paragraph">
<p>If you specify a database name and it does not exist, the server will attempt to create it.</p>
</div>
<div class="paragraph">
<p>If you only supply <code>postgres://</code> as the endpoint, RKE2 will attempt to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to localhost using <code>postgres</code> as the username and password.</p>
</li>
<li>
<p>Create a database named <code>kubernetes</code>.</p>
</li>
</ul>
</div>
</div>
<div id="_tabs_1_mysql_mariadb--panel" class="tabpanel" aria-labelledby="_tabs_1_mysql_mariadb">
<div class="paragraph">
<p>A typical <code>datastore-endpoint</code> option for MySQL and MariaDB has the following format:</p>
</div>
<div class="paragraph">
<p><code>mysql://username:password@tcp(hostname:3306)/database-name</code></p>
</div>
<div class="paragraph">
<p>More advanced configuration parameters are available. For more information, please see <a href="https://github.com/go-sql-driver/mysql#dsn-data-source-name" class="bare">https://github.com/go-sql-driver/mysql#dsn-data-source-name</a>.</p>
</div>
<div class="paragraph">
<p>If you specify a database name and it does not exist, the server will attempt to create it.</p>
</div>
<div class="paragraph">
<p>If you only supply <code>mysql://</code> as the endpoint, RKE2 will attempt to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to the MySQL socket at <code>/var/run/mysqld/mysqld.sock</code> using the <code>root</code> user and no password.</p>
</li>
<li>
<p>Create a database with the name <code>kubernetes</code>.</p>
</li>
</ul>
</div>
</div>
<div id="_tabs_1_etcd--panel" class="tabpanel" aria-labelledby="_tabs_1_etcd">
<div class="paragraph">
<p>A typical <code>datastore-endpoint</code> option for etcd has the following format:</p>
</div>
<div class="paragraph">
<p><code>https://etcd-host-1:2379,https://etcd-host-2:2379,https://etcd-host-3:2379</code></p>
</div>
<div class="paragraph">
<p>The above assumes a typical three node etcd cluster. The parameter accepts comma separated etcd URLs.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_database"><a class="anchor" href="#_external_database"></a>External database</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_create_an_external_datastore"><a class="anchor" href="#_1_create_an_external_datastore"></a>1. Create an External Datastore</h3>
<div class="paragraph">
<p>You will first need to create an external datastore for the cluster. See the <a href="#_datastore_options">Datastore Options</a> section for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_launch_server_nodes"><a class="anchor" href="#_2_launch_server_nodes"></a>2. Launch Server Nodes</h3>
<div class="paragraph">
<p>RKE2 requires two or more server nodes for this HA configuration. See the <a href="../install/requirements.html" class="xref page">Requirements</a> guide for minimum machine requirements.</p>
</div>
<div class="paragraph">
<p>When starting the <code>rke2-server</code> service on these nodes with <code>systemctl start rke2-server</code>, you must set the <code>datastore-endpoint</code> option in the config so that RKE2 knows how to connect to the external datastore. The <code>token</code> option can also be used to set a deterministic token when adding nodes. When empty, this token will be generated automatically for further use.</p>
</div>
<div class="paragraph">
<p>For example, a <code>config.yaml</code> like the following could be used to configure RKE2 with a MySQL database as the external datastore and set a token:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The RKE2 config file needs to be created manually. You can do that by running touch /etc/rancher/rke2/config.yaml as a privileged user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datastore-endpoint: "mysql://username:password@tcp(hostname:3306)/database-name"
token: SECRET</code></pre>
</div>
</div>
<div class="paragraph">
<p>The datastore endpoint format differs based on the database type. For details, refer to the section on <a href="#_datastore_endpoint_format_and_functionality">datastore endpoint formats</a>.</p>
</div>
<div class="paragraph">
<p>To configure TLS certificates when launching server nodes, refer to the <a href="#_external_datastore_configuration_parameters">datastore configuration section</a>.</p>
</div>
<div class="paragraph">
<p>By default, server nodes will be schedulable and thus your workloads can get launched on them. If you wish to have a dedicated control plane where no user workloads will run, you can use <a href="../advanced.html#_node_labels_and_taints" class="xref page">taints</a>.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve started the <code>rke2-server</code> process on all server nodes, ensure that the cluster has come up properly with <code>kubectl get nodes</code>. You should see your server nodes in the <code>Ready</code> state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_optional_join_additional_server_nodes"><a class="anchor" href="#_3_optional_join_additional_server_nodes"></a>3. Optional: Join Additional Server Nodes</h3>
<div class="paragraph">
<p>The same example config specified in step 2 can be used to join additional server nodes and the same token from the first node must be added to the config.</p>
</div>
<div class="paragraph">
<p>If the first server node was started without the <code>token</code> option, the token value can be retrieved from any server already joined to the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat /var/lib/rancher/rke2/server/token</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can join an additional server by adding the <code>server</code> address to the config and starting the the <code>rke2-server</code> process with <code>systemctl start rke2-server</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">server: https://you-first-server-node-address:9345
datastore-endpoint: "mysql://username:password@tcp(hostname:3306)/database-name"
token: SECRET</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few config flags that must be the same in all server nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network related flags: <code>cluster-dns</code>, <code>cluster-domain</code>, <code>cluster-cidr</code>, <code>service-cidr</code></p>
</li>
<li>
<p>Flags controlling the deployment of certain components: <code>disable-helm-controller</code> and any component passed to <code>disable</code></p>
</li>
<li>
<p>Feature related flags: <code>secrets-encryption</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you retain a copy of this token as it is required when restoring from backup and adding nodes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_4_optional_join_agent_nodes"><a class="anchor" href="#_4_optional_join_agent_nodes"></a>4. Optional: Join Agent Nodes</h3>
<div class="paragraph">
<p>Because RKE2 server nodes are schedulable by default, agent nodes are not required for a RKE2 cluster. However, you may wish to have dedicated agent nodes to run your apps and services.</p>
</div>
<div class="paragraph">
<p>You just need to specify the URL the agent should register to (either one of the server IPs or a fixed registration address) and the token it should use in the <code>config</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">server: https://you-first-server-node-address:9345
token: SECRET</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can install the agent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -sfL https://get.rke2.io | INSTALL_RKE2_TYPE="agent" sh -</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="embedded.html">Embedded datastore</a></span>
  <span class="next"><a href="backup_restore.html">备份与恢复</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
