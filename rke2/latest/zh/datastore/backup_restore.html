<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>Backup and Restore | RKE2  Latest</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/rke2/latest/zh/datastore/backup_restore.html">
    <link rel="prev" href="external.html">
    <link rel="next" href="../architecture.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-12-04"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>
<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/assets");
</script>
<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/backup_restore.html" hreflang="x-default" rel="alternate"/>
<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/datastore/backup_restore.html" hrefLang="zh-CN" rel="alternate" />
<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/datastore/backup_restore.html" hreflang="en-US" rel="alternate" />

<!-- JSON-LD for doc metadata -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "name": "Backup and Restore | SUSE Rancher Prime: RKE2 latest",
  "headline": "Backup and Restore",
  "description": "Backup and Restore",
  "inLanguage": "zh_cn",
  "dateModified": "2025-12-04T00:00:00Z",
  "author": {
    "@type": "Organization",
    "name": "SUSE Product & Solution Documentation Team",
    "url": "https://documentation.suse.com"
  },
  "mentions": [
    {
      "@type": "SoftwareApplication",
      "name": "SUSE Rancher Prime: RKE2",
      "softwareVersion": "latest",
      "applicationCategory": "Cloud Infrastructure",
      "operatingSystem": "Linux"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "SUSE",
    "url": "https://documentation.suse.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
    }
  }
}
</script>
<!-- end JSON-LD for doc metadata -->
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><shared-header
language="en"
languages='{
    "en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
    "de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
    "fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
    "es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
    "zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
    "pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'
enable-search='false'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="rke2" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">RKE2</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">介绍</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/quickstart.html">快速开始</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/requirements.html">要求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/configuration.html">配置选项</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/ha.html">高可用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/methods.html">安装方法</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/private_registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/registry_mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/containerd_registry_configuration.html">Containerd 镜像仓库配置</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/airgap.html">离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/windows_airgap.html">Windows 离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/server_roles.html">管理 Server 角色</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/packaged_components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/uninstall.html">卸载</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/upgrade.html">升级 SUSE® Rancher Prime: RKE2 集群</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/manual_upgrade.html">手动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/automated_upgrade.html">自动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/roll_back.html">Rolling Back RKE2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/about_hardened_images.html">强化镜像</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/hardening_guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment111.html">CIS 1.11 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment110.html">CIS 1.10 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cis_self_assessment19.html">CIS 1.9 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/fips3_support.html">FIPS 140-3 Enablement</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_policies.html">默认 Pod 安全策略</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/pod_security_standards.html">默认 Pod 安全标准</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/secrets_encryption.html">Secrets Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/selinux.html">SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/certificates.html">Certificate Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/token.html">Token Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Datastore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="embedded.html">Embedded datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="external.html">External Datastore</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="backup_restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">下一代 Kubernetes 发行版剖析</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster_access.html">集群访问</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic_network_options.html">Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus_sriov.html">Multus and SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking_services.html">Networking Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/windows_bgp.html">Windows and BGP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高级选项和配置</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Add-ons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/import_images.html">Import Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/gpu_operators.html">GPU Operators</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/ai_conformance.html">CNCF AI Conformance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/cli_tools.html">CLI 工具</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/linux_agent_config.html">Agent 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/logging.html">日志</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource_profiling.html">Resource Profiling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/server_config.html">Server 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/windows_agent_config.html">Windows Agent 配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known_issues.html">已知问题和限制</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.35.X.html">v1.35.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.34.X.html">v1.34.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RKE2</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.31/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.32/en/introduction.html">1.32-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.31/en/introduction.html">1.31-latest</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/v0.25/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/v0.25/en/index.html">0.25</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.14/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/1.8/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../os-manager/1.9/en/index.html">1.9-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../os-manager/1.8/en/index.html">1.8</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher for AWS</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">v2.13</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/1.10/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-virtual-clusters/v1.0.1/en/introduction.html">SUSE® Virtual Clusters</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../suse-virtual-clusters/1.0.2/en/introduction.html">1.0.2-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../suse-virtual-clusters/v1.0.1/en/introduction.html">v1.0.1-latest</a>
            </li>
            <li class="version">
              <a href="../../../../suse-virtual-clusters/v1.0.0/en/introduction.html">v1.0.0</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.6/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.7/en/introduction/overview.html">v1.7 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a class="home-link-dsc" href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home"></a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/rke2" title="RKE2" aria-label="SUSE Documentation - RKE2">
        RKE2
      </a>
    </li>
      <li>
          Datastore
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/rke2-product-docs/edit/main/versions/latest/modules/zh/pages/datastore/backup_restore.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:rke2" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Backup and Restore</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>RKE2 backups up the cluster information using etcd snapshots. This page describes how to use the rke2 etcd-snapshot CLI tool to manage etcd snapshots and how to restore from an etcd snapshot. Snapshots are for embedded etcd only, if you use another datastore with <code>datastore-endpoint</code> config go to <a href="#_external_db_backups_experimental">Experimental</a>.</p>
</div>
<div class="paragraph">
<p>RKE2 etcd snapshots are stored on the node file system, and may optionally be uploaded to an S3 compatible object store for disaster recovery scenarios. Snapshots can be both automated on a reoccurring schedule, and taken manually on-demand.  The <code>rke2 etcd-snapshot</code> CLI tool offers a set of subcommands that can be used to create, delete, and manage snapshots.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subcommand</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete given snapshot(s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ls, list, l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prune</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove snapshots that exceed the configured retention count</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger an on-demand etcd snapshot</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For additional information on the etcd snapshot subcommands, run <code>rke2 etcd-snapshot --help</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_snapshots"><a class="anchor" href="#_creating_snapshots"></a>Creating Snapshots</h2>
<div class="sectionbody">
<div id="_tabs_1" class="openblock tabs is-sync data-sync-group-id=snapshots is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_scheduled" class="tab">
<p>Scheduled</p>
</li>
<li id="_tabs_1_on_demand" class="tab">
<p>On-demand</p>
</li>
</ul>
</div>
<div id="_tabs_1_scheduled--panel" class="tabpanel" aria-labelledby="_tabs_1_scheduled">
<div class="paragraph">
<p>Scheduled snapshots are enabled by default, at 00:00 and 12:00 system time, with 5 snapshots retained. Scheduled snapshots have a name that starts with <code>etcd-snapshot</code>, followed by the node name and timestamp.</p>
</div>
<div class="paragraph">
<p>The following options control the operation of scheduled snapshots:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-disable-snapshots</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable scheduled snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the base name of etcd scheduled snapshots. (Default: <code>etcd-snapshot</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compress etcd snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory to save db snapshots. (Default location: <code>${data-dir}/db/snapshots</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-retention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of snapshots to retain (default: 5)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-schedule-cron</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot interval time in cron spec. eg. every 5 hours <code>0 */5 * * *</code> (default: <code>0 */12 * * *</code>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The data-dir value defaults to <code>/var/lib/rancher/rke2</code> and can be changed independently by setting the <code>--data-dir</code> flag.</p>
</div>
<div class="paragraph">
<p>Scheduled snapshots are saved to the path set by the server&#8217;s <code>--etcd-snapshot-dir</code> value. If you want them replicated in S3 compatible object stores, refer to <a href="#_s3_compatible_object_store_support">S3 configuration options</a></p>
</div>
</div>
<div id="_tabs_1_on_demand--panel" class="tabpanel" aria-labelledby="_tabs_1_on_demand">
<div class="paragraph">
<p>Snapshots can be saved manually by running the <code>rke2 etcd-snapshot save</code> command. There is no retention for these on-demand snapshots and the user needs to remove them manually by using <code>rke2 etcd-snapshot delete</code> or <code>rke2 etcd-snapshot prune</code> commands. On-demand snapshots have a name that starts with <code>on-demand</code>, followed by the node name and timestamp.</p>
</div>
<div class="paragraph">
<p>The following options control the operation of on-demand snapshots:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the base name of etcd on-demand snapshots. (Default: <code>on-demand</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compress etcd snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory to save db snapshots. (Default location: <code>${data-dir}/db/snapshots</code>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The data-dir value defaults to <code>/var/lib/rancher/rke2</code> and can be changed independently by setting the <code>--data-dir</code> flag.</p>
</div>
<div class="paragraph">
<p>The <code>--name</code> flag can only be set when running the <code>rke2 etcd-snapshot save</code> command. The other two can also be part of the <code>rke2 server</code> <a href="../install/configuration.html#_configuration_file" class="xref page">configuration file</a>.</p>
</div>
<div class="paragraph">
<p>On-demand snapshots are saved to the path set by the server&#8217;s <code>--etcd-snapshot-dir</code> value. If you want them replicated in S3 compatible object stores, refer to <a href="#_s3_compatible_object_store_support">S3 configuration options</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deleting_snapshots"><a class="anchor" href="#_deleting_snapshots"></a>Deleting Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Scheduled snapshots are deleted automatically when the number of snapshots exceeds the configured retention count (5 by default). The oldest snapshots are removed first.</p>
</div>
<div class="paragraph">
<p>To manually delete scheduled snapshot(s) or on-demand snapshot(s), you can use the <code>rke2 etcd-snapshot delete</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 etcd-snapshot delete &lt;SNAPSHOT-NAME-1&gt; &lt;SNAPSHOT-NAME-2&gt; ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>prune</code> subcommand removes snapshots that match the name prefix (<code>on-demand</code> by default) and exceed the configured retention count. It includes the flag <code>--snapshot-retention</code> to set the retention count. For scheduled snapshots, it overrides the default retention policy. On-demand snapshots have no retention policy and hence this flag is required.</p>
</div>
<div class="paragraph">
<p>Prune "on-demand" snapshots down to a smaller amount:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 etcd-snapshot prune --snapshot-retention  &lt;NUM-OF-SNAPSHOTS-TO-RETAIN&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Prune "scheduled" snapshots down to a smaller amount:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 etcd-snapshot prune --name etcd-snapshot --etcd-snapshot-retention &lt;NUM-OF-SNAPSHOTS-TO-RETAIN&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_s3_compatible_object_store_support"><a class="anchor" href="#_s3_compatible_object_store_support"></a>S3 Compatible Object Store Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RKE2 supports replicating etcd snapshots to and restoring etcd snapshots from S3-compatible object stores. S3 support is available for both on-demand and scheduled snapshots.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable backup to S3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 endpoint url</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-endpoint-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 custom CA cert to connect to S3 endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-skip-ssl-verify</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables S3 SSL certificate validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-access-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 access key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-secret-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 secret key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-bucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 bucket name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-region</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 region / bucket location (optional). defaults to us-east-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-folder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy server to use when connecting to S3, overriding any proxy-releated environment variables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-insecure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables S3 over HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 timeout (default: <code>5m0s</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-config-secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of secret in the kube-system namespace used to configure S3, if etcd-s3 is enabled and no other etcd-s3 options are set</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, this is how the creation and deletion of on-demand etcd snapshots in S3 would work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell-session hljs" data-lang="shell-session">$ rke2 etcd-snapshot --s3 --s3-bucket=test-bucket --s3-access-key=test --s3-secret-key=secret save
INFO[0000] Snapshot on-demand-server-0-1754907117 saved.

$ rke2 etcd-snapshot --s3 --s3-bucket=test-bucket --s3-access-key=test --s3-secret-key=secret ls
Name                              Location                                                                          Size    Created
on-demand-server-0-1754907117     s3://test-bucket/test-folder/on-demand-server-0-1754907117                        8937504 2025-07-22T10:02:03Z
on-demand-server-0-1754907117     file:///var/lib/rancher/rke2/server/db/snapshots/on-demand-server-0-1754907117    8937504 2025-07-22T10:02:03Z

$ rke2 etcd-snapshot --s3 --s3-bucket=test-bucket --s3-access-key=test --s3-secret-key=secret delete on-demand-server-0-1753178523
INFO[0000] Snapshot on-demand-server-0-1754907117 deleted.

$ rke2 etcd-snapshot --s3 --s3-bucket=test-bucket --s3-access-key=test --s3-secret-key=secret ls
Name                              Location                                                                          Size    Created</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_s3_retention"><a class="anchor" href="#_s3_retention"></a>S3 Retention</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>Starting in versions v1.34.0+rke2r1, v1.33.4+rke2r1, v1.32.8+rke2r1, v1.31.12+rke2r1, RKE2 includes a new flag for S3 retention. It has the same default value as the local snapshot retention.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-retention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of snapshots in S3 to retain (default: <code>5</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_s3_configuration_secret_support"><a class="anchor" href="#_s3_configuration_secret_support"></a>S3 Configuration Secret Support</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>S3 Configuration Secret support is available as of the August 2024 releases: v1.30.4+rke2r1, v1.29.8+rke2r1, v1.28.13+rke2r1</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RKE2 supports reading etcd S3 snapshot configuration from a Kubernetes Secret.
This may be preferred to hardcoding credentials in RKE2 CLI flags or config files for security reasons, or if credentials need to be rotated without restarting RKE2.
To pass S3 snapshot configuration via a Secret, start RKE2 with <code>--etcd-s3</code> and <code>--etcd-s3-config-secret=&lt;SECRET-NAME&gt;</code>.
The Secret does not need to exist when RKE2 is started, but it will be checked for every time a snapshot save/list/delete/prune operation is performed.</p>
</div>
<div class="paragraph">
<p>The S3 config Secret cannot be used when restoring a snapshot, as the apiserver is not available to provide the secret during a restore.
S3 configuration must be passed via the CLI when restoring a snapshot stored on S3.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pass only the the <code>--etcd-s3</code> and <code>--etcd-s3-config-secret</code> flags to enable the Secret.<br>
If any other S3 configuration flags are set, the Secret will be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keys in the Secret correspond to the <code>--etcd-s3-*</code> CLI flags listed above.
The <code>etcd-s3-endpoint-ca</code> key accepts a PEM-encoded CA bundle, or the <code>etcd-s3-endpoint-ca-name</code> key may be used to specify the name of a ConfigMap in the <code>kube-system</code> namespace containing one or more PEM-encoded CA bundles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: rke2-etcd-snapshot-s3-config
  namespace: kube-system
type: etcd.k3s.cattle.io/s3-config-secret
stringData:
  etcd-s3-endpoint: ""
  etcd-s3-endpoint-ca: ""
  etcd-s3-endpoint-ca-name: ""
  etcd-s3-skip-ssl-verify: "false"
  etcd-s3-access-key: "AWS_ACCESS_KEY_ID"
  etcd-s3-secret-key: "AWS_SECRET_ACCESS_KEY"
  etcd-s3-bucket: "bucket"
  etcd-s3-folder: "folder"
  etcd-s3-region: "us-east-1"
  etcd-s3-insecure: "false"
  etcd-s3-timeout: "5m"
  etcd-s3-proxy: ""</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restoring_snapshots"><a class="anchor" href="#_restoring_snapshots"></a>Restoring Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RKE2 runs through several steps when restoring a snapshot:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the snapshot is stored on S3, the file is downloaded into the snapshot directory.</p>
</li>
<li>
<p>If the snapshot is compressed, it is decompressed.</p>
</li>
<li>
<p>If present, the current etcd database files are moved to <code>${data-dir}/server/db/etcd-old-$TIMESTAMP/</code>.</p>
</li>
<li>
<p>The snapshot&#8217;s contents are extracted out to disk, and the checksum is verified.</p>
</li>
<li>
<p>Etcd is started, and all etcd cluster members except the current node are removed from the cluster.</p>
</li>
<li>
<p>CA Certificates and other confidential data are extracted from the datastore and written to disk, for later use.</p>
</li>
<li>
<p>The restore is complete, and RKE2 can be restarted and used normally on the server where the restore was performed.</p>
</li>
<li>
<p>(optional) Agents and control-plane servers can be started normally.</p>
</li>
<li>
<p>(optional) Etcd servers can be restarted to rejoin to the cluster after removing old database files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When restoring a snapshot, you don&#8217;t need to use the same RKE2 version that created it; a higher minor version is also acceptable.</p>
</div>
<div class="sect2">
<h3 id="_snapshot_restore_steps"><a class="anchor" href="#_snapshot_restore_steps"></a>Snapshot Restore Steps</h3>
<div class="paragraph">
<p>Select the tab below that matches your cluster configuration.</p>
</div>
<div id="_tabs_2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_single_server" class="tab">
<p>Single Server</p>
</li>
<li id="_tabs_2_multiple_servers" class="tab">
<p>Multiple Servers</p>
</li>
</ul>
</div>
<div id="_tabs_2_single_server--panel" class="tabpanel" aria-labelledby="_tabs_2_single_server">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop the RKE2 service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl stop rke2-server</code></pre>
</div>
</div>
</li>
<li>
<p>Run <code>rke2 server</code> with the <code>--cluster-reset</code> flag, and <code>--cluster-reset-restore-path</code> indicating the path to the snapshot to restore.
If the snapshot is stored on S3, provide S3 configuration flags (<code>--etcd-s3</code>, <code>--etcd-s3-bucket</code>, and so on), and give only the filename name of the snapshot as the restore path.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the <code>--cluster-reset</code> flag without specifying a snapshot to restore simply resets the etcd cluster to a single member without restoring a snapshot.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 server \
  --cluster-reset \
   --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Result:</strong> RKE2 restores the snapshot and resets cluster membership, then prints a message indicating that it is ready to be restarted:<br>
 <code>Managed etcd cluster membership has been reset, restart without --cluster-reset flag now.</code></p>
</div>
</li>
<li>
<p>Start RKE2 again:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start rke2-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an etcd-s3 backup configuration is defined within the RKE2 config file, the RKE2 restore will attempt to pull the snapshot file from the configured S3 bucket. In this instance only the snapshot filename should be passed in the argument <code>--cluster-reset-restore-path</code>. To restore from a local snapshot file, where an etcd-s3 backup configuration is present, add the argument <code>--etcd-s3=false</code> and pass the full path to the local snapshot file in the argument <code>--cluster-reset-restore-path</code>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>As a safety mechanism, when RKE2 resets the cluster, it creates an empty file at <code>/var/lib/rancher/rke2/server/db/reset-flag</code> that prevents users from accidentally running multiple cluster resets in succession. This file is deleted when RKE2 starts normally.</p>
</div>
</div>
<div id="_tabs_2_multiple_servers--panel" class="tabpanel" aria-labelledby="_tabs_2_multiple_servers">
<div class="paragraph">
<p>In this example there are 3 servers, <code>S1</code>, <code>S2</code>, and <code>S3</code>. The snapshot is located on <code>S1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop RKE2 on all servers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> systemctl stop rke2-server</code></pre>
</div>
</div>
</li>
<li>
<p>On S1, run <code>rke2 server</code> with the <code>--cluster-reset</code> option, and <code>--cluster-reset-restore-path</code> indicating the path to the snapshot to restore.
If the snapshot is stored on S3, provide S3 configuration flags (<code>--etcd-s3</code>, <code>--etcd-s3-bucket</code>, and so on), and give only the filename name of the snapshot as the restore path.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the <code>--cluster-reset</code> flag without specifying a snapshot to restore simply resets the etcd cluster to a single member without restoring a snapshot.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 server \
  --cluster-reset \
  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Result:</strong> RKE2 restores the snapshot and resets cluster membership, then prints a message indicating that it is ready to be restarted:<br>
 <code>Managed etcd cluster membership has been reset, restart without --cluster-reset flag now.</code><br>
 <code>Backup and delete ${datadir}/server/db on each peer etcd server and rejoin the nodes.</code></p>
</div>
</li>
<li>
<p>On S1, start RKE2 again:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start rke2-server</code></pre>
</div>
</div>
</li>
<li>
<p>On S2 and S3, delete the data directory, <code>/var/lib/rancher/rke2/server/db/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf /var/lib/rancher/rke2/server/db/</code></pre>
</div>
</div>
</li>
<li>
<p>On S2 and S3, start RKE2 again to join the restored cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start rke2-server</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If an etcd-s3 backup configuration is defined within the RKE2 config file, the RKE2 restore will attempt to pull the snapshot file from the configured S3 bucket. In this instance only the snapshot filename should be passed in the argument <code>--cluster-reset-restore-path</code>. To restore from a local snapshot file, where an etcd-s3 backup configuration is present, add the argument <code>--etcd-s3=false</code> and pass the full path to the local snapshot file in the argument <code>--cluster-reset-restore-path</code>.</p>
</div>
<div class="paragraph">
<p>As a safety mechanism, when RKE2 resets the cluster, it creates an empty file at <code>/var/lib/rancher/rke2/server/db/reset-flag</code> that prevents users from accidentally running multiple cluster resets in succession. This file is deleted when RKE2 starts normally.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restoring_to_new_hosts"><a class="anchor" href="#_restoring_to_new_hosts"></a>Restoring To New Hosts</h4>
<div class="paragraph">
<p>It is possible to restore an etcd snapshot to a different host than it was taken on. When doing so, you must pass the <a href="../security/token.html#_server" class="xref page">server token</a> that was originally used when taking the snapshot, as it is used to decrypt the bootstrap data inside the snapshot. The process is the same as above but changing step 2 by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the node that took the snapshot save the value of: <code>/var/lib/rancher/rke2/server/token</code>. This is <code>&lt;BACKED-UP-TOKEN-VALUE&gt;</code> in step 3.</p>
</li>
<li>
<p>Copy the snapshot to the new node. The path in the node is <code>&lt;PATH-TO-SNAPSHOT&gt;</code> in step 3</p>
</li>
<li>
<p>Initiate the restore from snapshot on the first server node with the following commands:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rke2 server \
  --cluster-reset \
  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;
  --token=&lt;BACKED-UP-TOKEN-VALUE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The token value can also be set in the RKE2 config file.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Node resources are also included in the etcd snapshot. If restoring to a new set of nodes, you will need to manually delete any old nodes that are no longer present in the cluster.</p>
</li>
<li>
<p>If there is a token set in the RKE2 config file, make sure it is the same as the <code>&lt;BACKED-UP-TOKEN-VALUE&gt;</code>, otherwise RKE2 will fail to start.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_etcdsnapshotfile_custom_resources"><a class="anchor" href="#_etcdsnapshotfile_custom_resources"></a>ETCDSnapshotFile Custom Resources</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>ETCDSnapshotFiles are available as of the November 2023 releases: v1.28.4+rke2r1, v1.27.8+rke2r1, v1.26.11+rke2r1, v1.25.16+rke2r1</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Snapshots can be viewed remotely using any Kubernetes client by listing or describing cluster-scoped <code>ETCDSnapshotFile</code> resources.
Unlike the <code>rke2 etcd-snapshot list</code> command, which only shows snapshots visible to that node, <code>ETCDSnapshotFile</code> resources track all snapshots present on cluster members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">$ kubectl get etcdsnapshotfile
Name                              Location                                                                           Size     Created
etcd-snapshot-server-0-1754906881 s3://test-bucket/test-folder/etcd-snapshot-server-0-1754906881                     8937504  2025-08-11T10:08:01Z
etcd-snapshot-server-0-1754906881 file:///var/lib/rancher/rke2/server/db/snapshots/etcd-snapshot-server-0-1754907185 8937504  2025-08-11T10:08:01Z
etcd-snapshot-server-0-1754907185 s3://test-bucket/test-folder/etcd-snapshot-server-0-1754907185                     9633824  2025-08-11T10:13:05Z
etcd-snapshot-server-0-1754907185 file:///var/lib/rancher/rke2/server/db/snapshots/etcd-snapshot-server-0-1754907185 9633824  2025-08-11T10:13:05Z</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">$ kubectl describe etcdsnapshotfile s3-etcd-snapshot-server-0-1754906881-e1e196
Name:         s3-etcd-snapshot-server-0-1754906881-e1e196
Namespace:
Labels:       etcd.rke2.cattle.io/snapshot-storage-node=s3
Annotations:  etcd.rke2.cattle.io/snapshot-token-hash: 2bb80d537b1d
API Version:  k3s.cattle.io/v1
Kind:         ETCDSnapshotFile
Metadata:
  Creation Timestamp:  2025-08-11T10:10:37Z
  Finalizers:
    wrangler.cattle.io/managed-etcd-snapshots-controller
  Generation:        1
  Resource Version:  2356
  UID:               d4fa68e7-b692-4ad8-8740-77d2bb9c062f
Spec:
  Location:   s3://test-bucket/test-folder/etcd-snapshot-server-0-1754906881
  Node Name:  server-0
  s3:
    Bucket:           test-bucket
    Endpoint:         localhost:9090
    Insecure:         true
    Prefix:           test-folder
    Region:           us-east-1
    Skip SSL Verify:  true
  Snapshot Name:      etcd-snapshot-server-0-1754906881
Status:
  Creation Time:  2025-08-11T10:08:01Z
  Ready To Use:   true
  Size:           8937504
Events:
  Type    Reason               Age    From             Message
  ----    ------               ----   ----             -------
  Normal  ETCDSnapshotCreated  6m24s  rke2-supervisor  Snapshot etcd-snapshot-server-0-1754906881 saved on server-0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">$ kubectl describe etcdsnapshotfile s3-on-demand-k3s-server-1-1730308816-79b15c</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_db_backups_experimental"><a class="anchor" href="#_external_db_backups_experimental"></a>External DB Backups (Experimental)</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to backing up the datastore itself, you must also back up the server token file at <code>/var/lib/rancher/rke2/server/token</code>.
You must restore this file, or pass its value into the <code>token</code> option, when restoring from backup.
If you do not use the same token value when restoring, the snapshot will be unusable, as the token is used to encrypt confidential data within the datastore itself.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_backup_and_restore_with_sqlite"><a class="anchor" href="#_backup_and_restore_with_sqlite"></a>Backup and Restore with SQLite</h3>
<div class="paragraph">
<p>No special commands are required to back up or restore the SQLite datastore.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To back up the SQLite datastore, take a copy of <code>/var/lib/rancher/rke2/server/db/</code>.</p>
</li>
<li>
<p>To restore the SQLite datastore, restore the contents of <code>/var/lib/rancher/rke2/server/db</code> (and the token, as discussed above).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_backup_and_restore_with_external_datastore"><a class="anchor" href="#_backup_and_restore_with_external_datastore"></a>Backup and Restore with External Datastore</h3>
<div class="paragraph">
<p>When an external datastore is used, backup and restore operations are handled outside of RKE2. The database administrator will need to back up the external database, or restore it from a snapshot or dump.</p>
</div>
<div class="paragraph">
<p>We recommend configuring the database to take recurring snapshots.</p>
</div>
<div class="paragraph">
<p>For details on taking database snapshots and restoring your database from them, refer to the official database documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/replication-snapshot-method.html">Official MySQL documentation</a></p>
</li>
<li>
<p><a href="https://www.postgresql.org/docs/8.3/backup-dump.html">Official PostgreSQL documentation</a></p>
</li>
<li>
<p><a href="https://etcd.io/docs/latest/op-guide/recovery/">Official etcd documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="external.html">External Datastore</a></span>
  <span class="next"><a href="../architecture.html">下一代 Kubernetes 发行版剖析</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
