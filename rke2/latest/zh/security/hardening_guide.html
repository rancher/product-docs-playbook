<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>CIS Hardening Guide | RKE2  Latest</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/rke2/latest/zh/security/hardening_guide.html">
    <link rel="prev" href="about_hardened_images.html">
    <link rel="next" href="cis_self_assessment111.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2026-01-15"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>
<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/assets");
</script>
<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/security/hardening_guide.html" hreflang="x-default" rel="alternate"/>
<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/security/hardening_guide.html" hrefLang="zh-CN" rel="alternate" />
<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/security/hardening_guide.html" hreflang="en-US" rel="alternate" />

<!-- JSON-LD for doc metadata -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "name": "CIS Hardening Guide | SUSE Rancher Prime: RKE2 latest",
  "headline": "CIS Hardening Guide",
  "description": "CIS Hardening Guide",
  "inLanguage": "zh_cn",
  "dateModified": "2026-01-15T00:00:00Z",
  "author": {
    "@type": "Organization",
    "name": "SUSE Product & Solution Documentation Team",
    "url": "https://documentation.suse.com"
  },
  "mentions": [
    {
      "@type": "SoftwareApplication",
      "name": "SUSE Rancher Prime: RKE2",
      "softwareVersion": "latest",
      "applicationCategory": "Cloud Infrastructure",
      "operatingSystem": "Linux"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "SUSE",
    "url": "https://documentation.suse.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
    }
  }
}
</script>
<!-- end JSON-LD for doc metadata -->
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><shared-header
language="en"
languages='{
    "en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
    "de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
    "fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
    "es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
    "zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
    "pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'
enable-search='false'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="rke2" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">RKE2</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">介绍</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/quickstart.html">快速开始</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/requirements.html">要求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/configuration.html">配置选项</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/ha.html">高可用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/methods.html">安装方法</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/private_registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/registry_mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/containerd_registry_configuration.html">Containerd 镜像仓库配置</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/airgap.html">离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/windows_airgap.html">Windows 离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/server_roles.html">管理 Server 角色</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/packaged_components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install/uninstall.html">卸载</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/upgrade.html">升级 SUSE® Rancher Prime: RKE2 集群</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/manual_upgrade.html">手动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/automated_upgrade.html">自动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrade/roll_back.html">Rolling Back RKE2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="about_hardened_images.html">强化镜像</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="hardening_guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cis_self_assessment111.html">CIS 1.11 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cis_self_assessment110.html">CIS 1.10 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cis_self_assessment19.html">CIS 1.9 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fips3_support.html">FIPS 140-3 Enablement</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pod_security_policies.html">默认 Pod 安全策略</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pod_security_standards.html">默认 Pod 安全标准</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="secrets_encryption.html">Secrets Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="selinux.html">SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="certificates.html">Certificate Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="token.html">Token Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Datastore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/embedded.html">Embedded datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/external.html">External Datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/backup_restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">下一代 Kubernetes 发行版剖析</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster_access.html">集群访问</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic_network_options.html">Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus_sriov.html">Multus and SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking_services.html">Networking Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/windows_bgp.html">Windows and BGP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高级选项和配置</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Add-ons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/import_images.html">Import Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../add-ons/gpu_operators.html">GPU Operators</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/ai_conformance.html">CNCF AI Conformance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/cli_tools.html">CLI 工具</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/linux_agent_config.html">Agent 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/logging.html">日志</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource_profiling.html">Resource Profiling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/server_config.html">Server 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/windows_agent_config.html">Windows Agent 配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known_issues.html">已知问题和限制</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.35.X.html">v1.35.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.34.X.html">v1.34.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes-old/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RKE2</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.31/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.32/en/introduction.html">1.32-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.31/en/introduction.html">1.31-latest</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/v0.25/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/v0.25/en/index.html">0.25</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.14/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/1.8/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../os-manager/1.9/en/index.html">1.9-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../os-manager/1.8/en/index.html">1.8</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher for AWS</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">v2.13</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/1.10/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-virtual-clusters/v1.0.1/en/introduction.html">SUSE® Virtual Clusters</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../suse-virtual-clusters/1.0.2/en/introduction.html">1.0.2-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../suse-virtual-clusters/v1.0.1/en/introduction.html">v1.0.1-latest</a>
            </li>
            <li class="version">
              <a href="../../../../suse-virtual-clusters/v1.0.0/en/introduction.html">v1.0.0</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.6/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.7/en/introduction/overview.html">v1.7 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a class="home-link-dsc" href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home"></a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/rke2" title="RKE2" aria-label="SUSE Documentation - RKE2">
        RKE2
      </a>
    </li>
      <li>
          Security
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/rke2-product-docs/edit/main/versions/latest/modules/zh/pages/security/hardening_guide.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:rke2" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CIS Hardening Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document provides prescriptive guidance for hardening a production installation of SUSE® Rancher Prime: RKE2. It outlines the configurations and controls required to address Kubernetes benchmark controls from the Center for Internet Security (CIS).</p>
</div>
<div class="paragraph">
<p>For more details about evaluating a hardened cluster against the official CIS benchmark, refer to the appropriate CIS Self-Assessment Guide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="cis_self_assessment111.html" class="xref page">CIS Self-Assessment Guide v1.11</a> for RKE2 v1.29 and newer</p>
</li>
<li>
<p><a href="cis_self_assessment110.html" class="xref page">CIS Self-Assessment Guide v1.10</a> for RKE2 v1.29-v1.31</p>
</li>
<li>
<p><a href="cis_self_assessment19.html" class="xref page">CIS Self-Assessment Guide v1.9</a> for RKE2 v1.27-v1.29</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RKE2 is designed to be "hardened by default" and pass the majority of the Kubernetes CIS controls without modification. There are a few notable exceptions to this that require manual intervention to fully pass the CIS Benchmark:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>RKE2 will not modify the host operating system. Therefore, you, the operator, must make a few host-level modifications.</p>
</li>
<li>
<p>RKE2 will not modify the host operating system. Therefore, you, the operator, must make a few host-level modifications.</p>
</li>
<li>
<p>Certain CIS controls for Network Policies and Pod Security Standards (or Pod Security Policies (PSP) on RKE2 versions prior to v1.25) will restrict the functionality of the cluster. You must opt into having RKE2 configure these for you. To help ensure these requirements are met, RKE2 can be started with the <code>profile</code> flag set to <code>cis</code> or <code>cis-1.23</code> depending on the RKE2 version.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This guide assumes that RKE2 has been installed, but is not yet running. If you have already started RKE2, you will need to stop the RKE2 service.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_host_level_requirements"><a class="anchor" href="#_host_level_requirements"></a>Host-level requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three areas of host-level requirements: kernel parameters, kubelet&#8217;s protect-kernel-defaults and etcd process/directory configuration. These are outlined in this section.</p>
</div>
<div class="sect2">
<h3 id="_kernel_parameters"><a class="anchor" href="#_kernel_parameters"></a>Kernel parameters</h3>
<div class="paragraph">
<p>CIS benchmark requires some specific kernel parameters configuration to be set. When RKE2 is installed, it creates a sysctl config file to set the required parameters appropriately. However, it does not automatically configure the host to use this configuration. You must do this manually. The location of the config file depends on the installation method used.</p>
</div>
<div class="paragraph">
<p>If RKE2 was installed via RPM, YUM, or DNF (the default on OSes that use RPMs, such as CentOS), run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo cp -f /usr/share/rke2/rke2-cis-sysctl.conf /etc/sysctl.d/60-rke2-cis.conf
sudo systemctl restart systemd-sysctl</code></pre>
</div>
</div>
<div class="paragraph">
<p>If RKE2 was installed via the tarball (the default on OSes that do not use RPMs, such as Ubuntu), run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo cp -f /usr/local/share/rke2/rke2-cis-sysctl.conf /etc/sysctl.d/60-rke2-cis.conf
sudo systemctl restart systemd-sysctl</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your system lacks the <code>systemd-sysctl.service</code> and/or the <code>/etc/sysctl.d</code> directory, you will want to make sure the sysctls are applied at boot by running the following command during start-up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo sysctl -p /usr/local/share/rke2/rke2-cis-sysctl.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please perform this step only on fresh installations, before actually using RKE2 to deploy Kubernetes. Many Kubernetes components, including CNI plugins, set up their own sysctls. Restarting the <code>systemd-sysctl</code> service on a running Kubernetes cluster can result in unexpected side-effects.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kubelet_parameter_protect_kernel_defaults_is_set_to_true"><a class="anchor" href="#_kubelet_parameter_protect_kernel_defaults_is_set_to_true"></a>Kubelet parameter <code>protect-kernel-defaults</code> is set to <code>true</code></h3>
<div class="paragraph">
<p>This is a kubelet flag that will cause the kubelet to exit if the required kernel parameters are unset or are set to values that are different from the kubelet&#8217;s defaults.</p>
</div>
<div class="paragraph">
<p>RKE2 will automatically set the flag to <code>true</code> when the <code>profile</code> flag is set.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>protect-kernel-defaults</code> is exposed as a top-level flag for RKE2. If you have set <code>profile</code> to <code>cis-1.XX</code> and <code>protect-kernel-defaults</code> to <code>false</code> explicitly, RKE2 will exit with an error.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RKE2 will also check the same kernel parameters that the kubelet does and exit with an error following the same rules as the kubelet. This is done as a convenience to help the operator more quickly and easily identify what kernel parameters are violating the kubelet defaults.</p>
</div>
</div>
<div class="sect2">
<h3 id="_etcd_is_configured_properly"><a class="anchor" href="#_etcd_is_configured_properly"></a>etcd is configured properly</h3>
<div class="paragraph">
<p>The CIS Benchmark requires that the etcd data directory be owned by the <code>etcd</code> user and group. This implicitly requires the etcd process run as the host-level <code>etcd</code> user. To achieve this, RKE2 takes several steps when started with a valid <code>cis</code> or <code>cis-1.XX</code> profile:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check that the <code>etcd</code> user and group exists on the host. If they don&#8217;t, exit with an error.</p>
</li>
<li>
<p>Create etcd&#8217;s data directory with <code>etcd</code> as the user and group owner.</p>
</li>
<li>
<p>Ensure the etcd process is run as the <code>etcd</code> user and group by setting the etcd static pod&#8217;s <code>SecurityContext</code> appropriately.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On some Linux distributions, the <code>useradd</code> command will not create a group. The <code>-U</code> flag is included below to account for that. This flag tells <code>useradd</code> to create a group with the same name as the user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo useradd -r -c "etcd user" -s /sbin/nologin -M etcd -U</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>etcd</code> user and group must be defined in the traditional database files at /etc/passwd and /etc/group. Golang&#8217;s stdlib <code>os/user</code> package does not support external user databases such as NSS or systemd userdb (varlink).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rke2_configuration"><a class="anchor" href="#_rke2_configuration"></a>RKE2 Configuration</h2>
<div class="sectionbody">
<div id="_tabs_1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_v1_29_and_newer" class="tab">
<p>v1.29 and Newer</p>
</li>
<li id="_tabs_1_v1_25_v1_28" class="tab">
<p>v1.25 - v1.28</p>
</li>
<li id="_tabs_1_v1_24_and_older" class="tab">
<p>v1.24 and Older</p>
</li>
</ul>
</div>
<div id="_tabs_1_v1_29_and_newer--panel" class="tabpanel" aria-labelledby="_tabs_1_v1_29_and_newer">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">profile: "cis"
# For cis-1.11 only, not needed on cis-1.9/cis-1.10
kube-apiserver-arg:
  - 'service-account-extend-token-expiration=false'</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_v1_25_v1_28--panel" class="tabpanel" aria-labelledby="_tabs_1_v1_25_v1_28">
<div class="paragraph">
<p><strong>Generic CIS configuration</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Version Gate Available with October 2023 releases (v1.25.15+rke2r1, v1.26.10+rke2r1, v1.27.7+rke2r1, v1.28.3+rke2r1)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">profile: "cis"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the generic <code>cis</code> profile will ensure that the cluster passes the CIS benchmark (rke2-cis-1.XX-profile-hardened) associated with the Kubernetes version that RKE2 is running. For example, RKE2 v1.26.XX with the <code>profile: cis</code> will pass the <code>rke2-cis-1.8-profile-hardened</code> in Rancher.</p>
</div>
<div class="paragraph">
<p>Use of the generic <code>cis</code> profile ensures that upgrades to RKE2 do not require a change to existing configuration. Whatever changes are necessary to pass applicable CIS benchmark will be automatically applied.</p>
</div>
<div class="paragraph">
<p>A rough mapping of RKE2 versions to CIS benchmark versions is as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2 Minors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicable CIS Benchmark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile Flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.27-1.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cis</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cis-1.23</code>, <code>cis</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cis-1.23</code>, <code>cis</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cis-1.23</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cis-1.23</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.19-1.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cis-1.6</code></p></td>
</tr>
</tbody>
</table>
</div>
<div id="_tabs_1_v1_24_and_older--panel" class="tabpanel" aria-labelledby="_tabs_1_v1_24_and_older">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">profile: "cis-1.23"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration file must be named <code>config.yaml</code> and placed in <code>/etc/rancher/rke2</code>. The directory needs to be created prior to installing RKE2.</p>
</div>
<div class="paragraph">
<p>When the <code>profile</code> flag is set it does the following:</p>
</div>
</div>
</div>
</div>
<div id="_tabs_2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_v1_25_and_newer" class="tab">
<p>v1.25 and Newer</p>
</li>
<li id="_tabs_2_v1_24_and_older" class="tab">
<p>v1.24 and Older</p>
</li>
</ul>
</div>
<div id="_tabs_2_v1_25_and_newer--panel" class="tabpanel" aria-labelledby="_tabs_2_v1_25_and_newer">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Checks that host-level requirements have been met. If they haven&#8217;t, RKE2 will exit with a fatal error describing the unmet requirements.</p>
</li>
<li>
<p>Configures the etcd static pod to run as the etcd user and group, as explained in the <a href="#_etcd_is_configured_properly">etcd hardening guide</a>.</p>
</li>
<li>
<p>Applies network policies that allow the cluster to pass associated controls.</p>
</li>
<li>
<p>Applies more restrictive file permissions (600 vs 644) to agent manifests and other configurations files.</p>
</li>
<li>
<p>Configures the Pod Security Admission Controller to enforce restricted mode in all namespaces, with the exception of the <code>kube-system</code>, <code>cis-operator-system</code>, and <code>tigera-operator</code> namespaces. These namespaces are exempted to allow system pods to run without restrictions, which is required for proper operation of the cluster. For more information about the PSA configuration, see the default <a href="pod_security_standards.html#_pod_security_standards" class="xref page">Pod Security Admission configurations</a>. For more information about Pod Security Standards, please refer to the <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/">official documentation</a>.</p>
</li>
</ol>
</div>
</div>
<div id="_tabs_2_v1_24_and_older--panel" class="tabpanel" aria-labelledby="_tabs_2_v1_24_and_older">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Checks that host-level requirements have been met. If they haven&#8217;t, RKE2 will exit with a fatal error describing the unmet requirements.</p>
</li>
<li>
<p>Applies network policies that allow the cluster to pass associated controls.</p>
</li>
<li>
<p>Configures runtime pod security policies that allow the cluster to pass associated controls.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_runtime_requirements"><a class="anchor" href="#_kubernetes_runtime_requirements"></a>Kubernetes runtime requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The runtime requirements to pass the CIS Benchmark are centered around pod security and network policies. Most of this is automatically handled by RKE2 when using a valid <code>cis-1.XX</code> profile, but some additional operator intervention is required.</p>
</div>
<div class="sect2">
<h3 id="_pod_security"><a class="anchor" href="#_pod_security"></a>Pod Security</h3>
<div class="paragraph">
<p>RKE2 always runs with some amount of pod security.</p>
</div>
<div id="_tabs_3" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_3_v1_25_and_newer" class="tab">
<p>v1.25 and Newer</p>
</li>
<li id="_tabs_3_v1_24_and_older" class="tab">
<p>v1.24 and Older</p>
</li>
</ul>
</div>
<div id="_tabs_3_v1_25_and_newer--panel" class="tabpanel" aria-labelledby="_tabs_3_v1_25_and_newer">
<div class="paragraph">
<p>On v1.25 and newer, <a href="https://kubernetes.io/docs/concepts/security/pod-security-admission/">Pod Security Admission (PSA)</a> are used for pod security. A default Pod Security Admission config file will be added to the cluster upon startup as follows:</p>
</div>
<div class="paragraph">
<p>With the <code>cis</code>/<code>cis-1.23</code> profile:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RKE2 will apply a restricted pod security standard via a configuration file which will enforce <code>restricted</code> mode throughout the cluster with an exception to the <code>kube-system</code>, <code>cis-operator-system</code> and <code>tigera-operator</code> namespaces to ensure successful operation of system pods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Without the <code>cis</code>/<code>cis-1.23</code> profile:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RKE2 will apply a nonrestricted pod security standard via a configuration file which will enforce <code>privileged</code> mode throughout the cluster which allows a completely unrestricted mode to all pods in the cluster. See the <a href="pod_security_standards.html" class="xref page">Pod Security Policies</a> page for more details.</p>
</li>
</ul>
</div>
</div>
<div id="_tabs_3_v1_24_and_older--panel" class="tabpanel" aria-labelledby="_tabs_3_v1_24_and_older">
<div class="paragraph">
<p>On v1.24 and older, the <code>PodSecurityPolicy</code> admission controller is always enabled. A policy is applied based on the profile passed to RKE2.</p>
</div>
<div class="paragraph">
<p>With the <code>cis-1.6</code> profile:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RKE2 will put a much more restrictive set of policies in place. These policies meet the requirements outlined in section 5.2 of the CIS Benchmark.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Without the <code>cis-1.6</code> profile:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RKE2 will put an unrestricted policy in place that allows Kubernetes to run as though the <code>PodSecurityPolicy</code> admission controller was not enabled. See the <a href="pod_security_policies.html" class="xref page">Pod Security Policies</a> page for more details.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Kubernetes control plane components and critical additions such as CNI, DNS, and Ingress are ran as pods in the <code>kube-system</code> namespace. Therefore, this namespace will have a policy that is less restrictive so that these components can run properly.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_network_policies"><a class="anchor" href="#_network_policies"></a>Network Policies</h3>
<div class="paragraph">
<p>When ran with a valid "cis-1.XX" profile, RKE2 will put <code>NetworkPolicies</code> in place that passes the CIS Benchmark for Kubernetes' built-in namespaces. These namespaces are: <code>kube-system</code>, <code>kube-public</code>, and <code>default</code>.</p>
</div>
<div class="paragraph">
<p>The <code>NetworkPolicy</code> used will only allow pods within the same namespace to talk to each other. There are some notable exceptions to this is that it allows DNS requests to be resolved.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DNS requests are allowed to reach the dns server</p>
</li>
<li>
<p>HTTP/s requests are allowed to reach the ingress-nginx service</p>
</li>
<li>
<p>HTTPs requests are allowed to reach the metrics-server</p>
</li>
<li>
<p>Requests to the ingress-nginx webhook on the specified pod by the ingress-nginx pod (normally 8443)</p>
</li>
<li>
<p>HTTPs requests to the rke2-snapshot-validation-webhook</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Operator Intervention Required</div>
<div class="paragraph">
<p>Operators must manage network policies as normal for additional namespaces that are created.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_default_service_account"><a class="anchor" href="#_configure_default_service_account"></a>Configure <code>default</code> service account</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Set <code>automountServiceAccountToken</code> to <code>false</code> for <code>default</code> service accounts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Kubernetes provides a <code>default</code> service account which is used by cluster workloads where no specific service account is assigned to the pod. Where access to the Kubernetes API from a pod is required, a specific service account should be created for that pod, and rights granted to that service account. The <code>default</code> service account should be configured such that it does not provide a service account token and does not have any explicit rights assignments.</p>
</div>
<div class="paragraph">
<p>For each namespace including <code>default</code> and <code>kube-system</code> on a standard RKE2 install, the <code>default</code> service account must include this value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">automountServiceAccountToken: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>RKE2 will automatically set the value correctly for kube-system, cis-operator-system, kube-node-lease and tigera-operator namespaces.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Operator Intervention Required</div>
<div class="paragraph">
<p>For namespaces created by the cluster operator, the following script and configuration file can be used to configure the <code>default</code> service account.</p>
</div>
<div class="paragraph">
<p>The configuration below must be saved to a file called <code>account_update.yaml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: default
automountServiceAccountToken: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a bash script file called <code>account_update.sh</code>. Be sure to <code>sudo chmod +x account_update.sh</code> so the script has execute permissions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash -e

for namespace in $(kubectl get namespaces -A -o=jsonpath="{.items[*]['metadata.name']}"); do
  echo -n "Patching namespace $namespace - "
  kubectl patch serviceaccount default -n ${namespace} -p "$(cat account_update.yaml)"
done</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute this script to apply the <code>account_update.yaml</code> configuration to <code>default</code> service account in all namespaces.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_api_server_audit_configuration"><a class="anchor" href="#_api_server_audit_configuration"></a>API Server audit configuration</h3>
<div class="paragraph">
<p>CIS requirements 1.2.22 to 1.2.25 are related to configuring audit logs for the API Server. When RKE2 is started with the <code>profile</code> flag set, it will automatically configure hardened <code>--audit-log-</code> parameters in the API Server to pass those CIS checks.</p>
</div>
<div class="paragraph">
<p>RKE2&#8217;s default audit policy is configured to not log requests in the API Server. This is done to allow cluster operators flexibility to customize an audit policy that suits their auditing requirements and needs, as these are specific to each users' environment and policies.</p>
</div>
<div class="paragraph">
<p>A default audit policy is created by RKE2 when started with the <code>profile</code> flag set. The policy is defined in <code>/etc/rancher/rke2/audit-policy.yaml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: audit.k8s.io/v1
kind: Policy
metadata:
  creationTimestamp: null
rules:
- level: None</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Operator Intervention Required</div>
<div class="paragraph">
<p>To start logging requests to the API Server, at least <code>level</code> parameter must be modified, for example, to <code>Metadata</code>. Detailed information about policy configuration for the API server can be found in the Kubernetes <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/audit/">documentation</a>.</p>
</div>
<div class="paragraph">
<p>After adapting the audit policy, RKE2 must be restarted to load the new configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">sudo systemctl restart rke2-server.service</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>API Server audit logs will be written to <code>/var/lib/rancher/rke2/server/logs/audit.log</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_known_issues"><a class="anchor" href="#_known_issues"></a>Known issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are controls that default RKE2 currently does not pass. Each gap will be explained and how it is addressed.</p>
</div>
<div class="sect2">
<h3 id="_control_1_1_12"><a class="anchor" href="#_control_1_1_12"></a>Control 1.1.12</h3>
<div class="paragraph">
<p>Ensure that the etcd data directory ownership is set to <code>etcd:etcd</code>.</p>
</div>
<div class="sect3">
<h4 id="_rationale"><a class="anchor" href="#_rationale"></a>Rationale</h4>
<div class="paragraph">
<p>etcd is a highly-available key-value store used by Kubernetes deployments for persistent storage of all of its REST API objects. This data directory should be protected from any unauthorized reads or writes. It should be owned by <code>etcd:etcd</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remediation"><a class="anchor" href="#_remediation"></a>Remediation</h4>
<div class="paragraph">
<p>This can be remediated by creating an <code>etcd</code> user and group as described <a href="#_etcd_is_configured_properly">above</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_control_5_1_5"><a class="anchor" href="#_control_5_1_5"></a>Control 5.1.5</h3>
<div class="paragraph">
<p>Ensure that default service accounts are not actively used</p>
</div>
<div class="sect3">
<h4 id="_rationale_2"><a class="anchor" href="#_rationale_2"></a>Rationale</h4>
<div class="paragraph">
<p>Kubernetes provides a <code>default</code> service account which is used by cluster workloads where no specific service account is assigned to the pod.</p>
</div>
<div class="paragraph">
<p>Where access to the Kubernetes API from a pod is required, a specific service account should be created for that pod, and rights granted to that service account.</p>
</div>
<div class="paragraph">
<p>The <code>default</code> service account should be configured such that it does not provide a service account token and does not have any explicit rights assignments.</p>
</div>
<div class="paragraph">
<p>This can be remediated by updating the <code>automountServiceAccountToken</code> field to <code>false</code> for the <code>default</code> service account in each namespace.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have followed this guide, your RKE2 cluster will be configured to pass the CIS Kubernetes Benchmark. You can review our CIS Self-Assessment Guides to understand how we verified each of the benchmarks and how you can do the same on your cluster.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="about_hardened_images.html">强化镜像</a></span>
  <span class="next"><a href="cis_self_assessment111.html">CIS 1.11 Self-Assessment Guide</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
