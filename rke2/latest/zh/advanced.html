<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>高级选项和配置 | RKE2  Latest</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/rke2/latest/zh/advanced.html">
    <link rel="prev" href="networking/windows_bgp.html">
    <link rel="next" href="add-ons/helm.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-12-04"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>
<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/assets");
</script>
<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/advanced.html" hreflang="x-default" rel="alternate"/>
<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/zh/advanced.html" hrefLang="zh-CN" rel="alternate" />
<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/rke2/latest/en/advanced.html" hreflang="en-US" rel="alternate" />

<!-- JSON-LD for doc metadata -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "name": "高级选项和配置 | SUSE Rancher Prime: RKE2 latest",
  "headline": "高级选项和配置",
  "description": "高级选项和配置",
  "inLanguage": "zh_cn",
  "dateModified": "2025-12-04T00:00:00Z",
  "author": {
    "@type": "Organization",
    "name": "SUSE Product & Solution Documentation Team",
    "url": "https://documentation.suse.com"
  },
  "mentions": [
    {
      "@type": "SoftwareApplication",
      "name": "SUSE Rancher Prime: RKE2",
      "softwareVersion": "latest",
      "applicationCategory": "Cloud Infrastructure",
      "operatingSystem": "Linux"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "SUSE",
    "url": "https://documentation.suse.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
    }
  }
}
</script>
<!-- end JSON-LD for doc metadata -->
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><shared-header
language="en"
languages='{
    "en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
    "de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
    "fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
    "es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
    "zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
    "pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'
enable-search='false'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="rke2" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">RKE2</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">介绍</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/quickstart.html">快速开始</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/requirements.html">要求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/configuration.html">配置选项</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/ha.html">高可用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/methods.html">安装方法</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/private_registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/registry_mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/containerd_registry_configuration.html">Containerd 镜像仓库配置</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/airgap.html">离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/windows_airgap.html">Windows 离线安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/server_roles.html">管理 Server 角色</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/packaged_components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install/uninstall.html">卸载</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Upgrades</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade/upgrade.html">升级 SUSE® Rancher Prime: RKE2 集群</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade/manual_upgrade.html">手动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade/automated_upgrade.html">自动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade/roll_back.html">Rolling Back RKE2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/about_hardened_images.html">强化镜像</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/hardening_guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/cis_self_assessment111.html">CIS 1.11 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/cis_self_assessment110.html">CIS 1.10 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/cis_self_assessment19.html">CIS 1.9 Self-Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/fips3_support.html">FIPS 140-3 Enablement</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/pod_security_policies.html">默认 Pod 安全策略</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/pod_security_standards.html">默认 Pod 安全标准</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/secrets_encryption.html">Secrets Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/selinux.html">SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/certificates.html">Certificate Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/token.html">Token Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Datastore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="datastore/embedded.html">Embedded datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="datastore/external.html">External Datastore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="datastore/backup_restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">下一代 Kubernetes 发行版剖析</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cluster_access.html">集群访问</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/basic_network_options.html">Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/multus_sriov.html">Multus and SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/networking_services.html">Networking Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/windows_bgp.html">Windows and BGP</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="advanced.html">高级选项和配置</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Add-ons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-ons/helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-ons/import_images.html">Import Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add-ons/gpu_operators.html">GPU Operators</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/ai_conformance.html">CNCF AI Conformance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/cli_tools.html">CLI 工具</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/linux_agent_config.html">Agent 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/logging.html">日志</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/resource_profiling.html">Resource Profiling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/server_config.html">Server 配置参考</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/windows_agent_config.html">Windows Agent 配置参考</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="known_issues.html">已知问题和限制</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.35.X.html">v1.35.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.34.X.html">v1.34.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes-old/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RKE2</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../admission-controller/1.31/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../admission-controller/1.32/en/introduction.html">1.32-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../admission-controller/1.31/en/introduction.html">1.31-latest</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.30/en/introduction.html">1.30</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../cluster-api/v0.25/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../cluster-api/v0.25/en/index.html">0.25</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../continuous-delivery/v0.14/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../continuous-delivery/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../os-manager/1.8/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../os-manager/1.9/en/index.html">1.9-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../os-manager/1.8/en/index.html">1.8</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher for AWS</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">v2.13</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../storage/1.10/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../storage/1.10/en/longhorn-documentation.html">1.10 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.9/en/longhorn-documentation.html">1.9</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../suse-virtual-clusters/v1.0.1/en/introduction.html">SUSE® Virtual Clusters</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../suse-virtual-clusters/1.0.2/en/introduction.html">1.0.2-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../suse-virtual-clusters/v1.0.1/en/introduction.html">v1.0.1-latest</a>
            </li>
            <li class="version">
              <a href="../../../suse-virtual-clusters/v1.0.0/en/introduction.html">v1.0.0</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../virtualization/v1.6/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../virtualization/v1.7/en/introduction/overview.html">v1.7 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.5/en/introduction/overview.html">v1.5</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a class="home-link-dsc" href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home"></a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/rke2" title="RKE2" aria-label="SUSE Documentation - RKE2">
        RKE2
      </a>
    </li>
      <li>
          <a href="advanced.html" title="高级选项和配置" aria-label="高级选项和配置">高级选项和配置</a>
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/rke2-product-docs/edit/main/versions/latest/modules/zh/pages/advanced.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:rke2" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">高级选项和配置</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本文描述了用于运行和管理 RKE2 的高级设置：</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_证书轮换"><a class="anchor" href="#_证书轮换"></a>证书轮换</h2>
<div class="sectionbody">
<div class="paragraph">
<p>默认情况下，RKE2 中的证书在 12 个月后过期。</p>
</div>
<div class="paragraph">
<p>如果证书已经过期或剩余的时间不足 90 天，则在 RKE2 重启时轮换证书。</p>
</div>
<div class="paragraph">
<p>你可以手动轮换证书。为此，建议先停止 rke2-server 进程，然后轮换证书，最后再次启动该进程：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">systemctl stop rke2-server
rke2 certificate rotate
systemctl start rke2-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以通过传递 <code>--service</code> 标志来轮换单个服务，例如：<code>rke2 certificate rotate --service api-server</code>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_自动部署清单"><a class="anchor" href="#_自动部署清单"></a>自动部署清单</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 <code>/var/lib/rancher/rke2/server/manifests</code> 中找到的任何文件都会以类似于 <code>kubectl apply</code> 的方式自动部署到 Kubernetes。</p>
</div>
<div class="paragraph">
<p>有关使用清单目录部署 Helm Chart 的信息，请参阅 <a href="add-ons/helm.html" class="xref page">Helm</a> 章节。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置_containerd"><a class="anchor" href="#_配置_containerd"></a>配置 Containerd</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RKE2 会在 <code>/var/lib/rancher/rke2/agent/etc/containerd/config.toml</code> 中为 containerd 生成 <code>config.toml</code>。</p>
</div>
<div class="paragraph">
<p>如果要对这个文件进行高级定制，你可以在同一目录中创建另一个名为 <code>config.toml.tmpl</code> 的文件，此文件将会代替默认设置。</p>
</div>
<div class="paragraph">
<p><code>config.toml.tmpl</code> 是一个 Go 模板文件，并且 <code>config.Node</code> 结构会被传递给模板。有关如何使用该结构自定义配置文件的示例，请参见<a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates_linux.go#L10-L104">此模板</a>。</p>
</div>
<div class="sect2">
<h3 id="_base_template"><a class="anchor" href="#_base_template"></a>Base Template</h3>
<div class="paragraph">
<p>You can extend the RKE2 base template instead of copy-pasting the complete stock template out of the source code. This is useful if you need to build on the existing configuration, and add a few extra lines at the end.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">#/var/lib/rancher/rke2/agent/etc/containerd/config.toml.tmpl

{{ template "base" . }}

[plugins."io.containerd.grpc.v1.cri".containerd.runtimes."custom"]
  runtime_type = "io.containerd.runc.v2"
[plugins."io.containerd.grpc.v1.cri".containerd.runtimes."custom".options]
  BinaryName = "/usr/bin/custom-container-runtime"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置_http_代理"><a class="anchor" href="#_配置_http_代理"></a>配置 HTTP 代理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are running RKE2 in an environment, which only has external connectivity through an HTTP proxy, you can configure your proxy settings on the RKE2 systemd service. These proxy settings will then be used in RKE2 and passed down to the embedded containerd and kubelet, as well as the control-plane, etcd, and kube-proxy static pods.</p>
</div>
<div class="paragraph">
<p>将必要的 <code>HTTP_PROXY</code>、<code>HTTPS_PROXY</code> 和 <code>NO_PROXY</code> 变量添加到 systemd 服务的环境文件中，通常是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/etc/default/rke2-server</code></p>
</li>
<li>
<p><code>/etc/default/rke2-agent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RKE2 会自动将集群内部 Pod 和 Service IP 范围以及集群 DNS 域添加到 <code>NO_PROXY</code> 条目列表中。你需要确保 Kubernetes 节点本身使用的 IP 地址范围（即节点的公共和私有 IP）包含在 <code>NO_PROXY</code> 列表中，或者可以通过代理访问节点。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">HTTP_PROXY=http://your-proxy.example.com:8888
HTTPS_PROXY=http://your-proxy.example.com:8888
NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你想在不影响 RKE2 和 Kubelet 的情况下为 containerd 配置代理，你可以在变量前加上 <code>CONTAINERD_</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">CONTAINERD_HTTP_PROXY=http://your-proxy.example.com:8888
CONTAINERD_HTTPS_PROXY=http://your-proxy.example.com:8888
CONTAINERD_NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_节点标签和污点"><a class="anchor" href="#_节点标签和污点"></a>节点标签和污点</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RKE2 Agent 可以通过 <code>node-label</code> 和 <code>node-taint</code> 选项来配置，它们会为 kubelet 添加标签和污点。这两个选项只能在注册时添加标签和/或污点，因此它们只能被添加一次，之后不能再通过运行 rke2 命令来移除。</p>
</div>
<div class="paragraph">
<p>如果你想在节点注册后更改节点标签和污点，你需要使用 <code>kubectl</code>。关于如何添加<a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">污点</a>和<a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node">节点标签</a>的详细信息，请参阅官方 Kubernetes 文档。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_agent_节点注册的工作原理"><a class="anchor" href="#_agent_节点注册的工作原理"></a>Agent 节点注册的工作原理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agent 节点通过 <code>rke2 agent</code> 进程发起的 WebSocket 连接进行注册，连接由作为 agent 进程一部分运行的客户端负载均衡器维护。</p>
</div>
<div class="paragraph">
<p>Agent 将使用 join token 的集群 Secret 以及随机生成的节点密码注册到 Server，密码存储在 <code>/etc/rancher/node/password</code> 中。Server 会将各个节点的密码存储为 Kubernetes Secret，后续的任何尝试都必须使用相同的密码。节点密码 Secret 存储在 <code>kube-system</code> 命名空间中，名称使用 <code>&lt;host&gt;.node-password.rke2</code> 模板。当相应的 Kubernetes 节点被删除时，这些 Secret 也会被删除。</p>
</div>
<div class="paragraph">
<p>如果 Agent 的 <code>/etc/rancher/node</code> 目录被删除，你需要在启动前为 Agent 重新创建密码文件，或者从 Server 或 Kubernetes 集群中删除该条目（取决于 RKE2版本）。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_使用安装脚本启动_server"><a class="anchor" href="#_使用安装脚本启动_server"></a>使用安装脚本启动 Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>安装脚本为 systemd 提供了单元，但默认情况下不启用或启动该服务。</p>
</div>
<div class="paragraph">
<p>使用 systemd 运行时，日志将在 <code>/var/log/syslog</code> 中创建，你可以通过 <code>journalctl -u rke2-server</code> 或 <code>journalctl -u rke2-agent</code> 查看日志。</p>
</div>
<div class="paragraph">
<p>使用安装脚本安装的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -sfL https://get.rke2.io | sh -
systemctl enable rke2-server
systemctl start rke2-server</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>中国用户，可以使用以下方法加速安装：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -sfL https://rancher-mirror.rancher.cn/rke2/install.sh | INSTALL_RKE2_MIRROR=cn sh -
systemctl enable rke2-server
systemctl start rke2-server</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_禁用_server_chart"><a class="anchor" href="#_禁用_server_chart"></a>禁用 Server Chart</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在集群引导期间与 <code>rke2</code> 绑在一起的 Server Chart 可以被禁用并替换。常见的用例是替换捆绑的 <code>rke2-ingress-nginx</code> Chart。</p>
</div>
<div class="paragraph">
<p>要禁用任何捆绑的系统 Chart，请在引导之前在配置文件中设置 <code>disable</code> 参数。要禁用的系统 Chart 完整列表：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rke2-canal</code></p>
</li>
<li>
<p><code>rke2-coredns</code></p>
</li>
<li>
<p><code>rke2-ingress-nginx</code></p>
</li>
<li>
<p><code>rke2-metrics-server</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，由于 server Chart 对集群的操作非常重要，因此集群操作人员需要确保已禁用或更换组件。有关集群中各个系统 Chart 角色的更多信息，请参阅<a href="architecture.html#_server_charts" class="xref page">架构概述</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_在分类的_aws_区域或具有自定义_aws_api_端点的网络上安装"><a class="anchor" href="#_在分类的_aws_区域或具有自定义_aws_api_端点的网络上安装"></a>在分类的 AWS 区域或具有自定义 AWS API 端点的网络上安装</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在公共 AWS 区域，为确保 RKE2 支持云并且能够自动配置某些云资源，请使用以下内容配置 RKE2：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># /etc/rancher/rke2/config.yaml
cloud-provider-name: aws</code></pre>
</div>
</div>
<div class="paragraph">
<p>在分类区域（例如 SC2S 或 C2S）上安装 RKE2 时，你需要注意一些额外的条件，从而确保 RKE2 知道如何以及在哪里与适当的 AWS 端点进行安全通信。</p>
</div>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>确保满足所有常见的 AWS 云提供商<a href="https://rancher.com/docs/rke/latest/en/config-options/cloud-providers/aws/">先决条件</a>。它们与区域无关，并且始终是必需的。</p>
</li>
<li>
<p>通过创建 <code>cloud.conf</code> 文件确保 RKE2 知道将 <code>ec2</code> 和 <code>elasticloadbalancing</code> 服务的 API 请求发送到哪里，以下是 <code>us-iso-east-1</code> (C2S) 区域的示例：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># /etc/rancher/rke2/cloud.conf
[Global]
[ServiceOverride "ec2"]
  Service=ec2
  Region=us-iso-east-1
  URL=https://ec2.us-iso-east-1.c2s.ic.gov
  SigningRegion=us-iso-east-1
[ServiceOverride "elasticloadbalancing"]
  Service=elasticloadbalancing
  Region=us-iso-east-1
  URL=https://elasticloadbalancing.us-iso-east-1.c2s.ic.gov
  SigningRegion=us-iso-east-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你使用的是<a href="https://docs.aws.amazon.com/vpc/latest/privatelink/endpoint-services-overview.html">私有 AWS 端点</a>，请确保为每个私有端点使用适当的 <code>URL</code>。</p>
</div>
</li>
<li>
<p>确保将适当的 AWS CA 包加载到系统的根 CA 信任库中。该操作可能已完成，具体取决于你使用的 AMI。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># on CentOS/RHEL 7/8
cp &lt;ca.pem&gt; /etc/pki/ca-trust/source/anchors/
update-ca-trust</code></pre>
</div>
</div>
</li>
<li>
<p>使用在步骤 1 中创建的自定义 <code>cloud.conf</code> 配置 RKE2，以使用 <code>aws</code> 云提供商：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># /etc/rancher/rke2/config.yaml
...
cloud-provider-name: aws
cloud-provider-config: "/etc/rancher/rke2/cloud.conf"
...</code></pre>
</div>
</div>
</li>
<li>
<p><a href="install/methods.html" class="xref page">正常安装</a> RKE2（很可能使用<a href="install/airgap.html" class="xref page">离线</a>安装）。</p>
</li>
<li>
<p>使用 <code>kubectl get nodes --show-labels</code> 确认集群节点标签上是否存在 AWS 元数据，从而验证安装是否成功。</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_control_plane_组件资源请求限制"><a class="anchor" href="#_control_plane_组件资源请求限制"></a>Control Plane 组件资源请求/限制</h2>
<div class="sectionbody">
<div class="paragraph">
<p>以下选项在 RKE2 的 <code>server</code> 子命令下可用。这些选项允许为 RKE2 中的 control plane 组件指定 CPU 请求和限制。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">   --control-plane-resource-requests value       (components) Control Plane resource requests [$RKE2_CONTROL_PLANE_RESOURCE_REQUESTS]
   --control-plane-resource-limits value         (components) Control Plane resource limits [$RKE2_CONTROL_PLANE_RESOURCE_LIMITS]</code></pre>
</div>
</div>
<div class="paragraph">
<p>值是 <code>[controlplane-component]-(cpu|memory)=[desired-value]</code> 格式的逗号分隔列表。<code>controlplane-component</code> 的值可能是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">kube-apiserver
kube-scheduler
kube-controller-manager
kube-proxy
etcd
cloud-controller-manager</code></pre>
</div>
</div>
<div class="paragraph">
<p>因此，示例配置值可能如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># /etc/rancher/rke2/config.yaml
control-plane-resource-requests:
  - kube-apiserver-cpu=500m
  - kube-apiserver-memory=512M
  - kube-scheduler-cpu=250m
  - kube-scheduler-memory=512M
  - etcd-cpu=1000m</code></pre>
</div>
</div>
<div class="paragraph">
<p>CPU/内存的单位值与 Kubernetes 资源单位相同（参见 <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-units-in-kubernetes">Kubernetes 中的资源限制</a>）。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_额外的_control_plane_组件卷挂载"><a class="anchor" href="#_额外的_control_plane_组件卷挂载"></a>额外的 control plane 组件卷挂载</h2>
<div class="sectionbody">
<div class="paragraph">
<p>以下选项在 RKE2 的 <code>server</code> 子命令下可用。些选项指定主机路径，将节点文件系统中的目录挂载到与前缀名称相对应的静态 Pod 组件中。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">标志</th>
<th class="tableblock halign-left valign-top">ENV VAR</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-apiserver-extra-mount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_APISERVER_EXTRA_MOUNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kube-apiserver extra volume mounts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-scheduler-extra-mount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_SCHEDULER_EXTRA_MOUNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kube-scheduler extra volume mounts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-controller-manager-extra-mount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_MOUNT</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-proxy-extra-mount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_PROXY_EXTRA_MOUNT</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-extra-mount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_ETCD_EXTRA_MOUNT</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--cloud-controller-manager-extra-mount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_MOUNT</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_rw_主机路径卷挂载"><a class="anchor" href="#_rw_主机路径卷挂载"></a>RW 主机路径卷挂载</h3>
<div class="paragraph">
<p><code>/source/volume/path/on/host:/destination/volume/path/in/staticpod</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_ro_主机路径卷挂载"><a class="anchor" href="#_ro_主机路径卷挂载"></a>RO 主机路径卷挂载</h3>
<div class="paragraph">
<p>要将卷挂载为只读，在卷挂载的最后加上 <code>:ro</code>。
<code>/source/volume/path/on/host:/destination/volume/path/in/staticpod:ro</code></p>
</div>
<div class="paragraph">
<p>通过在配置文件中以数组形式传递标志值，可以为同一个组件指定多个卷挂载。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># /etc/rancher/rke2/config.yaml
kube-apiserver-extra-mount:
   - "/tmp/foo.yaml:/root/foo.yaml"
   - "/tmp/bar.txt:/etc/bar.txt:ro"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_额外的_control_plane_组件环境变量"><a class="anchor" href="#_额外的_control_plane_组件环境变量"></a>额外的 Control Plane 组件环境变量</h2>
<div class="sectionbody">
<div class="paragraph">
<p>以下选项在 RKE2 的 <code>server</code> 子命令下可用。这些选项以标准格式指定额外的环境变量，即 <code>KEY=VALUE</code>，用于与前缀名称相对应的静态 Pod 组件。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">标志</th>
<th class="tableblock halign-left valign-top">ENV VAR</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-apiserver-extra-env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_APISERVER_EXTRA_ENV</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-scheduler-extra-env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_SCHEDULER_EXTRA_ENV</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-controller-manager-extra-env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_ENV</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--kube-proxy-extra-env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_KUBE_PROXY_EXTRA_ENV</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-extra-env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_ETCD_EXTRA_ENV</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--cloud-controller-manager-extra-env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_ENV</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>通过在配置文件中以数组形式传递标志值，可以为同一个组件指定多个环境变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># /etc/rancher/rke2/config.yaml
kube-apiserver-extra-env:
  - "MY_FOO=FOO"
  - "MY_BAR=BAR"
kube-scheduler-extra-env: "TZ=America/Los_Angeles"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_nvidia_operator"><a class="anchor" href="#_deploy_nvidia_operator"></a>Deploy NVIDIA operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/latest/index.html">NVIDIA operator</a> allows administrators of Kubernetes clusters to manage GPUs just like CPUs. It includes everything needed for pods to be able to operate GPUs.</p>
</div>
<div class="sect2">
<h3 id="_host_os_requirements"><a class="anchor" href="#_host_os_requirements"></a>Host OS requirements</h3>
<div class="paragraph">
<p>To expose the GPU to the pod correctly, the NVIDIA kernel drivers and the <code>libnvidia-ml</code> library must be correctly installed in the host OS. The NVIDIA Operator can automatically install drivers and libraries on some operating systems; check the NVIDIA documentation for information on <a href="https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/latest/platform-support.html#supported-operating-systems-and-kubernetes-platforms">supported operating system releases</a>. Installation of the NVIDIA components on your host OS is out of the scope of this document; reference the NVIDIA documentation for instructions.</p>
</div>
<div class="paragraph">
<p>The following three commands should return a correct output if the kernel driver is correctly installed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>lsmod | grep nvidia</code> returns a list of Nvidia kernel modules. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nvidia_uvm           2129920  0
nvidia_drm            131072  0
nvidia_modeset       1572864  1 nvidia_drm
video                  77824  1 nvidia_modeset
nvidia               9965568  2 nvidia_uvm,nvidia_modeset
ecc                    45056  1 nvidia</code></pre>
</div>
</div>
</li>
<li>
<p><code>cat /proc/driver/nvidia/version</code> returns the NVRM and GCC version of the driver. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NVRM version: NVIDIA UNIX Open Kernel Module for x86_64  555.42.06  Release Build  (abuild@host)  Thu Jul 11 12:00:00 UTC 2024
GCC version:  gcc version 7.5.0 (SUSE Linux)</code></pre>
</div>
</div>
</li>
<li>
<p><code>find /usr/ -iname libnvidia-ml.so</code> returns a path to the <code>libnvidia-ml.so</code> library. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/usr/lib64/libnvidia-ml.so</code></pre>
</div>
</div>
<div class="paragraph">
<p>This library is used by Kubernetes components to interact with the kernel driver.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_operator_installation"><a class="anchor" href="#_operator_installation"></a>Operator installation</h3>
<div class="paragraph">
<p>Once the OS is ready and RKE2 is running, install the GPU Operator with the following yaml manifest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: gpu-operator
  namespace: kube-system
spec:
  repo: https://helm.ngc.nvidia.com/nvidia
  chart: gpu-operator
  targetNamespace: gpu-operator
  createNamespace: true
  valuesContent: |-
    toolkit:
      env:
      - name: CONTAINERD_SOCKET
        value: /run/k3s/containerd/containerd.sock</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The NVIDIA operator restarts containerd with a hangup call which restarts RKE2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After one minute approximately, you can make the following checks to verify that everything works as expected.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Assuming the drivers and <code>libnvidia-ml.so</code> library are installed, check if the operator detects them correctly.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get node $NODENAME -o jsonpath='{.metadata.labels}' | grep "nvidia.com/gpu.deploy.driver"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the value <code>pre-installed</code>. If you see <code>true</code>, the drivers are not correctly installed. If the <a href="#_host_os_requirements">pre-requirements</a> are correct, it is possible that you forgot to reboot the node after installing all packages.</p>
</div>
<div class="paragraph">
<p>You can also check other driver labels with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get node $NODENAME -o jsonpath='{.metadata.labels}' | jq | grep "nvidia.com"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see labels specifying driver and GPU (e.g. <code>nvidia.com/gpu.machine</code> or <code>nvidia.com/cuda.driver.major</code>).</p>
</div>
</li>
<li>
<p>Check if the gpu was added (by nvidia-device-plugin-daemonset) as an allocatable resource in the node.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get node $NODENAME -o jsonpath='{.status.allocatable}' | jq</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see <code>"nvidia.com/gpu":</code> followed by the number of gpus in the node.</p>
</div>
</li>
<li>
<p>Check that the container runtime binary was installed by the operator (in particular by the <code>nvidia-container-toolkit-daemonset</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ls /usr/local/nvidia/toolkit/nvidia-container-runtime</code></pre>
</div>
</div>
</li>
<li>
<p>Verify if containerd config was updated to include the nvidia container runtime.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep nvidia /etc/containerd/config.toml</code></pre>
</div>
</div>
</li>
<li>
<p>Run a pod to verify that the GPU resource can successfully be scheduled on a pod and the pod can detect it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Pod
metadata:
  name: nbody-gpu-benchmark
  namespace: default
spec:
  restartPolicy: OnFailure
  runtimeClassName: nvidia
  containers:
  - name: cuda-container
    image: nvcr.io/nvidia/k8s/cuda-sample:nbody
    args: ["nbody", "-gpu", "-benchmark"]
    resources:
      limits:
        nvidia.com/gpu: 1
    env:
    - name: NVIDIA_VISIBLE_DEVICES
      value: all
    - name: NVIDIA_DRIVER_CAPABILITIES
      value: compute,utility</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>Available as of October 2024 releases: v1.28.15+rke2r1, v1.29.10+rke2r1, v1.30.6+rke2r1, v1.31.2+rke2r1.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RKE2 will now use <code>PATH</code> to find alternative container runtimes, in addition to checking the default paths used by the container runtime packages. In order to use this feature, you must modify the RKE2 service&#8217;s PATH environment variable to add the directories containing the container runtime binaries.</p>
</div>
<div class="paragraph">
<p>It&#8217;s recommended that you modify one of this two environment files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/etc/default/rke2-server # or rke2-agent</p>
</li>
<li>
<p>/etc/sysconfig/rke2-server # or rke2-agent</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example adds the <code>PATH</code> in <code>/etc/default/rke2-server</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo PATH=$PATH &gt;&gt; /etc/default/rke2-server</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>PATH</code> changes should be done with care to avoid placing untrusted binaries in the path of services that run as root.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="networking/windows_bgp.html">Windows and BGP</a></span>
  <span class="next"><a href="add-ons/helm.html">Helm</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
