<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CIS ハードニングガイド :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/k3s/latest/ja/security/hardening-guide.html">
    <link rel="prev" href="secrets-encryption.html">
    <link rel="next" href="self-assessment-1.10.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-03-26"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ja/security/hardening-guide.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/security/hardening-guide.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ja/security/hardening-guide.html" hrefLang="ja-JP" rel="alternate" />


<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/security/hardening-guide.html" hreflang="en-US" rel="alternate" />

<!-- Link for the Korean page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ko/security/hardening-guide.html" hreflang="ko-KR" rel="alternate" />


<!-- Link for the Chinese page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/zh/security/hardening-guide.html" hreflang="zh-CN" rel="alternate" />






<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="k3s" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">K3s</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">K3s - 軽量なKubernetes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quick-start.html">クイックスタートガイド</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../installation/installation.html">インストール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/requirements.html">要件</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/configuration.html">設定オプション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/private-registry.html">プライベートレジストリの設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/registry-mirror.html">埋め込みレジストリミラー</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/airgap.html">エアギャップインストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/server-roles.html">サーバーロールの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/packaged-components.html">パッケージ化されたコンポーネントの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/uninstall.html">K3sのアンインストール</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../datastore/datastore.html">クラスタデータストア</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/backup-restore.html">バックアップとリストア</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha-embedded.html">高可用性組み込みetcd</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha.html">高可用性外部データベース</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/cluster-loadbalancer.html">クラスター・ロードバランサー</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">アップグレード</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/killall.html">K3sの停止</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/manual.html">手動アップグレード</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/automated.html">自動アップグレード</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/roll-back.html">Rolling Back K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="security.html">セキュリティ</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="secrets-encryption.html">secretの暗号化設定</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="hardening-guide.html">CIS ハードニングガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="self-assessment-1.10.html">CIS 1.10 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="self-assessment-1.9.html">CIS 1.9 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="self-assessment-1.8.html">CIS 1.8 セルフアセスメントガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="self-assessment-1.7.html">CIS 1.7 セルフアセスメントガイド</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../cli/cli.html">CLIツール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/server.html">server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/agent.html">k3s エージェント</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/certificate.html">certificate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/etcd-snapshot.html">etcd-snapshot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/secrets-encrypt.html">secrets-encrypt</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/token.html">token</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">アーキテクチャ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster-access.html">クラスターアクセス</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../storage.html">ボリュームとストレージ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../import-images.html">Import images</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../networking/networking.html">ネットワーキング</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic-network-options.html">基本的なネットワークオプション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/distributed-multicloud.html">分散型ハイブリッドまたはマルチクラウドクラスター</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus-ipams.html">Multus and IPAM plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking-services.html">ネットワーキングサービス</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高度なオプション / 設定</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/env-variables.html">環境変数</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/flag-deprecation.html">フラグの非推奨化</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource-profiling.html">リソースプロファイリング</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../related-projects.html">関連プロジェクト</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known-issues.html">既知の問題</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3s</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/k3s" title="K3s" aria-label="SUSE Documentation - K3s">
        K3s
      </a>
    </li>
      <li>
          <a href="security.html" title="セキュリティ" aria-label="セキュリティ">セキュリティ</a>
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/k3s-product-docs/edit/main/docs/latest/modules/ja/pages/security/hardening-guide.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:k3s" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CIS ハードニングガイド</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このドキュメントは、K3s の本番インストールをハードニングするための指針を提供します。これは、Center for Internet Security (CIS) の Kubernetes ベンチマークコントロールに対応するために必要な設定とコントロールを概説しています。</p>
</div>
<div class="paragraph">
<p>K3s には多くのセキュリティ緩和策がデフォルトで適用されており、変更なしで多くの Kubernetes CIS コントロールに合格します。ただし、CIS ベンチマークに完全に準拠するためには手動での介入が必要な例外もいくつかあります。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>K3s はホストオペレーティングシステムを変更しません。ホストレベルの変更は手動で行う必要があります。</p>
</li>
<li>
<p><code>NetworkPolicies</code> および <code>PodSecurityStandards</code> (<code>v1.24</code> 以前では <code>PodSecurityPolicies</code>) に関する特定の CIS ポリシーコントロールは、クラスターの機能を制限します。これらを設定するには、コマンドラインフラグまたは設定ファイルに適切なオプション（アドミッションプラグインの有効化）を追加し、適切なポリシーを手動で適用する必要があります。詳細は以下のセクションに記載されています。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>CIS ベンチマークの最初のセクション (1.1) は主にポッドマニフェストの権限と所有権に関するものです。K3s はコアコンポーネントにこれらを使用しません。すべてが単一のバイナリにパッケージ化されているためです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ホストレベルの要件"><a class="anchor" href="#_ホストレベルの要件"></a>ホストレベルの要件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ホストレベルの要件には、カーネルパラメータと etcd プロセス/ディレクトリの設定の2つの領域があります。これらはこのセクションで概説されています。</p>
</div>
<div class="sect2">
<h3 id="_protect_kernel_defaults_が設定されていることを確認する"><a class="anchor" href="#_protect_kernel_defaults_が設定されていることを確認する"></a><code>protect-kernel-defaults</code> が設定されていることを確認する</h3>
<div class="paragraph">
<p>これは、必要なカーネルパラメータが未設定または kubelet のデフォルト値と異なる値に設定されている場合に kubelet が終了するようにする kubelet フラグです。</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>注:</strong> <code>protect-kernel-defaults</code> は K3s のトップレベルフラグとして公開されています。</p>
</div>
</blockquote>
</div>
<div class="sect3">
<h4 id="_カーネルパラメータを設定する"><a class="anchor" href="#_カーネルパラメータを設定する"></a>カーネルパラメータを設定する</h4>
<div class="paragraph">
<p><code>/etc/sysctl.d/90-kubelet.conf</code> というファイルを作成し、以下のスニペットを追加します。その後、<code>sysctl -p /etc/sysctl.d/90-kubelet.conf</code> を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vm.panic_on_oom=0
vm.overcommit_memory=1
kernel.panic=10
kernel.panic_on_oops=1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_ランタイム要件"><a class="anchor" href="#_kubernetes_ランタイム要件"></a>Kubernetes ランタイム要件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CIS ベンチマークに準拠するためのランタイム要件は、ポッドセキュリティ（PSP または PSA 経由）、ネットワークポリシー、および API サーバーの監査ログに集中しています。これらはこのセクションで概説されています。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、K3s にはポッドセキュリティやネットワークポリシーは含まれていません。ただし、K3s にはネットワークポリシーを強制するコントローラーが付属しており、作成された場合に適用されます。K3s はデフォルトで監査を有効にしていないため、監査ログの設定と監査ポリシーを手動で作成する必要があります。デフォルトでは、K3s は <code>PodSecurity</code> および <code>NodeRestriction</code> アドミッションコントローラーを含む複数のアドミッションコントローラーを有効にして実行されます。</p>
</div>
<div class="sect2">
<h3 id="_ポッドセキュリティ"><a class="anchor" href="#_ポッドセキュリティ"></a>ポッドセキュリティ</h3>
<div id="_tabs_1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_v1_25_and_newer" class="tab">
<p>v1.25 and Newer</p>
</li>
<li id="_tabs_1_v1_24_and_older" class="tab">
<p>v1.24 and Older</p>
</li>
</ul>
</div>
<div id="_tabs_1_v1_25_and_newer--panel" class="tabpanel" aria-labelledby="_tabs_1_v1_25_and_newer">
<div class="paragraph">
<p>K3s v1.25 以降は、ポッドセキュリティを制御するための <a href="https://kubernetes.io/docs/concepts/security/pod-security-admission/">Pod Security Admissions (PSAs)</a> をサポートしています。PSA は以下のフラグを K3s サーバーに渡すことで有効になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--kube-apiserver-arg="admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml"</pre>
</div>
</div>
<div class="paragraph">
<p>ポリシーは <code>/var/lib/rancher/k3s/server</code> ディレクトリに <code>psa.yaml</code> という名前のファイルに書き込む必要があります。</p>
</div>
<div class="paragraph">
<p>以下は準拠した PSA の例です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apiserver.config.k8s.io/v1
kind: AdmissionConfiguration
plugins:
- name: PodSecurity
  configuration:
    apiVersion: pod-security.admission.config.k8s.io/v1beta1
    kind: PodSecurityConfiguration
    defaults:
      enforce: "restricted"
      enforce-version: "latest"
      audit: "restricted"
      audit-version: "latest"
      warn: "restricted"
      warn-version: "latest"
    exemptions:
      usernames: []
      runtimeClasses: []
      namespaces: [kube-system, cis-operator-system]</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_v1_24_and_older--panel" class="tabpanel" aria-labelledby="_tabs_1_v1_24_and_older">
<div class="paragraph">
<p>K3s v1.24 以前は、ポッドセキュリティを制御するための <a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/">Pod Security Policies (PSPs)</a> をサポートしています。PSP は以下のフラグを K3s サーバーに渡すことで有効になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--kube-apiserver-arg="enable-admission-plugins=NodeRestriction,PodSecurityPolicy"</pre>
</div>
</div>
<div class="paragraph">
<p>これにより、<code>NodeRestriction</code> プラグインを維持しつつ、<code>PodSecurityPolicy</code> を有効にします。</p>
</div>
<div class="paragraph">
<p>PSP が有効になると、CIS ベンチマークのセクション 5.2 で説明されている必要なコントロールを満たすためのポリシーを適用できます。</p>
</div>
<div class="paragraph">
<p>以下は準拠した PSP の例です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: restricted-psp
spec:
  privileged: false                # CIS - 5.2.1
  allowPrivilegeEscalation: false  # CIS - 5.2.5
  requiredDropCapabilities:        # CIS - 5.2.7/8/9
    - ALL
  volumes:
    - 'configMap'
    - 'emptyDir'
    - 'projected'
    - 'secret'
    - 'downwardAPI'
    - 'csi'
    - 'persistentVolumeClaim'
    - 'ephemeral'
  hostNetwork: false               # CIS - 5.2.4
  hostIPC: false                   # CIS - 5.2.3
  hostPID: false                   # CIS - 5.2.2
  runAsUser:
    rule: 'MustRunAsNonRoot'       # CIS - 5.2.6
  seLinux:
    rule: 'RunAsAny'
  supplementalGroups:
    rule: 'MustRunAs'
    ranges:
      - min: 1
        max: 65535
  fsGroup:
    rule: 'MustRunAs'
    ranges:
      - min: 1
        max: 65535
  readOnlyRootFilesystem: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記の PSP を有効にするためには、ClusterRole と ClusterRoleBinding を作成する必要があります。また、追加の特権を必要とするシステムレベルのポッドに必要な「システム無制限ポリシー」と、servicelb が正常に機能するために必要な sysctl を許可する追加のポリシーも含める必要があります。</p>
</div>
<div class="paragraph">
<p>上記の設定を次のセクションで説明する <a href="#_networkpolicies">ネットワークポリシー</a> と組み合わせて、単一のファイルを <code>/var/lib/rancher/k3s/server/manifests</code> ディレクトリに配置できます。以下は <code>policy.yaml</code> ファイルの例です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: restricted-psp
spec:
  privileged: false
  allowPrivilegeEscalation: false
  requiredDropCapabilities:
    - ALL
  volumes:
    - 'configMap'
    - 'emptyDir'
    - 'projected'
    - 'secret'
    - 'downwardAPI'
    - 'csi'
    - 'persistentVolumeClaim'
    - 'ephemeral'
  hostNetwork: false
  hostIPC: false
  hostPID: false
  runAsUser:
    rule: 'MustRunAsNonRoot'
  seLinux:
    rule: 'RunAsAny'
  supplementalGroups:
    rule: 'MustRunAs'
    ranges:
      - min: 1
        max: 65535
  fsGroup:
    rule: 'MustRunAs'
    ranges:
      - min: 1
        max: 65535
  readOnlyRootFilesystem: false
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: system-unrestricted-psp
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: '*'
spec:
  allowPrivilegeEscalation: true
  allowedCapabilities:
  - '*'
  fsGroup:
    rule: RunAsAny
  hostIPC: true
  hostNetwork: true
  hostPID: true
  hostPorts:
  - max: 65535
    min: 0
  privileged: true
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    rule: RunAsAny
  volumes:
  - '*'
---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: svclb-psp
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: '*'
spec:
  allowPrivilegeEscalation: false
  allowedCapabilities:
  - NET_ADMIN
  allowedUnsafeSysctls:
  - net.ipv4.ip_forward
  - net.ipv6.conf.all.forwarding
  fsGroup:
    rule: RunAsAny
  hostPorts:
  - max: 65535
    min: 0
  runAsUser:
    rule: RunAsAny
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    rule: RunAsAny
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: psp:restricted-psp
rules:
- apiGroups:
  - policy
  resources:
  - podsecuritypolicies
  verbs:
  - use
  resourceNames:
  - restricted-psp
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: psp:system-unrestricted-psp
rules:
- apiGroups:
  - policy
  resources:
  - podsecuritypolicies
  resourceNames:
  - system-unrestricted-psp
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: psp:svclb-psp
rules:
- apiGroups:
  - policy
  resources:
  - podsecuritypolicies
  resourceNames:
  - svclb-psp
  verbs:
  - use
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: default:restricted-psp
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: psp:restricted-psp
subjects:
- kind: Group
  name: system:authenticated
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: system-unrestricted-node-psp-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: psp:system-unrestricted-psp
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:nodes
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: system-unrestricted-svc-acct-psp-rolebinding
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: psp:system-unrestricted-psp
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:serviceaccounts
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: svclb-psp-rolebinding
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: psp:svclb-psp
subjects:
- kind: ServiceAccount
  name: svclb
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: intra-namespace
  namespace: kube-system
spec:
  podSelector: {}
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: kube-system
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: intra-namespace
  namespace: default
spec:
  podSelector: {}
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: default
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: intra-namespace
  namespace: kube-public
spec:
  podSelector: {}
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: kube-public</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>注意:</strong> Kubernetes の重要な追加機能である CNI、DNS、および Ingress は <code>kube-system</code> ネームスペースでポッドとして実行されます。したがって、これらのコンポーネントが適切に動作するために、このネームスペースには制限が少ないポリシーが適用されます。</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_networkpolicies"><a class="anchor" href="#_networkpolicies"></a>NetworkPolicies</h3>
<div class="paragraph">
<p>CIS は、すべてのネームスペースに対して、ネームスペースおよびポッドへのトラフィックを合理的に制限するネットワークポリシーが適用されることを要求しています。</p>
</div>
<div class="paragraph">
<p>ネットワークポリシーは <code>/var/lib/rancher/k3s/server/manifests</code> ディレクトリに配置する必要があり、起動時に自動的にデプロイされます。</p>
</div>
<div class="paragraph">
<p>以下は、準拠したネットワークポリシーの例です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: intra-namespace
  namespace: kube-system
spec:
  podSelector: {}
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: kube-system</code></pre>
</div>
</div>
<div class="paragraph">
<p>適用された制限により、DNS は意図的に許可されない限りブロックされます。以下は、DNS のトラフィックを許可するネットワークポリシーです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-network-dns-policy
  namespace: &lt;NAMESPACE&gt;
spec:
  ingress:
  - ports:
    - port: 53
      protocol: TCP
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      k8s-app: kube-dns
  policyTypes:
  - Ingress</code></pre>
</div>
</div>
<div class="paragraph">
<p>メトリクスサーバーおよび Traefik Ingress コントローラーは、アクセスを許可するネットワークポリシーが作成されない限り、デフォルトでブロックされます。Ensure that you use the sample yaml below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-metrics-server
  namespace: kube-system
spec:
  podSelector:
    matchLabels:
      k8s-app: metrics-server
  ingress:
  - {}
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-svclbtraefik-ingress
  namespace: kube-system
spec:
  podSelector:
    matchLabels:
      svccontroller.k3s.cattle.io/svcname: traefik
  ingress:
  - {}
  policyTypes:
  - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-traefik-v121-ingress
  namespace: kube-system
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: traefik
  ingress:
  - {}
  policyTypes:
  - Ingress
---</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>オペレーターは、作成された追加のネームスペースに対して通常通りネットワークポリシーを管理する必要があります。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_api_サーバーの監査設定"><a class="anchor" href="#_api_サーバーの監査設定"></a>API サーバーの監査設定</h3>
<div class="paragraph">
<p>CIS 要件 1.2.22 から 1.2.25 は、API サーバーの監査ログの設定に関連しています。K3s はデフォルトでログディレクトリと監査ポリシーを作成しません。監査要件は各ユーザーのポリシーと環境に依存するためです。</p>
</div>
<div class="paragraph">
<p>ログディレクトリは、理想的には K3s を開始する前に作成する必要があります。潜在的な機密情報の漏洩を防ぐために、制限されたアクセス権限を推奨します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo mkdir -p -m 700 /var/lib/rancher/k3s/server/logs</code></pre>
</div>
</div>
<div class="paragraph">
<p>リクエストメタデータをログに記録するための初期監査ポリシーを以下に示します。このポリシーは <code>/var/lib/rancher/k3s/server</code> ディレクトリに <code>audit.yaml</code> という名前のファイルに書き込む必要があります。API サーバーのポリシー設定に関する詳細情報は、Kubernetes の<a href="https://kubernetes.io/docs/tasks/debug-application-cluster/audit/">ドキュメント</a>に記載されています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: audit.k8s.io/v1
kind: Policy
rules:
- level: Metadata</code></pre>
</div>
</div>
<div class="paragraph">
<p>両方の設定は、API サーバーへの引数として渡す必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--kube-apiserver-arg='audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log'
--kube-apiserver-arg='audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml'</code></pre>
</div>
</div>
<div class="paragraph">
<p>設定が K3s インストール後に作成された場合、それらは <code>/etc/systemd/system/k3s.service</code> の K3s の systemd サービスに追加する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ExecStart=/usr/local/bin/k3s \
    server \
	'--kube-apiserver-arg=audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log' \
	'--kube-apiserver-arg=audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml' \</code></pre>
</div>
</div>
<div class="paragraph">
<p>新しい設定を読み込むために K3s を再起動する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo systemctl daemon-reload
sudo systemctl restart k3s.service</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_コンポーネントの設定"><a class="anchor" href="#_kubernetes_コンポーネントの設定"></a>Kubernetes コンポーネントの設定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>以下の設定は<a href="../installation/configuration.html#_configuration_file" class="xref page">設定ファイル</a>に配置する必要があり、Kubernetes コンポーネントを強化するために必要なすべての修正が含まれています。</p>
</div>
<div id="_tabs_2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_v1_25_and_newer" class="tab">
<p>v1.25 and Newer</p>
</li>
<li id="_tabs_2_v1_24_and_older" class="tab">
<p>v1.24 and Older</p>
</li>
</ul>
</div>
<div id="_tabs_2_v1_25_and_newer--panel" class="tabpanel" aria-labelledby="_tabs_2_v1_25_and_newer">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">protect-kernel-defaults: true
secrets-encryption: true
kube-apiserver-arg:
  - 'admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml'
  - 'audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log'
  - 'audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml'
  - 'audit-log-maxage=30'
  - 'audit-log-maxbackup=10'
  - 'audit-log-maxsize=100'
  - 'request-timeout=300s'
  - 'service-account-lookup=true'
kube-controller-manager-arg:
  - 'terminated-pod-gc-threshold=10'
  - 'use-service-account-credentials=true'
kubelet-arg:
  - 'streaming-connection-idle-timeout=5m'
  - 'make-iptables-util-chains=true'</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_v1_24_and_older--panel" class="tabpanel" aria-labelledby="_tabs_2_v1_24_and_older">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">protect-kernel-defaults: true
secrets-encryption: true
kube-apiserver-arg:
  - 'enable-admission-plugins=NodeRestriction,PodSecurityPolicy,NamespaceLifecycle,ServiceAccount'
  - 'audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log'
  - 'audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml'
  - 'audit-log-maxage=30'
  - 'audit-log-maxbackup=10'
  - 'audit-log-maxsize=100'
  - 'request-timeout=300s'
  - 'service-account-lookup=true'
kube-controller-manager-arg:
  - 'terminated-pod-gc-threshold=10'
  - 'use-service-account-credentials=true'
kubelet-arg:
  - 'streaming-connection-idle-timeout=5m'
  - 'make-iptables-util-chains=true'</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_コントロールプレーンの実行と引数"><a class="anchor" href="#_コントロールプレーンの実行と引数"></a>コントロールプレーンの実行と引数</h2>
<div class="sectionbody">
<div class="paragraph">
<p>以下に、K3s コントロールプレーンコンポーネントと、デフォルトで開始時に与えられる引数を示します。右側にコメントとして、それらが満たす CIS 1.6 コントロールが記載されています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kube-apiserver
    --advertise-port=6443
    --allow-privileged=true
    --anonymous-auth=false                                                            # 1.2.1
    --api-audiences=unknown
    --authorization-mode=Node,RBAC
    --bind-address=127.0.0.1
    --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs
    --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt                    # 1.2.31
    --enable-admission-plugins=NodeRestriction,PodSecurityPolicy                      # 1.2.17
    --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt                  # 1.2.32
    --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt                   # 1.2.29
    --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key                    # 1.2.29
    --etcd-servers=https://127.0.0.1:2379
    --insecure-port=0                                                                 # 1.2.19
    --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt
    --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt
    --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key
    --profiling=false                                                                 # 1.2.21
    --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt
    --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key
    --requestheader-allowed-names=system:auth-proxy
    --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt
    --requestheader-extra-headers-prefix=X-Remote-Extra-
    --requestheader-group-headers=X-Remote-Group
    --requestheader-username-headers=X-Remote-User
    --secure-port=6444                                                                # 1.2.20
    --service-account-issuer=k3s
    --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key            # 1.2.28
    --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.key
    --service-cluster-ip-range=10.43.0.0/16
    --storage-backend=etcd3
    --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt        # 1.2.30
    --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key # 1.2.30
    --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kube-controller-manager
    --address=127.0.0.1
    --allocate-node-cidrs=true
    --bind-address=127.0.0.1                                                       # 1.3.7
    --cluster-cidr=10.42.0.0/16
    --cluster-signing-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.crt
    --cluster-signing-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key
    --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig
    --port=10252
    --profiling=false                                                              # 1.3.2
    --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt                   # 1.3.5
    --secure-port=0
    --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.key # 1.3.4
    --use-service-account-credentials=true                                         # 1.3.3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kube-scheduler
    --address=127.0.0.1
    --bind-address=127.0.0.1                                              # 1.4.2
    --kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig
    --port=10251
    --profiling=false                                                     # 1.4.1
    --secure-port=0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubelet
    --address=0.0.0.0
    --anonymous-auth=false                                                # 4.2.1
    --authentication-token-webhook=true
    --authorization-mode=Webhook                                          # 4.2.2
    --cgroup-driver=cgroupfs
    --client-ca-file=/var/lib/rancher/k3s/agent/client-ca.crt             # 4.2.3
    --cloud-provider=external
    --cluster-dns=10.43.0.10
    --cluster-domain=cluster.local
    --cni-bin-dir=/var/lib/rancher/k3s/data/223e6420f8db0d8828a8f5ed3c44489bb8eb47aa71485404f8af8c462a29bea3/bin
    --cni-conf-dir=/var/lib/rancher/k3s/agent/etc/cni/net.d
    --container-runtime-endpoint=/run/k3s/containerd/containerd.sock
    --container-runtime=remote
    --containerd=/run/k3s/containerd/containerd.sock
    --eviction-hard=imagefs.available&lt;5%,nodefs.available&lt;5%
    --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10%
    --fail-swap-on=false
    --healthz-bind-address=127.0.0.1
    --hostname-override=hostname01
    --kubeconfig=/var/lib/rancher/k3s/agent/kubelet.kubeconfig
    --kubelet-cgroups=/systemd/system.slice
    --node-labels=
    --pod-manifest-path=/var/lib/rancher/k3s/agent/pod-manifests
    --protect-kernel-defaults=true                                        # 4.2.6
    --read-only-port=0                                                    # 4.2.4
    --resolv-conf=/run/systemd/resolve/resolv.conf
    --runtime-cgroups=/systemd/system.slice
    --serialize-image-pulls=false
    --tls-cert-file=/var/lib/rancher/k3s/agent/serving-kubelet.crt        # 4.2.10
    --tls-private-key-file=/var/lib/rancher/k3s/agent/serving-kubelet.key # 4.2.10</code></pre>
</div>
</div>
<div class="paragraph">
<p>CIS要件1.2.22から1.2.25に関する追加情報は以下に示されています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_既知の問題"><a class="anchor" href="#_既知の問題"></a>既知の問題</h2>
<div class="sectionbody">
<div class="paragraph">
<p>以下は、K3sがデフォルトでは現在パスしないコントロールです。各ギャップについて説明し、それが手動のオペレーター介入によってパスできるか、または将来のK3sリリースで対処されるかどうかについての注釈を付けます。</p>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_15"><a class="anchor" href="#_コントロール_1_2_15"></a>コントロール 1.2.15</h3>
<div class="paragraph">
<p><code>NamespaceLifecycle</code>アドミッションコントロールプラグインが設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p>アドミッションコントロールポリシーを<code>NamespaceLifecycle</code>に設定することで、存在しないネームスペースにオブジェクトが作成されないようにし、終了中のネームスペースが新しいオブジェクトの作成に使用されないようにします。これは、ネームスペース終了プロセスの整合性を確保し、新しいオブジェクトの可用性を確保するために推奨されます。</p>
</div>
<div class="paragraph">
<p>これは、<code>enable-admission-plugins=</code>の値としてこの引数を渡し、それを<code>--kube-apiserver-arg=</code>引数に渡して<code>k3s server</code>に渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_16"><a class="anchor" href="#_コントロール_1_2_16"></a>コントロール 1.2.16</h3>
<div class="paragraph">
<p><code>PodSecurityPolicy</code>アドミッションコントロールプラグインが設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p>Pod Security Policyは、ポッドが実行できるアクションとアクセスできる内容を制御するクラスター レベルのリソースです。<code>PodSecurityPolicy</code>オブジェクトは、システムに受け入れられるためにポッドが従わなければならない条件のセットを定義します。Pod Security Policiesは、ポッドがアクセスできるセキュリティ機能を制御する設定と戦略で構成されているため、ポッドのアクセス許可を制御するために使用する必要があります。</p>
</div>
<div class="paragraph">
<p>これは、<code>enable-admission-plugins=</code>の値としてこの引数を渡し、それを<code>--kube-apiserver-arg=</code>引数に渡して<code>k3s server</code>に渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_22"><a class="anchor" href="#_コントロール_1_2_22"></a>コントロール 1.2.22</h3>
<div class="paragraph">
<p><code>--audit-log-path</code>引数が設定されていることを確認します。
.理由</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="paragraph">
<p>Kubernetes APIサーバーの監査は、個々のユーザー、管理者、またはシステムの他のコンポーネントによってシステムに影響を与えたアクティビティの一連の記録を文書化するセキュリティ関連の時系列セットを提供します。現在、Kubernetesは基本的な監査機能しか提供していませんが、有効にする必要があります。適切な監査ログパスを設定することで有効にできます。</p>
</div>
<div class="paragraph">
<p>これは、<code>--kube-apiserver-arg=</code>引数にこの引数を値として渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_23"><a class="anchor" href="#_コントロール_1_2_23"></a>コントロール 1.2.23</h3>
<div class="paragraph">
<p><code>--audit-log-maxage</code>引数が30または適切な値に設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p>ログを少なくとも30日間保持することで、過去に遡ってイベントを調査または関連付けることができます。監査ログの保持期間を30日またはビジネス要件に応じて設定します。</p>
</div>
<div class="paragraph">
<p>これは、<code>--kube-apiserver-arg=</code>引数にこの引数を値として渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_24"><a class="anchor" href="#_コントロール_1_2_24"></a>コントロール 1.2.24</h3>
<div class="paragraph">
<p><code>--audit-log-maxbackup</code>引数が10または適切な値に設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p>Kubernetesはログファイルを自動的にローテーションします。古いログファイルを保持することで、調査や関連付けに十分なログデータを利用できるようになります。たとえば、ファイルサイズを100 MBに設定し、保持する古いログファイルの数を10に設定した場合、約1 GBのログデータを分析に使用できる可能性があります。</p>
</div>
<div class="paragraph">
<p>これは、<code>--kube-apiserver-arg=</code>引数にこの引数を値として渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_25"><a class="anchor" href="#_コントロール_1_2_25"></a>コントロール 1.2.25</h3>
<div class="paragraph">
<p><code>--audit-log-maxsize</code>引数が100または適切な値に設定されていることを確認します。
.理由</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="paragraph">
<p>Kubernetesはログファイルを自動的にローテーションします。古いログファイルを保持することで、調査や関連付けに十分なログデータを利用できるようになります。ファイルサイズを100 MBに設定し、保持する古いログファイルの数を10に設定した場合、約1 GBのログデータを分析に使用できる可能性があります。</p>
</div>
<div class="paragraph">
<p>これは、<code>--kube-apiserver-arg=</code>引数にこの引数を値として渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_26"><a class="anchor" href="#_コントロール_1_2_26"></a>コントロール 1.2.26</h3>
<div class="paragraph">
<p><code>--request-timeout</code>引数が適切に設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p>グローバルリクエストタイムアウトを設定することで、ユーザーの接続速度に応じてAPIサーバーのリクエストタイムアウト制限を延長できます。デフォルトでは60秒に設定されており、接続が遅い場合には問題が発生する可能性があります。リクエストのデータ量が60秒以内に送信できる量を超えると、クラスターリソースにアクセスできなくなる可能性があります。ただし、このタイムアウト制限を大きく設定しすぎると、APIサーバーのリソースが枯渇し、サービス拒否攻撃に対して脆弱になる可能性があります。したがって、この制限を適切に設定し、必要に応じてデフォルトの60秒の制限を変更することをお勧めします。</p>
</div>
<div class="paragraph">
<p>これは、<code>--kube-apiserver-arg=</code>引数にこの引数を値として渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_27"><a class="anchor" href="#_コントロール_1_2_27"></a>コントロール 1.2.27</h3>
<div class="paragraph">
<p><code>--service-account-lookup</code>引数がtrueに設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p><code>--service-account-lookup</code>が有効になっていない場合、apiserverは認証トークンが有効であることのみを確認し、リクエストに記載されているサービスアカウントトークンが実際にetcdに存在するかどうかを検証しません。これにより、対応するサービスアカウントが削除された後でもサービスアカウントトークンを使用できるようになります。これは、チェック時と使用時のセキュリティ問題の一例です。</p>
</div>
<div class="paragraph">
<p>これは、<code>--kube-apiserver-arg=</code>引数にこの引数を値として渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_33"><a class="anchor" href="#_コントロール_1_2_33"></a>コントロール 1.2.33</h3>
<div class="paragraph">
<p><code>--encryption-provider-config</code>引数が適切に設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p><code>etcd</code>は、KubernetesデプロイメントでそのすべてのREST APIオブジェクトの永続ストレージとして使用される高可用性のキー値ストアです。これらのオブジェクトは機密性が高いため、漏洩を防ぐために保存時に暗号化する必要があります。</p>
</div>
<div class="paragraph">
<p>K3sでシークレット暗号化を構成する方法の詳細な手順は<a href="secrets-encryption.html" class="xref page">Secrets Encryption</a>にあります。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_2_34"><a class="anchor" href="#_コントロール_1_2_34"></a>コントロール 1.2.34</h3>
<div class="paragraph">
<p>暗号化プロバイダーが適切に構成されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p><code>etcd</code>暗号化が使用されている場合、適切な暗号化プロバイダーのセットが使用されていることを確認することが重要です。現在、<code>aescbc</code>、<code>kms</code>、および<code>secretbox</code>が適切なオプションである可能性が高いです。</p>
</div>
<div class="paragraph">
<p>これは、上記のように有効な構成を<code>k3s</code>に渡すことで修正できます。K3sでシークレット暗号化を構成する方法の詳細な手順は<a href="secrets-encryption.html" class="xref page">Secrets Encryption</a>にあります。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_1_3_1"><a class="anchor" href="#_コントロール_1_3_1"></a>コントロール 1.3.1</h3>
<div class="paragraph">
<p><code>--terminated-pod-gc-threshold</code>引数が適切に設定されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p>ガベージコレクションは、十分なリソースの可用性を確保し、パフォーマンスと可用性の低下を防ぐために重要です。最悪の場合、システムがクラッシュするか、長時間使用できなくなる可能性があります。現在のガベージコレクションの設定は12,500個の終了したポッドであり、システムが維持するには多すぎる可能性があります。システムリソースとテストに基づいて、ガベージコレクションを有効にするための適切なしきい値を選択します。</p>
</div>
<div class="paragraph">
<p>これは、<code>--kube-apiserver-arg=</code>引数にこの引数を値として渡すことで修正できます。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_3_2_1"><a class="anchor" href="#_コントロール_3_2_1"></a>コントロール 3.2.1</h3>
<div class="paragraph">
<p>最小限の監査ポリシーが作成されていることを確認します。</p>
</div>
<details>
<summary class="title">理由</summary>
<div class="content">
<div class="paragraph">
<p>ログ記録は、すべてのシステムにとって潜在的な不正アクセスを検出するための重要な探知コントロールです。</p>
</div>
<div class="paragraph">
<p>これは、コントロール1.2.22 - 1.2.25を渡し、その有効性を確認することで修正できます。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_4_2_7"><a class="anchor" href="#_コントロール_4_2_7"></a>コントロール 4.2.7</h3>
<div class="paragraph">
<p><code>--make-iptables-util-chains</code>引数がtrueに設定されていることを確認します。</p>
</div>
<details>
<summary class="title">根拠</summary>
<div class="content">
<div class="paragraph">
<p>Kubeletは、ポッドのネットワークオプションの選択に基づいて、iptablesの必要な変更を自動的に管理できます。iptablesの変更はkubeletに任せることを推奨します。これにより、iptablesの設定がポッドのネットワーク設定と同期した状態を保つことができます。動的なポッドネットワーク設定の変更に対して手動でiptablesを設定すると、ポッド/コンテナ間および外部との通信が妨げられる可能性があります。iptablesのルールが厳しすぎたり、逆に緩すぎたりすることがあります。</p>
</div>
<div class="paragraph">
<p>これを修正するには、この引数を <code>k3s server</code> の <code>--kube-apiserver-arg=</code> 引数に値として渡します。以下に例を示します。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_コントロール_5_1_5"><a class="anchor" href="#_コントロール_5_1_5"></a>コントロール 5.1.5</h3>
<div class="paragraph">
<p>デフォルトのサービスアカウントが積極的に使用されていないことを確認する</p>
</div>
<details>
<summary class="title">根拠</summary>
<div class="content">
<div class="paragraph">
<p>Kubernetesは、ポッドに特定のサービスアカウントが割り当てられていない場合に使用される <code>default</code> サービスアカウントを提供します。</p>
</div>
<div class="paragraph">
<p>ポッドからKubernetes APIへのアクセスが必要な場合、そのポッド用に特定のサービスアカウントを作成し、そのサービスアカウントに権限を付与する必要があります。</p>
</div>
<div class="paragraph">
<p>デフォルトのサービスアカウントは、サービスアカウントトークンを提供せず、明示的な権限の割り当てがないように構成する必要があります。</p>
</div>
<div class="paragraph">
<p>これは、各ネームスペースの <code>default</code> サービスアカウントの <code>automountServiceAccountToken</code> フィールドを <code>false</code> に更新することで修正できます。</p>
</div>
<div class="paragraph">
<p>= 組み込みのネームスペース（<code>kube-system</code>、<code>kube-public</code>、<code>kube-node-lease</code>、および <code>default</code>）の <code>default</code> サービスアカウントについては、K3sは自動的にこれを行いません。これらのサービスアカウントのフィールドを手動で更新して、コントロールをパスすることができます。</p>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_結論"><a class="anchor" href="#_結論"></a>結論</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このガイドに従った場合、K3sクラスターはCIS Kubernetesベンチマークに準拠するように構成されます。各ベンチマークのチェックの期待事項と、クラスターで同じことを行う方法を理解するために、<a href="self-assessment-1.8.html" class="xref page">CIS 1.8 自己評価ガイド</a> を確認できます。</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="secrets-encryption.html">secretの暗号化設定</a></span>
  <span class="next"><a href="self-assessment-1.10.html">CIS 1.10 Self Assessment Guide</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
