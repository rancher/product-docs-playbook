<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CIS 1.7 セルフアセスメントガイド :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/k3s/latest/ja/security/self-assessment-1.7.html">
    <link rel="prev" href="self-assessment-1.8.html">
    <link rel="next" href="../cli/cli.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2024-09-11"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ja/security/self-assessment-1.7.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/security/self-assessment-1.7.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ja/security/self-assessment-1.7.html" hrefLang="ja-JP" rel="alternate" />


<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/security/self-assessment-1.7.html" hreflang="en-US" rel="alternate" />

<!-- Link for the Korean page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ko/security/self-assessment-1.7.html" hreflang="ko-KR" rel="alternate" />


<!-- Link for the Chinese page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/zh/security/self-assessment-1.7.html" hreflang="zh-CN" rel="alternate" />






<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="k3s" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">K3s</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">K3s - 軽量なKubernetes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quick-start.html">クイックスタートガイド</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../installation/installation.html">インストール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/requirements.html">要件</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/configuration.html">設定オプション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/private-registry.html">プライベートレジストリの設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/registry-mirror.html">埋め込みレジストリミラー</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/airgap.html">エアギャップインストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/server-roles.html">サーバーロールの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/packaged-components.html">パッケージ化されたコンポーネントの管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/uninstall.html">K3sのアンインストール</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../datastore/datastore.html">クラスタデータストア</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/backup-restore.html">バックアップとリストア</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha-embedded.html">高可用性組み込みetcd</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha.html">高可用性外部データベース</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/cluster-loadbalancer.html">クラスター・ロードバランサー</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">アップグレード</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/killall.html">K3sの停止</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/manual.html">手動アップグレード</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/automated.html">自動アップグレード</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/roll-back.html">Rolling Back K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="security.html">セキュリティ</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="secrets-encryption.html">secretの暗号化設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hardening-guide.html">CIS ハードニングガイド</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="self-assessment-1.10.html">CIS 1.10 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="self-assessment-1.9.html">CIS 1.9 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="self-assessment-1.8.html">CIS 1.8 セルフアセスメントガイド</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="self-assessment-1.7.html">CIS 1.7 セルフアセスメントガイド</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../cli/cli.html">CLIツール</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/server.html">server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/agent.html">k3s エージェント</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/certificate.html">certificate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/etcd-snapshot.html">etcd-snapshot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/secrets-encrypt.html">secrets-encrypt</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/token.html">token</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">アーキテクチャ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster-access.html">クラスターアクセス</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../storage.html">ボリュームとストレージ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../import-images.html">Import images</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../networking/networking.html">ネットワーキング</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic-network-options.html">基本的なネットワークオプション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/distributed-multicloud.html">分散型ハイブリッドまたはマルチクラウドクラスター</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus-ipams.html">Multus and IPAM plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking-services.html">ネットワーキングサービス</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高度なオプション / 設定</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/env-variables.html">環境変数</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/flag-deprecation.html">フラグの非推奨化</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource-profiling.html">リソースプロファイリング</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../related-projects.html">関連プロジェクト</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known-issues.html">既知の問題</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3s</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/k3s" title="K3s" aria-label="SUSE Documentation - K3s">
        K3s
      </a>
    </li>
      <li>
          <a href="security.html" title="セキュリティ" aria-label="セキュリティ">セキュリティ</a>
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/k3s-product-docs/edit/main/docs/latest/modules/ja/pages/security/self-assessment-1.7.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:k3s" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CIS 1.7 セルフアセスメントガイド</h1>
<div class="sect1">
<h2 id="_概要"><a class="anchor" href="#_概要"></a>概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このドキュメントは <a href="hardening-guide.html" class="xref page">K3s セキュリティ強化ガイド</a> の補足資料です。強化ガイドは K3s の本番環境インストールを強化するための具体的なガイダンスを提供し、このベンチマークガイドは、CIS Kubernetes ベンチマークの各コントロールに対して強化されたクラスターのセキュリティレベルを評価するのに役立ちます。これは K3s オペレーター、セキュリティチーム、監査人、および意思決定者によって使用されることを意図しています。</p>
</div>
<div class="paragraph">
<p>このガイドは K3s の <strong>v1.25-v1.26</strong> リリースラインおよび CIS Kubernetes ベンチマークの <strong>v1.7.1</strong> リリースに特化しています。</p>
</div>
<div class="paragraph">
<p>各コントロールに関する詳細な説明やテスト失敗時の修正方法については、CIS Kubernetes ベンチマーク v1.7.1 の該当セクションを参照してください。ベンチマークは、無料アカウントを作成した後に <a href="https://www.cisecurity.org/benchmark/kubernetes/">Center for Internet Security (CIS)</a> からダウンロードできます。</p>
</div>
<div class="sect2">
<h3 id="_コントロールテストの方法論"><a class="anchor" href="#_コントロールテストの方法論"></a>コントロールテストの方法論</h3>
<div class="paragraph">
<p>CIS Kubernetes ベンチマークの各コントロールは、付随する強化ガイドに従って設定された K3s クラスターに対して評価されました。</p>
</div>
<div class="paragraph">
<p>コントロール監査が元の CIS ベンチマークと異なる場合、K3s に特化した監査コマンドがテスト用に提供されます。</p>
</div>
<div class="paragraph">
<p>各コントロールの結果は以下の通りです：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>合格</strong> - テスト対象の K3s クラスターがベンチマークに記載された監査に合格しました。</p>
</li>
<li>
<p><strong>該当なし</strong> - コントロールは K3s の設計上適用されません。修正セクションでその理由を説明します。</p>
</li>
<li>
<p><strong>警告</strong> - コントロールは CIS ベンチマークで手動とされており、クラスターの使用ケースやその他の要因に依存します。これらのコントロールは K3s がその実装を妨げないことを確認するために評価されていますが、テスト対象のクラスターのさらなる設定や監査は行われていません。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>このガイドは、K3s が Systemd ユニットとして実行されていることを前提としています。インストール方法が異なる場合は、シナリオに合わせて「監査」コマンドを調整する必要があります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>このガイドでは、<code>scored</code> テスト、つまり <code>自動化</code> テストのみを対象としています。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_1_コントロールプレーンノードの設定ファイル"><a class="anchor" href="#_1_1_コントロールプレーンノードの設定ファイル"></a>1.1 コントロールプレーンノードの設定ファイル</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_1_1_api_サーバーポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_1_api_サーバーポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.1 API サーバーポッド仕様ファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod 600 /etc/kubernetes/manifests/kube-apiserver.yaml
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_2_api_サーバーポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_2_api_サーバーポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.2 API サーバーポッド仕様ファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chown root:root /etc/kubernetes/manifests/kube-apiserver.yaml
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_3_コントローラーマネージャーポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_3_コントローラーマネージャーポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.3 コントローラーマネージャーポッド仕様ファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod 600 /etc/kubernetes/manifests/kube-controller-manager.yaml
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_4_コントローラーマネージャーポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_4_コントローラーマネージャーポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.4 コントローラーマネージャーポッド仕様ファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chown root:root /etc/kubernetes/manifests/kube-controller-manager.yaml
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_5_スケジューラーポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_5_スケジューラーポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.5 スケジューラーポッド仕様ファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod 600 /etc/kubernetes/manifests/kube-scheduler.yaml
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_6_スケジューラーポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_6_スケジューラーポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.6 スケジューラーポッド仕様ファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chown root:root /etc/kubernetes/manifests/kube-scheduler.yaml
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_7_etcd_ポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_7_etcd_ポッド仕様ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.7 etcd ポッド仕様ファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod 600 /var/lib/rancher/k3s/server/db/etcd/config
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_8_etcd_ポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_8_etcd_ポッド仕様ファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.8 etcd ポッド仕様ファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chown root:root /var/lib/rancher/k3s/server/db/etcd/config
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_9_コンテナネットワークインターフェイスファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_9_コンテナネットワークインターフェイスファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.9 コンテナネットワークインターフェイスファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod 600 &lt;path/to/cni/files&gt;
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_10_コンテナネットワークインターフェイスファイルの所有者が_rootroot_に設定されていることを確認する手動"><a class="anchor" href="#_1_1_10_コンテナネットワークインターフェイスファイルの所有者が_rootroot_に設定されていることを確認する手動"></a>1.1.10 コンテナネットワークインターフェイスファイルの所有者が root:root に設定されていることを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chown root:root &lt;path/to/cni/files&gt;
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_11_etcd_データディレクトリの権限が_700_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_11_etcd_データディレクトリの権限が_700_以上の制限に設定されていることを確認する自動化"></a>1.1.11 etcd データディレクトリの権限が 700 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c %a /var/lib/rancher/k3s/server/db/etcd</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '700' が '700' と等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">700</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_1_12_etcd_データディレクトリの所有者が_etcdetcd_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_12_etcd_データディレクトリの所有者が_etcdetcd_に設定されていることを確認する自動化"></a>1.1.12 etcd データディレクトリの所有者が etcd:etcd に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
etcd サーバーノードで、コマンド 'ps -ef | grep etcd' から引数 --data-dir として渡される etcd データディレクトリを取得します。
上記で見つかった etcd データディレクトリに基づいて以下のコマンドを実行します。
例: chown etcd:etcd /var/lib/etcd
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_13_admin_conf_ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_13_admin_conf_ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.13 admin.conf ファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod 600 /var/lib/rancher/k3s/server/cred/admin.kubeconfig</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_14_admin_conf_ファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_14_admin_conf_ファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.14 admin.conf ファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/rancher/k3s/server/cred/admin.kubeconfig; then stat -c %U:%G /var/lib/rancher/k3s/server/cred/admin.kubeconfig; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'root:root' が 'root:root' と等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_1_15_scheduler_conf_ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_15_scheduler_conf_ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.15 scheduler.conf ファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/rancher/k3s/server/cred/scheduler.kubeconfig; then stat -c permissions=%a /var/lib/rancher/k3s/server/cred/scheduler.kubeconfig; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> permissions が 600 であり、600 以上の制限が期待される</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions=600</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_1_16_scheduler_conf_ファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_16_scheduler_conf_ファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.16 scheduler.conf ファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/rancher/k3s/server/cred/scheduler.kubeconfig; then stat -c %U:%G /var/lib/rancher/k3s/server/cred/scheduler.kubeconfig; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'root:root' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_1_17_controller_manager_conf_ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_17_controller_manager_conf_ファイルの権限が_600_以上の制限に設定されていることを確認する自動化"></a>1.1.17 controller-manager.conf ファイルの権限が 600 以上の制限に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/rancher/k3s/server/cred/controller.kubeconfig; then stat -c permissions=%a /var/lib/rancher/k3s/server/cred/controller.kubeconfig; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> permissions が 600 であり、600 以上の制限が期待される</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions=600</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_1_18_controller_manager_conf_ファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_18_controller_manager_conf_ファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.18 controller-manager.conf ファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c %U:%G /var/lib/rancher/k3s/server/cred/controller.kubeconfig</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'root:root' が 'root:root' と等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_1_19_kubernetes_pki_ディレクトリおよびファイルの所有者が_rootroot_に設定されていることを確認する自動化"><a class="anchor" href="#_1_1_19_kubernetes_pki_ディレクトリおよびファイルの所有者が_rootroot_に設定されていることを確認する自動化"></a>1.1.19 Kubernetes PKI ディレクトリおよびファイルの所有者が root:root に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c %U:%G /var/lib/rancher/k3s/server/tls</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'root:root' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_1_20_kubernetes_pki_証明書ファイルの権限が_600_以上の制限に設定されていることを確認する手動"><a class="anchor" href="#_1_1_20_kubernetes_pki_証明書ファイルの権限が_600_以上の制限に設定されていることを確認する手動"></a>1.1.20 Kubernetes PKI 証明書ファイルの権限が 600 以上の制限に設定されていることを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod -R 600 /etc/kubernetes/pki/*.crt</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_21_kubernetes_pki_キーファイルの権限が_600_に設定されていることを確認する手動"><a class="anchor" href="#_1_1_21_kubernetes_pki_キーファイルの権限が_600_に設定されていることを確認する手動"></a>1.1.21 Kubernetes PKI キーファイルの権限が 600 に設定されていることを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod -R 600 /etc/kubernetes/pki/*.key</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_2_api_サーバー"><a class="anchor" href="#_1_2_api_サーバー"></a>1.2 API サーバー</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_2_1_anonymous_auth_引数が_false_に設定されていることを確認する手動"><a class="anchor" href="#_1_2_1_anonymous_auth_引数が_false_に設定されていることを確認する手動"></a>1.2.1 --anonymous-auth 引数が false に設定されていることを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'anonymous-auth'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--anonymous-auth' が 'false' と等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_2_token_auth_fileパラメータが設定されていないことを確認する自動化"><a class="anchor" href="#_1_2_2_token_auth_fileパラメータが設定されていないことを確認する自動化"></a>1.2.2 <code>--token-auth-file</code>パラメータが設定されていないことを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep containerd | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--token-auth-file&#8217;が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 2335 2317 0 17:22 ? 00:00:08 containerd root 3156 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 0eff118b8646895c6dc4bd530114d320ccef7d44c9ffe7e90bd79fb484244b84 -address /run/k3s/containerd/containerd.sock root 3179 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id ec6b2ac160de7aadf2c1b9e7e58c7413533f71764e58bf8ac79aef2c4c0bb914 -address /run/k3s/containerd/containerd.sock root 3254 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 0499640f2232b224f1ff1ffba2a5787f1d31956d9ffa22e2b6f3b424f22afbbd -address /run/k3s/containerd/containerd.sock root 4425 1 0 17:23 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 1fb515723128cd4294015fec56cb07c994ded503dcd8fd36b179dcb58f77a2be -address /run/k3s/containerd/containerd.sock root 4512 1 0 17:23 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id b39e79cf734d3c5d0f1f7e502c46a45d78668bdc07a2fdda5a100a6fd9c100db -address /run/k3s/containerd/containerd.sock</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_3_denyserviceexternalipsが設定されていないことを確認する自動化"><a class="anchor" href="#_1_2_3_denyserviceexternalipsが設定されていないことを確認する自動化"></a>1.2.3 <code>--DenyServiceExternalIPs</code>が設定されていないことを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep containerd | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--enable-admission-plugins&#8217;が存在するか、存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 2335 2317 0 17:22 ? 00:00:08 containerd root 3156 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 0eff118b8646895c6dc4bd530114d320ccef7d44c9ffe7e90bd79fb484244b84 -address /run/k3s/containerd/containerd.sock root 3179 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id ec6b2ac160de7aadf2c1b9e7e58c7413533f71764e58bf8ac79aef2c4c0bb914 -address /run/k3s/containerd/containerd.sock root 3254 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 0499640f2232b224f1ff1ffba2a5787f1d31956d9ffa22e2b6f3b424f22afbbd -address /run/k3s/containerd/containerd.sock root 4425 1 0 17:23 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 1fb515723128cd4294015fec56cb07c994ded503dcd8fd36b179dcb58f77a2be -address /run/k3s/containerd/containerd.sock root 4512 1 0 17:23 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id b39e79cf734d3c5d0f1f7e502c46a45d78668bdc07a2fdda5a100a6fd9c100db -address /run/k3s/containerd/containerd.sock</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_4_kubelet_client_certificateおよび_kubelet_client_key引数が適切に設定されていることを確認する自動化"><a class="anchor" href="#_1_2_4_kubelet_client_certificateおよび_kubelet_client_key引数が適切に設定されていることを確認する自動化"></a>1.2.4 <code>--kubelet-client-certificate</code>および<code>--kubelet-client-key</code>引数が適切に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'kubelet-certificate-authority'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--kubelet-client-certificate&#8217;が存在し、'--kubelet-client-key&#8217;が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_5_kubelet_certificate_authority引数が適切に設定されていることを確認する自動化"><a class="anchor" href="#_1_2_5_kubelet_certificate_authority引数が適切に設定されていることを確認する自動化"></a>1.2.5 <code>--kubelet-certificate-authority</code>引数が適切に設定されていることを確認する（自動化）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正:</strong>
Kubernetesのドキュメントに従い、apiserverとkubelet間のTLS接続を設定します。その後、コントロールプレーンノードのAPIサーバーポッド仕様ファイル
/etc/kubernetes/manifests/kube-apiserver.yamlを編集し、設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">--kubelet-certificate-authority パラメータを証明書認証局の証明書ファイルのパスに設定します。
--kubelet-certificate-authority=&amp;lt;ca-string&amp;gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>許容 - サービング証明書を生成する際、特定のクラウドプロバイダーに必要なホスト名のオーバーライドと組み合わせると機能が壊れる可能性があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_6_authorization_mode_引数が_alwaysallow_に設定されていないことを確認する_自動化"><a class="anchor" href="#_1_2_6_authorization_mode_引数が_alwaysallow_に設定されていないことを確認する_自動化"></a>1.2.6 --authorization-mode 引数が AlwaysAllow に設定されていないことを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'authorization-mode'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--authorization-mode' に 'AlwaysAllow' が含まれていない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">May 15 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_7_authorization_mode_引数に_node_が含まれていることを確認する_自動化"><a class="anchor" href="#_1_2_7_authorization_mode_引数に_node_が含まれていることを確認する_自動化"></a>1.2.7 --authorization-mode 引数に Node が含まれていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'authorization-mode'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--authorization-mode' に 'Node' が含まれている</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">May 15 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_8_authorization_mode_引数に_rbac_が含まれていることを確認する_自動化"><a class="anchor" href="#_1_2_8_authorization_mode_引数に_rbac_が含まれていることを確認する_自動化"></a>1.2.8 --authorization-mode 引数に RBAC が含まれていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'authorization-mode'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--authorization-mode' に 'RBAC' が含まれている</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">May 15 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_9_admission_control_プラグイン_eventratelimit_が設定されていることを確認する_手動"><a class="anchor" href="#_1_2_9_admission_control_プラグイン_eventratelimit_が設定されていることを確認する_手動"></a>1.2.9 admission control プラグイン EventRateLimit が設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubernetes のドキュメントに従い、設定ファイルに希望する制限を設定します。
次に、API サーバーのポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、以下のパラメータを設定します。
--enable-admission-plugins=&#8230;&#8203;,EventRateLimit,&#8230;&#8203;
--admission-control-config-file=&lt;path/to/configuration/file&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_10_常に許可するアドミッションコントロールプラグインが設定されていないことを確認する_自動化"><a class="anchor" href="#_1_2_10_常に許可するアドミッションコントロールプラグインが設定されていないことを確認する_自動化"></a>1.2.10 常に許可するアドミッションコントロールプラグインが設定されていないことを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'enable-admission-plugins'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--enable-admission-plugins' に 'AlwaysAdmit' が含まれていない、または '--enable-admission-plugins' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">May 15 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_11_常にイメージをプルするアドミッションコントロールプラグインが設定されていることを確認する_手動"><a class="anchor" href="#_1_2_11_常にイメージをプルするアドミッションコントロールプラグインが設定されていることを確認する_手動"></a>1.2.11 常にイメージをプルするアドミッションコントロールプラグインが設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--enable-admission-plugins パラメータに AlwaysPullImages を含めます。
--enable-admission-plugins=&#8230;&#8203;,AlwaysPullImages,&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_12_podsecuritypolicy_が使用されていない場合securitycontextdeny_アドミッションコントロールプラグインが設定されていることを確認する_手動"><a class="anchor" href="#_1_2_12_podsecuritypolicy_が使用されていない場合securitycontextdeny_アドミッションコントロールプラグインが設定されていることを確認する_手動"></a>1.2.12 PodSecurityPolicy が使用されていない場合、SecurityContextDeny アドミッションコントロールプラグインが設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--enable-admission-plugins パラメータに SecurityContextDeny を含めます。ただし、PodSecurityPolicy が既に存在する場合は除きます。
--enable-admission-plugins=&#8230;&#8203;,SecurityContextDeny,&#8230;&#8203;
許容 - Pod Security Policy を有効にすると、アプリケーションが予期せず失敗する可能性があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_13_serviceaccount_アドミッションコントロールプラグインが設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_13_serviceaccount_アドミッションコントロールプラグインが設定されていることを確認する_自動化"></a>1.2.13 ServiceAccount アドミッションコントロールプラグインが設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--disable-admission-plugins' が存在する、または '--disable-admission-plugins' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">May 15 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_14_namespacelifecycle_アドミッションコントロールプラグインが設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_14_namespacelifecycle_アドミッションコントロールプラグインが設定されていることを確認する_自動化"></a>1.2.14 NamespaceLifecycle アドミッションコントロールプラグインが設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--disable-admission-plugins' が存在する、または '--disable-admission-plugins' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_15_ノード制限アドミッションコントロールプラグインが設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_15_ノード制限アドミッションコントロールプラグインが設定されていることを確認する_自動化"></a>1.2.15 ノード制限アドミッションコントロールプラグインが設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'enable-admission-plugins'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--enable-admission-plugins' に 'NodeRestriction' が含まれている</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_16_secure_port_引数が_0_に設定されていないことを確認する_この推奨事項は時代遅れであり合意プロセスに従って削除されます_自動化"><a class="anchor" href="#_1_2_16_secure_port_引数が_0_に設定されていないことを確認する_この推奨事項は時代遅れであり合意プロセスに従って削除されます_自動化"></a>1.2.16 --secure-port 引数が 0 に設定されていないことを確認する - この推奨事項は時代遅れであり、合意プロセスに従って削除されます (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'secure-port'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--secure-port' が 0 より大きいか、または '--secure-port' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_17_profiling_引数が_false_に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_17_profiling_引数が_false_に設定されていることを確認する_自動化"></a>1.2.17 --profiling 引数が false に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'profiling'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--profiling' が 'false' に等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_18_audit_log_path_引数が設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_18_audit_log_path_引数が設定されていることを確認する_自動化"></a>1.2.18 --audit-log-path 引数が設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--audit-log-path パラメータを適切なパスとファイルに設定します。例えば、
--audit-log-path=/var/log/apiserver/audit.log
許容。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_19_audit_log_maxage_引数が30または適切な値に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_19_audit_log_maxage_引数が30または適切な値に設定されていることを確認する_自動化"></a>1.2.19 --audit-log-maxage 引数が30または適切な値に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--audit-log-maxage パラメータを30または適切な日数に設定します。例えば、
--audit-log-maxage=30
許容。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_20_audit_log_maxbackup_引数が10または適切な値に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_20_audit_log_maxbackup_引数が10または適切な値に設定されていることを確認する_自動化"></a>1.2.20 --audit-log-maxbackup 引数が10または適切な値に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--audit-log-maxbackup パラメータを10または適切な値に設定します。例えば、
--audit-log-maxbackup=10
許容。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_21_audit_log_maxsize_引数が100または適切な値に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_21_audit_log_maxsize_引数が100または適切な値に設定されていることを確認する_自動化"></a>1.2.21 --audit-log-maxsize 引数が100または適切な値に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--audit-log-maxsize パラメータを適切なサイズ（MB単位）に設定します。例えば、100 MBに設定するには、--audit-log-maxsize=100
許容。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_22_request_timeout_引数が適切に設定されていることを確認する_手動"><a class="anchor" href="#_1_2_22_request_timeout_引数が適切に設定されていることを確認する_手動"></a>1.2.22 --request-timeout 引数が適切に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、必要に応じて以下のパラメータを適切に設定します。例えば、--request-timeout=300s
許容。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_23_service_account_lookup_引数が_true_に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_23_service_account_lookup_引数が_true_に設定されていることを確認する_自動化"></a>1.2.23 --service-account-lookup 引数が true に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--service-account-lookup' が存在しないか、'--service-account-lookup' が 'true' に等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_24_service_account_key_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_24_service_account_key_file_引数が適切に設定されていることを確認する_自動化"></a>1.2.24 --service-account-key-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの API サーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--service-account-key-file パラメータをサービスアカウントの公開鍵ファイルに設定します。例えば、
--service-account-key-file=&lt;filename&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_25_etcd_certfile_および_etcd_keyfile_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_25_etcd_certfile_および_etcd_keyfile_引数が適切に設定されていることを確認する_自動化"></a>1.2.25 --etcd-certfile および --etcd-keyfile 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal -u k3s | grep 'Running kube-apiserver' | tail -n1</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--etcd-certfile' が存在し、'--etcd-keyfile' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_26_tls_cert_file_および_tls_private_key_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_26_tls_cert_file_および_tls_private_key_file_引数が適切に設定されていることを確認する_自動化"></a>1.2.26 --tls-cert-file および --tls-private-key-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal -u k3s | grep -A1 'Running kube-apiserver' | tail -n2</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--tls-cert-file' が存在し、かつ '--tls-private-key-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key" 2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-scheduler --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --bind-address=127.0.0.1 --kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --profiling=false --secure-port=10259"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_27_client_ca_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_27_client_ca_file_引数が適切に設定されていることを確認する_自動化"></a>1.2.27 --client-ca-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'client-ca-file'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--client-ca-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_28_etcd_cafile_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_1_2_28_etcd_cafile_引数が適切に設定されていることを確認する_自動化"></a>1.2.28 --etcd-cafile 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'etcd-cafile'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--etcd-cafile' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_2_29_適切に_encryption_provider_config_引数が設定されていることを確認する_手動"><a class="anchor" href="#_1_2_29_適切に_encryption_provider_config_引数が設定されていることを確認する_手動"></a>1.2.29 適切に --encryption-provider-config 引数が設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubernetesのドキュメントに従い、EncryptionConfigファイルを設定します。
次に、コントロールプレーンノードのAPIサーバーポッド仕様ファイル /etc/kubernetes/manifests/kube-apiserver.yaml を編集し、--encryption-provider-config パラメータをそのファイルのパスに設定します。
例: --encryption-provider-config=&lt;/path/to/EncryptionConfig/File&gt;
許容 - 暗号化を有効にすると、データが暗号化されるため、データの復旧方法が変更されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_30_適切に暗号化プロバイダーが設定されていることを確認する_手動"><a class="anchor" href="#_1_2_30_適切に暗号化プロバイダーが設定されていることを確認する_手動"></a>1.2.30 適切に暗号化プロバイダーが設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubernetesのドキュメントに従い、EncryptionConfigファイルを設定します。
このファイルで、暗号化プロバイダーとしてaescbc、kms、またはsecretboxを選択します。
許容 - 暗号化を有効にすると、データが暗号化されるため、データの復旧方法が変更されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_32_apiサーバーが強力な暗号スイートのみを使用していることを確認する_手動"><a class="anchor" href="#_1_2_32_apiサーバーが強力な暗号スイートのみを使用していることを確認する_手動"></a>1.2.32 APIサーバーが強力な暗号スイートのみを使用していることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-apiserver' | tail -n1 | grep 'tls-cipher-suites'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--tls-cipher-suites' が 'TLS_AES_128_GCM_SHA256,TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256,TLS_RSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_GCM_SHA384' の有効な要素を含む</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_3_コントローラーマネージャー"><a class="anchor" href="#_1_3_コントローラーマネージャー"></a>1.3 コントローラーマネージャー</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_3_1_terminated_pod_gc_threshold_引数が適切に設定されていることを確認する_手動"><a class="anchor" href="#_1_3_1_terminated_pod_gc_threshold_引数が適切に設定されていることを確認する_手動"></a>1.3.1 --terminated-pod-gc-threshold 引数が適切に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-controller-manager' | tail -n1 | grep 'terminated-pod-gc-threshold'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--terminated-pod-gc-threshold' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --bind-address=127.0.0.1 --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --configure-cloud-routes=false --controllers=*,tokencleaner,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --profiling=false --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --terminated-pod-gc-threshold=10 --use-service-account-credentials=true"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_3_2_profiling_引数が_false_に設定されていることを確認する_自動"><a class="anchor" href="#_1_3_2_profiling_引数が_false_に設定されていることを確認する_自動"></a>1.3.2 --profiling 引数が false に設定されていることを確認する (自動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-controller-manager' | tail -n1 | grep 'profiling'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--profiling' が 'false' に等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --bind-address=127.0.0.1 --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --configure-cloud-routes=false --controllers=*,tokencleaner,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --profiling=false --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --terminated-pod-gc-threshold=10 --use-service-account-credentials=true"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_3_3_use_service_account_credentials_引数が_true_に設定されていることを確認する_自動化"><a class="anchor" href="#_1_3_3_use_service_account_credentials_引数が_true_に設定されていることを確認する_自動化"></a>1.3.3 --use-service-account-credentials 引数が true に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-controller-manager' | tail -n1 | grep 'use-service-account-credentials'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--use-service-account-credentials' が 'false' ではない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --bind-address=127.0.0.1 --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --configure-cloud-routes=false --controllers=*,tokencleaner,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --profiling=false --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --terminated-pod-gc-threshold=10 --use-service-account-credentials=true"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_3_4_service_account_private_key_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_1_3_4_service_account_private_key_file_引数が適切に設定されていることを確認する_自動化"></a>1.3.4 --service-account-private-key-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-controller-manager' | tail -n1 | grep 'service-account-private-key-file'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--service-account-private-key-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --bind-address=127.0.0.1 --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --configure-cloud-routes=false --controllers=*,tokencleaner,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --profiling=false --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --terminated-pod-gc-threshold=10 --use-service-account-credentials=true"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_3_5_root_ca_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_1_3_5_root_ca_file_引数が適切に設定されていることを確認する_自動化"></a>1.3.5 --root-ca-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-controller-manager' | tail -n1 | grep 'root-ca-file'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--root-ca-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --bind-address=127.0.0.1 --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.nochain.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/k3s/server/tls/server-ca.nochain.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/k3s/server/tls/server-ca.key --configure-cloud-routes=false --controllers=*,tokencleaner,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig --profiling=false --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --terminated-pod-gc-threshold=10 --use-service-account-credentials=true"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_3_6_rotatekubeletservercertificate_引数が_true_に設定されていることを確認する_自動化"><a class="anchor" href="#_1_3_6_rotatekubeletservercertificate_引数が_true_に設定されていることを確認する_自動化"></a>1.3.6 RotateKubeletServerCertificate 引数が true に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
コントロールプレーンノードの Controller Manager ポッド仕様ファイル /etc/kubernetes/manifests/kube-controller-manager.yaml を編集し、--feature-gates パラメータに RotateKubeletServerCertificate=true を含めます。
--feature-gates=RotateKubeletServerCertificate=true
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_7_bind_address_引数が_127_0_0_1_に設定されていることを確認する_自動化"><a class="anchor" href="#_1_3_7_bind_address_引数が_127_0_0_1_に設定されていることを確認する_自動化"></a>1.3.7 --bind-address 引数が 127.0.0.1 に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/ps -ef | grep containerd | grep -v grep</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--bind-address' が存在する OR '--bind-address' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root 2335 2317 0 17:22 ? 00:00:08 containerd root 3156 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 0eff118b8646895c6dc4bd530114d320ccef7d44c9ffe7e90bd79fb484244b84 -address /run/k3s/containerd/containerd.sock root 3179 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id ec6b2ac160de7aadf2c1b9e7e58c7413533f71764e58bf8ac79aef2c4c0bb914 -address /run/k3s/containerd/containerd.sock root 3254 1 0 17:22 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 0499640f2232b224f1ff1ffba2a5787f1d31956d9ffa22e2b6f3b424f22afbbd -address /run/k3s/containerd/containerd.sock root 4425 1 0 17:23 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id 1fb515723128cd4294015fec56cb07c994ded503dcd8fd36b179dcb58f77a2be -address /run/k3s/containerd/containerd.sock root 4512 1 0 17:23 ? 00:00:00 /var/lib/rancher/k3s/data/19eadf174fb6dfb5a92b12cd3045d81e09a334ba9af3c2afa5382675f3f6c918/bin/containerd-shim-runc-v2 -namespace k8s.io -id b39e79cf734d3c5d0f1f7e502c46a45d78668bdc07a2fdda5a100a6fd9c100db -address /run/k3s/containerd/containerd.sock</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_スケジューラー"><a class="anchor" href="#_1_4_スケジューラー"></a>1.4 スケジューラー</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_4_1_profiling_引数が_false_に設定されていることを確認する_自動化"><a class="anchor" href="#_1_4_1_profiling_引数が_false_に設定されていることを確認する_自動化"></a>1.4.1 --profiling 引数が false に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal -u k3s | grep 'Running kube-scheduler' | tail -n1</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--profiling' が 'false' である</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">May 15 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-scheduler --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --bind-address=127.0.0.1 --kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --profiling=false --secure-port=10259"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_1_4_2_bind_address_引数が_127_0_0_1_に設定されていることを確認する_自動化"><a class="anchor" href="#_1_4_2_bind_address_引数が_127_0_0_1_に設定されていることを確認する_自動化"></a>1.4.2 --bind-address 引数が 127.0.0.1 に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal  -u k3s | grep 'Running kube-scheduler' | tail -n1 | grep 'bind-address'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--bind-address' が '127.0.0.1' に等しい、または '--bind-address' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">May 15 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-scheduler --authentication-kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --authorization-kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --bind-address=127.0.0.1 --kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig --profiling=false --secure-port=10259"</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_etcd_ノード構成"><a class="anchor" href="#_2_etcd_ノード構成"></a>2 Etcd ノード構成</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_2_1_cert_file_および_key_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_2_1_cert_file_および_key_file_引数が適切に設定されていることを確認する_自動化"></a>2.1 --cert-file および --key-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep -A 4 'client-transport-security' /var/lib/rancher/k3s/server/db/etcd/config | grep -E 'cert-file|key-file'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'cert-file' が存在し、'key-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">cert-file: /var/lib/rancher/k3s/server/tls/etcd/server-client.crt key-file: /var/lib/rancher/k3s/server/tls/etcd/server-client.key</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_2_2_client_cert_auth_引数が_true_に設定されていることを確認する_自動化"><a class="anchor" href="#_2_2_client_cert_auth_引数が_true_に設定されていることを確認する_自動化"></a>2.2 --client-cert-auth 引数が true に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep -A 4 'client-transport-security' /var/lib/rancher/k3s/server/db/etcd/config | grep 'client-cert-auth'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--client-cert-auth' が存在する、または 'client-cert-auth' が 'true' に等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">client-cert-auth: true</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_2_3_auto_tls_引数が_true_に設定されていないことを確認する_自動化"><a class="anchor" href="#_2_3_auto_tls_引数が_true_に設定されていないことを確認する_自動化"></a>2.3 --auto-tls 引数が true に設定されていないことを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">if grep -q '^auto-tls' /var/lib/rancher/k3s/server/db/etcd/config;then grep '^auto-tls' /var/lib/rancher/k3s/server/db/etcd/config;else echo 'notset';fi</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--auto-tls' が存在しない、または '--auto-tls' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">notset</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_2_4_peer_cert_file_および_peer_key_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_2_4_peer_cert_file_および_peer_key_file_引数が適切に設定されていることを確認する_自動化"></a>2.4 --peer-cert-file および --peer-key-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep -A 4 'peer-transport-security' /var/lib/rancher/k3s/server/db/etcd/config | grep -E 'cert-file|key-file'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'cert-file' が存在し、'key-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">cert-file: /var/lib/rancher/k3s/server/tls/etcd/peer-server-client.crt key-file: /var/lib/rancher/k3s/server/tls/etcd/peer-server-client.key</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_2_5_peer_client_cert_auth_引数が_true_に設定されていることを確認する_自動化"><a class="anchor" href="#_2_5_peer_client_cert_auth_引数が_true_に設定されていることを確認する_自動化"></a>2.5 --peer-client-cert-auth 引数が true に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep -A 4 'peer-transport-security' /var/lib/rancher/k3s/server/db/etcd/config | grep 'client-cert-auth'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--client-cert-auth' が存在する、または 'client-cert-auth' が 'true' に等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">client-cert-auth: true</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_2_6_peer_auto_tls_引数が_true_に設定されていないことを確認する_自動化"><a class="anchor" href="#_2_6_peer_auto_tls_引数が_true_に設定されていないことを確認する_自動化"></a>2.6 --peer-auto-tls 引数が true に設定されていないことを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">if grep -q '^peer-auto-tls' /var/lib/rancher/k3s/server/db/etcd/config;then grep '^peer-auto-tls' /var/lib/rancher/k3s/server/db/etcd/config;else echo 'notset';fi</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--peer-auto-tls' が存在しない、または '--peer-auto-tls' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">notset</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_2_7_etcd_に対して一意の証明書認証局が使用されていることを確認する_自動化"><a class="anchor" href="#_2_7_etcd_に対して一意の証明書認証局が使用されていることを確認する_自動化"></a>2.7 Etcd に対して一意の証明書認証局が使用されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">if grep -q 'trusted-ca-file' /var/lib/rancher/k3s/server/db/etcd/config;then grep 'trusted-ca-file' /var/lib/rancher/k3s/server/db/etcd/config;else echo 'notset';fi</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'trusted-ca-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">trusted-ca-file: /var/lib/rancher/k3s/server/tls/etcd/server-ca.crt trusted-ca-file: /var/lib/rancher/k3s/server/tls/etcd/peer-ca.crt</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_1_ワーカーノード構成ファイル"><a class="anchor" href="#_4_1_ワーカーノード構成ファイル"></a>4.1 ワーカーノード構成ファイル</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_4_1_1_kubelet_サービスファイルのパーミッションが_600_以上の制限に設定されていることを確認する_自動化"><a class="anchor" href="#_4_1_1_kubelet_サービスファイルのパーミッションが_600_以上の制限に設定されていることを確認する_自動化"></a>4.1.1 kubelet サービスファイルのパーミッションが 600 以上の制限に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正:</strong>
各ワーカーノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例: chmod 600 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
該当なし - すべての構成はコンテナ実行時の引数として渡されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_2_kubelet_サービスファイルの所有者が_rootroot_に設定されていることを確認する_自動化"><a class="anchor" href="#_4_1_2_kubelet_サービスファイルの所有者が_rootroot_に設定されていることを確認する_自動化"></a>4.1.2 kubelet サービスファイルの所有者が root:root に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正:</strong>
各ワーカーノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例:
chown root:root /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
該当なし。
すべての構成はコンテナ実行時の引数として渡されます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_3_プロキシ_kubeconfig_ファイルが存在する場合パーミッションが_600_以上の制限に設定されていることを確認する_手動"><a class="anchor" href="#_4_1_3_プロキシ_kubeconfig_ファイルが存在する場合パーミッションが_600_以上の制限に設定されていることを確認する_手動"></a>4.1.3 プロキシ kubeconfig ファイルが存在する場合、パーミッションが 600 以上の制限に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正:</strong>
各ワーカーノードで以下のコマンドを実行します（システム上のファイルの場所に基づく）。
例:
chmod 600 /var/lib/rancher/k3s/agent/kubeproxy.kubeconfig</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_4_プロキシ_kubeconfig_ファイルが存在する場合所有者が_rootroot_に設定されていることを確認する_手動"><a class="anchor" href="#_4_1_4_プロキシ_kubeconfig_ファイルが存在する場合所有者が_rootroot_に設定されていることを確認する_手動"></a>4.1.4 プロキシ kubeconfig ファイルが存在する場合、所有者が root:root に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/rancher/k3s/agent/kubeproxy.kubeconfig; then stat -c %U:%G /var/lib/rancher/k3s/agent/kubeproxy.kubeconfig; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'root:root' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_1_5_kubeconfig_kubelet_conf_ファイルのパーミッションが_600_以上の制限に設定されていることを確認する_自動化"><a class="anchor" href="#_4_1_5_kubeconfig_kubelet_conf_ファイルのパーミッションが_600_以上の制限に設定されていることを確認する_自動化"></a>4.1.5 --kubeconfig kubelet.conf ファイルのパーミッションが 600 以上の制限に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test -e /var/lib/rancher/k3s/server/cred/admin.kubeconfig; then stat -c permissions=%a /var/lib/rancher/k3s/server/cred/admin.kubeconfig; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> パーミッションが 600 であり、600 以上の制限が期待される</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">permissions=600</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_1_6_kubeconfig_kubelet_conf_ファイルの所有者が_rootroot_に設定されていることを確認する_自動化"><a class="anchor" href="#_4_1_6_kubeconfig_kubelet_conf_ファイルの所有者が_rootroot_に設定されていることを確認する_自動化"></a>4.1.6 --kubeconfig kubelet.conf ファイルの所有者が root:root に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c %U:%G /var/lib/rancher/k3s/agent/kubelet.kubeconfig</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'root:root' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_1_7_証明書認証局ファイルのパーミッションが_600_以上の制限に設定されていることを確認する_手動"><a class="anchor" href="#_4_1_7_証明書認証局ファイルのパーミッションが_600_以上の制限に設定されていることを確認する_手動"></a>4.1.7 証明書認証局ファイルのパーミッションが 600 以上の制限に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正:</strong>
--client-ca-file のファイルパーミッションを変更するために以下のコマンドを実行します
chmod 600 &lt;filename&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_8_クライアント証明書認証局ファイルの所有者が_rootroot_に設定されていることを確認する_手動"><a class="anchor" href="#_4_1_8_クライアント証明書認証局ファイルの所有者が_rootroot_に設定されていることを確認する_手動"></a>4.1.8 クライアント証明書認証局ファイルの所有者が root:root に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stat -c %U:%G /var/lib/rancher/k3s/server/tls/client-ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> 'root:root' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">root:root</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_1_9_kubelet_config_構成ファイルのパーミッションが_600_以上の制限に設定されていることを確認する_自動化"><a class="anchor" href="#_4_1_9_kubelet_config_構成ファイルのパーミッションが_600_以上の制限に設定されていることを確認する_自動化"></a>4.1.9 kubelet --config 構成ファイルのパーミッションが 600 以上の制限に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正:</strong>
監査ステップで特定された構成ファイルの場所を使用して以下のコマンドを実行します
chmod 600 /var/lib/kubelet/config.yaml</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_10_kubelet_config_構成ファイルの所有者が_rootroot_に設定されていることを確認する_自動化"><a class="anchor" href="#_4_1_10_kubelet_config_構成ファイルの所有者が_rootroot_に設定されていることを確認する_自動化"></a>4.1.10 kubelet --config 構成ファイルの所有者が root:root に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正:</strong>
監査ステップで特定された構成ファイルの場所を使用して以下のコマンドを実行します
chown root:root /var/lib/kubelet/config.yaml
該当なし。
すべての構成はコンテナ実行時の引数として渡されます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_2_kubelet"><a class="anchor" href="#_4_2_kubelet"></a>4.2 Kubelet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_4_2_1_anonymous_auth_引数が_false_に設定されていることを確認する_自動化"><a class="anchor" href="#_4_2_1_anonymous_auth_引数が_false_に設定されていることを確認する_自動化"></a>4.2.1 --anonymous-auth 引数が false に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test $(journalctl -D /var/log/journal -u k3s | grep "Running kube-apiserver" | wc -l) -gt 0; then journalctl -D /var/log/journal -u k3s | grep "Running kube-apiserver" | tail -n1 | grep "anonymous-auth" | grep -v grep; else echo "--anonymous-auth=false"; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--anonymous-auth' が 'false' に等しい</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_2_2_authorization_mode_引数が_alwaysallow_に設定されていないことを確認する_自動化"><a class="anchor" href="#_4_2_2_authorization_mode_引数が_alwaysallow_に設定されていないことを確認する_自動化"></a>4.2.2 --authorization-mode 引数が AlwaysAllow に設定されていないことを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test $(journalctl -D /var/log/journal -u k3s | grep "Running kube-apiserver" | wc -l) -gt 0; then journalctl -D /var/log/journal -u k3s | grep "Running kube-apiserver" | tail -n1 | grep "authorization-mode" | grep -v grep; else echo "--authorization-mode=Webhook"; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--authorization-mode' に 'AlwaysAllow' が含まれていない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_2_3_client_ca_file_引数が適切に設定されていることを確認する_自動化"><a class="anchor" href="#_4_2_3_client_ca_file_引数が適切に設定されていることを確認する_自動化"></a>4.2.3 --client-ca-file 引数が適切に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/bin/sh -c 'if test $(journalctl -D /var/log/journal -u k3s | grep "Running kube-apiserver" | wc -l) -gt 0; then journalctl -D /var/log/journal -u k3s | grep "Running kube-apiserver" | tail -n1 | grep "client-ca-file" | grep -v grep; else echo "--client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt"; fi'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--client-ca-file' が存在する</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:25 server-0 k3s[2317]: time="2024-05-15T17:22:25Z" level=info msg="Running kube-apiserver --admission-control-config-file=/var/lib/rancher/k3s/server/psa.yaml --advertise-address=10.10.10.100 --advertise-port=6443 --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,k3s --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log --audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml --authorization-mode=Node,RBAC --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt --egress-selector-config-file=/var/lib/rancher/k3s/server/etc/egress-selector-config.yaml --enable-admission-plugins=NodeRestriction --enable-aggregator-routing=true --enable-bootstrap-token-auth=true --encryption-provider-config=/var/lib/rancher/k3s/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --profiling=false --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6444 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key --service-account-lookup=true --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.current.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_2_4_read_only_port_引数が_0_に設定されていることを確認する_手動"><a class="anchor" href="#_4_2_4_read_only_port_引数が_0_に設定されていることを確認する_手動"></a>4.2.4 --read-only-port 引数が 0 に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal -u k3s | grep 'Running kubelet' | tail -n1 | grep 'read-only-port'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--read-only-port' が '0' に等しい、または '--read-only-port' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:27 server-0 k3s[2317]: time="2024-05-15T17:22:27Z" level=info msg="Running kubelet --address=0.0.0.0 --allowed-unsafe-sysctls=net.ipv4.ip_forward,net.ipv6.conf.all.forwarding --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=systemd --client-ca-file=/var/lib/rancher/k3s/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --containerd=/run/k3s/containerd/containerd.sock --event-qps=0 --eviction-hard=imagefs.available&lt;5%,nodefs.available&lt;5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=server-0 --kubeconfig=/var/lib/rancher/k3s/agent/kubelet.kubeconfig --make-iptables-util-chains=true --node-ip=10.10.10.100 --node-labels= --pod-infra-container-image=rancher/mirrored-pause:3.6 --pod-manifest-path=/var/lib/rancher/k3s/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --streaming-connection-idle-timeout=5m --tls-cert-file=/var/lib/rancher/k3s/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/k3s/agent/serving-kubelet.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_2_5_streaming_connection_idle_timeout_引数が_0_に設定されていないことを確認する_手動"><a class="anchor" href="#_4_2_5_streaming_connection_idle_timeout_引数が_0_に設定されていないことを確認する_手動"></a>4.2.5 <code>--streaming-connection-idle-timeout</code> 引数が 0 に設定されていないことを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 合格</p>
</div>
<div class="paragraph">
<p><strong>監査:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl -D /var/log/journal -u k3s | grep 'Running kubelet' | tail -n1 | grep 'streaming-connection-idle-timeout'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>期待される結果:</strong> '--streaming-connection-idle-timeout' が '0' でない、または '--streaming-connection-idle-timeout' が存在しない</p>
</div>
<details>
<summary class="title">返された値:</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">2024年5月15日 17:22:27 server-0 k3s[2317]: time="2024-05-15T17:22:27Z" level=info msg="Running kubelet --address=0.0.0.0 --allowed-unsafe-sysctls=net.ipv4.ip_forward,net.ipv6.conf.all.forwarding --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=systemd --client-ca-file=/var/lib/rancher/k3s/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --containerd=/run/k3s/containerd/containerd.sock --event-qps=0 --eviction-hard=imagefs.available&lt;5%,nodefs.available&lt;5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=server-0 --kubeconfig=/var/lib/rancher/k3s/agent/kubelet.kubeconfig --make-iptables-util-chains=true --node-ip=10.10.10.100 --node-labels= --pod-infra-container-image=rancher/mirrored-pause:3.6 --pod-manifest-path=/var/lib/rancher/k3s/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --streaming-connection-idle-timeout=5m --tls-cert-file=/var/lib/rancher/k3s/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/k3s/agent/serving-kubelet.key"</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_4_2_6_make_iptables_util_chains_引数が_true_に設定されていることを確認する_自動化"><a class="anchor" href="#_4_2_6_make_iptables_util_chains_引数が_true_に設定されていることを確認する_自動化"></a>4.2.6 <code>--make-iptables-util-chains</code> 引数が true に設定されていることを確認する (自動化)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubelet 設定ファイルを使用している場合は、ファイルを編集して <code>makeIPTablesUtilChains</code> を <code>true</code> に設定します。
コマンドライン引数を使用している場合は、各ワーカーノードの kubelet サービスファイル
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf を編集し、
KUBELET_SYSTEM_PODS_ARGS 変数から --make-iptables-util-chains 引数を削除します。
システムに基づいて、kubelet サービスを再起動します。例えば:
systemctl daemon-reload
systemctl restart kubelet.service
許容。</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_7_hostname_override_引数が設定されていないことを確認する_手動"><a class="anchor" href="#_4_2_7_hostname_override_引数が設定されていないことを確認する_手動"></a>4.2.7 <code>--hostname-override</code> 引数が設定されていないことを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
各ワーカーノードの kubelet サービスファイル /etc/systemd/system/kubelet.service.d/10-kubeadm.conf を編集し、
KUBELET_SYSTEM_PODS_ARGS 変数から --hostname-override 引数を削除します。
システムに基づいて、kubelet サービスを再起動します。例えば、
systemctl daemon-reload
systemctl restart kubelet.service
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_8_eventrecordqps_引数が適切なイベントキャプチャを確保するレベルに設定されていることを確認する_手動"><a class="anchor" href="#_4_2_8_eventrecordqps_引数が適切なイベントキャプチャを確保するレベルに設定されていることを確認する_手動"></a>4.2.8 eventRecordQPS 引数が適切なイベントキャプチャを確保するレベルに設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubelet 設定ファイルを使用している場合は、ファイルを編集して <code>eventRecordQPS</code> を適切なレベルに設定します。
コマンドライン引数を使用している場合は、各ワーカーノードの kubelet サービスファイル
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf を編集し、
KUBELET_SYSTEM_PODS_ARGS 変数に以下のパラメータを設定します。
システムに基づいて、kubelet サービスを再起動します。例えば、
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_9_tls_cert_file_および_tls_private_key_file_引数が適切に設定されていることを確認する_手動"><a class="anchor" href="#_4_2_9_tls_cert_file_および_tls_private_key_file_引数が適切に設定されていることを確認する_手動"></a>4.2.9 <code>--tls-cert-file</code> および <code>--tls-private-key-file</code> 引数が適切に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubelet 設定ファイルを使用している場合は、ファイルを編集して <code>tlsCertFile</code> をこの Kubelet を識別するための証明書ファイルの場所に設定し、
<code>tlsPrivateKeyFile</code> を対応する秘密鍵ファイルの場所に設定します。
コマンドライン引数を使用している場合は、各ワーカーノードの kubelet サービスファイル
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf を編集し、
KUBELET_CERTIFICATE_ARGS 変数に以下のパラメータを設定します。
--tls-cert-file=&lt;path/to/tls-certificate-file&gt;
--tls-private-key-file=&lt;path/to/tls-key-file&gt;
システムに基づいて、kubelet サービスを再起動します。例えば、
systemctl daemon-reload
systemctl restart kubelet.service
許容 - サービング証明書を生成する際、特定のクラウドプロバイダーに必要なホスト名オーバーライドと組み合わせて機能が壊れる可能性があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_10_rotate_certificates_引数が_false_に設定されていないことを確認する_手動"><a class="anchor" href="#_4_2_10_rotate_certificates_引数が_false_に設定されていないことを確認する_手動"></a>4.2.10 <code>--rotate-certificates</code> 引数が false に設定されていないことを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubelet 設定ファイルを使用している場合は、ファイルを編集して <code>rotateCertificates</code> を <code>true</code> に設定するか、
デフォルト値を使用するために削除します。
コマンドライン引数を使用している場合は、各ワーカーノードの kubelet サービスファイル
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf を編集し、
KUBELET_CERTIFICATE_ARGS 変数から --rotate-certificates=false 引数を削除します。
システムに基づいて、kubelet サービスを再起動します。例えば、
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_11_rotatekubeletservercertificate_引数が_true_に設定されていることを確認する_手動"><a class="anchor" href="#_4_2_11_rotatekubeletservercertificate_引数が_true_に設定されていることを確認する_手動"></a>4.2.11 RotateKubeletServerCertificate 引数が true に設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
各ワーカーノードの kubelet サービスファイル /etc/systemd/system/kubelet.service.d/10-kubeadm.conf を編集し、
KUBELET_CERTIFICATE_ARGS 変数に以下のパラメータを設定します。
--feature-gates=RotateKubeletServerCertificate=true
システムに基づいて、kubelet サービスを再起動します。例えば:
systemctl daemon-reload
systemctl restart kubelet.service
該当なし。</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_12_kubelet_が強力な暗号化スイートのみを使用していることを確認する_手動"><a class="anchor" href="#_4_2_12_kubelet_が強力な暗号化スイートのみを使用していることを確認する_手動"></a>4.2.12 Kubelet が強力な暗号化スイートのみを使用していることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubelet 設定ファイルを使用している場合は、ファイルを編集して <code>TLSCipherSuites</code> を
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
またはこれらの値のサブセットに設定します。
実行可能な引数を使用している場合は、各ワーカーノードの kubelet サービスファイル
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf を編集し、
--tls-cipher-suites パラメータを以下のように設定します。またはこれらの値のサブセットに設定します。
--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
システムに基づいて、kubelet サービスを再起動します。例えば:
systemctl daemon-reload
systemctl restart kubelet.service</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_13_ポッドの_pid_に制限が設定されていることを確認する_手動"><a class="anchor" href="#_4_2_13_ポッドの_pid_に制限が設定されていることを確認する_手動"></a>4.2.13 ポッドの PID に制限が設定されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
このパラメータの適切なレベルを決定し、
--pod-max-pids コマンドラインパラメータまたは PodPidsLimit 設定ファイル設定を使用して設定します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_1_rbac_とサービスアカウント"><a class="anchor" href="#_5_1_rbac_とサービスアカウント"></a>5.1 RBAC とサービスアカウント</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_1_1_cluster_admin_ロールが必要な場合にのみ使用されていることを確認する_手動"><a class="anchor" href="#_5_1_1_cluster_admin_ロールが必要な場合にのみ使用されていることを確認する_手動"></a>5.1.1 cluster-admin ロールが必要な場合にのみ使用されていることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
cluster-admin ロールへのすべての clusterrolebinding を特定します。それらが使用されているかどうか、
およびこのロールが必要かどうか、またはより少ない権限のロールを使用できるかどうかを確認します。
可能な場合は、最初にユーザーを低権限のロールにバインドし、その後 cluster-admin ロールへの
clusterrolebinding を削除します:
kubectl delete clusterrolebinding [name]</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_2_シークレットへのアクセスを最小限に抑える_手動"><a class="anchor" href="#_5_1_2_シークレットへのアクセスを最小限に抑える_手動"></a>5.1.2 シークレットへのアクセスを最小限に抑える (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な場合は、クラスター内の Secret オブジェクトへの get、list、および watch アクセスを削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_3_ロールおよび_clusterroles_でのワイルドカードの使用を最小限に抑える_手動"><a class="anchor" href="#_5_1_3_ロールおよび_clusterroles_でのワイルドカードの使用を最小限に抑える_手動"></a>5.1.3 ロールおよび ClusterRoles でのワイルドカードの使用を最小限に抑える (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な場合は、clusterroles および roles でのワイルドカードの使用を特定のオブジェクトまたはアクションに置き換えます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_4_ポッドの作成アクセスを最小限に抑える_手動"><a class="anchor" href="#_5_1_4_ポッドの作成アクセスを最小限に抑える_手動"></a>5.1.4 ポッドの作成アクセスを最小限に抑える (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な場合は、クラスター内のポッドオブジェクトへの作成アクセスを削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_5_デフォルトのサービスアカウントが積極的に使用されていないことを確認する_手動"><a class="anchor" href="#_5_1_5_デフォルトのサービスアカウントが積極的に使用されていないことを確認する_手動"></a>5.1.5 デフォルトのサービスアカウントが積極的に使用されていないことを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubernetes ワークロードが Kubernetes API サーバーへの特定のアクセスを必要とする場合は、明示的なサービスアカウントを作成します。
各デフォルトのサービスアカウントの設定を変更して、この値を含めます
automountServiceAccountToken: false
許容 - Kubernetes はデフォルトのサービスアカウントを提供します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_6_サービスアカウントトークンが必要な場合にのみマウントされることを確認する_手動"><a class="anchor" href="#_5_1_6_サービスアカウントトークンが必要な場合にのみマウントされることを確認する_手動"></a>5.1.6 サービスアカウントトークンが必要な場合にのみマウントされることを確認する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
サービスアカウントトークンをマウントする必要がないポッドおよびサービスアカウントの定義を変更して無効にします。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_7_systemmasters_グループの使用を避ける_手動"><a class="anchor" href="#_5_1_7_systemmasters_グループの使用を避ける_手動"></a>5.1.7 system:masters グループの使用を避ける (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> 警告</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のすべてのユーザーから system:masters グループを削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_8_kubernetes_クラスター内での_bindimpersonateおよび_escalate_権限の使用を制限する_手動"><a class="anchor" href="#_5_1_8_kubernetes_クラスター内での_bindimpersonateおよび_escalate_権限の使用を制限する_手動"></a>5.1.8 Kubernetes クラスター内での Bind、Impersonate、および Escalate 権限の使用を制限する (手動)</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な限り、サブジェクトから偽装、バインド、およびエスカレート権限を削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_9_永続ボリュームの作成アクセスを最小限に抑える手動"><a class="anchor" href="#_5_1_9_永続ボリュームの作成アクセスを最小限に抑える手動"></a>5.1.9 永続ボリュームの作成アクセスを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な限り、クラスター内のPersistentVolumeオブジェクトへの作成アクセスを削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_10_ノードのプロキシサブリソースへのアクセスを最小限に抑える手動"><a class="anchor" href="#_5_1_10_ノードのプロキシサブリソースへのアクセスを最小限に抑える手動"></a>5.1.10 ノードのプロキシサブリソースへのアクセスを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な限り、ノードオブジェクトのプロキシサブリソースへのアクセスを削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_11_証明書署名要求オブジェクトの承認サブリソースへのアクセスを最小限に抑える手動"><a class="anchor" href="#_5_1_11_証明書署名要求オブジェクトの承認サブリソースへのアクセスを最小限に抑える手動"></a>5.1.11 証明書署名要求オブジェクトの承認サブリソースへのアクセスを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な限り、証明書署名要求オブジェクトの承認サブリソースへのアクセスを削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_12_webhook構成オブジェクトへのアクセスを最小限に抑える手動"><a class="anchor" href="#_5_1_12_webhook構成オブジェクトへのアクセスを最小限に抑える手動"></a>5.1.12 Webhook構成オブジェクトへのアクセスを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な限り、validatingwebhookconfigurationsまたはmutatingwebhookconfigurationsオブジェクトへのアクセスを削除します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_1_13_サービスアカウントトークンの作成アクセスを最小限に抑える手動"><a class="anchor" href="#_5_1_13_サービスアカウントトークンの作成アクセスを最小限に抑える手動"></a>5.1.13 サービスアカウントトークンの作成アクセスを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能な限り、serviceaccountオブジェクトのトークンサブリソースへのアクセスを削除します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_2_ポッドセキュリティ基準"><a class="anchor" href="#_5_2_ポッドセキュリティ基準"></a>5.2 ポッドセキュリティ基準</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_2_1_クラスターに少なくとも1つのアクティブなポリシー制御メカニズムが存在することを確認する手動"><a class="anchor" href="#_5_2_1_クラスターに少なくとも1つのアクティブなポリシー制御メカニズムが存在することを確認する手動"></a>5.2.1 クラスターに少なくとも1つのアクティブなポリシー制御メカニズムが存在することを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Pod Security Admissionまたは外部ポリシー制御システムが、ユーザーのワークロードを含むすべてのネームスペースに存在することを確認します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_2_特権コンテナの受け入れを最小限に抑える手動"><a class="anchor" href="#_5_2_2_特権コンテナの受け入れを最小限に抑える手動"></a>5.2.2 特権コンテナの受け入れを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、特権コンテナの受け入れを制限します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_3_ホストプロセスidネームスペースを共有するコンテナの受け入れを最小限に抑える自動"><a class="anchor" href="#_5_2_3_ホストプロセスidネームスペースを共有するコンテナの受け入れを最小限に抑える自動"></a>5.2.3 ホストプロセスIDネームスペースを共有するコンテナの受け入れを最小限に抑える（自動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>hostPID</code>コンテナの受け入れを制限します。
許容 - Pod Security Policyを有効にすると、アプリケーションが予期せず失敗する可能性があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_4_ホストipcネームスペースを共有するコンテナの受け入れを最小限に抑える自動"><a class="anchor" href="#_5_2_4_ホストipcネームスペースを共有するコンテナの受け入れを最小限に抑える自動"></a>5.2.4 ホストIPCネームスペースを共有するコンテナの受け入れを最小限に抑える（自動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>hostIPC</code>コンテナの受け入れを制限します。
許容 - Pod Security Policyを有効にすると、アプリケーションが予期せず失敗する可能性があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_5_ホストネットワークネームスペースを共有するコンテナの受け入れを最小限に抑える自動"><a class="anchor" href="#_5_2_5_ホストネットワークネームスペースを共有するコンテナの受け入れを最小限に抑える自動"></a>5.2.5 ホストネットワークネームスペースを共有するコンテナの受け入れを最小限に抑える（自動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>hostNetwork</code>コンテナの受け入れを制限します。
許容 - Pod Security Policyを有効にすると、アプリケーションが予期せず失敗する可能性があります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_6_allowprivilegeescalationを持つコンテナの受け入れを最小限に抑える自動"><a class="anchor" href="#_5_2_6_allowprivilegeescalationを持つコンテナの受け入れを最小限に抑える自動"></a>5.2.6 allowPrivilegeEscalationを持つコンテナの受け入れを最小限に抑える（自動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>.spec.allowPrivilegeEscalation</code>が<code>true</code>に設定されているコンテナの受け入れを制限します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_7_ルートコンテナの受け入れを最小限に抑える自動"><a class="anchor" href="#_5_2_7_ルートコンテナの受け入れを最小限に抑える自動"></a>5.2.7 ルートコンテナの受け入れを最小限に抑える（自動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内の各ネームスペースにポリシーを作成し、<code>MustRunAsNonRoot</code>またはUIDの範囲に0を含まない<code>MustRunAs</code>が設定されていることを確認します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_8_net_raw機能を持つコンテナの受け入れを最小限に抑える自動"><a class="anchor" href="#_5_2_8_net_raw機能を持つコンテナの受け入れを最小限に抑える自動"></a>5.2.8 NET_RAW機能を持つコンテナの受け入れを最小限に抑える（自動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>NET_RAW</code>機能を持つコンテナの受け入れを制限します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_9_追加機能を持つコンテナの受け入れを最小限に抑える自動"><a class="anchor" href="#_5_2_9_追加機能を持つコンテナの受け入れを最小限に抑える自動"></a>5.2.9 追加機能を持つコンテナの受け入れを最小限に抑える（自動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
<code>allowedCapabilities</code>が空の配列に設定されていない限り、クラスターのポリシーに<code>allowedCapabilities</code>が存在しないことを確認します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_10_機能が割り当てられたコンテナの受け入れを最小限に抑える手動"><a class="anchor" href="#_5_2_10_機能が割り当てられたコンテナの受け入れを最小限に抑える手動"></a>5.2.10 機能が割り当てられたコンテナの受け入れを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスターで実行されているアプリケーションの機能の使用を確認します。ネームスペースにLinux機能を必要としないアプリケーションが含まれている場合、すべての機能を削除しないコンテナの受け入れを禁止するPSPを追加することを検討します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_11_windows_hostprocessコンテナの受け入れを最小限に抑える手動"><a class="anchor" href="#_5_2_11_windows_hostprocessコンテナの受け入れを最小限に抑える手動"></a>5.2.11 Windows HostProcessコンテナの受け入れを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>.securityContext.windowsOptions.hostProcess</code>が<code>true</code>に設定されているコンテナの受け入れを制限します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_12_hostpathボリュームの受け入れを最小限に抑える手動"><a class="anchor" href="#_5_2_12_hostpathボリュームの受け入れを最小限に抑える手動"></a>5.2.12 HostPathボリュームの受け入れを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>hostPath</code>ボリュームを持つコンテナの受け入れを制限します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_13_hostportsを使用するコンテナの受け入れを最小限に抑える手動"><a class="anchor" href="#_5_2_13_hostportsを使用するコンテナの受け入れを最小限に抑える手動"></a>5.2.13 HostPortsを使用するコンテナの受け入れを最小限に抑える（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラスター内のユーザーワークロードを持つ各ネームスペースにポリシーを追加し、<code>hostPort</code>セクションを使用するコンテナの受け入れを制限します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_3_ネットワークポリシーとcni"><a class="anchor" href="#_5_3_ネットワークポリシーとcni"></a>5.3 ネットワークポリシーとCNI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_3_1_使用中のcniがネットワークポリシーをサポートしていることを確認する手動"><a class="anchor" href="#_5_3_1_使用中のcniがネットワークポリシーをサポートしていることを確認する手動"></a>5.3.1 使用中のCNIがネットワークポリシーをサポートしていることを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
使用中のCNIプラグインがネットワークポリシーをサポートしていない場合、別のプラグインを使用するか、Kubernetesクラスター内のトラフィックを制限するための代替メカニズムを検討します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_3_2_すべてのネームスペースにネットワークポリシーが定義されていることを確認する手動"><a class="anchor" href="#_5_3_2_すべてのネームスペースにネットワークポリシーが定義されていることを確認する手動"></a>5.3.2 すべてのネームスペースにネットワークポリシーが定義されていることを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
ドキュメントに従い、必要に応じてNetworkPolicyオブジェクトを作成します。
許容 - ネットワークポリシーを有効にすると、特定のアプリケーションが互いに通信できなくなる可能性があります。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_4_シークレット管理"><a class="anchor" href="#_5_4_シークレット管理"></a>5.4 シークレット管理</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_4_1_環境変数としてのシークレットよりもファイルとしてのシークレットを使用することを推奨手動"><a class="anchor" href="#_5_4_1_環境変数としてのシークレットよりもファイルとしてのシークレットを使用することを推奨手動"></a>5.4.1 環境変数としてのシークレットよりもファイルとしてのシークレットを使用することを推奨（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
可能であれば、アプリケーションコードを再記述し、環境変数ではなくマウントされたシークレットファイルからシークレットを読み取るようにします。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_4_2_外部シークレットストレージを検討する手動"><a class="anchor" href="#_5_4_2_外部シークレットストレージを検討する手動"></a>5.4.2 外部シークレットストレージを検討する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
クラウドプロバイダーやサードパーティのシークレット管理ソリューションが提供するシークレット管理オプションを参照します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_5_拡張可能なアドミッションコントロール"><a class="anchor" href="#_5_5_拡張可能なアドミッションコントロール"></a>5.5 拡張可能なアドミッションコントロール</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_5_1_imagepolicywebhookアドミッションコントローラーを使用してイメージの出所を設定する手動"><a class="anchor" href="#_5_5_1_imagepolicywebhookアドミッションコントローラーを使用してイメージの出所を設定する手動"></a>5.5.1 ImagePolicyWebhookアドミッションコントローラーを使用してイメージの出所を設定する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubernetesのドキュメントに従い、イメージの出所を設定します。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_7_一般的なポリシー"><a class="anchor" href="#_5_7_一般的なポリシー"></a>5.7 一般的なポリシー</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_7_1_ネームスペースを使用してリソース間に管理境界を作成する手動"><a class="anchor" href="#_5_7_1_ネームスペースを使用してリソース間に管理境界を作成する手動"></a>5.7.1 ネームスペースを使用してリソース間に管理境界を作成する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
ドキュメントに従い、必要に応じてデプロイメント内のオブジェクトのためにネームスペースを作成します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_7_2_pod定義でseccompプロファイルがdockerdefaultに設定されていることを確認する手動"><a class="anchor" href="#_5_7_2_pod定義でseccompプロファイルがdockerdefaultに設定されていることを確認する手動"></a>5.7.2 Pod定義でseccompプロファイルがdocker/defaultに設定されていることを確認する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
<code>securityContext</code>を使用して、Pod定義でdocker/default seccompプロファイルを有効にします。以下はその例です：
  securityContext:
    seccompProfile:
      type: RuntimeDefault</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_7_3_podおよびコンテナにsecuritycontextを適用する手動"><a class="anchor" href="#_5_7_3_podおよびコンテナにsecuritycontextを適用する手動"></a>5.7.3 PodおよびコンテナにSecurityContextを適用する（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> WARN</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubernetesのドキュメントに従い、PodにSecurityContextを適用します。推奨されるSecurityContextのリストについては、CIS Security Benchmark for Docker Containersを参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_7_4_デフォルトのネームスペースは使用しない手動"><a class="anchor" href="#_5_7_4_デフォルトのネームスペースは使用しない手動"></a>5.7.4 デフォルトのネームスペースは使用しない（手動）</h3>
<div class="paragraph">
<p><strong>結果:</strong> 該当なし</p>
</div>
<div class="paragraph">
<p><strong>修正方法:</strong>
Kubernetesリソースの適切な分離を可能にするためにネームスペースを作成し、すべての新しいリソースが特定のネームスペースに作成されることを確認します。
許容 - Kubernetesはデフォルトのネームスペースを提供します。</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="self-assessment-1.8.html">CIS 1.8 セルフアセスメントガイド</a></span>
  <span class="next"><a href="../cli/cli.html">CLIツール</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
