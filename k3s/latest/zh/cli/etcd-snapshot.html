<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>k3s etcd-snapshot :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/k3s/latest/zh/cli/etcd-snapshot.html">
    <link rel="prev" href="certificate.html">
    <link rel="next" href="secrets-encrypt.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-06-02"/>
<link rel="stylesheet" href="../../../../_/css/search.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/zh/cli/etcd-snapshot.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/cli/etcd-snapshot.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/zh/cli/etcd-snapshot.html" hrefLang="zh-CN" rel="alternate" />


<!-- Link for the English page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/cli/etcd-snapshot.html" hreflang="en-US" rel="alternate" />

<!-- Link for the Korean page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ko/cli/etcd-snapshot.html" hreflang="ko-KR" rel="alternate" />

<!-- Link for the Japanese page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ja/cli/etcd-snapshot.html" hreflang="ja-JP" rel="alternate" />







<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="k3s" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">K3s</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">K3s - 轻量级 Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quick-start.html">快速入门指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../installation/installation.html">安装</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/configuration.html">Configuration Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/private-registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/registry-mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/airgap.html">Air-Gap Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/server-roles.html">Managing Server Roles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/packaged-components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/uninstall.html">Uninstalling K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../datastore/datastore.html">集群数据存储</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/backup-restore.html">备份和恢复</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha-embedded.html">高可用嵌入式 etcd</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/ha.html">高可用外部数据库</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../datastore/cluster-loadbalancer.html">Cluster Load Balancer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../upgrades/upgrades.html">升级</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/killall.html">停止 K3s</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/manual.html">手动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/automated.html">自动升级</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../upgrades/roll-back.html">Rolling Back K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../security/security.html">安全</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/secrets-encryption.html">Secret 加密配置</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/hardening-guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.10.html">CIS 1.10 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.9.html">CIS 1.9 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.8.html">CIS 1.8 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/self-assessment-1.7.html">CIS 1.7 Self Assessment Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="cli.html">CLI 工具</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="server.html">server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="agent.html">agent</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="certificate.html">certificate</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="etcd-snapshot.html">etcd-snapshot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="secrets-encrypt.html">secrets-encrypt</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="token.html">token</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../architecture.html">架构</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cluster-access.html">集群访问</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../storage.html">卷和存储</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../import-images.html">Import images</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="../networking/networking.html">Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/basic-network-options.html">Basic Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/distributed-multicloud.html">Distributed hybrid or multicloud cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/multus-ipams.html">Multus and IPAM plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/networking-services.html">网络</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../helm.html">Helm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced.html">高级选项和配置</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">参考</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/env-variables.html">环境变量</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/flag-deprecation.html">Flag Deprecation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/resource-profiling.html">资源分析</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../release-notes/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../related-projects.html">Related Projects</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../known-issues.html">已知问题</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">常见问题</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3s</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="../../en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/k3s" title="K3s" aria-label="SUSE Documentation - K3s">
        K3s
      </a>
    </li>
      <li>
          <a href="cli.html" title="CLI 工具" aria-label="CLI 工具">CLI 工具</a>
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/k3s-product-docs/edit/main/docs/latest/modules/zh/pages/cli/etcd-snapshot.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:k3s" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">k3s etcd-snapshot</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page documents the management of etcd snapshots using the <code>k3s etcd-snapshot</code> CLI, as well as configuration of etcd scheduled snapshots for the <code>k3s server</code> process, and use of the <code>k3s server --cluster-reset</code> command to reset etcd cluster membership and optionally restore etcd snapshots.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_snapshots"><a class="anchor" href="#_creating_snapshots"></a>Creating Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Snapshots are saved to the path set by the server&#8217;s <code>--etcd-snapshot-dir</code> value, which defaults to <code>${data-dir}/server/db/snapshots</code>. The data-dir value defaults to <code>/var/lib/rancher/k3s</code> and can be changed independently by setting the <code>--data-dir</code> flag.</p>
</div>
<div class="sect2">
<h3 id="_scheduled_snapshots"><a class="anchor" href="#_scheduled_snapshots"></a>Scheduled Snapshots</h3>
<div class="paragraph">
<p>Scheduled snapshots are enabled by default, at 00:00 and 12:00 system time, with 5 snapshots retained. To configure the snapshot interval or the number of retained snapshots, refer to the <a href="#_snapshot_configuration_options">snapshot configuration options</a>.</p>
</div>
<div class="paragraph">
<p>Scheduled snapshots have a name that starts with <code>etcd-snapshot</code>, followed by the node name and timestamp. The base name can be changed with the <code>--etcd-snapshot-name</code> flag in the server configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_demand_snapshots"><a class="anchor" href="#_on_demand_snapshots"></a>On-demand Snapshots</h3>
<div class="paragraph">
<p>Snapshots can be saved manually by running the <code>k3s etcd-snapshot save</code> command.</p>
</div>
<div class="paragraph">
<p>On-demand snapshots have a name that starts with <code>on-demand</code>, followed by the node name and timestamp. The base name can be changed with the <code>--name</code> flag when saving the snapshot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_snapshot_configuration_options"><a class="anchor" href="#_snapshot_configuration_options"></a>Snapshot Configuration Options</h3>
<div class="paragraph">
<p>These flags can be passed to the <code>k3s server</code> command to reset the etcd cluster, and optionally restore from a snapshot.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--cluster-reset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forget all peers and become sole member of a new cluster. This can also be set with the environment variable <code>[$K3S_CLUSTER_RESET]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--cluster-reset-restore-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to snapshot file to be restored</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These flags are valid for both <code>k3s server</code> and <code>k3s etcd-snapshot</code>, however when passed to <code>k3s etcd-snapshot</code> the <code>--etcd-</code> prefix can be omitted to avoid redundancy.
Flags can be passed in with the command line, or in the <a href="../installation/configuration.html#_configuration_file" class="xref page">configuration file</a>, which may be easier to use.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-disable-snapshots</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable scheduled snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compress etcd snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory to save db snapshots. (Default location: <code>${data-dir}/db/snapshots</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-retention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of snapshots to retain (default: 5)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-snapshot-schedule-cron</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot interval time in cron spec. eg. every 5 hours <code>0 */5 * * *</code> (default: <code>0 */12 * * *</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_s3_compatible_object_store_support"><a class="anchor" href="#_s3_compatible_object_store_support"></a>S3 Compatible Object Store Support</h3>
<div class="paragraph">
<p>K3s supports writing etcd snapshots to and restoring etcd snapshots from S3-compatible object stores. S3 support is available for both on-demand and scheduled snapshots.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">选项</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用备份到 S3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 端点网址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-endpoint-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 自定义 CA 证书，用于连接到 S3 端点</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-skip-ssl-verify</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁用 S3 SSL 证书验证</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-access-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 access key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-secret-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 secret key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-bucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 存储桶名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-region</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 区域/存储桶位置（可选）。默认为 us-east-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-folder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 文件夹</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy server to use when connecting to S3, overriding any proxy-releated environment variables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-insecure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables S3 over HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 timeout (default: <code>5m0s</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--etcd-s3-config-secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of secret in the kube-system namespace used to configure S3, if etcd-s3 is enabled and no other etcd-s3 options are set</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>执行按需的 etcd 快照并将其保存到 S3：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s etcd-snapshot \
  --s3 \
  --s3-bucket=&lt;S3-BUCKET-NAME&gt; \
  --s3-access-key=&lt;S3-ACCESS-KEY&gt; \
  --s3-secret-key=&lt;S3-SECRET-KEY&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>要从 S3 中执行按需的 etcd 快照还原，首先确保 K3s 没有运行。然后运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s server \
  --cluster-init \
  --cluster-reset \
  --etcd-s3 \
  --cluster-reset-restore-path=&lt;SNAPSHOT-NAME&gt; \
  --etcd-s3-bucket=&lt;S3-BUCKET-NAME&gt; \
  --etcd-s3-access-key=&lt;S3-ACCESS-KEY&gt; \
  --etcd-s3-secret-key=&lt;S3-SECRET-KEY&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_s3_configuration_secret_support"><a class="anchor" href="#_s3_configuration_secret_support"></a>S3 Configuration Secret Support</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>S3 Configuration Secret support is available as of the August 2024 releases: v1.30.4+k3s1, v1.29.8+k3s1, v1.28.13+k3s1.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>K3s supports reading etcd S3 snapshot configuration from a Kubernetes Secret.
This may be preferred to hardcoding credentials in K3s CLI flags or config files for security reasons, or if credentials need to be rotated without restarting K3s.
To pass S3 snapshot configuration via a Secret, start K3s with <code>--etcd-s3</code> and <code>--etcd-s3-config-secret=&lt;SECRET-NAME&gt;</code>.
The Secret does not need to exist when K3s is started, but it will be checked for every time a snapshot save/list/delete/prune operation is performed.</p>
</div>
<div class="paragraph">
<p>The S3 config Secret cannot be used when restoring a snapshot, as the apiserver is not available to provide the secret during a restore.
S3 configuration must be passed via the CLI when restoring a snapshot stored on S3.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pass only the the <code>--etcd-s3</code> and <code>--etcd-s3-config-secret</code> flags to enable the Secret.
If any other S3 configuration flags are set, the Secret will be ignored.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keys in the Secret correspond to the <code>--etcd-s3-*</code> CLI flags listed above.
The <code>etcd-s3-endpoint-ca</code> key accepts a PEM-encoded CA bundle, or the <code>etcd-s3-endpoint-ca-name</code> key may be used to specify the name of a ConfigMap in the <code>kube-system</code> namespace containing one or more PEM-encoded CA bundles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: k3s-etcd-snapshot-s3-config
  namespace: kube-system
type: etcd.k3s.cattle.io/s3-config-secret
stringData:
  etcd-s3-endpoint: ""
  etcd-s3-endpoint-ca: ""
  etcd-s3-endpoint-ca-name: ""
  etcd-s3-skip-ssl-verify: "false"
  etcd-s3-access-key: "AWS_ACCESS_KEY_ID"
  etcd-s3-secret-key: "AWS_SECRET_ACCESS_KEY"
  etcd-s3-bucket: "bucket"
  etcd-s3-folder: "folder"
  etcd-s3-region: "us-east-1"
  etcd-s3-insecure: "false"
  etcd-s3-timeout: "5m"
  etcd-s3-proxy: ""</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_snapshots"><a class="anchor" href="#_managing_snapshots"></a>Managing Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s 支持用于处理 etcd 快照的一组子命令。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">子命令</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除给定的快照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ls, list, l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">列出快照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prune</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除超过配置的保留数量的快照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">触发即时 etcd 快照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>无论 etcd 快照是存储在本地还是存储在 S3 兼容的对象存储中，这些命令都将按预期执行。</p>
</div>
<div class="paragraph">
<p>有关 etcd 快照子命令的更多信息，请运行 <code>k3s etcd-snapshot --help</code>。</p>
</div>
<div class="paragraph">
<p>从 S3 中删除快照。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s etcd-snapshot delete          \
  --s3                            \
  --s3-bucket=&lt;S3-BUCKET-NAME&gt;    \
  --s3-access-key=&lt;S3-ACCESS-KEY&gt; \
  --s3-secret-key=&lt;S3-SECRET-KEY&gt; \
  &lt;SNAPSHOT-NAME&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用默认保留策略 (5) 修剪本地快照。<code>prune</code> 子命令接受额外的标志 <code>--snapshot-retention</code>，允许覆盖默认保留策略。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s etcd-snapshot prune</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s etcd-snapshot prune --snapshot-retention 10</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_etcdsnapshotfile_custom_resources"><a class="anchor" href="#_etcdsnapshotfile_custom_resources"></a>ETCDSnapshotFile Custom Resources</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>ETCDSnapshotFiles are available as of the November 2023 releases: v1.28.4+k3s2, v1.27.8+k3s2, v1.26.11+k3s2, v1.25.16+k3s4.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Snapshots can be viewed remotely using any Kubernetes client by listing or describing cluster-scoped <code>ETCDSnapshotFile</code> resources.
Unlike the <code>k3s etcd-snapshot list</code> command, which only shows snapshots visible to that node, <code>ETCDSnapshotFile</code> resources track all snapshots present on cluster members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get etcdsnapshotfile
NAME                                             SNAPSHOTNAME                        NODE           LOCATION                                                                            SIZE      CREATIONTIME
local-on-demand-k3s-server-1-1730308816-3e9290   on-demand-k3s-server-1-1730308816   k3s-server-1   file:///var/lib/rancher/k3s/server/db/snapshots/on-demand-k3s-server-1-1730308816   2891808   2024-10-30T17:20:16Z
s3-on-demand-k3s-server-1-1730308816-79b15c      on-demand-k3s-server-1-1730308816   s3             s3://etcd/k3s-test/on-demand-k3s-server-1-1730308816                                2891808   2024-10-30T17:20:16Z</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl describe etcdsnapshotfile s3-on-demand-k3s-server-1-1730308816-79b15c
Name:         s3-on-demand-k3s-server-1-1730308816-79b15c
Namespace:
Labels:       etcd.k3s.cattle.io/snapshot-storage-node=s3
Annotations:  etcd.k3s.cattle.io/snapshot-token-hash: b4b83cda3099
API Version:  k3s.cattle.io/v1
Kind:         ETCDSnapshotFile
Metadata:
  Creation Timestamp:  2024-10-30T17:20:16Z
  Finalizers:
    wrangler.cattle.io/managed-etcd-snapshots-controller
  Generation:        1
  Resource Version:  790
  UID:               bec9a51c-dbbe-4746-922e-a5136bef53fc
Spec:
  Location:   s3://etcd/k3s-test/on-demand-k3s-server-1-1730308816
  Node Name:  s3
  s3:
    Bucket:           etcd
    Endpoint:         s3.example.com
    Prefix:           k3s-test
    Region:           us-east-1
    Skip SSL Verify:  true
  Snapshot Name:      on-demand-k3s-server-1-1730308816
Status:
  Creation Time:  2024-10-30T17:20:16Z
  Ready To Use:   true
  Size:           2891808
Events:
  Type    Reason               Age   From            Message
  ----    ------               ----  ----            -------
  Normal  ETCDSnapshotCreated  113s  k3s-supervisor  Snapshot on-demand-k3s-server-1-1730308816 saved on S3</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restoring_snapshots"><a class="anchor" href="#_restoring_snapshots"></a>Restoring Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s runs through several steps when restoring a snapshot:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the snapshot is stored on S3, the file is downloaded into the snapshot directory.</p>
</li>
<li>
<p>If the snapshot is compressed, it is decompressed.</p>
</li>
<li>
<p>If present, the current etcd database files are moved to <code>${data-dir}/server/db/etcd-old-$TIMESTAMP/</code>.</p>
</li>
<li>
<p>The snapshot&#8217;s contents are extracted out to disk, and the checksum is verified.</p>
</li>
<li>
<p>Etcd is started, and all etcd cluster members except the current node are removed from the cluster.</p>
</li>
<li>
<p>CA Certificates and other confidential data are extracted from the datastore and written to disk, for later use.</p>
</li>
<li>
<p>The restore is complete, and K3s can be restarted and used normally on the server where the restore was performed.</p>
</li>
<li>
<p>(optional) Agents and control-plane servers can be started normally.</p>
</li>
<li>
<p>(optional) Etcd servers can be restarted to rejoin to the cluster after removing old database files.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_snapshot_restore_steps"><a class="anchor" href="#_snapshot_restore_steps"></a>Snapshot Restore Steps</h3>
<div class="paragraph">
<p>Select the tab below that matches your cluster configuration.</p>
</div>
<div id="_tabs_1" class="openblock tabs is-sync data-sync-group-id=etcdsnap is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_single_server" class="tab">
<p>Single Server</p>
</li>
<li id="_tabs_1_multiple_servers" class="tab">
<p>Multiple Servers</p>
</li>
</ul>
</div>
<div id="_tabs_1_single_server--panel" class="tabpanel" aria-labelledby="_tabs_1_single_server">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop the K3s service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl stop k3s</code></pre>
</div>
</div>
</li>
<li>
<p>Run <code>k3s server</code> with the <code>--cluster-reset</code> flag, and <code>--cluster-reset-restore-path</code> indicating the path to the snapshot to restore.
If the snapshot is stored on S3, provide S3 configuration flags (<code>--etcd-s3</code>, <code>--etcd-s3-bucket</code>, and so on), and give only the filename name of the snapshot as the restore path.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the <code>--cluster-reset</code> flag without specifying a snapshot to restore simply resets the etcd cluster to a single member without restoring a snapshot.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s server \
  --cluster-reset \
  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Result:</strong> K3s restores the snapshot and resets cluster membership, then prints a message indicating that it is ready to be restarted:
<code>Managed etcd cluster membership has been reset, restart without --cluster-reset flag now.</code></p>
</div>
</li>
<li>
<p>Start K3s again:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start k3s</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="_tabs_1_multiple_servers--panel" class="tabpanel" aria-labelledby="_tabs_1_multiple_servers">
<div class="paragraph">
<p>In this example there are 3 servers, <code>S1</code>, <code>S2</code>, and <code>S3</code>. The snapshot is located on <code>S1</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop K3s on all servers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl stop k3s</code></pre>
</div>
</div>
</li>
<li>
<p>On S1, run <code>k3s server</code> with the <code>--cluster-reset</code> option, and <code>--cluster-reset-restore-path</code> indicating the path to the snapshot to restore.
If the snapshot is stored on S3, provide S3 configuration flags (<code>--etcd-s3</code>, <code>--etcd-s3-bucket</code>, and so on), and give only the filename name of the snapshot as the restore path.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the <code>--cluster-reset</code> flag without specifying a snapshot to restore simply resets the etcd cluster to a single member without restoring a snapshot.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s server \
  --cluster-reset \
  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Result:</strong> K3s restores the snapshot and resets cluster membership, then prints a message indicating that it is ready to be restarted:
<code>Managed etcd cluster membership has been reset, restart without --cluster-reset flag now.</code>
<code>Backup and delete ${datadir}/server/db on each peer etcd server and rejoin the nodes.</code></p>
</div>
</li>
<li>
<p>On S1, start K3s again:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start k3s</code></pre>
</div>
</div>
</li>
<li>
<p>On S2 and S3, delete the data directory, <code>/var/lib/rancher/k3s/server/db/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf /var/lib/rancher/k3s/server/db/</code></pre>
</div>
</div>
</li>
<li>
<p>On S2 and S3, start K3s again to join the restored cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start k3s</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="certificate.html">certificate</a></span>
  <span class="next"><a href="secrets-encrypt.html">secrets-encrypt</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../../_/js/vendor/tabs.js"></script>


<script src="../../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
