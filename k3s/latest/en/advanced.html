<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Options / Configuration :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/k3s/latest/en/advanced.html">
    <link rel="prev" href="helm.html">
    <link rel="next" href="reference/env-variables.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-09-15"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/advanced.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/advanced.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/en/advanced.html" hrefLang="en-US" rel="alternate" />



<!-- Link for the Korean page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ko/advanced.html" hreflang="ko-KR" rel="alternate" />

<!-- Link for the Japanese page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/ja/advanced.html" hreflang="ja-JP" rel="alternate" />

<!-- Link for the Chinese page -->
<link href="https://documentation.suse.com/cloudnative/k3s/latest/zh/advanced.html" hreflang="zh-CN" rel="alternate" />






<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="k3s" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">K3s</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quick-start.html">Quick-Start Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="installation/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/configuration.html">Configuration Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/private-registry.html">Private Registry Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/registry-mirror.html">Embedded Registry Mirror</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/airgap.html">Air-Gap Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/server-roles.html">Managing Server Roles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/packaged-components.html">Managing Packaged Components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation/uninstall.html">Uninstalling K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="datastore/datastore.html">Cluster Datastore</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="datastore/backup-restore.html">Backup and Restore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="datastore/ha-embedded.html">High Availability Embedded etcd</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="datastore/ha.html">High Availability External DB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="datastore/cluster-loadbalancer.html">Cluster Load Balancer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="upgrades/upgrades.html">Upgrades</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrades/killall.html">Stopping K3s</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrades/manual.html">Manual Upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrades/automated.html">Automated Upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrades/roll-back.html">Rolling Back K3s</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="security/security.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/secrets-encryption.html">Secrets Encryption Config</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/hardening-guide.html">CIS Hardening Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/self-assessment-1.10.html">CIS 1.10 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/self-assessment-1.9.html">CIS 1.9 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/self-assessment-1.8.html">CIS 1.8 Self Assessment Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security/self-assessment-1.7.html">CIS 1.7 Self Assessment Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="cli/cli.html">CLI Tools</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli/server.html">server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli/agent.html">agent</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli/certificate.html">certificate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli/etcd-snapshot.html">etcd-snapshot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli/secrets-encrypt.html">secrets-encrypt</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cli/token.html">token</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cluster-access.html">Cluster Access</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="storage.html">Volumes and Storage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="import-images.html">Import images</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="networking/networking.html">Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/basic-network-options.html">Basic Network Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/distributed-multicloud.html">Distributed hybrid or multicloud cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/multus-ipams.html">Multus and IPAM plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking/networking-services.html">Networking Services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="helm.html">Helm</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="advanced.html">Advanced Options / Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/env-variables.html">Environment Variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/flag-deprecation.html">Flag Deprecation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reference/resource-profiling.html">Resource Profiling</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Release Notes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.33.X.html">v1.33.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.32.X.html">v1.32.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.31.X.html">v1.31.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.30.X.html">v1.30.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-notes/v1.29.X.html">v1.29.X</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Older&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes/v1.28.X.html">v1.28.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes/v1.27.X.html">v1.27.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes/v1.26.X.html">v1.26.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes/v1.25.X.html">v1.25.X</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="release-notes/v1.24.X.html">v1.24.X</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="related-projects.html">Related Projects</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="known-issues.html">Known Issues</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="faq.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3s</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../os-manager/next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../os-manager/next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/k3s" title="K3s" aria-label="SUSE Documentation - K3s">
        K3s
      </a>
    </li>
      <li>
          <a href="advanced.html" title="Advanced Options / Configuration" aria-label="Advanced Options / Configuration">Advanced Options / Configuration</a>
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/k3s-product-docs/edit/main/docs/latest/modules/en/pages/advanced.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:k3s" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Advanced Options / Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section contains advanced information describing the different ways you can run and manage K3s, as well as steps necessary to prepare the host OS for K3s use.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_certificate_management"><a class="anchor" href="#_certificate_management"></a>Certificate Management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_certificate_authority_certificates"><a class="anchor" href="#_certificate_authority_certificates"></a>Certificate Authority Certificates</h3>
<div class="paragraph">
<p>K3s generates self-signed Certificate Authority (CA) Certificates during startup of the first server node. These CA certificates are valid for 10 years, and are not automatically renewed.</p>
</div>
<div class="paragraph">
<p>For information on using custom CA certificates, or renewing the self-signed CA certificates, see the <a href="cli/certificate.html#_certificate_authority_ca_certificates" class="xref page"><code>k3s certificate rotate-ca</code> command documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_client_and_server_certificates"><a class="anchor" href="#_client_and_server_certificates"></a>Client and Server certificates</h3>
<div class="paragraph">
<p>K3s client and server certificates are valid for 365 days from their date of issuance. Any certificates that are expired, or within 90 days of expiring, are automatically renewed every time K3s starts.</p>
</div>
<div class="paragraph">
<p>For information on manually rotating client and server certificates, see the <a href="cli/certificate.html#_client_and_server_certificates" class="xref page"><code>k3s certificate rotate</code> command documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_token_management"><a class="anchor" href="#_token_management"></a>Token Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, K3s uses a single static token for both servers and agents. With care, this token can be rotated once the cluster has been created.
It is also possible to enable a second static token that can only be used to join agents, or to create temporary <code>kubeadm</code> style join tokens that expire automatically.
For more information, see the <a href="cli/token.html#_k3s_token_1" class="xref page"><code>k3s token</code> command documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_an_http_proxy"><a class="anchor" href="#_configuring_an_http_proxy"></a>Configuring an HTTP proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are running K3s in an environment, which only has external connectivity through an HTTP proxy, you can configure your proxy settings on the K3s systemd service. These proxy settings will then be used in K3s and passed down to the embedded containerd and kubelet.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Proxy configuration and other environment variables from the host are NOT passed into Pods.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The K3s installation script will automatically take the <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code> and <code>NO_PROXY</code>, as well as the <code>CONTAINERD_HTTP_PROXY</code>, <code>CONTAINERD_HTTPS_PROXY</code> and <code>CONTAINERD_NO_PROXY</code> variables from the current shell, if they are present, and write them to the environment file of your systemd service, usually:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/etc/systemd/system/k3s.service.env</code></p>
</li>
<li>
<p><code>/etc/systemd/system/k3s-agent.service.env</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, you can also configure the proxy by editing these files.</p>
</div>
<div class="paragraph">
<p>K3s will automatically add the cluster internal Pod and Service IP ranges and cluster DNS domain to the list of <code>NO_PROXY</code> entries. You should ensure that the IP address ranges used by the Kubernetes nodes themselves (i.e. the public and private IPs of the nodes) are included in the <code>NO_PROXY</code> list, or that the nodes can be reached through the proxy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP_PROXY=http://your-proxy.example.com:8888
HTTPS_PROXY=http://your-proxy.example.com:8888
NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to configure the proxy settings for containerd without affecting K3s and the Kubelet, you can prefix the variables with <code>CONTAINERD_</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CONTAINERD_HTTP_PROXY=http://your-proxy.example.com:8888
CONTAINERD_HTTPS_PROXY=http://your-proxy.example.com:8888
CONTAINERD_NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_docker_as_the_container_runtime"><a class="anchor" href="#_using_docker_as_the_container_runtime"></a>Using Docker as the Container Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s includes and defaults to <a href="https://containerd.io/">containerd</a>, an industry-standard container runtime.
As of Kubernetes 1.24, the Kubelet no longer includes dockershim, the component that allows the kubelet to communicate with dockerd.
K3s 1.24 and higher include <a href="https://github.com/Mirantis/cri-dockerd">cri-dockerd</a>, which allows seamless upgrade from prior releases of K3s while continuing to use the Docker container runtime.</p>
</div>
<div class="paragraph">
<p>To use Docker instead of containerd:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Docker on the K3s node. One of Rancher&#8217;s <a href="https://github.com/rancher/install-docker">Docker installation scripts</a> can be used to install Docker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl https://releases.rancher.com/install-docker/20.10.sh | sh</code></pre>
</div>
</div>
</li>
<li>
<p>Install K3s using the <code>--docker</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -sfL https://get.k3s.io | sh -s - --docker</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the cluster is available:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sudo k3s kubectl get pods --all-namespaces
NAMESPACE     NAME                                     READY   STATUS      RESTARTS   AGE
kube-system   local-path-provisioner-6d59f47c7-lncxn   1/1     Running     0          51s
kube-system   metrics-server-7566d596c8-9tnck          1/1     Running     0          51s
kube-system   helm-install-traefik-mbkn9               0/1     Completed   1          51s
kube-system   coredns-8655855d6-rtbnb                  1/1     Running     0          51s
kube-system   svclb-traefik-jbmvl                      2/2     Running     0          43s
kube-system   traefik-758cd5fc85-2wz97                 1/1     Running     0          43s</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the Docker containers are running:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sudo docker ps
CONTAINER ID        IMAGE                     COMMAND                  CREATED              STATUS              PORTS               NAMES
3e4d34729602        897ce3c5fc8f              "entry"                  About a minute ago   Up About a minute                       k8s_lb-port-443_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0
bffdc9d7a65f        rancher/klipper-lb        "entry"                  About a minute ago   Up About a minute                       k8s_lb-port-80_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0
436b85c5e38d        rancher/library-traefik   "/traefik --configfi…"   About a minute ago   Up About a minute                       k8s_traefik_traefik-758cd5fc85-2wz97_kube-system_07abe831-ffd6-4206-bfa1-7c9ca4fb39e7_0
de8fded06188        rancher/pause:3.1         "/pause"                 About a minute ago   Up About a minute                       k8s_POD_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0
7c6a30aeeb2f        rancher/pause:3.1         "/pause"                 About a minute ago   Up About a minute                       k8s_POD_traefik-758cd5fc85-2wz97_kube-system_07abe831-ffd6-4206-bfa1-7c9ca4fb39e7_0
ae6c58cab4a7        9d12f9848b99              "local-path-provisio…"   About a minute ago   Up About a minute                       k8s_local-path-provisioner_local-path-provisioner-6d59f47c7-lncxn_kube-system_2dbd22bf-6ad9-4bea-a73d-620c90a6c1c1_0
be1450e1a11e        9dd718864ce6              "/metrics-server"        About a minute ago   Up About a minute                       k8s_metrics-server_metrics-server-7566d596c8-9tnck_kube-system_031e74b5-e9ef-47ef-a88d-fbf3f726cbc6_0
4454d14e4d3f        c4d3d16fe508              "/coredns -conf /etc…"   About a minute ago   Up About a minute                       k8s_coredns_coredns-8655855d6-rtbnb_kube-system_d05725df-4fb1-410a-8e82-2b1c8278a6a1_0
c3675b87f96c        rancher/pause:3.1         "/pause"                 About a minute ago   Up About a minute                       k8s_POD_coredns-8655855d6-rtbnb_kube-system_d05725df-4fb1-410a-8e82-2b1c8278a6a1_0
4b1fddbe6ca6        rancher/pause:3.1         "/pause"                 About a minute ago   Up About a minute                       k8s_POD_local-path-provisioner-6d59f47c7-lncxn_kube-system_2dbd22bf-6ad9-4bea-a73d-620c90a6c1c1_0
64d3517d4a95        rancher/pause:3.1         "/pause"</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_etcdctl"><a class="anchor" href="#_using_etcdctl"></a>Using etcdctl</h2>
<div class="sectionbody">
<div class="paragraph">
<p>etcdctl provides a CLI for interacting with etcd servers. K3s does not bundle etcdctl.</p>
</div>
<div class="paragraph">
<p>If you would like to use etcdctl to interact with K3s&#8217;s embedded etcd, install etcdctl using the <a href="https://etcd.io/docs/latest/install/">official documentation</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ETCD_VERSION="v3.5.5"
ETCD_URL="https://github.com/etcd-io/etcd/releases/download/${ETCD_VERSION}/etcd-${ETCD_VERSION}-linux-amd64.tar.gz"
curl -sL ${ETCD_URL} | sudo tar -zxv --strip-components=1 -C /usr/local/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may then use etcdctl by configuring it to use the K3s-managed certificates and keys for authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo etcdctl version \
  --cacert=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt \
  --cert=/var/lib/rancher/k3s/server/tls/etcd/client.crt \
  --key=/var/lib/rancher/k3s/server/tls/etcd/client.key</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_containerd"><a class="anchor" href="#_configuring_containerd"></a>Configuring containerd</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Version Gate</div>
<div class="paragraph">
<p>K3s includes containerd 2.0 as of the February 2025 releases: v1.31.6+k3s1 and v1.32.2+k3s1.
Be aware that containerd 2.0 prefers config version 3, while containerd 1.7 prefers config version 2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>K3s will generate a configuration file for containerd at <code>/var/lib/rancher/k3s/agent/etc/containerd/config.toml</code>, using values specific to the current cluster and node configuration.</p>
</div>
<div class="paragraph">
<p>For advanced customization, you can create a containerd config template in the same directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For containerd 2.0, place a version 3 configuration template in <code>config-v3.toml.tmpl</code>.</p>
<div class="paragraph">
<p>See the <a href="https://github.com/containerd/containerd/blob/release/2.0/docs/cri/config.md">containerd 2.0 documentation</a> for more information.</p>
</div>
</li>
<li>
<p>For containerd 1.7 and earlier, place a version 2 configuration template in <code>config.toml.tmpl</code>.</p>
<div class="paragraph">
<p>See the <a href="https://github.com/containerd/containerd/blob/release/1.7/docs/cri/config.md">containerd 1.7 documentation</a> for more information.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Containerd 2.0 is backwards compatible with prior config versions, and k3s will continue to render legacy version 2 configuration from <code>config.toml.tmpl</code> if <code>config-v3.toml.tmpl</code> is not found.</p>
</div>
<div class="paragraph">
<p>The template file is rendered into the containerd config using the <a href="https://pkg.go.dev/text/template"><code>text/template</code></a> library.
See <code>ContainerdConfigTemplateV3</code> and <code>ContainerdConfigTemplate</code> in <a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates.go"><code>templates.go</code></a> for the default template content.
The template is executed with a <a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates.go#L22-L33"><code>ContainerdConfig</code></a> struct as its dot value (data argument).</p>
</div>
<div class="sect2">
<h3 id="_base_template"><a class="anchor" href="#_base_template"></a>Base template</h3>
<div class="paragraph">
<p>You can extend the K3s base template instead of copy-pasting the complete stock template out of the K3s source code. This is useful if you only need to build on the existing configuration by adding a few extra lines before or after the defaults.</p>
</div>
<div class="listingblock">
<div class="title">/var/lib/rancher/k3s/agent/etc/containerd/config-v3.toml.tmpl</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">{{ template "base" . }}

[plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.'custom']
  runtime_type = "io.containerd.runc.v2"
[plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.'custom'.options]
  BinaryName = "/usr/bin/custom-container-runtime"
  SystemdCgroup = true</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For best results, do NOT simply copy a prerendered <code>config.toml</code> into the template and make your desired changes. Use the base template, or provide a full template based on the k3s defaults linked above.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_alternative_container_runtime_support"><a class="anchor" href="#_alternative_container_runtime_support"></a>Alternative Container Runtime Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s will automatically detect alternative container runtimes if they are present when K3s starts. Supported container runtimes are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>crun, lunatic, nvidia, nvidia-cdi, nvidia-experimental, slight, spin, wasmedge, wasmer, wasmtime, wws</pre>
</div>
</div>
<div class="paragraph">
<p>K3s uses the service&#8217;s <code>PATH</code> environment variable to search for container runtime executables.
If an installed container runtime is not detected by K3s, ensure it is present in a system path, which generally includes:
<code>/usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin</code></p>
</div>
<div class="sect2">
<h3 id="_nvidia_container_runtime"><a class="anchor" href="#_nvidia_container_runtime"></a>NVIDIA Container Runtime</h3>
<div class="paragraph">
<p>NVIDIA GPUs require installation of the NVIDIA Container Runtime in order to schedule and run accelerated workloads in Pods. To use NVIDIA GPUs with K3s, perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the nvidia-container package repository on the node by following the instructions at:
<a href="https://nvidia.github.io/libnvidia-container/" class="bare">https://nvidia.github.io/libnvidia-container/</a></p>
</li>
<li>
<p>Install the nvidia container runtime packages. For example:
<code>apt install -y nvidia-container-runtime cuda-drivers-fabricmanager-515 nvidia-headless-515-server</code></p>
</li>
<li>
<p><a href="installation/installation.html" class="xref page">Install K3s</a>, or restart it if already installed.</p>
</li>
<li>
<p>Confirm that the nvidia container runtime has been found by k3s:
<code>grep nvidia /var/lib/rancher/k3s/agent/etc/containerd/config.toml</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If these steps are followed properly, K3s will automatically add NVIDIA runtimes to the containerd configuration, depending on what runtime executables are found.
2
K3s includes Kubernetes RuntimeClass definitions for all supported alternative runtimes. You can select one of these to replace <code>runc</code> as the default runtime on a node by setting the <code>--default-runtime</code> value via the k3s CLI or config file.</p>
</div>
<div class="paragraph">
<p>If you have not changed the default runtime on your GPU nodes, you must explicitly request the NVIDIA runtime by setting <code>runtimeClassName: nvidia</code> in the Pod spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Pod
metadata:
  name: nbody-gpu-benchmark
  namespace: default
spec:
  restartPolicy: OnFailure
  runtimeClassName: nvidia
  containers:
  - name: cuda-container
    image: nvcr.io/nvidia/k8s/cuda-sample:nbody
    args: ["nbody", "-gpu", "-benchmark"]
    resources:
      limits:
        nvidia.com/gpu: 1
    env:
    - name: NVIDIA_VISIBLE_DEVICES
      value: all
    - name: NVIDIA_DRIVER_CAPABILITIES
      value: all</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the NVIDIA Container Runtime is also frequently used with <a href="https://github.com/NVIDIA/k8s-device-plugin/">NVIDIA Device Plugin</a>, with modifications to ensure that pod specs include <code>runtimeClassName: nvidia</code>, as mentioned above.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_agentless_servers_experimental"><a class="anchor" href="#_running_agentless_servers_experimental"></a>Running Agentless Servers (Experimental)</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This feature is experimental.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When started with the <code>--disable-agent</code> flag, servers do not run the kubelet, container runtime, or CNI. They do not register a Node resource in the cluster, and will not appear in <code>kubectl get nodes</code> output.
Because they do not host a kubelet, they cannot run pods or be managed by operators that rely on enumerating cluster nodes, including the embedded etcd controller and the system upgrade controller.</p>
</div>
<div class="paragraph">
<p>Running agentless servers may be advantageous if you want to obscure your control-plane nodes from discovery by agents and workloads, at the cost of increased administrative overhead caused by lack of cluster operator support.</p>
</div>
<div class="paragraph">
<p>By default, the apiserver on agentless servers will not be able to make outgoing connections to admission webhooks or aggregated apiservices running within the cluster. To remedy this, set the <code>--egress-selector-mode</code> server flag to either <code>pod</code> or <code>cluster</code>. If you are changing this flag on an existing cluster, you&#8217;ll need to restart all nodes in the cluster for the option to take effect.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_rootless_servers_experimental"><a class="anchor" href="#_running_rootless_servers_experimental"></a>Running Rootless Servers (Experimental)</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This feature is experimental.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Rootless mode allows running K3s servers as an unprivileged user, so as to protect the real root on the host from potential container-breakout attacks.</p>
</div>
<div class="paragraph">
<p>See <a href="https://rootlesscontaine.rs/" class="bare">https://rootlesscontaine.rs/</a> to learn more about Rootless Kubernetes.</p>
</div>
<div class="sect2">
<h3 id="_known_issues_with_rootless_mode"><a class="anchor" href="#_known_issues_with_rootless_mode"></a>Known Issues with Rootless mode</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Ports</strong></p>
<div class="paragraph">
<p>When running rootless a new network namespace is created.  This means that K3s instance is running with networking fairly detached from the host.
The only way to access Services run in K3s from the host is to set up port forwards to the K3s network namespace.
Rootless K3s includes controller that will automatically bind 6443 and service ports below 1024 to the host with an offset of 10000.</p>
</div>
<div class="paragraph">
<p>For example, a Service on port 80 will become 10080 on the host, but 8080 will become 8080 without any offset. Currently, only LoadBalancer Services are automatically bound.</p>
</div>
</li>
<li>
<p><strong>Cgroups</strong></p>
<div class="paragraph">
<p>Cgroup v1 and Hybrid v1/v2 are not supported; only pure Cgroup v2 is supported. If K3s fails to start due to missing cgroups when running rootless, it is likely that your node is in Hybrid mode, and the "missing" cgroups are still bound to a v1 controller.</p>
</div>
</li>
<li>
<p><strong>Multi-node/multi-process cluster</strong></p>
<div class="paragraph">
<p>Multi-node rootless clusters, or multiple rootless k3s processes on the same node, are not currently supported. See <a href="https://github.com/k3s-io/k3s/issues/6488#issuecomment-1314998091">#6488</a> for more details.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_starting_rootless_servers"><a class="anchor" href="#_starting_rootless_servers"></a>Starting Rootless Servers</h3>
<div class="ulist">
<ul>
<li>
<p>Enable cgroup v2 delegation, see <a href="https://rootlesscontaine.rs/getting-started/common/cgroup2/" class="bare">https://rootlesscontaine.rs/getting-started/common/cgroup2/</a> .
This step is required; the rootless kubelet will fail to start without the proper cgroups delegated.</p>
</li>
<li>
<p>Download <code>k3s-rootless.service</code> from <a href="https://github.com/k3s-io/k3s/blob/master/k3s-rootless.service"><code>https://github.com/k3s-io/k3s/blob/&lt;VERSION&gt;/k3s-rootless.service</code></a>.
Make sure to use the same version of <code>k3s-rootless.service</code> and <code>k3s</code>.</p>
</li>
<li>
<p>Install <code>k3s-rootless.service</code> to <code>~/.config/systemd/user/k3s-rootless.service</code>.
Installing this file as a system-wide service (<code>/etc/systemd/...</code>) is not supported.
Depending on the path of <code>k3s</code> binary, you might need to modify the <code>ExecStart=/usr/local/bin/k3s ...</code> line of the file.</p>
</li>
<li>
<p>Run <code>systemctl --user daemon-reload</code></p>
</li>
<li>
<p>Run <code>systemctl --user enable --now k3s-rootless</code></p>
</li>
<li>
<p>Run <code>KUBECONFIG=~/.kube/k3s.yaml kubectl get pods -A</code>, and make sure the pods are running.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Don&#8217;t try to run <code>k3s server --rootless</code> on a terminal, as terminal sessions do not allow cgroup v2 delegation.
If you really need to try it on a terminal, use <code>systemd-run --user -p Delegate=yes --tty k3s server --rootless</code> to wrap it in a systemd scope.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_rootless_configuration"><a class="anchor" href="#_advanced_rootless_configuration"></a>Advanced Rootless Configuration</h3>
<div class="paragraph">
<p>Rootless K3s uses <a href="https://github.com/rootless-containers/rootlesskit">rootlesskit</a> and <a href="https://github.com/rootless-containers/slirp4netns">slirp4netns</a> to communicate between host and user network namespaces.
Some of the configuration used by rootlesskit and slirp4nets can be set by environment variables. The best way to set these is to add them to the <code>Environment</code> field of the k3s-rootless systemd unit.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K3S_ROOTLESS_MTU</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the MTU for the slirp4netns virtual interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K3S_ROOTLESS_CIDR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.41.0.0/16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the CIDR used by slirp4netns virtual interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K3S_ROOTLESS_ENABLE_IPV6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">autotedected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables slirp4netns IPv6 support. If not specified, it is automatically enabled if K3s is configured for dual-stack operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K3S_ROOTLESS_PORT_DRIVER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builtin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selects the rootless port driver; either <code>builtin</code> or <code>slirp4netns</code>. Builtin is faster, but masquerades the original source address of inbound packets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K3S_ROOTLESS_DISABLE_HOST_LOOPBACK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether or not access to the hosts&#8217;s loopback address via the gateway interface is enabled. It is recommended that this not be changed, for security reasons.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_troubleshooting_rootless"><a class="anchor" href="#_troubleshooting_rootless"></a>Troubleshooting Rootless</h3>
<div class="ulist">
<ul>
<li>
<p>Run <code>systemctl --user status k3s-rootless</code> to check the daemon status</p>
</li>
<li>
<p>Run <code>journalctl --user -f -u k3s-rootless</code> to see the daemon log</p>
</li>
<li>
<p>See also <a href="https://rootlesscontaine.rs/" class="bare">https://rootlesscontaine.rs/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_node_labels_and_taints"><a class="anchor" href="#_node_labels_and_taints"></a>Node Labels and Taints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3s agents can be configured with the options <code>--node-label</code> and <code>--node-taint</code> which adds a label and taint to the kubelet. The two options only add labels and/or taints <a href="cli/agent.html#_node_labels_and_taints_for_agents" class="xref page">at registration time</a>, so they can only be set when the node is first joined to the cluster.</p>
</div>
<div class="paragraph">
<p>All current versions of Kubernetes restrict nodes from registering with most labels with <code>kubernetes.io</code> and <code>k8s.io</code> prefixes, specifically including the <code>kubernetes.io/role</code> label. If you attempt to start a node with a disallowed label, K3s will fail to start. As stated by the Kubernetes authors:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Nodes are not permitted to assert their own role labels. Node roles are typically used to identify privileged or control plane types of nodes, and allowing nodes to label themselves into that pool allows a compromised node to trivially attract workloads (like control plane daemonsets) that confer access to higher privilege credentials.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-auth/279-limit-node-access/README.md#proposal">SIG-Auth KEP 279</a> for more information.</p>
</div>
<div class="paragraph">
<p>If you want to change node labels and taints after node registration, or add reserved labels, you should use <code>kubectl</code>. Refer to the official Kubernetes documentation for details on how to add <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">taints</a> and <a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node">node labels.</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_starting_the_service_with_the_installation_script"><a class="anchor" href="#_starting_the_service_with_the_installation_script"></a>Starting the Service with the Installation Script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The installation script will auto-detect if your OS is using systemd or openrc and enable and start the service as part of the installation process.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When running with openrc, logs will be created at <code>/var/log/k3s.log</code>.</p>
</li>
<li>
<p>When running with systemd, logs will be created in <code>/var/log/syslog</code> and viewed using <code>journalctl -u k3s</code> (or <code>journalctl -u k3s-agent</code> on agents).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of disabling auto-starting and service enablement with the install script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -sfL https://get.k3s.io | INSTALL_K3S_SKIP_START=true INSTALL_K3S_SKIP_ENABLE=true sh -</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_k3s_in_docker"><a class="anchor" href="#_running_k3s_in_docker"></a>Running K3s in Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several ways to run K3s in Docker:</p>
</div>
<div id="_tabs_1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_k3d" class="tab">
<p>K3d</p>
</li>
<li id="_tabs_1_docker" class="tab">
<p>Docker</p>
</li>
</ul>
</div>
<div id="_tabs_1_k3d--panel" class="tabpanel" aria-labelledby="_tabs_1_k3d">
<div class="paragraph">
<p><a href="https://github.com/k3d-io/k3d">k3d</a> is a utility designed to easily run multi-node K3s clusters in Docker.</p>
</div>
<div class="paragraph">
<p>k3d makes it very easy to create single- and multi-node k3s clusters in docker, e.g. for local development on Kubernetes.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://k3d.io/#installation">Installation</a> documentation for more information on how to install and use k3d.</p>
</div>
</div>
<div id="_tabs_1_docker--panel" class="tabpanel" aria-labelledby="_tabs_1_docker">
<div class="paragraph">
<p>To use Docker, <code>rancher/k3s</code> images are also available to run the K3s server and agent.
Using the <code>docker run</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo docker run \
  --privileged \
  --name k3s-server-1 \
  --hostname k3s-server-1 \
  -p 6443:6443 \
  -d rancher/k3s:v1.24.10-k3s1 \
  server</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must specify a valid K3s version as the tag; the <code>latest</code> tag is not maintained.<br>
Docker images do not allow a <code>+</code> sign in tags, use a <code>-</code> in the tag instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once K3s is up and running, you can copy the admin kubeconfig out of the Docker container for use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo docker cp k3s-server-1:/etc/rancher/k3s/k3s.yaml ~/.kube/config</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_selinux_support"><a class="anchor" href="#_selinux_support"></a>SELinux Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are installing K3s on a system where SELinux is enabled by default (such as CentOS), you must ensure the proper SELinux policies have been installed.</p>
</div>
<div id="_tabs_2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_automatic_installation" class="tab">
<p>Automatic Installation</p>
</li>
<li id="_tabs_2_manual_installation" class="tab">
<p>Manual Installation</p>
</li>
</ul>
</div>
<div id="_tabs_2_automatic_installation--panel" class="tabpanel" aria-labelledby="_tabs_2_automatic_installation">
<div class="paragraph">
<p>The <a href="installation/configuration.html#_configuration_with_install_script" class="xref page">install script</a> will automatically install the SELinux RPM from the Rancher RPM repository if on a compatible system if not performing an air-gapped install. Automatic installation can be skipped by setting <code>INSTALL_K3S_SKIP_SELINUX_RPM=true</code>.</p>
</div>
</div>
<div id="_tabs_2_manual_installation--panel" class="tabpanel" aria-labelledby="_tabs_2_manual_installation">
<div class="paragraph">
<p>The necessary policies can be installed with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y container-selinux selinux-policy-base
yum install -y https://rpm.rancher.io/k3s/latest/common/centos/9/noarch/k3s-selinux-1.6-1.el9.noarch.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>To force the install script to log a warning rather than fail, you can set the following environment variable: <code>INSTALL_K3S_SELINUX_WARN=true</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_selinux_enforcement"><a class="anchor" href="#_enabling_selinux_enforcement"></a>Enabling SELinux Enforcement</h3>
<div class="paragraph">
<p>To leverage SELinux, specify the <code>--selinux</code> flag when starting K3s servers and agents or setting the <code>K3S_SELINUX=true</code> environment variable..</p>
</div>
<div class="paragraph">
<p>This option can also be specified in the K3s <a href="installation/configuration.html#_configuration_file" class="xref page">configuration file</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>selinux: true</pre>
</div>
</div>
<div class="paragraph">
<p>Using a custom <code>--data-dir</code> under SELinux is not supported. To customize it, you would most likely need to write your own custom policy. For guidance, you could refer to the <a href="https://github.com/containers/container-selinux">containers/container-selinux</a> repository, which contains the SELinux policy files for Container Runtimes, and the <a href="https://github.com/k3s-io/k3s-selinux">k3s-io/k3s-selinux</a> repository, which contains the SELinux policy for K3s.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_lazy_pulling_of_estargz_experimental"><a class="anchor" href="#_enabling_lazy_pulling_of_estargz_experimental"></a>Enabling Lazy Pulling of eStargz (Experimental)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_whats_lazy_pulling_and_estargz"><a class="anchor" href="#_whats_lazy_pulling_and_estargz"></a>What&#8217;s lazy pulling and eStargz?</h3>
<div class="paragraph">
<p>Pulling images is known as one of the time-consuming steps in the container lifecycle.
According to <a href="https://www.usenix.org/conference/fast16/technical-sessions/presentation/harter">Harter, et al.</a>,</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>pulling packages accounts for 76% of container start time, but only 6.4% of that data is read</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To address this issue, k3s experimentally supports <em>lazy pulling</em> of image contents.
This allows k3s to start a container before the entire image has been pulled.
Instead, the necessary chunks of contents (e.g. individual files) are fetched on-demand.
Especially for large images, this technique can shorten the container startup latency.</p>
</div>
<div class="paragraph">
<p>To enable lazy pulling, the target image needs to be formatted as <a href="https://github.com/containerd/stargz-snapshotter/blob/main/docs/stargz-estargz.md"><em>eStargz</em></a>.
This is an OCI-alternative but 100% OCI-compatible image format for lazy pulling.
Because of the compatibility, eStargz can be pushed to standard container registries (e.g. ghcr.io) as well as this is <em>still runnable</em> even on eStargz-agnostic runtimes.</p>
</div>
<div class="paragraph">
<p>eStargz is developed based on the <a href="https://github.com/google/crfs">stargz format proposed by Google CRFS project</a> but comes with practical features including content verification and performance optimization.
For more details about lazy pulling and eStargz, please refer to <a href="https://github.com/containerd/stargz-snapshotter">Stargz Snapshotter project repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_k3s_for_lazy_pulling_of_estargz"><a class="anchor" href="#_configure_k3s_for_lazy_pulling_of_estargz"></a>Configure k3s for lazy pulling of eStargz</h3>
<div class="paragraph">
<p>As shown in the following, <code>--snapshotter=stargz</code> option is needed for k3s server and agent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3s server --snapshotter=stargz</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, you can perform lazy pulling for eStargz-formatted images.
The following example Pod manifest uses eStargz-formatted <code>node:13.13.0</code> image (<code>ghcr.io/stargz-containers/node:13.13.0-esgz</code>).
When the stargz snapshotter is enabled, K3s performs lazy pulling for this image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Pod
metadata:
  name: nodejs
spec:
  containers:
  - name: nodejs-estargz
    image: ghcr.io/stargz-containers/node:13.13.0-esgz
    command: ["node"]
    args:
    - -e
    - var http = require('http');
      http.createServer(function(req, res) {
        res.writeHead(200);
        res.end('Hello World!\n');
      }).listen(80);
    ports:
    - containerPort: 80</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_logging_sources"><a class="anchor" href="#_additional_logging_sources"></a>Additional Logging Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://documentation.suse.com/cloudnative/rancher-manager/latest/en/observability/logging/logging-helm-chart-options.html">Rancher logging</a> for K3s can be installed without using Rancher. The following instructions should be executed to do so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">helm repo add rancher-charts https://charts.rancher.io
helm repo update
helm install --create-namespace -n cattle-logging-system rancher-logging-crd rancher-charts/rancher-logging-crd
helm install --create-namespace -n cattle-logging-system rancher-logging --set additionalLoggingSources.k3s.enabled=true rancher-charts/rancher-logging</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_network_policy_logging"><a class="anchor" href="#_additional_network_policy_logging"></a>Additional Network Policy Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Packets dropped by network policies can be logged. The packet is sent to the iptables NFLOG action, which shows the packet details, including the network policy that blocked it.</p>
</div>
<div class="paragraph">
<p>If there is a lot of traffic, the number of log messages could be very high. To control the log rate on a per-policy basis, set the <code>limit</code> and <code>limit-burst</code> iptables parameters by adding the following annotations to the network policy in question:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kube-router.io/netpol-nflog-limit=&lt;LIMIT-VALUE&gt;</code></p>
</li>
<li>
<p><code>kube-router.io/netpol-nflog-limit-burst=&lt;LIMIT-BURST-VALUE&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Default values are <code>limit=10/minute</code> and <code>limit-burst=10</code>. Check the <a href="https://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html#:~:text=restrict%20the%20rate%20of%20matches">iptables manual</a> for more information on the format and possible values for these fields.</p>
</div>
<div class="paragraph">
<p>To convert NFLOG packets to log entries, install ulogd2 and configure <code>[log1]</code> to read on <code>group=100</code>. Then, restart the ulogd2 service for the new config to be committed.
When a packet is blocked by network policy rules, a log message will appear in <code>/var/log/ulog/syslogemu.log</code>.</p>
</div>
<div class="paragraph">
<p>Packets sent to the NFLOG netlink socket can also be read by using command-line tools like tcpdump or tshark:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tcpdump -ni nflog:100</code></pre>
</div>
</div>
<div class="paragraph">
<p>While more readily available, tcpdump will not show the name of the network policy that blocked the packet. Use wireshark&#8217;s tshark command instead to display the full NFLOG packet header, including the <code>nflog.prefix</code> field that contains the policy name.</p>
</div>
<div class="paragraph">
<p>Network Policy logging of dropped packets does not support <a href="https://github.com/k3s-io/k3s/issues/8008">policies with an empty <code>podSelector</code></a>. If you rely on logging dropped packets for diagnostic or audit purposes, ensure that your policies include a pod selector that matches the affected pods.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="helm.html">Helm</a></span>
  <span class="next"><a href="reference/env-variables.html">Environment Variables</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
