<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to build and use custom OS images :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/os-manager/1.6/en/custom-images.html">
    <link rel="prev" href="networking-static.html">
    <link rel="next" href="unmanaged-os.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-07-03"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/os-manager/1.6/en/custom-images.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/os-manager/1.6/en/custom-images.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/os-manager/1.6/en/custom-images.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="os-manager" data-version="1.6">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">OS Manager</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Quickstarts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart-ui.html">SUSE® Rancher Prime: OS Manager the visual way</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart-cli.html">SUSE® Rancher Prime: OS Manager the command line way</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Rancher OS Management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="architecture.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="architecture-components.html">SUSE® Rancher Prime: OS Manager Components</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="custom-resources.html">Custom Resources</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="architecture-services.html">Services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="architecture-machineonboarding.html">Machine onboarding</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="architecture-clusterdeployment.html">Kubernetes cluster provisioning</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication.html">Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plans.html">Plans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade-lifecycle.html">Upgrade lifecycle</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="custom-install.html">Customize installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="extra-rpms.html">Add third party RPMs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lvm-drives-example.html">Extra LVM volume group</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hostname.html">Customize hostname</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking-vlans.html">Configure VLANs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="wifi.html">Configure WiFi</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ntp.html">Configure NTP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="removable-device-cloudconfig.html">Include cloud-config from removable devices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="custom-certificate.html">Add custom certificates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="raspi-disk.html">Install on Raspberry Pi</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Node operational tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade.html">Upgrade</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reset.html">Machine reset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="behind-proxy.html">Behind a proxy configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rancher-vmware.html">Using Elemental with Rancher and VMware</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Operator operational tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="backup.html">Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="restore.html">Restore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="airgap.html">Airgap install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="channels.html">Channels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="networking.html">Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="networking-vlans.html">Configure a VLAN</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="wifi.html">Configure Wi-Fi</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="networking-static.html">Static Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="custom-images.html">Build Custom OS Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="unmanaged-os.html">Register an Unmanaged OS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tpm.html"> Trusted Platform Module (TPM)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-support.html">Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-restore.html">Restore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-upgrade.html">Upgrade</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-rancher-upgrades.html">Rancher upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-reset.html">Reset</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-config-reference.html">Cloud-config</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineregistration-reference.html">MachineRegistration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineinventory-reference.html">MachineInventory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineinventoryselector-reference.html">MachineInventorySelector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineinventoryselectortemplate-reference.html">MachineInventorySelectorTemplate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managedosimage-reference.html">ManagedOSImage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managedosversionchannel-reference.html">ManagedOSVersionChannel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managedosversion-reference.html">ManagedOSVersion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="seedimage-reference.html">SeedImage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cluster-reference.html">Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operatorchart-reference.html">SUSE® Rancher Prime: OS Manager Operator Helm chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kubernetesversions.html">Kubernetes versions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="smbios.html">Smbios</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hardwarelabels.html">Hardware labels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="inventory-management.html">Inventory management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="release-notes.html">Release notes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OS Manager</span>
    <span class="version">1.6</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../1.7/en/index.html">1.7</a>
            </li>
            <li class="version is-current">
              <a href="index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/os-manager" title="OS Manager" aria-label="SUSE Documentation - OS Manager">
        OS Manager
      </a>
    </li>
      <li>
          Operator operational tasks
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.6</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../next/en/index.html">Next</a>
    <a class="version is-missing" href="../../latest/en/index.html">Latest</a>
    <a class="version is-missing" href="../../1.7/en/index.html">1.7</a>
    <a class="version is-current" href="custom-images.html">1.6</a>
    <a class="version" href="../../1.5/en/custom-images.html">1.5</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/elemental-product-docs/edit/main/docs/1.6/modules/en/pages/custom-images.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:os-manager" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">How to build and use custom OS images</h1>
<div class="sect1">
<h2 id="_remastering_an_os_image_with_a_custom_dockerfile"><a class="anchor" href="#_remastering_an_os_image_with_a_custom_dockerfile"></a>Remastering an OS image with a custom Dockerfile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since OS images provided by SUSE® Rancher Prime: OS Manager are container images, they can also be used as a base image in a Dockerfile in order to create a new container image.</p>
</div>
<div class="paragraph">
<p>The Elemental project publishes several flavors for images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>baremetal: An image containing firmware and drivers suitable for baremetal deployment.</p>
</li>
<li>
<p>rt: Based on the baremetal image, but contains the real-time kernel.</p>
</li>
<li>
<p>kvm: A slimmer image suitable for VMs.</p>
</li>
<li>
<p>base: The base system needed for Elemental used by the other flavors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Imagine some additional packages from an extra repository is required, the following example showcases how this could be added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-docker hljs" data-lang="docker"># The version of Elemental to modify.
FROM registry.suse.com/suse/sl-micro/6.0/baremetal-os-container:latest

# Custom commands
RUN rpm --import &lt;repo-signing-key-url&gt; &amp;&amp; \
    zypper addrepo --refresh &lt;repo_url&gt; extra_repo &amp;&amp; \
    zypper install -y &lt;extra_package&gt;

# IMPORTANT: /etc/os-release is used for versioning/upgrade. The
# values here should reflect the tag of the image currently being built
ARG IMAGE_REPO=norepo
ARG IMAGE_TAG=latest
RUN \
    sed -i -e "s|^IMAGE_REPO=.*|IMAGE_REPO=\"${IMAGE_REPO}\"|g" /etc/os-release &amp;&amp; \
    sed -i -e "s|^IMAGE_TAG=.*|IMAGE_TAG=\"${IMAGE_TAG}\"|g" /etc/os-release &amp;&amp; \
    sed -i -e "s|^IMAGE=.*|IMAGE=\"${IMAGE_REPO}:${IMAGE_TAG}\"|g" /etc/os-release

# IMPORTANT: it is good practice to recreate the initrd and re-apply `elemental-init`
# command that was used in the base image. This ensures that any eventual change that should
# be synced in initrd included binaries is also applied there and consistent.
RUN elemental init --force elemental-rootfs,grub-config,dracut-config,cloud-config-essentials,elemental-setup</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>latest</code> is the base version we want to customize.</p>
</div>
<div class="paragraph">
<p>And then execute the following commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker build --build-arg IMAGE_REPO=myrepo/custom-build \
             --build-arg IMAGE_TAG=v1.1.1 \
             -t myrepo/custom-build:v1.1.1 .
docker push myrepo/custom-build:v1.1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The new customized OS is available as the Docker image <code>myrepo/custom-build:v1.1.1</code> and it can
be run and verified using docker with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it myrepo/custom-build:v1.1.1 bash</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_custom_bootable_installation_iso"><a class="anchor" href="#_create_a_custom_bootable_installation_iso"></a>Create a custom bootable installation ISO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SUSE® Rancher Prime: OS Manager leverages container images to build its root filesystems; therefore, it is possible to use it in a multi-stage environment to create custom bootable media that bundles a custom container image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-docker hljs" data-lang="docker">FROM registry.suse.com/suse/sl-micro/6.0/baremetal-os-container:latest AS os

# Check the previous section on building custom images

# The released OS already includes the toolchain for building ISOs
FROM registry.suse.com/suse/sl-micro/6.0/baremetal-os-container:latest AS builder

ARG TARGETARCH
WORKDIR /iso
COPY --from=os / rootfs

# work around buildah issue: https://github.com/containers/buildah/issues/4242
RUN rm -f rootfs/etc/resolv.conf

RUN elemental build-iso \
        dir:rootfs \
        --bootloader-in-rootfs \
        --squash-no-compression \
        -o /output -n "elemental-${TARGETARCH}"

FROM busybox
COPY --from=builder /output /elemental-iso

ENTRYPOINT ["busybox", "sh", "-c"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build it with regular <code>docker build</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker build -t myrepo/custom-build:v1.1.1 \
              --build-arg IMAGE_REPO=myrepo/custom-build-iso \
              --build-arg IMAGE_TAG=v1.1.1 \
              .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting container image is actually a container image including the ISO, this container image can be pushed to an OCI registry too. The ISO image can be extracted from the container to the current folder by executing the container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run --rm -v $(pwd):/host mytest-image "busybox cp /elemental-iso/*.iso /host"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The new customized installation media can be found in <code>elemental-&lt;arch&gt;.iso</code>.</p>
</div>
<div class="paragraph">
<p>The above container run is equivalent to what <em>elemental-operator</em> does to extract the ISO from a container to build a new one including the registration URL, hence this is also a good check mark to verify the container can be pushed to a registry and used by the <em>elemental-operator</em> as a <code>baseImage</code> for a <a href="seedimage-reference.html" class="xref page">SeedImage</a> resource.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_list_custom_images_as_a_managedosversion_resource"><a class="anchor" href="#_list_custom_images_as_a_managedosversion_resource"></a>List custom images as a ManagedOSVersion resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In SUSE® Rancher Prime: OS Manager listing OS container images and ISO container images as ManagedOSVersion resources is not mandatory but handy. Specially from a UI perspective this makes the custom images visible and easy to use from the SUSE® Rancher Prime: OS Manager UI extension.</p>
</div>
<div class="paragraph">
<p>Continuing the example from the previous section a custom OS container referenced as <code>myrepo/custom-build:v1.1.1</code> was built and eventually pushed to a registry. Then this image is ready to be added as a ManagedOSVersion resource with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: elemental.cattle.io/v1beta1
kind: ManagedOSVersion
metadata:
  name: v1.1.1-custom-build
  namespace: fleet-default
spec:
  metadata:
    displayName: Custom build image
    upgradeImage: myrepo/custom-build:v1.1.1
  type: container
  version: v1.1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>type: container</code> states this is a container OS. This makes the image <code>myrepo/custom-build:v1.1.1</code> eligible for OS upgrades from the UI.</p>
</div>
<div class="paragraph">
<p>Finally, the custom container for the ISO <code>myrepo/custom-build-iso:v1.1.1</code> can also be included as a ManagedOSVersion resource with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: elemental.cattle.io/v1beta1
kind: ManagedOSVersion
metadata:
  name: v1.1.1-custom-build-iso
  namespace: fleet-default
spec:
  metadata:
    displayName: Custom build ISO image
    uri: myrepo/custom-build-iso:v1.1.1
  type: iso
  version: v1.1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the  <code>type: iso</code> states this is an ISO. This makes the image <code>myrepo/custom-build-iso:v1.1.1</code> eligible for SeedImages generation from UI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_partition_size"><a class="anchor" href="#_custom_partition_size"></a>Custom partition size</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When building custom images, it&#8217;s important to take into account disk partition sizes, to ensure the image and the upgrade snapshots can fit correctly over time.</p>
</div>
<div class="paragraph">
<p>A partitions' configuration can be included in your custom image, or alternatively it can be conveniently applied to the <a href="seedimage-reference.html" class="xref page">SeedImage</a> used to generate the install media.</p>
</div>
<div class="paragraph">
<p>Note that all <code>size</code> values are expressed in megabytes, and a value of <code>0</code> will take the rest of the disk. This is the default behavior of the <code>persistent</code> partition if no <code>size</code> has been defined for it. For more information, see the full <a href="https://github.com/rancher/elemental-toolkit/blob/main/config.yaml.example">configuration sample</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: elemental.cattle.io/v1beta1
kind: SeedImage
metadata:
  name: custom-partitions-iso
  namespace: fleet-default
spec:
  cloud-config:
    write_files:
    - path: /etc/elemental/config.d/partitions.yaml
      content: |
        install:
          partitions:
            recovery:
              size: 8192
            state:
              size: 16384
    - path: /etc/elemental/config.d/snapshotter.yaml
      content: |
        snapshotter:
          max-snaps: 2
  baseImage: myrepo/custom-build-iso:v1.1.1
  registrationRef:
    name: my-machine-registration
    namespace: fleet-default</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>state</code> partition will hold all system snapshots. Therefore when sizing this partition, the following formula can be considered: <code>$image_size * ($max_number_of_snapshots + 1 + 1)</code>. The <code>$max_number_of_snapshots</code> can be similarly configured with a custom configuration file as shown in the sample above.</p>
</div>
<div class="paragraph">
<p>Note that by default it&#8217;s <code>4</code> for the <code>btrfs</code> snapshotter type, and <code>2</code> for the <code>loopdevice</code> type. You can configure the snapshotter type in use editing the <a href="machineregistration-reference.html#_config_elemental_install_snapshotter" class="xref page">MachineRegistration</a>. Since the state partition is also used for the <a href="https://rancher.github.io/elemental-toolkit">SUSE® Rancher Prime: OS Manager Toolkit</a> work directory, it&#8217;s best to leave an additional <code>$image_size</code> worth of free space, so that the image can be unpacked correctly for example when running upgrades.</p>
</div>
<div class="paragraph">
<p>Lastly, an extra <code>$image_size</code> free space can be used as a safe margin to keep. This is especially important when using the <code>loopdevice</code> snapshotter type, in case newer images will grow in size from the originally installed one. On the contrary, the <code>btrfs</code> snapshotter can be used instead to save space on the <code>state</code> partition, or to use the same space to keep more snapshots.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_finding_suse_rancher_prime_os_manager_base_images"><a class="anchor" href="#_finding_suse_rancher_prime_os_manager_base_images"></a>Finding SUSE® Rancher Prime: OS Manager base images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using crane we can find the following SL-Micro images suitable for extending:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ crane catalog registry.suse.com | grep -i "suse/sl-micro"
suse/sl-micro/6.0/baremetal-iso-image
suse/sl-micro/6.0/baremetal-os-container
suse/sl-micro/6.0/base-iso-image
suse/sl-micro/6.0/base-os-container
suse/sl-micro/6.0/kvm-iso-image
suse/sl-micro/6.0/kvm-os-container
suse/sl-micro/6.0/rt-iso-image
suse/sl-micro/6.0/rt-os-container
suse/sl-micro/6.1/baremetal-iso-image
suse/sl-micro/6.1/baremetal-os-container
suse/sl-micro/6.1/base-iso-image
suse/sl-micro/6.1/base-os-container
suse/sl-micro/6.1/kvm-iso-image
suse/sl-micro/6.1/kvm-os-container
suse/sl-micro/6.1/rt-iso-image
suse/sl-micro/6.1/rt-os-container</code></pre>
</div>
</div>
<div class="paragraph">
<p>The images with the <code>-iso-image</code> suffix contain a pre-built ISO image and a busybox system to be able to copy the contents to a volume. Images with an <code>-os-container</code> suffix contain a root filesystem that can be used as the base for custom images.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="networking-static.html">Static Configuration</a></span>
  <span class="next"><a href="unmanaged-os.html">Register an Unmanaged OS</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
