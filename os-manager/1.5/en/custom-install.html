<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Customize SUSE® Rancher Prime: OS Manager Installation :: Rancher product documentation</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/os-manager/1.6/en/custom-install.html">
    <link rel="prev" href="installation.html">
    <link rel="next" href="hostname.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-07-03"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><!-- Canonical link -->
<link href="https://documentation.suse.com/cloudnative/os-manager/1.6/en/custom-install.html" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/os-manager/1.5/en/custom-install.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/os-manager/1.5/en/custom-install.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="os-manager" data-version="1.5">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">OS Manager</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Quickstarts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart-ui.html">SUSE® Rancher Prime: OS Manager the visual way</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart-cli.html">SUSE® Rancher Prime: OS Manager the command line way</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Rancher OS Management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="architecture.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="architecture-components.html">SUSE® Rancher Prime: OS Manager Components</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="custom-resources.html">Custom Resources</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="architecture-services.html">Services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="architecture-machineonboarding.html">Machine onboarding</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="architecture-clusterdeployment.html">Kubernetes cluster provisioning</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="authentication.html">Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plans.html">Plans</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade-lifecycle.html">Upgrade lifecycle</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation.html">Installation</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="custom-install.html">Customize installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hostname.html">Customize hostname</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="networking-vlans.html">Configure VLANs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="wifi.html">Configure WiFi</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ntp.html">Configure NTP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="removable-device-cloudconfig.html">Include cloud-config from removable devices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="custom-certificate.html">Add custom certificates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Node operational tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade.html">Upgrade</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reset.html">Machine reset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="behind-proxy.html">Behind a proxy configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rancher-vmware.html">Using Elemental with Rancher and VMware</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Operator operational tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="backup.html">Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="restore.html">Restore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="airgap.html">Airgap install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <a class="nav-link" href="networking.html">Networking</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="networking-vlans.html">Configure a VLAN</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="wifi.html">Configure Wi-Fi</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="custom-images.html">Build Custom OS Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="unmanaged-os.html">Register an Unmanaged OS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tpm.html"> Trusted Platform Module (TPM)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-support.html">Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-restore.html">Restore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-upgrade.html">Upgrade</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-rancher-upgrades.html">Rancher upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-reset.html">Reset</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud-config-reference.html">Cloud-config</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineregistration-reference.html">MachineRegistration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineinventory-reference.html">MachineInventory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineinventoryselector-reference.html">MachineInventorySelector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="machineinventoryselectortemplate-reference.html">MachineInventorySelectorTemplate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managedosimage-reference.html">ManagedOSImage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managedosversionchannel-reference.html">ManagedOSVersionChannel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managedosversion-reference.html">ManagedOSVersion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="seedimage-reference.html">SeedImage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cluster-reference.html">Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="operatorchart-reference.html">SUSE® Rancher Prime: OS Manager Operator Helm chart</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kubernetesversions.html">Kubernetes versions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="smbios.html">Smbios</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hardwarelabels.html">Hardware labels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="inventory-management.html">Inventory management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="release-notes.html">Release notes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OS Manager</span>
    <span class="version">1.5</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../admission-controller/1.29/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../admission-controller/1.30/en/introduction.html">1.30-next</a>
            </li>
            <li class="version is-latest">
              <a href="../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.27/en/introduction.html">1.27</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.26/en/introduction.html">1.26</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.25/en/introduction.html">1.25</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../cluster-api/latest/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../cluster-api/latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../continuous-delivery/v0.12/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../next/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../next/en/index.html">Next</a>
            </li>
            <li class="version">
              <a href="../../latest/en/index.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../1.6/en/index.html">1.6</a>
            </li>
            <li class="version is-current">
              <a href="index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-manager/latest/en/about-rancher/what-is-rancher.html">latest</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../storage/latest/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../storage/latest/en/longhorn-documentation.html">Latest</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.10/en/longhorn-documentation.html">1.10 (Dev)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.9/en/longhorn-documentation.html">1.9 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../virtualization/v1.5/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../virtualization/v1.5/en/introduction/overview.html">v1.5 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.4/en/introduction/overview.html">v1.4</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.3/en/introduction/overview.html">v1.3</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/os-manager" title="OS Manager" aria-label="SUSE Documentation - OS Manager">
        OS Manager
      </a>
    </li>
      <li>
          Installation
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.5</button>
  <div class="version-menu">
    <a class="version is-missing" href="../../next/en/index.html">Next</a>
    <a class="version is-missing" href="../../latest/en/index.html">Latest</a>
    <a class="version is-missing" href="../../1.7/en/index.html">1.7</a>
    <a class="version" href="../../1.6/en/custom-install.html">1.6</a>
    <a class="version is-current" href="custom-install.html">1.5</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/elemental-product-docs/edit/main/docs/1.5/modules/en/pages/custom-install.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:os-manager" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Customize SUSE® Rancher Prime: OS Manager Installation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>SUSE® Rancher Prime: OS Manager installed OS images can be customized in different ways.</p>
</div>
<div class="paragraph">
<p>One option is to remaster container OS images by simply using a docker build.
SLE Micro images are regular container images, so it is absolutely possible to create
a new image using a Dockerfile based on SLE Micro. See <a href="custom-images.html" class="xref page">Build Custom OS Images</a>
section for further details on that possibility.</p>
</div>
<div class="paragraph">
<p>Alternatively, it is also possible to provide additional resources within the installation
media so that during installation, or eventually at boot time, additional binaries such as
drivers or extra configuration files can be included.</p>
</div>
<div class="paragraph">
<p>This section focuses on how to customize the installation process from a given OS image.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customize_installation_iso_and_installation_process"><a class="anchor" href="#_customize_installation_iso_and_installation_process"></a>Customize installation ISO and installation process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to adapt the installation ISO a simple approach is to append extra configuration
files into the ISO root in an analog way the registration yaml configuration file
is added.</p>
</div>
<div class="sect2">
<h3 id="_common_customization_pattern"><a class="anchor" href="#_common_customization_pattern"></a>Common customization pattern</h3>
<div class="paragraph">
<p>SUSE® Rancher Prime: OS Manager installation can be customized in three different non-exclusive ways. First, including
some custom SUSE® Rancher Prime: OS Manager client configuration file, second, by including additional cloud-init files to execute at
boot time, and finally, by including  <code>cloud-init</code> files such as installation hooks or boot stages evaluated during
the live system boot itself.</p>
</div>
<div class="paragraph">
<p>A common pattern is to combine the three ways described above. This pattern will allow you to add custom steps during the installation and add <code>cloud-init</code> files to be evaluated at boot time.</p>
</div>
<div class="paragraph">
<p>Additional config files can be added dynamically boot time by generating the ISO via a <a href="seedimage-reference.html" class="xref page">SeedImage</a> including custom cloud-config data.</p>
</div>
<div class="paragraph">
<p>To apply this pattern, the following files need to be included in the ISO or generated at boot time:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <a href="https://rancher.github.io/elemental-toolkit/docs/customizing/general_configuration/">configuration file</a>
for the elemental client. The file must be named <code>config.yaml</code> and located by default in <code>/etc/elemental</code>.
This path can be configured as part of the installation parameters of a <a href="machineregistration-reference.html" class="xref page">MachineRegistration</a> resource.</p>
</li>
<li>
<p>The additional <code>cloud-init</code> files to be included into the installed system. They
allow to perform custom operations at boot time.</p>
</li>
<li>
<p>The installation hooks are evalutated at install time. They allow to perform custom operations
during the installation process (include extra software, set additional disks&#8230;&#8203;). The same
way <code>cloud-init</code> files can be included to perform custom operations during the live installation
media boot time.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_custom_suse_rancher_prime_os_manager_client_configuration_file"><a class="anchor" href="#_custom_suse_rancher_prime_os_manager_client_configuration_file"></a>Custom SUSE® Rancher Prime: OS Manager client configuration file</h4>
<div class="paragraph">
<p><a href="https://github.com/rancher/elemental-toolkit/blob/main/docs/elemental.md">SUSE® Rancher Prime: OS Manager client</a> <code>install</code>, <code>upgrade</code> and <code>reset</code> commands can be configured with a <a href="https://rancher.github.io/elemental-toolkit/docs/customizing/general_configuration/">custom configuration file</a> located by default in <code>/etc/elemental/config.yaml</code>.
If you have multiple yaml files, you need to add them in the <code>/etc/elemental/config.d</code> directory.</p>
</div>
<div class="paragraph">
<p>A simple example to set hooks location could be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">extra-partitions:
  - size: 10240
    fs: ext4
    label: EXTRA_PARTITION</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example sets an additional extra partition during the installation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_additional_cloud_init_files_within_the_installed_os"><a class="anchor" href="#_adding_additional_cloud_init_files_within_the_installed_os"></a>Adding additional cloud-init files within the installed OS</h4>
<div class="paragraph">
<p>In order to include additional cloud-init files during the installation they need
to be added to the installation data into the MachineRegistration resource. More specific
the <code>config-urls</code> field is used for this exact purpose. See <a href="machineregistration-reference.html" class="xref page">MachineRegistration reference</a> page.</p>
</div>
<div class="paragraph">
<p><code>config-urls</code> is a list of string literals where each item is an HTTP URL or a local path pointing to a
cloud-init file. The local path is evaluated during
the installation, hence it must exists within the installation media, commonly an ISO image.</p>
</div>
<div class="paragraph">
<p>By default, SUSE® Rancher Prime: OS Manager live systems mount the ISO root at <code>/run/initramfs/live</code> which is also the default path set for <code>config-url</code> in <code>MachineRegistrations</code>:
See the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: elemental.cattle.io/v1beta1
kind: MachineRegistration
metadata:
  name: my-nodes
  namespace: fleet-default
spec:
  ...
  config:
    ...
    elemental:
      ...
      install:
        ...
        config-urls:
        - "/run/initramfs/live/oem/custom_config.yaml"</code></pre>
</div>
</div>
<div class="paragraph">
<p>SUSE® Rancher Prime: OS Manager live ISOs, when booted, have the ISO root mounted at <code>/run/initramfs/live</code>.
According to that, the ISO for the example above is expected to include the <code>/oem/custom_config.yaml</code> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>/run/initramfs/live</code> is a readonly mountpoint and it&#8217;s not an appropriate path for dynamically generated content at ISO boot.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_adding_installation_hooks_or_boot_stages_for_the_live_system"><a class="anchor" href="#_adding_installation_hooks_or_boot_stages_for_the_live_system"></a>Adding installation hooks or boot stages for the live system</h4>
<div class="paragraph">
<p>[SUSE® Rancher Prime: OS Manager client](<a href="https://github.com/rancher/elemental-cli" class="bare">https://github.com/rancher/elemental-cli</a>) <code>install</code>, <code>upgrade</code> and <code>reset</code> procedures include four different hooks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>before-install</code>: executed after all partition mountpoints are set.</p>
</li>
<li>
<p><code>after-install-chroot</code>: executed after deploying the OS image and before unmounting the associated loop filesystem image. Runs chrooted to the OS image.</p>
</li>
<li>
<p><code>after-install</code>: executed just after the after-install-chroot hook. It is not chrooted.</p>
</li>
<li>
<p><code>post-install</code>: executed as the very last step before ending the installation, partitions are still mounted, the loop devices for the image is not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hooks are provided as <code>cloud-init</code> stages. Equivalent hooks exist for <code>reset</code> and <code>upgrade</code> procedures.
They are loaded from the <code>/iso-config</code> folder in ISO filesystem root. In fact, hooks are regular <code>cloud-init</code> stages with the
only difference that SUSE® Rancher Prime: OS Manager client parses them during <code>install</code>, <code>upgrade</code> or <code>reset</code> actions, rather than boot time.
Note any boot stage included this way will be executed during the live installation media boot.</p>
</div>
<div class="paragraph">
<p>Hooks are evaluated during <code>install</code>,<code>reset</code> and <code>upgrade</code> action from <code>/oem</code>, <code>/system/oem</code> and <code>/usr/local/cloud-config</code> paths,
however for the live ISOs there is an additional the path <code>/run/initramfs/live/iso-config</code> included. Note the <code>/run/initramfs/live</code>
prefix is the mount point of the ISO filesystem of the SUSE® Rancher Prime: OS Manager Live ISO once booted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_extra_driver_binaries_into_the_iso_example"><a class="anchor" href="#_adding_extra_driver_binaries_into_the_iso_example"></a>Adding extra driver binaries into the ISO example</h3>
<div class="paragraph">
<p>This example is covering the case in which extra driver binaries are included into the ISO
and during the installation they are installed over the OS image.</p>
</div>
<div class="paragraph">
<p>For that use case the following files are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>additional binaries to install (they could be in the form of RPMs)</p>
</li>
<li>
<p>additional hooks file to copy binaries into the persistent storage and to install them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s create an <code>overlay</code> directory to create the directory tree that needs to be
added into the ISO root. In that case the <code>overlay</code> directory could contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">overlay/
  data/
    extra_drivers/
      some_driver.rpm
  iso-config/
    install_hooks.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>overlay/iso-config/install_hooks.yaml</code> could be as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">name: "Install extra drivers"
stages:
  before-install:
    # Preload data to the persistent storage
    # During installation persistent partition is mounted at /run/cos/persistent
    - commands:
        - rsync -a /run/initramfs/live/data/ /run/cos/persistent
  after-install-chroot:
    # extra_drivers folder is at `/usr/local/extra_drivers` from the OS image chroot
    - commands:
      - rpm -iv /usr/local/extra_drivers/some_driver.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the installation hooks only cover installation procedures, for upgrades equivalent
<code>before-upgrade</code> and/or <code>after-upgrade-chroot</code> should be defined.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_extra_lvm_volume_group_disks_during_the_installation"><a class="anchor" href="#_adding_extra_lvm_volume_group_disks_during_the_installation"></a>Adding extra LVM volume group disks during the installation</h3>
<div class="paragraph">
<p>This example is covering the setup of an host with multiple disks and some of them used
as part of an LVM setup.</p>
</div>
<div class="paragraph">
<p>As an example, we have an host with three disks (<code>/dev/sda</code>, <code>/dev/sdb</code>
and <code>/dev/sdc</code>).</p>
</div>
<div class="paragraph">
<p>The first disk is used for a regular SUSE® Rancher Prime: OS Manager installation
and the other remaining two are used as part of a LVM group where arbitrary logical volumes
are created, formatted and mounted at boot time via an extended <code>fstab</code> file.</p>
</div>
<div class="paragraph">
<p>For this example, the following files are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>additional <code>clout-init</code> files included in the installed system</p>
</li>
<li>
<p>additional installation hooks to prepare the LVM volumes during the installation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s create an <code>overlay</code> directory to create the directory tree that needs to be
added into the ISO root. In that case the <code>overlay</code> directory could contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">overlay/
  oem/
    lvm_volumes_in_fstab.yaml
  iso-config/
    lvm_volumes_hook.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The installation hook <code>overlay/iso-config/lvm_volumes_hook.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">name: "Create LVM logic volumes over some physical disks"
stages:
  post-install:
    - name: "Create physical volume, volume group and logical volumes"
      if: '[ -e "/dev/sdb" ] &amp;&amp; [ -e "/dev/sdc" ]'
      commands:
      - |
        # Create the physical volume, volume group and logical volumes
        pvcreate /dev/sdb /dev/sdc
        vgcreate elementalLVM /dev/sdb /dev/sdc
        lvcreate -L 8G -n elementalVol1 elementalLVM
        lvcreate -l 100%FREE -n elementalVol2 elementalLVM

    # Trigger udev detection
    if [ ! -e "/dev/elementalLVM/elementalVol1" ] || [ ! -e "/dev/elementalLVM/elementalVol2" ]; then
      sleep 10
      udevadm settle
    fi

    # Ensure devices are already available
    [ -e "/dev/elementalLVM/elementalVol1" ] || exit 1
    [ -e "/dev/elementalLVM/elementalVol2" ] || exit 1

    # Format logical volumes with a known label for later use in fstab
    mkfs.xfs -L eVol1 /dev/elementalLVM/elementalVol1
    mkfs.xfs -L eVol2 /dev/elementalLVM/elementalVol2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The LVM devices are created and formatted as desired. This is a good
example of an installation hook, as this setup is only needed once, at installation
time. As an alternative, the same action could be done on first boot, however it would
require a more sophisticated logic to ensure it&#8217;s only applied once at first boot.</p>
</div>
<div class="paragraph">
<p>Finally, the boot time <code>cloud-init</code> files contain the mount points settings and trigger the
action of mounting those mountpoints. The SUSE® Rancher Prime: OS Manager OS <code>fstab</code> file is ephemeral and it&#8217;s
dynamically created at boot time. That&#8217;s why it doesn&#8217;t exist during the installation and
can&#8217;t be used in an installation hook.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of <code>overlay/oem/lvm_volumes_in_fstab.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">name: "Mount LVM volumes"
stages:
  initramfs:
    - name: "Extend fstab to mount LVM logical volumes at boot"
      commands:
      - |
        echo "LABEL=eVol1 /usr/local/eVol1  xfs defaults  0 0" &gt;&gt; /etc/fstab
        echo "LABEL=eVol2 /usr/local/eVol2  xfs defaults  0 0" &gt;&gt; /etc/fstab</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>initramfs</code> stage is the last stage before switching to the actual root tree.
At this stage, the <code>/etc/fstab</code> file already exists and can be adapted before
switching root. Once running in the final root tree, SystemD will handle the rest of the initialization and apply it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This cloud-init file should be included into the <code>/oem</code> directory on the installed
system. <code>/oem</code> is a mount point for the OEM partition. In order to include extra files,
they should be listed as <code>config-urls</code> within the Registration CRD at the
management cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_repacking_the_iso_image_with_extra_files"><a class="anchor" href="#_repacking_the_iso_image_with_extra_files"></a>Repacking the ISO image with extra files</h3>
<div class="paragraph">
<p>Assuming an <code>overlay</code> folder was created in the current directory containing all
additional files to be appended, the following <code>xorriso</code> command adds the extra files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">xorriso -indev elemental.x86_64.iso -outdev elemental.custom.x86_64.iso -map overlay / -boot_image any replay</code></pre>
</div>
</div>
<div class="paragraph">
<p>For that a <code>xorriso</code> equal or higher than version 1.5 is required.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="installation.html">Installation</a></span>
  <span class="next"><a href="hostname.html">Customize hostname</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
