<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<title>Architecture | SUSE® Virtual Clusters  v1.0.0</title>
    <link rel="canonical" href="https://documentation.suse.com/cloudnative/suse-virtual-clusters/v1.0.1/en/architecture.html">
    <link rel="prev" href="quickstart.html">
    <link rel="next" href="advanced-usage.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-11-07"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>
<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.10/assets");
</script>
<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/suse-virtual-clusters/v1.0.0/en/architecture.html" hreflang="x-default" rel="alternate"/>
<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/suse-virtual-clusters/v1.0.0/en/architecture.html" hrefLang="en-US" rel="alternate" />

<!-- JSON-LD for doc metadata -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "name": "Architecture | SUSE Virtual Clusters v1.0.0",
  "headline": "Architecture",
  "description": "Architecture",
  "inLanguage": "en",
  "dateModified": "2025-11-07T00:00:00Z",
  "author": {
    "@type": "Organization",
    "name": "SUSE Product & Solution Documentation Team",
    "url": "https://documentation.suse.com"
  },
  "mentions": [
    {
      "@type": "SoftwareApplication",
      "name": "SUSE Virtual Clusters",
      "softwareVersion": "v1.0.0",
      "applicationCategory": "Cloud Infrastructure",
      "operatingSystem": "Linux"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "SUSE",
    "url": "https://documentation.suse.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
    }
  }
}
</script>
<!-- end JSON-LD for doc metadata -->
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><shared-header
language="en"
languages='{
    "en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
    "de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
    "fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
    "es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
    "zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
    "pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'
enable-search='false'>
</shared-header>

<!-- Leaving as a comment, I expect it will be required again next year.
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a>
--><div class="body">
<div class="nav-container" data-component="suse-virtual-clusters" data-version="v1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Virtual Clusters</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quickstart.html">Quick Start</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanced-usage.html">Advanced Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="virtualclusterpolicy.html">VirtualClusterPolicy: Concepts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-tos for User</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/create-virtual-clusters.html">Creating a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/expose-workloads.html">Exposing workloads outside a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/addons.html">Addons</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-tos for Admin</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-admin/choose-mode.html">Choosing between Shared and Virtual Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-admin/adding-custom-cert.html">Adding custom certificates for K3s from K3k cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/crds.html">Customer Resource Definitions (CRDs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/k3kcli.html">k3kcli</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="how-tos-for-user/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Virtual Clusters</span>
    <span class="version">v1.0.0</span>
  </div>
  <ul class="components">
        <li class="component">
          <div class="title"><a href="../../../admission-controller/1.31/en/introduction.html">Admission Controller</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../admission-controller/1.32/en/introduction.html">1.32-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../admission-controller/1.31/en/introduction.html">1.31-latest</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.30/en/introduction.html">1.30</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.29/en/introduction.html">1.29</a>
            </li>
            <li class="version">
              <a href="../../../admission-controller/1.28/en/introduction.html">1.28</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../cluster-api/v0.25/en/index.html">Cluster API</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../cluster-api/v0.25/en/index.html">0.25</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.24/en/index.html">0.24</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.23/en/index.html">0.23</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.22/en/index.html">0.22</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.21/en/index.html">0.21</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.20/en/index.html">0.20</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.19/en/index.html">0.19</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.18/en/index.html">0.18</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.17/en/index.html">0.17</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.16/en/index.html">0.16</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.15/en/index.html">0.15</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../cluster-api/v0.11/en/index.html">0.11</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../continuous-delivery/v0.14/en/index.html">Continuous Delivery</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../continuous-delivery/v0.14/en/index.html">0.14</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.13/en/index.html">0.13</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.12/en/index.html">0.12</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.11/en/index.html">0.11</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.10/en/index.html">0.10</a>
            </li>
            <li class="version">
              <a href="../../../continuous-delivery/v0.9/en/index.html">0.9</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../k3s/latest/en/introduction.html">K3s</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../k3s/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../os-manager/1.8/en/index.html">OS Manager</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../os-manager/1.9/en/index.html">1.9-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../../os-manager/1.8/en/index.html">1.8</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.7/en/index.html">1.7</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.6/en/index.html">1.6</a>
            </li>
            <li class="version">
              <a href="../../../os-manager/1.5/en/index.html">1.5</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rke2/latest/en/introduction.html">RKE2</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rke2/latest/en/introduction.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../suse-observability/latest/en/classic.html">SUSE Observability</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../suse-observability/latest/en/classic.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">SUSE® Rancher for AWS</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-srfa/latest/en/about-rancher/what-is-rancher.html">Latest</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">SUSE® Rancher Manager</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../rancher-manager/v2.13/en/about-rancher/what-is-rancher.html">v2.13</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.12/en/about-rancher/what-is-rancher.html">v2.12</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.11/en/about-rancher/what-is-rancher.html">v2.11</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.10/en/about-rancher/what-is-rancher.html">v2.10</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.9/en/about-rancher/what-is-rancher.html">v2.9</a>
            </li>
            <li class="version">
              <a href="../../../rancher-manager/v2.8/en/about-rancher/what-is-rancher.html">v2.8</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../security/5.4/en/overview.html">SUSE® Security</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../../security/5.4/en/overview.html">5.4</a>
            </li>
            <li class="version">
              <a href="../../../security/5.3/en/overview.html">5.3</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../storage/1.10/en/longhorn-documentation.html">SUSE® Storage</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../storage/1.11/en/longhorn-documentation.html">1.11 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../storage/1.10/en/longhorn-documentation.html">1.10 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.9/en/longhorn-documentation.html">1.9</a>
            </li>
            <li class="version">
              <a href="../../../storage/1.8/en/longhorn-documentation.html">1.8</a>
            </li>
          </ul>
        </li>
        <li class="component is-current">
          <div class="title"><a href="../../v1.0.1/en/introduction.html">SUSE® Virtual Clusters</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../1.0.2/en/introduction.html">1.0.2-dev</a>
            </li>
            <li class="version is-latest">
              <a href="../../v1.0.1/en/introduction.html">v1.0.1-latest</a>
            </li>
            <li class="version is-current">
              <a href="introduction.html">v1.0.0</a>
            </li>
          </ul>
        </li>
        <li class="component">
          <div class="title"><a href="../../../virtualization/v1.6/en/introduction/overview.html">SUSE® Virtualization</a></div>
          <ul class="versions">
            <li class="version">
              <a href="../../../virtualization/v1.7/en/introduction/overview.html">v1.7 (Dev)</a>
            </li>
            <li class="version is-latest">
              <a href="../../../virtualization/v1.6/en/introduction/overview.html">v1.6 (Latest)</a>
            </li>
            <li class="version">
              <a href="../../../virtualization/v1.5/en/introduction/overview.html">v1.5</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a class="home-link-dsc" href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home"></a>
    </li>
    <li>
      <a href="https://documentation.suse.com/cloudnative/suse-virtual-clusters" title="SUSE Virtual Clusters" aria-label="SUSE Documentation - SUSE Virtual Clusters">
        SUSE Virtual Clusters
      </a>
    </li>
      <li>
          <a href="architecture.html" title="Architecture" aria-label="Architecture">Architecture</a>
      </li>
  </ul>
</nav><div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.0.0</button>
  <div class="version-menu">
    <a class="version" href="../../1.0.2/en/architecture.html">1.0.2-dev</a>
    <a class="version" href="../../v1.0.1/en/architecture.html">v1.0.1-latest</a>
    <a class="version is-current" href="architecture.html">v1.0.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/k3k-product-docs/edit/main/versions/v1.0.0/modules/en/pages/architecture.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:suse-virtual-clusters" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Architecture</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Virtual Clusters are isolated Kubernetes clusters provisioned on a physical cluster. K3k leverages <a href="https://k3s.io/">K3s</a> as the control plane of the Kubernetes cluster because of its lightweight footprint.</p>
</div>
<div class="paragraph">
<p>K3k provides two modes for deploying virtual clusters:
- Shared (default)
- Virtual</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shared_mode"><a class="anchor" href="#_shared_mode"></a>Shared Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default <strong>shared</strong> mode uses a K3s server as control plane with an <a href="https://docs.k3s.io/advanced#running-agentless-servers-experimental">agentless servers configuration</a>. With this option enabled, the servers do not run the kubelet, container runtime, or CNI. The server uses a <a href="https://virtual-kubelet.io/">Virtual Kubelet</a> provider implementation specific to K3k, which schedules the workloads and other eventually needed resources on the host cluster. This K3k Virtual Kubelet provider handles the reflection of resources and workload execution within the shared host cluster environment.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/shared-mode.png" alt="Shared Mode">
</div>
</div>
<div class="sect2">
<h3 id="_networking_and_storage"><a class="anchor" href="#_networking_and_storage"></a>Networking and Storage</h3>
<div class="paragraph">
<p>Because of this shared infrastructure, the CNI is the same as the one configured in the host cluster. The same goes for the available storage where the Storage Classes and Volumes are those of the host cluster.</p>
</div>
<div class="paragraph">
<p>To provide the needed isolation, K3k leverages Network Policies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_sharing_and_limits"><a class="anchor" href="#_resource_sharing_and_limits"></a>Resource Sharing and Limits</h3>
<div class="paragraph">
<p>In <strong>shared</strong> mode, K3k leverages Kubernetes 'ResourceQuotas' and 'LimitRanges' to manage resource sharing and enforce limits. Since all virtual cluster workloads run within the same namespace on the host cluster, ResourceQuotas are applied to this namespace to limit the total resources consumed by a virtual cluster. LimitRanges are used to set default resource requests and limits for pods, ensuring that workloads have reasonable resource allocations even if they do not explicitly specify them.</p>
</div>
<div class="paragraph">
<p>Each pod in a virtual cluster is assigned a unique name that incorporates the pod name, namespace and cluster name. This prevents naming collisions in the shared host cluster namespace.</p>
</div>
<div class="paragraph">
<p>It is important to understand that ResourceQuotas are applied at the namespace level. This means that all pods within a virtual cluster share the same quota. While this provides overall limits for the virtual cluster, it also means that resource allocation is dynamic. If one workload is not using its full resource allocation, other workloads within the <em>same</em> virtual cluster can utilize those resources, even if they belong to different deployments or services.</p>
</div>
<div class="paragraph">
<p>This dynamic sharing can be both a benefit and a challenge. It allows for efficient resource utilization, but it can also lead to unpredictable performance if workloads have varying resource demands. Furthermore, this approach makes it difficult to guarantee strict resource isolation between workloads within the same virtual cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
GPU resource sharing is an area of ongoing investigation. K3k is actively exploring potential solutions in this area.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_isolation_and_security"><a class="anchor" href="#_isolation_and_security"></a>Isolation and Security</h3>
<div class="paragraph">
<p>Isolation between virtual clusters in shared mode relies heavily on Kubernetes Network Policies. Network Policies define rules that control the network traffic allowed to and from pods. K3k configures Network Policies to ensure that pods in one virtual cluster cannot communicate with pods in other virtual clusters or with pods in the host cluster itself, providing a strong foundation for network isolation.</p>
</div>
<div class="paragraph">
<p>While Network Policies offer robust isolation capabilities, it is important to understand their characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CNI Integration:</strong> Network Policies integrate seamlessly with supported CNI plugins. K3k leverages this integration to enforce network isolation.</p>
</li>
<li>
<p><strong>Granular Control:</strong> Network Policies provide granular control over network traffic, allowing for fine-tuned security policies.</p>
</li>
<li>
<p><strong>Scalability:</strong> Network Policies scale well with the number of virtual clusters and applications, ensuring consistent isolation as the environment grows.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>K3k also utilizes Kubernetes Pod Security Admission (PSA) to enforce security policies within virtual clusters based on Pod Security Standards (PSS). PSS define different levels of security for pods, restricting what actions pods can perform. By configuring PSA to enforce a specific PSS level (for example, <code>baseline</code> or <code>restricted</code>) for a virtual cluster, K3k ensures that pods adhere to established security best practices and prevents them from using privileged features or performing potentially dangerous operations.</p>
</div>
<div class="paragraph">
<p>Key aspects of PSA integration include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Namespace-Level Enforcement:</strong> PSA configuration is applied at the namespace level, providing a consistent security posture for all pods within the virtual cluster.</p>
</li>
<li>
<p><strong>Standardized Profiles:</strong> PSS offers a set of predefined security profiles aligned with industry best practices, simplifying security configuration and ensuring a baseline level of security.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The shared mode architecture is designed with security in mind. K3k employs multiple layers of security controls, including Network Policies and PSA, to protect virtual clusters and the host cluster. While the shared namespace model requires careful configuration and management, these controls provide a robust security foundation for running workloads in a multi-tenant environment. K3k continuously evaluates and enhances its security mechanisms to address evolving threats and ensure the highest level of protection for its users.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_virtual_mode"><a class="anchor" href="#_virtual_mode"></a>Virtual Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>virtual</code> mode in K3k deploys fully functional K3s clusters (including both server and agent components) as virtual clusters. These K3s clusters run as pods within the host cluster. Each virtual cluster has its own dedicated K3s server and one or more K3s agents acting as worker nodes. This approach provides strong isolation, as each virtual cluster operates independently with its own control plane and worker nodes. While these virtual clusters run as pods on the host cluster, they function as complete and separate Kubernetes environments.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/virtual-mode.png" alt="Virtual Mode">
</div>
</div>
<div class="sect2">
<h3 id="_networking_and_storage_2"><a class="anchor" href="#_networking_and_storage_2"></a>Networking and Storage</h3>
<div class="paragraph">
<p>Virtual clusters in <code>virtual</code> mode each have their own independent networking configuration managed by their respective K3s servers. Each virtual cluster runs its own CNI plugin, configured within its K3s server, providing complete network isolation from other virtual clusters and the host cluster. While the virtual cluster networks ultimately operate on top of the host cluster&#8217;s network infrastructure, the networking configuration and traffic management are entirely separate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_sharing_and_limits_2"><a class="anchor" href="#_resource_sharing_and_limits_2"></a>Resource Sharing and Limits</h3>
<div class="paragraph">
<p>Resource sharing in <code>virtual</code> mode is managed by applying resource limits to the pods that make up the virtual cluster (both the K3s server pod and the K3s agent pods). Each pod is assigned a specific amount of CPU, memory, and other resources. The workloads running <em>within</em> the virtual cluster then utilize these allocated resources. This means that the virtual cluster as a whole has a defined resource pool determined by the limits on its constituent pods.</p>
</div>
<div class="paragraph">
<p>This approach provides a clear and direct way to control the resources available to each virtual cluster. However, it requires careful resource planning to ensure that each virtual cluster has sufficient capacity for its workloads.</p>
</div>
</div>
<div class="sect2">
<h3 id="_isolation_and_security_2"><a class="anchor" href="#_isolation_and_security_2"></a>Isolation and Security</h3>
<div class="paragraph">
<p>The <code>virtual</code> mode offers strong isolation due to the dedicated K3s clusters deployed for each virtual cluster. Because each virtual cluster runs its own separate control plane and worker nodes, workloads are effectively isolated from each other and from the host cluster. This architecture minimizes the risk of one virtual cluster impacting others or the host cluster.</p>
</div>
<div class="paragraph">
<p>Security in <code>virtual</code> mode benefits from the inherent isolation provided by the separate K3s clusters. However, standard Kubernetes security best practices still apply, and K3k emphasizes a layered security approach. While the K3s server pods often run with elevated privileges (due to the nature of their function, requiring access to system resources), K3k recommends minimizing these privileges whenever possible and adhering to the principle of least privilege. This can be achieved by carefully configuring the necessary capabilities instead of relying on full <code>privileged</code> mode. Further information on K3s security best practices can be found in the official K3s documentation: <a href="https://docs.k3s.io/security" class="bare">https://docs.k3s.io/security</a> (This link provides general security guidance, including discussions of capabilities and other relevant topics).</p>
</div>
<div class="paragraph">
<p>Currently, security in virtual  mode has a risk of privilege escalation as the server pods run with elevated privileges due to the nature of their function, requiring access to system resources.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_k3k_components"><a class="anchor" href="#_k3k_components"></a>K3k Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3k consists of two main components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Controller:</strong> The K3k controller is a core component that runs on the host cluster. It watches for <code>Cluster</code> custom resources (CRs) and manages the lifecycle of virtual clusters. When a new <code>Cluster</code> CR is created, the controller provisions the necessary resources, including namespaces, K3s server and agent pods, and network configurations, to create the virtual cluster.</p>
</li>
<li>
<p><strong>CLI:</strong> The K3k CLI provides a command-line interface for interacting with K3k. It allows users to easily create, manage, and access virtual clusters. The CLI simplifies common tasks such as creating <code>Cluster</code> CRs, retrieving kubeconfigs for accessing virtual clusters, and performing other management operations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_virtualclusterpolicy"><a class="anchor" href="#_virtualclusterpolicy"></a>VirtualClusterPolicy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3k introduces the VirtualClusterPolicy Custom Resource, a way to set up and apply common configurations and how your virtual clusters operate within the K3k environment.</p>
</div>
<div class="paragraph">
<p>The primary goal of VCPs is to allow administrators to centrally manage and apply consistent policies. This reduces repetitive configuration, helps meet organizational standards, and enhances the security and operational consistency of virtual clusters managed by K3k.</p>
</div>
<div class="paragraph">
<p>A VirtualClusterPolicy is bound to one or more Kubernetes Namespaces. Once bound, the rules defined in the VCP apply to all K3k virtual clusters that are running or get created in that Namespace. This allows for flexible policy application, meaning different Namespaces can use their own unique VCPs, while others can share a single VCP for a consistent setup.</p>
</div>
<div class="paragraph">
<p>Common use cases for administrators leveraging VirtualClusterPolicy include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defining the operational mode (like "shared" or "virtual") for virtual clusters.</p>
</li>
<li>
<p>Setting up resource quotas and limit ranges to effectively manage how much resources virtual clusters and their workloads can use.</p>
</li>
<li>
<p>Enforcing security standards, for example, by configuring Pod Security Admission (PSA) labels for Namespaces.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The K3k controller actively monitors VirtualClusterPolicy resources and the corresponding Namespace bindings. When a VCP is applied or updated, the controller ensures that the defined configurations are enforced on the relevant virtual clusters and their associated resources within the targeted Namespaces.</p>
</div>
<div class="paragraph">
<p>For a deep dive into what VirtualClusterPolicy can do, along with more examples, check out the <a href="virtualclusterpolicy.html" class="xref page">VirtualClusterPolicy Concepts</a> page. For a full list of all the spec fields, see the <a href="./crds/crd-docs.adoc#virtualclusterpolicy">API Reference for VirtualClusterPolicy</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comparison_and_trade_offs"><a class="anchor" href="#_comparison_and_trade_offs"></a>Comparison and Trade-offs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>K3k offers two distinct modes for deploying virtual clusters: <code>shared</code> and <code>virtual</code>. Each mode has its own strengths and weaknesses, and the best choice depends on the specific needs and priorities of the user. Here&#8217;s a comparison to help you make an informed decision:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Shared Mode</th>
<th class="tableblock halign-left valign-top">Virtual Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Architecture</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Agentless K3s server with Virtual Kubelet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full K3s cluster (server and agents) as pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Isolation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Policies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dedicated control plane and worker nodes as pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource Sharing</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic, namespace-level ResourceQuotas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource limits on virtual cluster pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Networking</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host cluster&#8217;s CNI
+
Host cluster&#8217;s Ingress Controller (option)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual cluster&#8217;s own CNI
+
Virtual cluster&#8217;s own Ingress Controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Storage</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host cluster&#8217;s storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bring your own storage provider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Security</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pod Security Admission (PSA), Network Policies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inherent isolation, PSA, Network Policies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Performance</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smaller footprint, more efficient due to running directly on the host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Higher overhead due to running full K3s clusters</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Trade-offs:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Isolation vs. Overhead:</strong> The <code>shared</code> mode has lower overhead but weaker isolation, while the <code>virtual</code> mode provides stronger isolation but potentially higher overhead due to running full K3s clusters.</p>
</li>
<li>
<p><strong>Resource Sharing:</strong> The <code>shared</code> mode offers dynamic resource sharing within a namespace, which can be efficient but less predictable. The <code>virtual</code> mode provides dedicated resources to each virtual cluster, offering more control but requiring careful planning.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on how to choose the right mode, see <a href="how-tos-for-admin/choose-mode.html" class="xref page">Choose Mode</a>.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="quickstart.html">Quick Start</a></span>
  <span class="next"><a href="advanced-usage.html">Advanced Usage</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
